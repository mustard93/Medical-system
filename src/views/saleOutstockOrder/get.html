<div ng-controller="saleOutstockOrderController"
     class="woutstock-order"
     ajax-url="rest/authen/wOutstockOrder/get.json?id={{mainStatus.pageParams.id}}&orderNo={{mainStatus.pageParams.orderNo}}"
     scope-data="showData"
     callback="initFlag=true;formData={};formData.wOutstockOrderId=showData.id;formData.id=showData.medicalStockId;addAreaisShow=false;"
     alert-error>
     <!-- 头部信息 -->
    <div class="relative">
     <div class="content-wrapper-heading pdb-m mgb-l relative clearfix">
       <p class="pdb-s pdt-s crumbs pd-c-xl">库存管理 >
         <a href="#/confirmOrder/query.html">
            <em class="color-custom-orange">销售单</em>
         </a>
        <em>>销售出库单详情</em>
       </p>
       <!-- 标题 -->
       <div class="pd-c-v-l">
         <div class="pos-rel-tl inline-block fl-l">
           <h1 class="pr-font-20 color-black">销售出库单详情</h1>
         </div>
       </div>
     </div>
   </div>
     <!-- 主内容区域 -->
     <div class="content-wrapper">
       <p class="mgb-l text-n color-3 text-bold">客户：{{showData.customerName}}</p>
       <p class="mgb-l text-n color-3 text-bold">{{showData.warehouseName}}</p>
       <div class="panel pr-panel pr-fuzzy-boundary pr-panel-height mgb-l pd-n">

         <div class="flex-column color-9 pd-c-l pdt-m pdb-m ">
           <div class="flex-item-6">
             <span class="mgr">单据编号：<em class="color-3">{{showData.orderNo || '暂无'}}</em></span>
             <span class="mgr">部门：<em class="color-3">{{showData.departmentName|| '暂无'}}</em></span>
             <span class="mgr">出库类型：<em class="color-black">{{showData.orderBusinessType|| '暂无'}}</em></span>
           </div>
           <div class="flex-item-6 text-right">
             <span class="mgr">出库日期：<em class="color-3">{{showData.createAt || '暂无' | date : 'yyyy-MM-dd' }}</em></span>
             <!-- <span class="mgr">状态：<em class="color-black" ng-class="{'color-green':showData.orderStatus=='已通过'}">{{showData.orderStatus}}</em></span> -->
             <a ng-if="initFlag"
                modal-center="1000px"
                modal-data='{"businessKey":"{{showData.id}}"}'
                modal-scope="this"
                modal-url="views/workflowTask/getOfDialog.html">
                <span class="mgr">状态：<em class="color-3">{{showData.orderStatus}}</em></span>
             </a>
           </div>
         </div>

          <!-- 主内容头部 -->
          <div class="">
            <div class="outside-table-d">
              <table class="table pr-table pr-new-table table-s-wid" >    <!-- table-wid -->
                <thead class="pr-bg-side">
                  <tr>
                    <th class="text-center">商品编号</th>
                    <th class="text-center">商品代码</th>
                    <th class="text-left w-100">商品全名</th>
                    <th class="text-center">规格/型号</th>
                    <th class="text-center">单位</th>
                    <th class="text-center">出库数量</th>
                    <th class="text-center">差异数量</th>
                    <th class="text-center">其他数量</th>
                    <th class="text-center">含税单价</th>
                    <th class="text-center">含税金额</th>
                    <th class="text-center">税率</th>
                    <th class="text-center">生产批号</th>
                    <th class="text-center">灭菌批号</th>
                    <th class="text-center">生产日期</th>
                    <th class="text-center">保质期</th>
                    <th class="text-center">失效日期</th>
                    <th class="text-center">产品执行标准</th>
                    <th class="text-center">保存温度</th>
                    <th class="text-center">产地品牌</th>
                    <th class="text-center">产品注册证号</th>
                    <th class="text-center">注册证有效期</th>
                  </tr>
                </thead>
                <tbody class="pr-bg-white" >
                  <tr ng-repeat="tr in showData.inoutstockDetails" ng-init="orderMedicalNoIds.push(tr.relId)" ng-controller="SalesOrderDetailsController">
                    <td class="text-center">{{tr.code}}</td>
                    <td class="text-center">{{tr.goodsCode}}</td>
                    <td class="text-center"><div class="autocut-l" title="{{tr.medicalStockName}}">{{tr.name}}</div></td>
                    <td class="text-center">{{tr.specificationAndModelType}}</td>
                    <td class="text-center">{{tr.unit}}</td>
                    <td  class="text-right">{{tr.outgoingQuantity?tr.outgoingQuantity:"—"}}</td>
                    <td class="text-right">{{tr.differenceQuantity?tr.differenceQuantity:"—"}}</td>
                    <td class="text-right">{{tr.otherQuantity?tr.otherQuantity:"—"}}</td>
                    <td class="text-right">
                      ￥{{tr.price}}
                    </td>
                    <td class="text-right" >
                      ￥{{(tr.price*tr.quantity).toFixed(2)}}
                    </td>
                    <td class="text-right">
                    {{tr.taxRate}}%
                    </td>
                    <td class="text-center">{{tr.productionBatch}}</td>
                    <td class="text-center">{{tr.sterilizationBatchNumber}}</td>
                    <td class="text-center">{{tr.productionDate | date : 'yyyy-MM-dd'}}</td>
                    <td class="text-center">{{tr.guaranteePeriod | date : 'yyyy-MM-dd'}}</td>
                    <td class="text-center">{{tr.validTill | date : 'yyyy-MM-dd'}}</td>
                    <td class="text-center">{{tr.productStandard}}</td>
                    <td class="text-center">{{tr.storedTemperature}}</td>
                    <td class="text-center">{{tr.brand}}</td>
                    <td class="text-center">{{tr.drugAdministrationCode}}</td>
                    <td class="text-center">{{tr.drugAdministrationCodeGuaranteePeriod}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
      </div>

     <!-- 备注 -->
     <div class="panel pr-panel pr-fuzzy-boundary pr-panel-height mgt-l">
        <!-- 备注 -->
        <div class="note">
          <p>备注：{{showData.note}}</p>
        </div>
    </div>
  </div>
     <!-- 物流信息 -->
     <div class="pr-indent-20 bt-dashed-line">
       <h1 class="pd-v-m mgl-x-l">物流信息</h1>
       <div class="woutstock-order-express">
         <ul class="clearfix mgl-mxx-l">
           <li class="express-list" ng-repeat="item in showData.kuaidiSet">
             <div class="flex-column pd-v-s bb-line">
               <div class="flex-item-9 text-center" style="margin-top:3px;">{{item.createAt || '暂无' | date : 'yyyy-MM-dd HH:mm'}}</div>
               <div class="flex-item-3 text-right pdt-s relative">
                 <a express-btn-toggle class="origin-ele" href="javascript:;">
                   <em class="circle"></em>
                   <em class="circle"></em>
                   <em class="circle"></em>
                 </a>
                 <div class="edit-del-btn text-center z-index-l">
                   <p class="pdt-s pdb-s bb-dashed-line">
                     <a href="javascript:;" ng-click="editThisAreaInfo(item)">编辑</a>
                   </p>
                   <p class="pdt-s pdb-s">
                     <a href="javascript:;" class="color-red"
                        handle-this-click
                        dialog-title="确认删除?"
                        dialog-content="您确认删除这条购需单吗?"
                        dialog-template="dialog-confirm.html"
                        request-url="rest/authen/wOutstockOrder/kuaidi/delete?wOutstockOrderId={{showData.id}}&kuaidiId={{item.id}}"
                        callback="$root.utils.goOrRefreshHref()">删除</a>
                   </p>
                 </div>
               </div>
             </div>
             <div class="text-center pdt-m">
               <p class="">{{item.type}}</p>
               <p class="color-orange">
                 <a href="javascript:;"
                    modal-right="600"
                    modal-data='{"type":"{{item.type}}","nu":"{{item.nu}}","kuaidiSet":{{showData.kuaidiSet}}}'
                    modal-scope="this"
                    modal-url="views/kuaidi/query3.html">{{item.nu}}
                 </a>
               </p>
             </div>
           </li>
           <!-- 添加物流信息li -->
           <li class="express-info express-list" ng-show="addAreaisShow==true">
             <div class="mgt-s">
               <select ng-if="addAreaisShow" class="select pr-select"
                       ng-model="formData.type"
                       chosen
                       select-source="rest/baseData/queryForSelectOptionByType?type=快递类型">
              </select>
             </div>
             <div class="mgt-s">
               <input type="text" class="ipt" ng-model="formData.nu" />
             </div>
             <div class="flex-column mgt-s">
               <span class="flex-item-6"><a href="javascript:;" ng-click="addAreaisShow=false;">取消</a></span>
               <span class="flex-item-6"><a href="" ng-click="saveExpressInfo(formData);" class="btn btn-primary pr-btn-xxsm">保存</a></span>
             </div>
           </li>
           <!-- 添加按钮 -->
           <li class="add-btn express-list" ng-class="{'express-info-empty':(!showData.kuaidiSet.length), 'add-btn':showData.kuaidiSet.length}">
             <a href="" ng-click="addAreaisShow=true;formData.nu=''"><span class="fa fa-plus"></span></a>
           </li>
         </ul>
       </div>
     </div>
     <!-- 流程图 -->
     <business-flow-show business-key="{{showData.id}}" business-type="销售单"></business-flow-show>
     <!-- 功能按钮 -->
     <div class="handle-btn-area relative">
       <div class="btn-area">
         <!-- 页面自定义按钮 -->
         <a href="#/saleOutstockOrder/query.html">返回销售出库单列表</a>
         <!-- 工作流控制按钮 -->
         <span class="mgr-l"
               ng-if="showData.didateFilter.buttons.length>0"
               custom-menu-list
               custom-menu-arr="{{showData.didateFilter.buttons}}">
         </span>
       </div>
     </div>
</div>
