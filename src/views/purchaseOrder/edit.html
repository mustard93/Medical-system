<div class="create-new-order"
     ng-controller="salesOrderEditCtrl"
     ajax-url="rest/authen/purchaseOrder/getOfEdit.json?id={{mainStatus.pageParams.id}}"
     scope-data="formData"
     alert-error>

     <div class="content-wrapper create-new-order"
          ajax-url="rest/index/queryBasicdataForSelectOption?basicDataType=Basic_BatchRequirementStatus"
          scope-data="batchRequirementStatus"
          alert-error>
  <!-- 主内容头部 -->
  <div class="content-wrapper-heading mg-l">
    <!-- <h1 class="pr-title-color pr-font-24">{{!formData.id?'新建':'编辑'}}订单</h1> -->
    <h1 class="pr-title-color pr-font-24">新建采购单</h1>
  </div>
  <!-- 主内容区域 -->
  <form id="editForm"
        form-validator
        parameter-body
        action="rest/authen/purchaseOrder/save.json"
        alert-error
        alert-ok
        scope-error-msg="errorMsg"
        scope-data="formData"
        callback="submitFormAfter()">
  <div class="content-wrapper-main pr-bg-white pr-fuzzy-boundary">
    <!-- 订单类型 -->
    <div class="flex-column mgb-l pd-c-xl pdt-m pdb-m bb-line">
      <div class="flex-item-2">
        <select class="select pr-select" ng-model="formData.type" style="max-width:180px;">
          <option value="普通订单">普通订单</option>
          <option value="寄售订单">寄售订单</option>
        </select>
      </div>
      <div class="flex-item-10 text-right text-s color-6 mgt">
        <span class="mgr-xl">采购员：
          <select class="select pr-select" style="max-width:120px;">
            <option value="刘丽">刘丽</option>
          </select>
        </span>
        <span class="mgr-xl">审批人：暂无</span>
        <span class="mgr-xl">状态：未提交</span>
      </div>
    </div>
    <!-- 供货商信息 -->
    <div class="pd-c-xl pdb-l bb-line" >
      <h1 class="pdb-l">供货商信息</h1>
      <span class="relative">
        <label class="pr-label">{{statusInfo.isLoading}}</label>
        <div class="relative inline-block">
          <select ng-if="formData.createAt"
                  class="ipt pr-short-ipt"
                  data-placeholder="供货商类型"
                  chosen
                  chosen-ajax
                  ng-model="formData.customerId"
                  select-source="rest/authen/customerAddress/queryForSelectOption.json">
          </select>
        </div>
      </span>
      <span>
        <label class="pr-label mgr-l"></label>
        <input type="text" class="ipt pr-only-btline" placeholder="供货商名">
      </span>
    </div>
    <!-- 发货人信息 -->
    <div class="consignee-info pd-c-xl pdt-l pdb-l bb-line"
         ajax-if="{{formData.customerId}}"
         ajax-url="rest/authen/customerAddress/get.json?id={{formData.customerId}}&t={{reloadTime}}"
         scope-data="customerAddress"
         callback="customerAddressGetCallBack(formData,customerAddress)"
         ng-class="{'static': customerAddress.contacts}">
      <h1 class="color-6 text-n mgb-l">发货人信息</h1>
      <ul ng-if="formData.customerId">
        <li class="mgr-m mgb-m"  ng-repeat="item in customerAddress.contacts" ng-click="formData.contactsId=item.id">
          <p class="pdb">{{item.name}} </p>
          <p class="text-n color-6 mgb-s">{{item.prov}} {{item.city}} {{item.area}} {{item.address}} {{item.tel}}</p>
          <p><a href="javacript:;"  modal-right="600" modal-data='{"customerAddressId":"{{formData.customerId}}","contact":{{item}}}' modal-scope="this" modal-url="views/customerAddress/contact/edit.html">修改</a></p>
          <i class="consignee-default-label"  ng-if="customerAddress.defaultContactId==item.id">默认</i>
          <i class="consignee-choise-label"   ng-if="formData.contactsId==item.id"><em class="fa fa-check color-white"></em></i>
        </li>
        <span>
          <button class="pr-add-item-whitebg"
                  modal-right="700"
                  modal-data='{"customerAddressId":"{{formData.customerId}}","contact":{}}'
                  modal-scope="this"
                  modal-url="views/customerAddress/contact/edit.html"
                  ng-class="{'static':!customerAddress.contacts}">
            <i class="fa fa-plus"></i>
          </button>
        </span>
      </ul>
    </div>
    <!-- 采购方信息 -->
    <div class="pd-c-xl pdb-l bb-line" >
      <h1 class="pdb-l pdt-l">采购方信息</h1>
      <span><input type="text" class="ipt pr-only-btline" placeholder="采购方名称"></span>
    </div>
    <!-- 收货人信息 -->
    <div class="consignee-info pd-c-xl pdt-l pdb-l bb-line"
         ajax-if="{{formData.customerId}}"
         ajax-url="rest/authen/customerAddress/get.json?id={{formData.customerId}}&t={{reloadTime}}"
         scope-data="customerAddress"
         callback="customerAddressGetCallBack(formData,customerAddress)"
         ng-class="{'static': customerAddress.contacts}">
      <h1 class="color-6 text-n mgb-l">收货人信息</h1>
      <ul ng-if="formData.customerId">
        <li class="mgr-m mgb-m"  ng-repeat="item in customerAddress.contacts" ng-click="formData.contactsId=item.id">
          <p class="pdb">{{item.name}} </p>
          <p class="text-n color-6 mgb-s">{{item.prov}} {{item.city}} {{item.area}} {{item.address}} {{item.tel}}</p>
          <p><a href="javacript:;"  modal-right="600" modal-data='{"customerAddressId":"{{formData.customerId}}","contact":{{item}}}' modal-scope="this" modal-url="views/customerAddress/contact/edit.html">修改</a></p>
          <i class="consignee-default-label"  ng-if="customerAddress.defaultContactId==item.id">默认</i>
          <i class="consignee-choise-label"   ng-if="formData.contactsId==item.id"><em class="fa fa-check color-white"></em></i>
        </li>
        <span>
          <button class="pr-add-item-whitebg"
                  modal-right="700"
                  modal-data='{"customerAddressId":"{{formData.customerId}}","contact":{}}'
                  modal-scope="this"
                  modal-url="views/customerAddress/contact/edit.html"
                  ng-class="{'static':!customerAddress.contacts}">
            <i class="fa fa-plus"></i>
          </button>
        </span>
      </ul>
    </div>
    <!-- 付款物流信息 -->
    <div class="mgt-l pd-c-xl">
      <h1 class="pdb-l">付款及货运要求</h1>
      <div class="flex-column">
        <div class="flex-item-6">
          <select class="select pr-select pr-short-ipt mgr-l"><option value="付款方式">付款方式</option></select>
          <select class="select pr-select pr-short-ipt mgr-l"><option value="结算方式">结算方式</option></select>
          <select class="select pr-select pr-short-ipt"><option value="账期要求">账期要求</option></select>
        </div>
        <div class="flex-item-6">
          <select class="select pr-select pr-short-ipt mgr-l"><option value="运输方式">运输方式</option></select>
          <select class="select pr-select pr-short-ipt mgr-l"><option value="承运单位">承运单位</option></select>
          <select class="select pr-select pr-short-ipt"><option value="期望到货时间">期望到货时间</option></select>
        </div>
      </div>
    </div>
    <!-- 订单清单 -->
    <div class="order-details pd-c-xl bb-line">
      <h1 class="pdt-l color-6 text-n">购需清单</h1>
      <table class="mgt-l pr-table" style="width:100%;max-width:none;table-layout:auto;">
        <thead>
          <th>器械编号</th>
          <th class="pr-indent-20" style="min-width:120px">药械名称/生产厂家/规格</th>
          <th class="text-center">单位</th>
          <th class="text-center">数量</th>
          <th class="text-center">单价</th>
          <th class="text-center">金额</th>
          <th class="text-center">整件数</th>
          <th class="text-center">散件数</th>
          <th class="text-center">注册证号</th>
          <th class="text-center">操作</th>
        </thead>
        <tbody  ng-init="medicalStockMap={};orderMedicalNoIds=[]" >
          <tr class="tr-interval"><td colspan="9"></td></tr>
          <tr ng-repeat="tr in formData.orderMedicalNos" ng-click="selectThis()"  ng-init="orderMedicalNoIds.push(tr.relId)" >
            <td class="has-border text-center text-s"></td> <!-- 器械编号 -->
            <td class="goods-name has-border pd-m"> <!-- 名称/厂家/规格 -->
              <div class="pr-table-td-m relative">
                <span class="goods-thumbnail inline-block"><img ng-src="{{tr.headUrl}}" alt=""></span>
                <span class="block">
                  <p class="pdl-m mgb-s color-6 text-n text-bold"><span>{{tr.name}}</span></p>
                  <p class="pdl-m mgb-s color-9 text-s"><span>{{tr.manufacturer}}</span></p>
                  <p class="mgl-m color-9 text-s"><span>{{tr.specification||"无规格"}}</span></p>
                </span>
              </div>
            </td>
            <td class="has-border text-center text-v-t pd-m">{{tr.unit}}</td> <!-- 单位 -->
            <td class="has-border text-center text-v-t pd-m"></td> <!-- 数量 -->
            <td class="has-border text-center text-v-t pd-m">￥{{tr.price}}</td> <!-- 单价 -->
            <td class="has-border text-center text-v-t pd-m"></td> <!-- 金额 -->
            <td class="has-border text-center text-v-t pd-m">12</td> <!-- 证件数 -->
            <td class="has-border text-center text-v-t pd-m">12</td> <!-- 散件数 -->
            <td class="has-border text-center text-v-t pd-m">1234455676</td> <!-- 注册证号 -->
            <td class="has-border text-center text-v-t pd-m"></td>
          </tr>

          <tr>
            <td colspan="12" class="pd-v-l">添加药械</td>
          </tr>

          <tr ng-init="addDataItem={}"
              ajax-if="{{addDataItem&&addDataItem.relId}}"
              ajax-url="rest/authen/medicalStock/get.json?id={{addDataItem.relId}}"
              scope-data="medical"
              callback="selectRelIdCallBack(medical)"
              show-loading = "true"
              class="showLoading relative">
            <td class="has-border text-center text-s"></td> <!-- 器械编号 -->
            <td class="goods-name has-border pd-m"> <!-- 名称/厂家/规格 -->
              <div class="pr-table-td-m relative">
                <span class="goods-thumbnail inline-block"><img ng-src="{{tr.headUrl}}" alt=""></span>
                <span class="block">
                  <p class="pdl-m mgb-s color-6 text-n text-bold"><span>{{tr.name}}</span></p>
                  <p class="pdl-m mgb-s color-9 text-s"><span>{{tr.manufacturer}}</span></p>
                  <p class="mgl-m color-9 text-s"><span>{{tr.specification||"无规格"}}</span></p>
                </span>
              </div>
            </td>
            <td class="has-border text-center text-v-t pd-m">{{tr.unit}}</td> <!-- 单位 -->
            <td class="has-border text-center text-v-t pd-m"></td> <!-- 数量 -->
            <td class="has-border text-center text-v-t pd-m">￥{{tr.price}}</td> <!-- 单价 -->
            <td class="has-border text-center text-v-t pd-m"></td> <!-- 金额 -->
            <td class="has-border text-center text-v-t pd-m">12</td> <!-- 证件数 -->
            <td class="has-border text-center text-v-t pd-m">12</td> <!-- 散件数 -->
            <td class="has-border text-center text-v-t pd-m">1234455676</td> <!-- 注册证号 -->
            <td class="fix-td-border">
              <button class="pr-add-item-glodbg color-white pr-bg-glod" type="button"  ng-click="addDataItemClick(addDataItem,medical)"><i class="fa fa-plus color-white"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="mgt-m mgb-l text-right"><a href="javascript:;">导入药械清单</a><i class="import-icon mgl-s"></i></p>
    </div>
    <!-- 备注 -->
    <div class="pd-c-xl bb-line">
      <h1 class="mgt-l">备注</h1>
      <textarea class="pr-textarea mgb-l mgt-l" ng-model="formData.note" maxlength="240" style="height:92px;" placeholder="请填写备注信息"></textarea>
    </div>
    <!-- 总价 -->
    <div class="text-right pd-c-xxxxl pdb-xxl pdt-xxl">
      <p class="pr-font-24 color-9 mgb">合计：<span class="pr-font-24 color-6">￥{{formData.totalPrice | number:2}}</span></p>
      <p class="pr-font-24 color-9">税额：<span class="pr-font-24 color-6">￥{{formData.totalPrice | number:2}}</span></p>
    </div>
    <!-- 提交按钮 -->
    <div class="pd-c-xl pdb-xxl text-right">
      <span class="mgr-l">
        <button class="pr-btn-save-glodbg"
                type="submit"
                ng-disabled="!formData.orderMedicalNos.length ||
                             !formData.customerId ||
                             !formData.saleUserId">保存</button>
      </span>
      <span class="mgr-l">
        <button ng-click="submitForm('editForm','submit')"
                class="pr-btn-create-glodbg"
                ng-disabled="!formData.orderMedicalNos.length ||
                             !formData.customerId ||
                             !formData.saleUserId">生成采购单</button>
      </span>

      <!-- <span><a href="javascript:;" ng-click="cancelThis('取消后无法回复原有数据,确认取消?', 'pr-dialog-confirm.html', '确认取消?')">取消</a></span> -->
      <span>
        <a href="javascript:;"
           handle-this-click
           dialog-title="确认取消?"
           dialog-content="取消后无法回复原有数据,确认取消?"
           dialog-template="pr-dialog-confirm.html">返回采购单中心</a>

      <!-- <span><a href="javascript:;" ng-click="cancelThis('取消后无法回复原有数据,确认取消?', 'pr-dialog-confirm.html', '确认取消?')">返回购需中心</a></span> -->

    </div>
  </div>
  </form>

  <!-- 加载选中药械库存-->
  <div ajax-if="orderMedicalNoIds"
       ajax-url="rest/authen/medicalStock/countStockByIds.json?ids={{orderMedicalNoIds.join(',')}}"
       scope-data="medicalStockMap"
       alert-error>
  </div>

</div><!--end batchRequirementStatus-->
</div>
