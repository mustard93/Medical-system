<div class="sale-return-order right-side"
     ng-controller="returnOrderAddController"
     ajax-If-eval="selectedData.id||responseData.relId||dialogData.id"
     ajax-url="rest/authen/arrivalNoticeOrder/get?id={{selectedData.id||responseData.relId||dialogData.id}}"
     scope-data="addDataObj"
     callback="choisedMedicalList=initChoisedMedicalList(addDataObj.orderMedicalNos,dialogData.medicalList);"
     alert-error>
  <form id="saleReturnAddForm"
        name="saleReturnAddForm"
        form-validator
        parameter-body
        action="rest/authen/purchaseReturnOrder/splitOrderMedicalNos"
        alert-error
        scope-data="responseData"
        callback="submitFormAfter(scopeResponse);$root.watchFormChange('responseData',this)"
        novalidate="true">
    <!-- 头部信息 -->
    <div class="relative">
      <div class="pd-m">
        <!-- 标题 -->
        <div class="mgb-m">
          <div class="mgb">
            <span class="pdb-m">参照来货通知单</span>
          </div>
          <div class="mgb">
            <span angucomplete placeholder="输入"
                  title-field="orderNo"
                  description-field="customerName"
                  search-fields=""
                  search-str-class="ipt"
                  url="rest/authen/arrivalNoticeOrder/query?orderStatus=已完成"
                  class="inline-block"
                  ng-model="selectedData">
            </span>
          </div>
          <h1 class="pr-font-22 color-black pdt-m">{{addDataObj.customerName}}</h1>
        </div>
      </div>
    </div>
    <!-- 药械列表 -->
    <div class="pd-loss-l">
      <div class="panel pr-panel pd-n pr-fuzzy-boundary pr-panel-height mgb">
        <div class="empty-panel" ng-if="!addDataObj">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="" ng-if="addDataObj">
          <p class="flex-column mgb  pd bb-dashed-line">
            <span class="flex-item-7">
              单据编号：<em >{{addDataObj.orderNo || '暂无'}}</em>
              <em  class="mgl">制单人：</em><em class="color-orange">{{addDataObj.inputUser.n || '暂无'}}</em>
              <em  class="mgl">
                审核人：</em><em class="color-black">{{addDataObj.inputUser.n || '暂无'}}</em>
            </span>
            <span class="flex-item-4 text-right">
              录单日期：<em >{{addDataObj.createAt | date : 'yyyy-MM-dd' }}</em>
            </span>
            <span class="flex-item-1 text-right">状态：
              <em class="color-black" ng-class="{'color-green':addDataObj.orderStatus=='已通过'}">{{addDataObj.orderStatus}}</em>
            </span>
          </p>
          <p class="flex-column mgb  pd">
            <span class="flex-item-12">
              部门：<em >{{addDataObj.salesDepartmentName || '暂无'}}</em>
              <em  class="mgl">制单人：</em><em class="color-orange">{{addDataObj.inputUser.n|| '暂无'}}</em>
              <em  class="mgl">业务员：</em><em class="color-black">{{addDataObj.inputUser.n || '暂无'}}</em>
              <em  class="mgl">业务类型：</em><em >{{addDataObj.orderBusinessType || '暂无'}}</em>
              <em  class="mgl">采购类型：</em><em >{{addDataObj.salesType || '暂无'}}</em>
            </span>
          </p>
        </div>
        <div class="outside-table-d">
          <table class="table pr-table pr-new-table table-wid" >
              <thead>
                <tr>
                  <th>
                    <input type="checkbox" class="selectAll" ng-init="isChoiseAll=false" ng-model="isChoiseAll" ng-click="handleChoiseAllEvent()">
                  </th>
                  <th class="text-center">商品编号</th>
                  <th class="text-left">商品全名</th>
                  <th class="text-center">规格/型号</th>
                  <th class="text-center">单位</th>
                  <th class="text-center">数量</th>
                  <th class="text-center w-110">批号要求</th>
                  <th class="text-center ">生产批号</th>
                  <th class="text-center ">灭菌批号</th>
                  <th class="text-center">含税单价</th>
                  <th class="text-center">税率</th>
                  <th class="text-center">折扣额</th>
                  <th class="text-center">折扣率</th>
                  <th class="text-center">无税单价</th>
                  <th class="text-center">无税金额</th>
                  <th class="text-center">税额</th>
                  <th class="text-center">价税合计</th>
                  <th class="text-center">报价</th>
                  <th class="text-center">产地</th>
                  <th class="text-center">失效日期</th>
                  <th class="text-center">退补标志</th>
                  <th class="text-center">保存温度</th>
                  <th class="text-center">品牌</th>
                  <th class="text-center">产地注册证号</th>
                  <th class="text-center">注册证有效期</th>
                  <th class="text-center">医保编码</th>
                  <th class="text-center">院内编码</th>
                </tr>
              </thead>
              <tbody class="bg-white">
                <tr ng-repeat="item in addDataObj.orderMedicalNos" >
                  <td class="select-td">
                    <input type="checkbox" class="selectOne" ng-model="item.itemSelected" ng-click="handleItemClickEvent(item);">
                  </td>
                  <td class="text-center">{{item.code}}</td>
                  <td class="text-left">{{item.name}}</td>
                  <td class="text-center">{{item.specificationAndModelType}}</td>
                  <td class="text-center">{{item.unit}}</td>
                  <td class="text-center">{{item.quantity}}</td>
                  <td class="text-center">{{item.batchRequirement}}</td>
                  <td class="text-center">{{tr.productionBatch}}</td>
                  <td class="text-center">{{tr.sterilizationBatchNumber}}</td>
                  <td class="text-right">{{item.price | currency:'￥'}}</td>
                  <td class="text-right">{{item.taxRate}}%</td>
                  <td class="text-right">￥{{item.discountPrice | number:2}}</td>
                  <td class="text-right">{{item.discountRate}}%</td>
                  <td class="text-right">￥{{$root.saleOrderUtils.getWuSuiDanJian(item) | number:2}}</td>
                  <td class="text-right">￥{{$root.saleOrderUtils.getWuSuiJinE(item) | number:2}}</td>
                  <td class="text-right">￥{{$root.saleOrderUtils.getSuiE(item) | number:2}}</td>
                  <td class="text-right">￥{{$root.saleOrderUtils.getJiaSuiHeJi(item) | number:2}}</td>
                  <td class="text-right">
                    ￥{{item.price | number:2}}
                  </td>
                  <td class="text-center">{{item.productionPlace}}</td>
                  <td class="text-center" ajax-url="rest/authen/medicalStock/getStockBatch?relMedicalStockId={{item.relId}}&p_and_s={{item.productionBatch}}"
                      scope-data="validTilldata">
                      {{validTilldata.validTill | date : 'yyyy-MM-dd'}}
                  </td>
                  <td class="text-center">{{item.withdrawalSign}}</td>
                  <td class="text-center">{{item.storedTemperature}}</td>
                  <td class="text-center">{{item.brand}}</td>
                  <td class="text-center">{{item.drugAdministrationCode}}</td>
                  <td class="text-center">{{item.drugAdministrationCodeGuaranteePeriod}}</td>
                  <td class="text-center">{{item.medicalInsuranceCode}}</td>
                  <td class="text-center">{{item.hospitalCode}}</td>
                </tr>
              </tbody>
            </table>
          <div class="empty-table clearfix" ng-if="!addDataObj">
            <div>&nbsp;</div>
            <div>&nbsp;</div>
            <div>&nbsp;</div>
          </div>
        </div>
      </div>
      <!-- 功能按钮 -->
      <div class="handle-btn-area relative">
        <div class="btn-area">
            <a class="mgr-l" ng-click="modal.closeAll();">取消</a>
            <button ng-disabled="!choisedMedicalList.length>0" ng-click="handleAddData(addDataObj.id, addDataObj.orderNo, choisedMedicalList)" type="button" class="pr-btn-save-glodbg mgr-l">确定</button>
        </div>
      </div>
    </div>
  </form>
</div>
