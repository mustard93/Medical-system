<!--listParams.customerId=dialogData.customerId;-->
<table-list
        ng-init="listParams={};"
        list-data="rest/authen/requestPurchaseOrderDetail/query"
        list-params="listParams"
        search-mode="noCaseSensitive"
        search-param="q"
>

    <div class="modal-content pr-modal-content right-side-new pr-bg-black4 more-stock "
     ng-controller="requestPurchaseOrderDetailDialogCtrl"
     style="position: relative"
     callback="initFlag=true;$root.reloadTime=$root.utils.getNowTime();getChoisedBatchsId(dialogData.choisedBatchList);"
>

    <style>

        .tab a {
            display: block;
            width: 150px;
            float: left;
            height: 100%;
            margin: 0;
            padding: 0;
            border-bottom: #C7A77B solid 1px;
            border-right: #C7A77B solid 1px;
            margin-top: -1px;
        }

        .tab a.cur {
            color: white;
            background: #443F3A;
            border-bottom: #443F3A solid 1px;
        }

        .goods-info {
            margin: 15px 20px;
        }

        .goods-info .color-6 {
            font-size: 12px;
            color: #999999;
            line-height: 16px;
            width: 40%;
            display: inline-block;

        }

        .goods-info .color-6 i {
            color: white;
            font-style: normal;

        }

        .line-dotted {
            height: 2px;
            margin: 10px 0;
            width: auto;
            border-bottom: dashed rgba(255, 255, 255, 0.26) 1px;
        }

        .order-list {
            width: 100%;
            margin: 15px;
            height: 570px;
            overflow: auto;
            padding-bottom: 50px;
        }

        .order-list ul.li-min-h li {
            width: 33%;
            float: left;
            cursor: pointer;
            padding-top: 5px;
        }

        .order-list li .mgb-xxl:hover,.order-list li .mgb-xxl.on {
            -webkit-box-shadow: 0 0 10px #ff8c00;
            -moz-box-shadow: 0 0 10px #ff8c00;
            box-shadow: 0 0 10px #ff8c00;
        }

        .order-list li .pr-bg-grey2 {
            background: #ddd;
        }



        .angucomplete-holder .ipt{
            width: 100%;
        }

    </style>

    <!-- 标题 -->
    <div class="bb-line-gold pr-bg-black2 min-h-l">
        <h1 ng-init="type='按商品查找'" class="pr-indent-20 pdb-m text-n" style="line-height:50px;max-height:35px;">增加采购条目</h1>
    </div>

    <div
         ajax-url="rest/authen/lendOrder/getByOrderCode?orderCode={{selectedData.data.orderCode}}"
         scope-data="scopeData"
         callback="isChoiseAll=false;checkRelId(dialogData.relId,scopeData.id); selectedBatchs= initChoisedMedicalList(formData.orderMedicalNos, scopeData.orderMedicalNos,'id');">


        <div class="pdt-s pdb-s pd-c-xl">
            <div class="inline-block relative" style="margin: 20px 0 20px -10px;color: #fff;">
                <span angucomplete placeholder="请先输入目标客户"
                      style="width: 390px; "
                      title-field="name"
                      search-str-class="ipt"
                      search-fields="{{dialogData.customerName}}"
                      url="rest/authen/customerAddress/query.json?isFilterDefault=true"
                      class="inline-block"
                      ng-model="scopeData">
                </span>
                <span class="receive-item-icon" style="top: 6px;right: 15px;"></span>
            </div>
        </div>

        <!--客戶和物流信息-->

            <p class="bb-line-gold" style="line-height: 40px; text-indent: 20px;">选择需要合并生成采购单的请购条目</p>

            <div ng-if="!scopeData" class="empty-table clearfix" style="opacity: .4">
                <div  style="background: #554D44;">&nbsp;</div>
                <div  style="background: #554D44;">&nbsp;</div>
                <div  style="background: #554D44;">&nbsp;</div>
            </div>

            <div ng-if="scopeData" style="margin: 15px  0;">
                <!-- 要求到货日期 -->
                <div class="inline-block relative">
                    <span class="color-9 mgl-m">要求到货日期：</span>

                    <div class="date-icon-outside" ng-if="!listParams.expectAtBeg">
                        <input type="text"
                               datepicker
                               class="ipt-date pr-short-ipt color-6 mgr-s pr-indent-10"
                               ng-readonly="true"
                               ng-model="listParams.expectAtBeg"
                               placeholder=""
                               style="z-index: 15"
                               ng-change="handleSearchFilter(listParams,dialogData.id)">
                        <span class="date-icon"></span>
                    </div>
                    <div class="date-icon-outside" ng-if="listParams.expectAtBeg">
                        <input type="text"
                               datepicker
                               class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                               ng-readonly="true"
                               style="z-index: 15"
                               ng-model="listParams.expectAtBeg">
                        <span class="delete-date-icon" style="z-index:16;" ng-click="listParams.expectAtBeg='';"></span>
                    </div>


                    <span class="color-9">至</span>
                    <div class="date-icon-outside" ng-if="!listParams.expectAtEnd">
                        <input type="text"
                               datepicker
                               class="ipt-date pr-short-ipt color-6 mgr-l pr-indent-10"
                               ng-readonly="true"
                               ng-model="listParams.expectAtEnd"
                               placeholder=""
                               style="z-index: 15"
                               ng-change="handleSearchFilter(listParams,dialogData.id)">
                        <span class="date-icon"></span>
                    </div>
                    <div class="date-icon-outside" ng-if="listParams.expectAtEnd">
                        <input type="text"
                               datepicker
                               class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                               ng-readonly="true"
                               ng-model="listParams.expectAtEnd"/>
                        <span class="delete-date-icon" style="z-index:10;" ng-click="listParams.expectAtEnd='';"></span>
                    </div>
                </div>

                <!-- 请购单编号 -->
                <div class="inline-block" style="margin-left: 15px;">
                    <span class="color-9" style="line-height: 26px;">请购单编号: </span>
                    <div class="order-list-search text-left code pos-rel-tr inline-block fl-r relative">
                        <span angucomplete placeholder=""
                              style="width: 180px; "
                              title-field="orderCode"
                              search-str-class="ipt ipt-bg-black"
                              url="rest/authen/requestPurchaseOrder/query"
                              class="inline-block"
                              ng-model="selectedOrderCode">
                        </span>
                        <span class="receive-item-icon" style="top: 6px;right: 15px;"></span>
                    </div>
                </div>

                <!-- 关键字过滤 -->
                <div class="inline-block" style="float: right; margin-right: 15px;">
                    <span class="color-9"></span>
                    <div class="order-list-search text-left code pos-rel-tr inline-block fl-r">
                        <input type="text"
                               class="ipt pdr-xxl relative"
                               placeholder="商品通用名"
                               ng-model="listParams.q"
                               style="background: #fff"
                               ng-change="handleSearchFilter(listParams,angucomplete_data.data.id)">
                        <i class="" style=""></i>
                    </div>
                </div>

            </div>

            <!-- 商品列表 -->
            <div ng-if="tbodyList.length" class="pr-panel pd-n pr-panel-height">
                <table class="table pr-table pr-new-table">
                    <thead>
                    <tr>
                        <th class="w-60 text-center mycheck">
                            <input type="checkbox" class="selectAll cur-pot" id='otherCustomerManagement_dialog_1'
                                   ng-model="isChoiseAll"
                                   ng-click="handleChoiseAllEvent(tbodyList,isChoiseAll);"
                            >
                            <label for="otherCustomerManagement_dialog_1" style="top: 10px;"></label>
                        </th>
                        <th class="text-center">序号</th>
                        <th class="text-center">请购单编号</th>
                        <th class="text-center">商品通用名</th>
                        <th class="text-center">剂型/分类</th>
                        <th class="text-center">规格/型号</th>
                        <th class="text-center">要求到货日期</th>
                        <th class="text-center">待采购量</th>
                        <th class="text-center">目标客户</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="item in tbodyList">

                        <td class="select-td text-center mycheck">

                            <!--ng-disabled="!compareOrderId(dialogData.relId,scopeData.id) || item.disabled"-->

                            <!--ng-init="item.handleFlag= compareOrderId(dialogData.relId,scopeData.data.id) && itemInArray(item.id,formData.orderMedicalNos,'id');-->
                            <!--item.disabled =  (itemInArray(item.id,formData.orderMedicalNos,'id')   || item.outgoingQuantity<1);"-->
                            <!---->
                            <input type="checkbox"

                                   ng-init="itemInArray(item.orderMedicalNos.uuid,dialoagData.orderMedicalNos,'uuid')"

                                   class="selectOne cur-pot" id='otherCustomerManagement_dialog_{{$index+2}}'
                                   ng-model="item.handleFlag"
                                   ng-click="handleItemClickEvent(item,scopeData.data.orderMedicalNos,'id');">
                            <label for="otherCustomerManagement_dialog_{{$index+2}}"></label>


                        </td>

                        <td class="text-center">{{$index+1}}</td>
                        <td class="text-center">{{item.orderCode}}</td>
                        <td>
                            <span
                              class="color-orange cur-pot lend-order-goods-info"
                                    ng-init="showInfoArea=false"
                                    ng-mouseenter="showInfoArea=true"
                                    ng-mouseleave="showInfoArea=false">{{item.orderMedicalNo.approvedName}}
                              <show-info-modal ng-show="showInfoArea"
                                               get-data-type="local"
                                               template-url="tpl/showInfoModalLendOrder"
                                               info-object="{{item.orderMedicalNo}}"
                                               info-title="商品信息">
                              </show-info-modal>
                            </span>
                        </td>
                        <td class="text-left">{{item.orderMedicalNo.dosageForms}}</td><!-- 剂型分类 -->
                        <td class="text-center">{{item.orderMedicalNo.specificationAndModelType}}</td> <!--规格／型号-->
                        <td class="text-center">{{item.orderMedicalNo.validTill | date : 'yyyy-MM-dd'}}</td> <!--要求到货日期-->
                        <td class="text-center">{{item.orderMedicalNo.quantity}}</td><!--待采购量-->
                        <td class="text-right">{{item.customerName}}</td><!--目标客户-->

                    </tr>
                    </tbody>
                </table>

                <div ng-if="!scopeData" class="empty-table clearfix" style="background: #6e6a67;">
                    <div>&nbsp;</div>
                    <div>&nbsp;</div>
                    <div>&nbsp;</div>
                </div>


                <!-- 导航 -->
                <div class="clearfix" ng-if="tbodyList.length">
                    <div class="fr">
                        <pagination status="status"></pagination>
                    </div>
                </div>

            </div>


            <div class="footer-button-area" style="position:fixed;bottom:0px;" >
                <button type="submit" style="margin-left:500px;"
                        class="pr-btn-create-glodbg new-left-side-button"
                        ng-disabled="choiced.length<1"
                        ng-click="addOrderDataToList(dialogData.relId,scopeData.data);modal.close()">确定</button>
            </div>
        </div>

    </div>
</table-list>



