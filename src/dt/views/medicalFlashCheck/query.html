<div class="" ng-controller="medicalFlashCheckEditCtrl">
  <!-- 头部信息 -->
  <div class="header-info relative">
    <p class="pdb-s pdt-s crumbs pd-c-xxl">库存报表 >
      <em>药械闪查</em>
    </p>
    <div class="pd-c-xxl pdt-l pdb-l">
      <!-- 标题 -->
      <div class="mgb">
        <h1 class="pr-font-20 color-black">药械闪查</h1>
      </div>
    </div>
  </div>
  <!-- 主内容区域 -->
  <div class="content-wrapper flex-column" style="margin-right:0px;">
    <div class="flex-item-7 mgt-l">
      <div class="pr-bg-white pr-border pd-c-v-s flex-column">
        <div class="inline-block mgr-xxl relative">
        <p class="mgb-s">商品</p>
        <span style="border: 1px solid rgba(0,0,0,.2);width:450px;height:36px;"
               angucomplete
               title-field="name"
               url="rest/authen/medicalStock/query.json"
               class="inline-block medical-select-span"
               ng-model="medicalData">

        </span>
        <i class="medical-search-icon"></i>
        </div>
        <div class="inline-block mgr-xxl relative">
          <p class="mgb-s">批号</p>
          <input type="text"
            ng-disabled="!medicalData.id"
            class="inline-block mgb"
            style="border: 1px solid rgba(0,0,0,.2);width:250px;height:36px;"
            placeholder=""
            ng-model="medicalData.productionBatch"
            />
        </div>

        <div class="inline-block mgl-xxl mgr-s mgt-l relative">
          <button ng-disabled="!medicalData.id"  ng-class="{'disabled':(!medicalData.id)}" type="button" style="width:150px;" class="mgt-s pr-btn-save-glodbg mgr"
          ng-click="medicalData.type='商品';medicalSearch(medicalData.id,medicalData.productionBatch);
          stockSearch(medicalData.id,medicalData.productionBatch);inOutStockSearch(medicalData.id,medicalData.productionBatch);">查询

          <!--  -->
          </button>
        </div>
      </div>

      <div class="pr-bg-white pr-border  flex-column mgt-l " style="min-height:150px;">
        <div class="meidcal-select-type pd-c-v-s flex-item-12 bb-dashed-line">
            <div class=" inline-block cur-pot" ng-click="medicalData.type='商品'" ng-class="{'medical-active':(medicalData.type=='商品')}">
              <p>
                商品信息
              </p>
              <i class="mgl"></i>
            </div>
            <div class="mgl-xxl inline-block cur-pot" ng-click="medicalData.type='价格'" ng-class="{'medical-active':(medicalData.type=='价格')}">
              <p>
                进销价格
              </p>
              <i class="mgl"></i>
            </div>
        </div>
        <!-- 显示商品信息 -->
        <div class="pd-c-v-s flex-item-12 flex-column "  ng-if="scopeData&&medicalData.type=='商品'">
          <!-- 第一行 -->
          <div class="inline-block flex-item-4 text-s text-left">
            <p>商品通用名称</p><p class="color-3 mgt-s">{{scopeData.approvedName}}</p>
          </div>
          <div class="inline-block flex-item-4 text-s text-left">
            <p>商品编号</p><p class="color-3 mgt-s">{{scopeData.code}}</p>
          </div>
          <div class="inline-block flex-item-4 text-s text-left">
            <p>产品注册证号／备案凭证编号／批准文号</p><p class="color-3 mgt-s">{{scopeData.medicalRegistryCode}}</p>
          </div>
          <!-- 第二行 -->
          <div class="inline-block flex-item-4 text-s text-left mgt">
            <p>剂型／分类</p><p class="color-3 mgt-s">{{scopeData.dosageForms}}</p>
          </div>
          <div class="inline-block flex-item-4 text-s text-left mgt">
            <p>规格／型号</p><p class="color-3 mgt-s">{{scopeData.specificationAndModelType}}</p>
          </div>
          <div class="inline-block flex-item-4 text-s text-left mgt">
            <p>生产企业</p><p class="color-3 mgt-s">{{scopeData.manufacturer}}</p>
          </div>
        </div>
        <!-- 进销价格 -->
        <div class="pd-c-v-s flex-item-12" ng-if="scopeData && medicalData.type=='价格'">
          <!-- 第一行 -->
          <div class="inline-block flex-item-3 text-s text-left">
            <p>牌价</p><p class="color-3 mgt-s">￥{{scopeData.quoteprice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>批发价</p><p class="color-3 mgt-s">￥{{scopeData.tradePrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>税率</p><p class="color-3 mgt-s">{{scopeData.tax}}%</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>&nbsp;</p><p class="color-3 mgt-s">&nbsp;</p>
          </div>
          <!-- 第二行 -->
          <div class="inline-block flex-item-3 text-s text-left">
            <p>参考采购价</p><p class="color-3 mgt-s">￥{{scopeData.purchasePrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最新采购价</p><p class="color-3 mgt-s">￥{{scopeData.newPurchasePrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最高采购价</p><p class="color-3 mgt-s">￥{{scopeData.maxPurchasePrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最低采购价</p><p class="color-3 mgt-s">￥{{scopeData.minPurchasePrice | number:2}}</p>
          </div>
          <!-- 第三行 -->
          <div class="inline-block flex-item-3 text-s text-left">
            <p>参考销售价</p><p class="color-3 mgt-s">￥{{scopeData.retailPrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最新销售价</p><p class="color-3 mgt-s">￥{{scopeData.newSalePrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最高销售价</p><p class="color-3 mgt-s">￥{{scopeData.maxRetailPrice | number:2}}</p>
          </div>
          <div class="inline-block flex-item-3 text-s text-left">
            <p>最低销售价</p><p class="color-3 mgt-s">￥{{scopeData.minRetailPrice | number:2}}</p>
          </div>
        </div>
        <div class="pr-bg-white flex-item-12" ng-if="!scopeData">
          <div class="empty-table clearfix">
            <div>&nbsp;</div>
            <div>&nbsp;</div>
            <div>&nbsp;</div>
          </div>
        </div>
      </div>
      <!-- 显示表格库存信息 -->
      <div class="out-scroll-div mgt-l ">
        <div class="flex-item-12 flex-column pr-bg-white pr-border" >
          <div class="flex-item-12 flex-column " >
            <p class="pd-c-v-l text-n flex-item-12 flex-column">
              <span class="text-left flex-item-6 color-6 text-bold">库存信息</span>
              <span class="text-right flex-item-6">合计：{{totalQuantity}}<em class="color-3"></em></span>
            </p>
            <table class="table pr-table pr-new-table mgb-n">
              <thead>
                <tr>
                  <th class="text-center">序号</th>
                  <th class="text-center">仓库</th>
                  <th class="text-center">批号</th>
                  <th class="text-center">现存量</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="item in stockData">
                  <td class="text-center">{{$index+1}}</td><!-- 序号-->
                  <td class="text-center">{{item.warehouseName}}</td><!-- 仓库 -->
                  <td class="text-center">{{item.productionBatch}}</td><!-- 批号 -->
                  <td class="text-center">{{item.stockModel.quantity || '0'}}</td><!-- 现存量 -->
                </tr>
              </tbody>
            </table>
            <div class="pr-bg-white flex-item-12" ng-if="!stockData.length">
              <div class="empty-table clearfix">
                <div>&nbsp;</div>
                <div>&nbsp;</div>
                <div>&nbsp;</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="flex-item-5 flex-column" >
      <div class="pd-c-v-l mgl-l" style="width:98%;background: rgba(255,255,255,0.40);min-height:780px;" >
        <p class="mgt-l mgl-m text-bold color-6" >
          出入库记录
        </p>
        <div class="mgt mgl-m" ng-if="inOutStockData.length">
          <span class="color-9" >起止年月：</span>
          <div class="date-icon-outside" ng-if="!stockData.createAtBeg">
              <input type="text"
                     datepicker
                     class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                     ng-readonly="true"
                     ng-model="stockData.createAtBeg"
                     ng-change="handleSearchFilter(stockData.createAtBeg,stockData.createAtEnd,medicalData.id)">
              <span class="date-icon"></span>
          </div>
          <div class="date-icon-outside" ng-if="stockData.createAtBeg">
              <input type="text"
                     datepicker
                     class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                     ng-readonly="true"
                     ng-model="stockData.createAtBeg">
              <span class="delete-date-icon" style="z-index:11;" ng-click="stockData.createAtBeg='';"></span>
          </div>
          <span class="color-9">至</span>
          <div class="date-icon-outside" ng-if="!stockData.createAtEnd">
              <input type="text"
                     datepicker
                     class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                     ng-readonly="true"
                     ng-model="stockData.createAtEnd"
                     invalid-popover
                     popover-show="stockData.createAtEnd<stockData.createAtBeg"
                     popover-options='{"content":"结束日期不应小于开始日期", "placement":"top", "trigger":"manual"}'
                     ng-change="handleSearchFilter(stockData.createAtBeg,stockData.createAtEnd,medicalData.id)" />
              <span class="date-icon"></span>
          </div>
          <div class="date-icon-outside" ng-if="stockData.createAtEnd">
              <input type="text"
                     datepicker
                     class="ipt-date pr-short-ipt color-6 mgr pr-indent-10"
                     ng-readonly="true"
                     ng-model="stockData.createAtEnd"/>
              <span class="delete-date-icon" style="z-index:11;" ng-click="stockData.createAtEnd='';"></span>
          </div>
        </div>

        <!-- 显示出入库时间段信息 -->
        <div class="scroll-out-div mgt">
          <div class="mgl-m flex-item-12 " ng-if="inOutStockData.length">
            <div class="flex-item-12 flex-column" ng-repeat="yearData in inOutStockData">
              <p class="pd-c-v-s color-3 flex-item-12 text-left " style="text-indent:50px;">
                {{yearData.year}}
              </p>
              <div class="text-s relative flex-item-12" ng-repeat="tr in yearData.detailVos">
                <span class="relative" style="top:-40px;">{{tr.date | date : 'yyyy-MM-dd'}}</span>
                <span ng-if="tr.inoutType=='入库'" class="inStock-icon"></span>
                <span ng-if="tr.inoutType=='出库'" class="outStock-icon"></span>
                <div class="show-info-stock" ng-class="{'pr-bg-inStock':(tr.inoutType=='入库')}">
                    <div class="show-info-stock-content">
                    <p>
                      {{tr.message}}
                    </p>
                    <p>
                      单据编号：<em class="color-orange">
                        <a href="#/arrivalNoticeOrder/get.html?orderNo={{tr.relOrderNo}}" ng-if="tr.inoutType=='入库'">
                            {{tr.relOrderNo}}
                        </a>
                        <a href="#/invoicesOrder/get.html?orderNo={{tr.relOrderNo}}" ng-if="tr.inoutType=='出库'">
                            {{tr.relOrderNo}}
                        </a>
                      </em>
                    </p>
                    </div>
                </div>
              </div>
            </div>
          </div>

          <div class=" flex-item-12 mgt" ng-if="!inOutStockData.length">
            <div class="empty-table clearfix">
              <div>&nbsp;</div>
              <div>&nbsp;</div>
              <div>&nbsp;</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
