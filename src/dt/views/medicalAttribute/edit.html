<page-main-header-component list-params="listParams"
                            crumbs-nav='[{"name":"基础档案","link":"","style":""},{"name":"商品类别管理","link":"","style":"color-custom-orange"}]'
                            component-title="商品类别管理">
</page-main-header-component>

<div class="content-wrapper order-center medical-attribute"
     ng-controller="medicalAttributeController"
     ng-init="moduleName='medicalAttribute';showModuleName='商品'"
     ajax-url="rest/authen/medicalAttribute/query.json?pageSize=999"
     scope-data="scopeTreeData"
     callback="scopeTreeData2=filterJSONDate(scopeTreeData);initFlag=true;showAddClass=false;formData={};"
     alert-error>
  <!-- 主内容区域 -->
  <div class="content-wrapper-main pdl-l pdr-l full-height">
    <div class="panel pr-panel pr-fuzzy-boundary pr-panel-height pd">
      <h1 class="text-bold text-n">{{showModuleName}}分类</h1>
      <div class="flex-column">
        <div class="flex-item-6 br-dotted-line" style="overflow-y:auto;max-height:550px;">
          <!-- 新增商品主类别按钮 -->
          <div class="pos-rel-tl order-create-btn mgt-l mgb-xl">
            <span ng-if="$root.hasAuthor('商品类别管理新增')">
              <a href="javascript:;" ng-click="showAddClass=!showAddClass"><i></i><span class="">新增{{showModuleName}}主类别</span></a>
            </span>
          </div>

          <!-- 新增商品主类别 -->
          <div class="mgt-l mgb-l add-main-class relative" ng-init="addMainClassObj={};addMainClassObj.level=1;" ng-if="showAddClass">
            <input type="hidden" ng-model="addMainClassObj.level">
            <p class="mgb-l">分类编号：<input type="text" class="ipt pr-short-ipt" ng-model="addMainClassObj.levelCode" /></p>
            <p class="mgb-l">分类名称：<input type="text" class="ipt pr-short-ipt" ng-model="addMainClassObj.showName"  /></p>
            <p><button type="button" class="pr-btn-confirm-glodbg-small" ng-click="addMainClass(addMainClassObj)">确认</button></p>
            <span class="cancel-btn fa fa-times-circle" ng-click="cancelAddClass()"></span>
          </div>

          <div ng-if="initFlag" class="z-tree mgt"
               z-tree-select={{scopeTreeData2}}
               z-tree-type="static"
               ng-model="formData.medicalAttribute"
               id-key="id"
               p-id-key="parentId">
          </div>
        </div>
        <div ng-if="formData.medicalAttribute" class="flex-item-6 pdt-l pdl-xxl text-n">
          <div class="bb-dashed-line pdt-l pdb-l">
            <span ng-if="$root.hasAuthor('商品类别管理删除')">
              <button type="button"
                      class="pr-btn-confirm-glodbg-small mgr-l bg-red"
                      handle-this-click
                      dialog-title="确认"
                      dialog-content="删除后将无法回复，确认删除?"
                      dialog-content-color="#FF3939"
                      dialog-template="pr-dialog-confirm.html"
                      callback="deleteThisClass()">
                <span class="fa fa-trash-o mgr text-n"></span>删除类别
              </button>
            </span>
            <button type="button" class="pr-btn-confirm-glodbg-small mgr-l" ng-click="addNewChildNode()">
              <span class="fa fa-plus-circle mgr text-n"></span>新增子类别
            </button>
          </div>
          <div class="">
            <p class="pdt-l pdb-l">
              <span>分类编号：</span>
              <span>
                <em ng-if="formData.medicalAttribute.parentCode">{{formData.medicalAttribute.parentCode}} +</em>
                <input type="text" class="ipt pr-short-ipt" style="width:80px;" ng-model="formData.medicalAttribute.levelCode" ng-disabled="!formData.medicalAttribute.parentCode">
              </span>
            </p>
            <p class="pdt-m pdb-m">
              <span>分类名称：</span>
              <span><input type="text" class="ipt pr-short-ipt" ng-model="formData.medicalAttribute.showName"></span>
            </p>
            <p class="pdt-m pdb-m">
              <span>编码规则提示：</span>
              <span>编码规则提示</span>
            </p>
            <p class="pdt-m pdb-m">
              <button type="button" class="pr-btn-confirm-glodbg-small" ng-click="saveNodeInfo(formData.medicalAttribute)" ng-disabled="!formData.medicalAttribute">保存</button>
            </p>
          </div>
        </div>
        <div ng-if="!formData.medicalAttribute" class="flex-item-6 pdt-l pdl-xxl text-n">
          <p class="text-center mgt-xxl" style="font-size:24px;">请选择{{showModuleName}}分类</p>
        </div>
      </div>
    </div>
  </div>
</div>
