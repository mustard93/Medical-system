<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="#" type="image/png">
    <title>盘谷医疗 - 用户登录</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../fonts/css/font-awesome.min.css">
    <!-- 开发模式 -->
    <link rel="stylesheet" href="../css/dev/style.css">
    <!-- 生产模式 -->
    <!-- <link rel="stylesheet" href="build/css/style.min.css?v=9deede1b89"> -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="../js/html5shiv.js"></script>
    <script src="../js/respond.min.js"></script>
    <![endif]-->
    <style media="screen">
      @media (min-width: 1200px) {
        .col-lg-12 {float: none;}
      }
    </style>
</head>

<body class="login-body min-w">
  <div class="container">
    <!-- Logo -->
    <div class="row">
      <div class="col-lg-12 sys-login-logo"></div>
    </div>
    <!-- 名称 -->
    <div class="row">
      <div class="col-lg-12"><p class="sys-login-title">盘谷医流综合服务平台</p></div>
    </div>
    <!-- 提示信息 -->
    <div class="row">
      <div class="col-lg-12 login-info-prompt" style="display:none;">
        <div>
          <i class="fa fa-exclamation-triangle"></i>
          <span></span>
        </div>
      </div>
    </div>
    <!-- 提交表单 -->
    <div class="row login-wrap">
      <form name="loginForm" class="form-signin" onsubmit="return false;" autocomplete="off">
        <div class="pr-form-control">
          <input type="text" class="form-control pd-n" placeholder="手机号码" name="phone" required autofocus />
        </div>
        <div>
          <input type="password" class="form-control pd-n" placeholder="密码" name="password" required />
        </div>
        <div class="col-lg-12 flex-column">
          <div class="col-lg-6 flex-item-6">
            <div class="square single-row">
                <div class="checkbox">
                    <input type="checkbox" name="remeberNumber" checked>
                    <label class="color-custom-gold">记住手机号码</label>
                </div>
            </div>
          </div>
          <div class="col-lg-6 flex-item-6 text-right">
            <a class="pull-right color-custom-orange" data-toggle="modal" href="user1.html#/reg/retrievepwd.html"> 忘记密码 ?</a>
          </div>
        </div>
        <div class="col-lg-12">
          <button class="btn btn-lg btn-login btn-block pr-btn-login"  type="submit">登 录</button>
        </div>
        <div class="col-lg-12 registration">
          <a class="" href="user1.html#/reg/verify_phone.html">注册账号</a>
        </div>
        <div class="fast-login-choise">
          <span></span>
          <span>快捷登录</span>
          <span></span>
        </div>
        <div class="fast-login-btn">
          <span><a href="#"></a></span>
          <span><a href="#"></a></span>
        </div>
      </form>
    </div>
    <!-- 忘记密码modal -->
    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" class="forgot-pwd modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" style="color:#c7a77b!important;" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title pr-font-16">忘记密码 ?</h4>
                </div>
                <div class="modal-body">
                    <p class="mgb-m">输入您的手机号码并获取短信验证码,以重置您的密码!</p>
                    <input type="number" name="your-phone" placeholder="您的手机号码" autocomplete="off" class="form-control placeholder-no-fix">
                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default pr-btn-transparentbg" type="button">取消</button>
                    <button class="btn btn-primary pr-btn-transparentbg" type="button">下一步</button>
                </div>
            </div>
        </div>
    </div>
  </div>

    <!-- Placed js at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/iCheck/jquery.icheck.min.js"></script>
    <script src="conf.js"></script>
    <script>


    // eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('$(6(){$(\'p[1="l"]\').k(\'j\',6(){m 4={};a($(\'2[1="5"]\').3()&&$(\'2[1="7"]\').3()){4.5=$(\'2[1="5"]\').3();4.7=$(\'2[1="7"]\').3();$.o({n:\'f://d.i.0.g:h/e/C/b/D.9\',A:\'B\',H:4,G:\'9\',E:6(8){a(8.F==z){s.t.q="/r/b.c#/u.c"}x{y(8.v||\'w\')}}})}})});',44,44,'|name|input|val|_0|phone|function|password|results|json|if|index|html|192|dt|http|107|8080|168|submit|on|loginForm|var|url|ajax|form|href|src|window|location|main|msg|登录失败|else|alert|200|type|post|rest|authorize|success|code|dataType|data'.split('|'),0,{}))

      //=========登陆ajax请求源码，生产环境请删除下列代码============================================
      // $(function () {
      //   $('form[name="loginForm"]').on('submit', function () {
      //     var _paramsObj = {};
      //     if ($('input[name="phone"]').val() && $('input[name="password"]').val()) {
      //       _paramsObj.phone = $('input[name="phone"]').val();
      //       _paramsObj.password = $('input[name="password"]').val();
      //       $.ajax({
      //         url: 'http://192.168.0.107:8080/dt/rest/index/authorize.json',
      //         type: 'post',
      //         data: _paramsObj,
      //         dataType: 'json',
      //         success: function (results) {
      //           if (results.code == 200) {  //验证成功
      //             window.location.href = "/src/index.html#/main.html";
      //           } else {
      //             alert(results.msg || '登录失败');
      //           }
      //         }
      //       });
      //     }
      //   });
      // });

      $(function () {
        console.log(conf);
        // 绑定发送事件
        $('form[name="loginForm"]').on('submit', function () {
          var _paramsObj = {};
          if ($('input[name="phone"]').val() && $('input[name="password"]').val()) {
            _paramsObj.phone = $.trim($('input[name="phone"]').val());
            _paramsObj.password = $('input[name="password"]').val();
            $.ajax({
              url: conf.serverPath+'rest/index/authorize.json',
              type: 'post',
              data: _paramsObj,
              xhrFields:{withCredentials: true},
              crossDomain:true,
              dataType: 'json',
              success: function (results) {
                if (results.code === 200) {  //验证成功
                  // 记住电话号码
                  var remeberNumber="";
                  if ($('input[name="remeberNumber"]').is(':checked')) {  //如果用户选择保存手机号码
                      remeberNumber= _paramsObj.phone;
                  }
                  if (window.localStorage) {    //如果当前用户浏览器支持localstorage
                    window.localStorage.setItem('remeberNumber', remeberNumber);
                  }

                  if (results.data.additional.DepartmentId) {
                    window.location.href = conf.indexPage||"index.html#/main.html";
                  } else {
                    window.location.href = conf.applyBindUrl||"user1.html#/reg/apply_bind.html"
                  }

                } else {
                  $('.login-info-prompt > div > span').text(results.msg);
                  $('.login-info-prompt').fadeIn(500);
                }
              },
              error:function(res){
                //{readyState: 0, responseText: "", status: 0, statusText: "error"}
                  alert("服务器连接不上或内部异常："+res.responseText);
              }
            });
          }
        });
        // 按钮可用与不可用
        // $('input[type!="checkbox"]').each(function () {
        //   $(this).on('keyup', function () {
        //     if ($('input[name="phone"]').val() && $('input[name="password"]').val()) {
        //       $('.pr-btn').removeAttr('disabled');
        //     } else {
        //       $('.pr-btn').attr('disabled', 'disabled');
        //     }
        //   });
        // });
        // icheck
        $('input[type="checkbox"]').iCheck({
          checkboxClass: 'icheckbox_square',
          radioClass: 'iradio_square',
          increaseArea: '20%' // optional
        });
        // 读取用户设置的手机号码

        if(window.localStorage){
            var remeberNumber = window.localStorage.getItem("remeberNumber");
            if(remeberNumber) {
              $('input[name="phone"]').val(remeberNumber);
            }

            // if(!remeberNumber) remeberNumber="";
            // $('input[name="phone"]').val(remeberNumber);
        }


      });
    </script>
</body>
</html>
