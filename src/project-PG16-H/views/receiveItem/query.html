<div class="medical-stock supplier-management child-project-management"
     ng-controller="receiveItemController"
     ng-init="listParams.orderStatus=mainStatus.pageParams.orderStatus">
     <table-list list-data="/rest/authen/receiveItem/query"
                 list-params="listParams"
                 search-mode="noCaseSensitive"
                 search-param="q">

  <div class="medical-stock child-project-management receive-item" ng-controller="receiveItemController">
    <!-- 主内容头部 -->
    <page-main-header-component list-params="listParams"
                                crumbs-nav='[{"name":"采购中心","link":"","style":""},{"name":"收货任务","link":"","style":"color-custom-orange"}]'
                                component-title="收货任务"
                                get-business-type-url="rest/index/queryBasicdataForSelectOption?basicDataType=Order_OrderBusinessType">
    </page-main-header-component>
    <!-- 主内容区域 -->
    <div class="mgl-xl status-num-list"
         ajax-url="rest/authen/receiveItem/countByStatus"
         scope-data="statusNumList">
      <span status-style-toggle class="rect-status rect-status-active mgl-s" ng-click="listParams.receiveItemStatus=null">收货列表
        <em ng-if="(statusNumList['待收货']+statusNumList['收货中'])!=0">{{statusNumList['待收货']+statusNumList['收货中']}}</em>
      </span>
      <span status-style-toggle class="rect-status" ng-click="listParams.receiveItemStatus='已完成'">已完成
        <!-- <em ng-if="statusNumList['已完成']!=0">{{statusNumList['已完成']}}</em> -->
      </span>
      <span status-style-toggle class="rect-status" ng-click="listParams.receiveItemStatus='未匹配商品关系'">未匹配商品关系
        <em ng-if="statusNumList['未匹配商品关系']!=0">{{statusNumList['未匹配商品关系']}}</em>
      </span>
      <span status-style-toggle class="rect-status" ng-click="listParams.receiveItemStatus='未加入采购目录商品'">未加入采购目录商品
        <em ng-if="statusNumList['未加入采购目录商品']!=0">{{statusNumList['未加入采购目录商品']}}</em>
      </span>
    </div>
    <div class="content-wrapper">
      <div class="content-wrapper-main pr-fuzzy-boundary">
        <div class="flex-column color-9 pd-c-l pdt-m pdb-m bg-white ">
          <div class="flex-item-8">
            <div class="inline-block mgr-s">
              <p class="mgb-s">采购计划编号：</p>
              <input type="text"
                     class="inline ipt pr-ipt-60"
                     style="width:100px;"
                     placeholder=""
                     ng-model="listParams.purchasePlanOrderCode"
                     auto-complete="rest/index/autoComplete?tableName=SPD.Order.ReceiveItem&property=purchasePlanOrderCode"/>
              </select>
            </div>
            <div class="inline-block mgr-s">
              <p class="mgb-s">物流编号：</p>
              <input type="text"
                     class="inline ipt pr-ipt-60"
                     style="width:100px;"
                     placeholder=""
                     ng-model="listParams.logisticCode"
                     auto-complete="rest/index/autoComplete?tableName=SPD.Order.ReceiveItem&property=logisticCode"/>

            </div>
            <div class="inline-block mgr-s">
              <p class="mgb-s">销售单编号：</p>
              <input type="text"
                     class="inline ipt pr-ipt-60"
                     style="width:100px;"
                     placeholder=""
                     ng-model="listParams.dtOrderCode"
                     auto-complete="rest/index/autoComplete?tableName=SPD.Order.ReceiveItem&property=dtOrderCode"/>
            </div>
            <div class="inline-block mgr-s">
              <p class="mgb-s">库房：</p>
              <select class="inline ipt-new-s pdt"
                      chosen
                      style="width:120px;"
                      data-placeholder=" "
                      default-empty="全部"
                      ng-model="listParams.storeRoomId"
                      select-source="rest/authen/storeRoom/queryForSelectOption">
              </select>
            </div>
            <div class="inline-block">
              <p class="mgb-s">供应商销售日期：</p>
              <div class="">
                <div class="date-icon-outside" >
                  <input type="text"
                         datepicker
                         class="ipt-date ipt color-3"
                         ng-readonly="true"
                         placeholder=""
                         ng-model="listParams.createAtBeg">
                        <span class="date-icon"></span>
                </div>
                <div class="date-icon-outside" >
                  <input type="text"
                         datepicker
                         class="ipt-date ipt color-3"
                         ng-readonly="true"
                         placeholder=""
                         ng-model="listParams.createAtEnd">
                        <span class="date-icon"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="flex-item-4 text-right mgt-xl">
              <div class="order-list-search inline-block text-left code pos-rel-tr pdl-l relative">
                <input type="text" class="ipt pdr-xxl" placeholder="商品名称/商品编码" ng-model="listParams.q">
                <i class=""></i>
              </div>
              <div class="inline-block mgl-m" ng-click="listParams.q=''">
                <i class="fa fa-refresh mgr-s color-light-brown"></i>
                <a href="" class="color-light-brown" >重置搜索条件</a>
              </div>
          </div>
        </div>
        <!-- 批量收货按钮 -->
        <div ng-if="!listParams.receiveItemStatus" class="flex-column color-9 pd-c-l bg-white pdt-m pdb-m bt-dashed-line">
          <a href="javascript:void(0)"
             class="batch-receive-btn"
             ng-disabled="!choisedMedicalList.length"
             handle-this-click
             dialog-title="确认提示?"
             dialog-content="批量收货的条目实收数量都为配送数量。确认批量收货?"
             dialog-content-color="#FF3939"
             dialog-template="pr-dialog-confirm.html"
             callback="handleBatchReceive()">批量收货
            <em class="fa fa-trash-o"></em>
          </a>
        </div>
        <div class="outside-table-d pr-bg-white pr-fuzzy-boundary">
          <table class="table pr-table pr-new-table pr-table-content table-wid-l">
            <thead class="pr-bg-side">
              <tr>
                <th class="w-60 text-center">
                  <input type="checkbox" class="selectAll cur-pot" ng-init="isChoiseAll=false" ng-model="isChoiseAll" ng-click="handleChoiseAllEvent()">
                </th>
                <th class="w-80">状态</th>
                <th class="w-80">序号</th>
                <th class="w-140">采购计划编码</th>
                <th class="w-80">商品编号</th>
                <th class="w-220">商品名称</th>
                <th>规格</th>
                <th>单位</th>
                <th>配送总数/已收总数</th>
                <th>生产批号</th>
                <th>配送数量/已收数量</th>
                <th>生产日期</th>
                <th>收货人</th>
                <th>收货时间</th>
                <th>有效期至</th>
                <th>发票号</th>
                <th>发票日期</th>
                <th>生产厂商</th>
                <th>产地</th>
                <th>供应商名称</th>
                <th>供应商订单编号</th>
                <th>供应商销售日期</th>
                <th>供应商商品编号</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-if="tbodyList.length"
                  ng-repeat="tr in tbodyList track by $index"
                  class="relative"
                  table-item-multiple-btn>
                <td class="select-td text-center">
                  <input type="checkbox" class="selectOne cur-pot" ng-model="tr.handleFlag" ng-click="handleItemClickEvent(tr);">
                </td>
                <td class="relative">
                  <span class="circle-status"
                        ng-class="{'pr-bg-grey4':tr.receiveItemStatus=='待收货'||tr.receiveItemStatus=='未匹配商品关系'||tr.receiveItemStatus=='未加入采购目录商品',
                                   'bg-pass-green':tr.receiveItemStatus =='已完成',
                                   'bg-freeze-orange':tr.receiveItemStatus =='收货中'}">

                    <span class="purchaseorder-buyer-info" style="right:16px;top:-10px;">
                      <i class="block pd-c-s text-normal" style="line-height:1.8">
                        <em class="inline-block">{{(tr.receiveItemStatus=='未匹配商品关系'||tr.receiveItemStatus=='未加入采购目录商品')?'待收货':tr.receiveItemStatus}}</em>
                      </i>
                    </span>

                  </span>
                  <div class="table-item-multiple-btn">
                    <div class="inline-block btn-receiveItem pr-bg-edit color-white"
                         ng-if="tr.receiveItemStatus=='待收货'"
                         modal-right="50%"
                         modal-scope="this"
                         modal-data='{"id":"{{tr.id}}"}'
                         modal-url="views/receiveItem/edit.html">开始收货...
                    </div>
                    <div class="inline-block btn-receiveItem pr-bg-edit color-white"
                         ng-if="tr.receiveItemStatus=='未加入采购目录商品'"
                         ng-click="$root.goTo('#/purchasecontent/edit.html?id='+tr.purchaseContentId+'&supplierId='+tr.hospitalSupplierId)">加入采购目录...</div>
                    <div class="inline-block btn-receiveItem pr-bg-edit color-white" ng-if="tr.receiveItemStatus=='未匹配商品关系'" ng-click="onceMatch(tr)">立即匹配...</div>
                    <div class="inline-block btn-receiveItem pr-bg-edit color-white"
                         ng-if="tr.receiveItemStatus=='收货中'"
                         style="right:80px;"
                         modal-right="50%"
                         modal-scope="this"
                         modal-data={"id":"{{tr.id}}"}
                         modal-url="views/receiveItem/edit.html">继续收货...
                    </div>
                    <div class="inline-block btn-receiveItem pr-bg-delete color-white"
                         ng-if="tr.receiveItemStatus=='收货中'"
                         style="right:-15px;top: -33px;"
                         handle-this-click
                         dialog-title="确认提示?"
                         dialog-content="该商品实收总数少于配送数量，确认结束收货？"
                         dialog-content-color="#FF3939"
                         dialog-template="pr-dialog-confirm.html"
                         callback="endReceipt(tr.id)">结束收货
                    </div>
                  </div>
                </td><!-- 状态 -->
                <td class="text-center">{{(status.currentPage-1)*status.pageSize+($index+1)}}</td><!-- 序号 -->
                <td>{{tr.purchasePlanOrderCode}}</td><!-- 采购计划编号 -->
                <td>{{tr.code}}</td><!-- 商品编号 -->
                <td class="text-left"><div class="autocut" title="{{tr.name}}">{{tr.name}}</div></td><!-- 商品名称 -->
                <td>{{tr.specification}}</td><!-- 规格 -->
                <td>{{tr.unit}}</td><!-- 单位 -->
                <td>{{tr.totalDeliveryQuantity || '0'}}/{{tr.totalReceiveQuantity || '0'}}</td><!-- 配送总数/已收总数 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="pro in tr.batchInfos">
                    {{pro.productionBatch}}
                  </div>
                </td><!-- 生产批号 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="rec in tr.batchInfos">
                    {{rec.deliveryQuantity}}/{{rec.hasReceiveQuantity}}
                  </div>
                </td><!-- 配送数量/已收数量 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="proD in tr.batchInfos">
                    {{proD.productionDate | date : 'yyyy-MM-dd'}}
                  </div>
                </td><!-- 生产日期 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="recN in tr.batchInfos">
                    {{recN.receiverName}}
                  </div>
                </td><!-- 收货人 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="recD in tr.batchInfos">
                    {{recD.receiveDate | date : 'yyyy-MM-dd'}}
                  </div>
                </td><!-- 收货时间 -->
                <td style="padding:0px;">
                  <div class="full-width hei-50" style="line-height:50px;padding-right:10px;" ng-class="{'bb-line-yellow':(tr.batchInfos.length>1)}" ng-repeat="til in tr.batchInfos">
                    {{til.validTill | date : 'yyyy-MM-dd'}}
                  </div>
                </td><!-- 有效期至 -->
                <td>{{tr.invoiceNo}}</td><!-- 发票号 -->
                <td>{{tr.invoiceDate | date:'yyyy-MM-dd'}}</td><!-- 发票日期 -->
                <td>{{tr.manufacturer}}</td><!-- 生产厂商 -->
                <td>{{tr.productionPlace}}</td><!-- 产地 -->
                <td>{{tr.distributorName}}</td><!-- 供应商名称 -->
                <td>{{tr.dtOrderCode}}</td><!-- 供应商订单编号 -->
                <td>{{tr.dtOrderCreateAt | date : 'yyyy-MM-dd'}}</td><!-- 供应商销售日期 -->
                <td>{{tr.distributorMedicalCode}}</td><!-- 供应商商品编号 -->
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pr-bg-white" ng-if="!tbodyList.length">
          <div class="empty-table clearfix">
            <div>&nbsp;</div>
            <div>&nbsp;</div>
            <div>&nbsp;</div>
          </div>
        </div>
        <div class="flex-column bg-white">
          <div class="flex-item-6">
            <!-- 批量收货按钮 -->
            <div  ng-if="!listParams.receiveItemStatus" class="flex-column color-9 pd-c-l pdt-m pdb-m">
              <a
                 href="javascript:void(0)"
                 class="batch-receive-btn"
                 ng-disabled="!choisedMedicalList.length"
                 handle-this-click
                 dialog-title="确认提示?"
                 dialog-content="批量收货的条目实收数量都为配送数量。确认批量收货?"
                 dialog-content-color="#FF3939"
                 dialog-template="pr-dialog-confirm.html"
                 callback="handleBatchReceive()">批量收货
                <em class="fa fa-trash-o"></em>
              </a>
            </div>
          </div>
          <div class="flex-item-6">
            <!-- 导航 -->
            <div class="clearfix pd-c-xl" ng-if="tbodyList.length">
                <div class="fr">
                    <pagination status="status"></pagination>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</table-list>
