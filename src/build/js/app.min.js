!function(){var e=document.getElementById("requirejs_baseUrlId");if(!e){var t=document.getElementsByTagName("srcript");e=t[t.length-1]}require.dir=e.src.match(/[^?#]*\//)[0],Config.tplPath||(Config.tplPath="")}(),require.config({waitSeconds:0,baseUrl:require.dir+"modules",paths:{WorkflowProcess:"../libs/workflow/WorkflowProcess",JTopo:"../libs/jtopo-0.4.8.min",jQuery:"../libs/jquery.min",underscore:"../libs/underscore/underscore-1.5.2.min",moment:"../libs/moment.min",echarts:"../libs/echarts/echarts-3.2.3.min",chosen:"../libs/chosen.jquery",angular:"../libs/angular",ngRoute:"../libs/angular-route",autocomplete:"../libs/jquery.autocomplete.min",bootstrap:"../libs/bootstrap.min","jquery-ui":"../libs/jquery-ui.min",nicescroll:"../libs/jquery-nicescroll.min",easypiechart:"../libs/easypiechart/angular.easypiechart",icheck:"../libs/jquery.icheck.min",morris:"../libs/morris-chart/morris.min",toastr:"../libs/toastr/toastr.min",raphael:"../libs/morris-chart/raphael.min",clndr:"../libs/calendar/clndr.min"},shim:{JTopo:{exports:"JTopo"},jQuery:{exports:"jQuery"},underscore:{exports:"_"},toastr:{deps:["jQuery"]},chosen:{deps:["jQuery"]},echarts:{exports:"echarts"},angular:{deps:["jQuery"],exports:"angular"},ngRoute:{deps:["angular"],exports:"ngRoute"},autocomplete:{deps:["jQuery"],exports:"autocomplete"},bootstrap:{deps:["jQuery"],exports:"bootstrap"},"jquery-ui":{deps:["jQuery"],exports:"jquery-ui"},nicescroll:{deps:["jQuery"],exports:"nicescroll"},easypiechart:{deps:["jQuery"],exports:"easypiechart"},icheck:{deps:["jQuery"],exports:"icheck"},morris:{deps:["raphael"],exports:"morris"},clndr:{deps:["jQuery"],exports:"clndr"}},urlArgs:""}),require(["bootstrap","jquery-ui","nicescroll","easypiechart","icheck"],function(){}),define("manageApp.template",["angular"],function(){angular.module("manageApp.template",[])}),define("manageApp.main",["main/init","main/services","main/controllers","main/directives","main/filters"]),define("manageApp.project",["project/init","project/services","project/controllers","project/directives","project/filters"]),define("manageApp.modal",["modal/init","modal/services","modal/directives"]),define("manageApp.upload",["upload/init","upload/directives"]),define("datePicker",["datepicker/datepicker"]),define("manageApp",["angular","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker"],function(){return angular.module("manageApp",["ngRoute","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker","easypiechart"])}),require(["manageApp","ngRoute"],function(e){e.config(["$routeProvider","$templateRequestProvider",function(e,t){window.Config?e.when("/:page*",{templateUrl:function(e){var t=(Config.viewsDir||"")+e.page;delete e.page;var a=$.param(e);return a?t+"?"+a:t},resolve:{load:function(){}}}).otherwise({redirectTo:Config.indexPage}):e.when("/:page*",{templateUrl:function(e){var t=e.page;delete e.page;var a=$.param(e);return a?t+"?"+a:t},resolve:{load:function(){}}}),t.httpOptions({headers:{template:"1"}})}]),angular.bootstrap(document,["manageApp"])}),define("datepicker/datepicker",["moment","angular"],function(e){e.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"日_一_二_三_四_五_六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日Ah点mm分",LLLL:"YYYY年MMMD日ddddAh点mm分",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日Ah点mm分",llll:"YYYY年MMMD日ddddAh点mm分"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"下午"===t||"晚上"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,a){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1130?"上午":n<1230?"中午":n<1800?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,a;return t=e().startOf("week"),a=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?a+"dddAh点整":a+"dddAh点mm"},lastWeek:function(){var t,a;return t=e().startOf("week"),a=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?a+"dddAh点整":a+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});var t=angular.module("datePicker",[]);t.constant("datePickerConfig",{template:Config.tplPath+"tpl/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),t.filter("mFormat",function(){return function(t,a,n){return e.isMoment(t)?n?e.tz(t,n).format(a):t.format(a):e(t).format(a)}}),t.directive("datePicker",["datePickerConfig","datePickerUtils",function(t,a){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",dateSelect:"=?",dateMonth:"=?",statusList:"=?"},link:function(n,r,i,o){function l(){n.views=t.views.concat(),n.view=i.view||t.view,n.views=n.views.slice(n.views.indexOf(i.maxView||"year"),n.views.indexOf(i.minView||"minutes")+1),1!==n.views.length&&n.views.indexOf(n.view)!==-1||(n.view=n.views[0])}function s(e){return a.getDate(n,i,e)}function c(e){e&&(n.model=e,o&&o.$setViewValue(e.format(i.format))),n.$emit("setDate",n.model,n.view),n.callbackOnSetDate&&n.callbackOnSetDate(i.datePicker,n.date)}function u(){var e=n.view;a.setParams($),n.model&&!v&&(n.date=y(n.model),v=!1);var t=n.date;switch(e){case"year":n.years=a.getVisibleYears(t);break;case"month":n.months=a.getVisibleMonths(t);break;case"date":n.weekdays=n.weekdays||a.getDaysOfWeek(),n.weeks=a.getVisibleWeeks(t);break;case"hours":n.hours=a.getVisibleHours(t);break;case"minutes":n.minutes=a.getVisibleMinutes(t,C)}f()}function d(){return"date"!==n.view?n.view:n.date?n.date.month():null}function f(){var e,r,i=n.view,o=n.date,l=[],s="";if(a.setParams($),"date"===i){var c,u=n.weeks;for(e=0;e<u.length;e++)for(c=u[e],l.push([]),r=0;r<c.length;r++)s="",a.isSameDay(o,c[r])&&(s+="active"),h(c[r],i)&&(s+=" now"),c[r].month()===o.month()&&p(c[r])||(s+=" disabled"),l[e].push(s)}else{var d=t.viewConfig[i],f=n[d[0]],m=d[1];for(e=0;e<f.length;e++)s="",a[m](o,f[e])&&(s+="active"),h(f[e],i)&&(s+=" now"),p(f[e])||(s+=" disabled"),l.push(s)}n.classes=l}function p(e){var t=!0;return D&&D.isAfter(e)&&(t=m(D,e)),k&&k.isBefore(e)&&(t&=m(k,e)),t}function m(e,a){return!!e.isSame(a,t.momentNames[n.view])}function g(e){return D&&D.isAfter(e)?D:k&&k.isBefore(e)?k:e}function h(e,t){var a=!0;switch(t){case"minutes":a&=~~(M.minutes()/C)===~~(e.minutes()/C);case"hours":a&=M.hours()===e.hours();case"date":a&=M.date()===e.date();case"month":a&=M.month()===e.month();case"year":a&=M.year()===e.year()}return a}a.setParams(i.timezone);var v=!1,$=n.tz=i.timezone,y=a.createMoment,b=a.eventIsForPicker,C=parseInt(i.step||t.step,10),w=!!i.partial,D=s("minDate"),k=s("maxDate"),x=r[0].id,M=n.now=y(),S=n.date=y(n.model||M),A="true"===i.autoClose;n.model||S.minute(Math.ceil(S.minute()/C)*C).second(0),n.template=i.template||t.template,n.watchDirectChanges=void 0!==i.watchDirectChanges,n.callbackOnSetDate=i.dateChange?a.findFunction(n,i.dateChange):void 0,l(),n.setView=function(e){n.views.indexOf(e)!==-1&&(n.view=e)},n.selectDate=function(e){if(i.disabled)return!1;if(m(n.date,e)&&(e=n.date),"date"==n.view&&n.dateSelect&&n.dateSelect(e),e=g(e),!e)return!1;n.date=e;var t=n.views[n.views.indexOf(n.view)+1];(!t||w||n.model)&&c(e),t?n.setView(t):A?(r.addClass("hidden"),n.$emit("hidePicker")):f()},n.$watch(d,u),n.watchDirectChanges&&n.$watch("model",function(){v=!1,u()}),n.next=function(t){var a=e(n.date);switch(t=t||1,n.view){case"year":case"month":a.year(a.year()+t);break;case"date":a.month(a.month()+t),n.dateMonth&&n.dateMonth(a);break;case"hours":case"minutes":a.hours(a.hours()+t)}a=g(a),a&&(n.date=a,c(a),v=!0,u())},n.prev=function(e){return n.next(-e||-1)},x&&n.$on("pickerUpdate",function(e,t,a){if(b(t,x)){var n=!1,r=!1;angular.isDefined(a.minDate)&&(D=!!a.minDate&&a.minDate,r=!0),angular.isDefined(a.maxDate)&&(k=!!a.maxDate&&a.maxDate,r=!0),angular.isDefined(a.minView)&&(i.minView=a.minView,n=!0),angular.isDefined(a.maxView)&&(i.maxView=a.maxView,n=!0),i.view=a.view||i.view,n&&l(),r&&u()}})}}}]),angular.module("datePicker").factory("datePickerUtils",function(){var t,a=function(a,n,r,i,o){var l=Date.UTC(0|a,0|n,0|r,0|i,0|o);return t?e.tz(l,t):e(l)};return{getVisibleMinutes:function(e,t){var n,r,i=e.year(),o=e.month(),l=e.date(),s=e.hours(),c=e.utcOffset()/60,u=[];for(r=0;r<60;r+=t)n=a(i,o,l,s-c,r),u.push(n);return u},getVisibleWeeks:function(t){t=e(t);var a=t.year(),n=t.month();t.date(1);var r=t.day();0===r?t.date(-6):t.date(1-r);for(var i=[];i.length<6&&!(t.year()===a&&t.month()>n);)i.push(this.getDaysOfWeek(t)),t.add(7,"d");return i},getVisibleYears:function(t){var n=e(t),r=n.year();n.year(r-r%10),r=n.year();for(var i,o,l=n.utcOffset()/60,s=[],c=0;c<12;c++)i=a(r,0,1,0-l),o=i.utcOffset()/60,o!==l&&(i=a(r,0,1,0-o),l=o),s.push(i),r++;return s},getDaysOfWeek:function(n){n=n?n:t?e.tz(t).day(0):e().day(0);for(var r,i,o=n.year(),l=n.month(),s=n.date(),c=[],u=n.utcOffset()/60,d=0;d<7;d++)r=a(o,l,s,0-u,0,!1),i=r.utcOffset()/60,i!==u&&(r=a(o,l,s,0-i,0,!1)),c.push(r),s++;return c},getVisibleMonths:function(e){for(var t,n,r=e.year(),i=e.utcOffset()/60,o=[],l=0;l<12;l++)t=a(r,l,1,0-i,0,!1),n=t.utcOffset()/60,n!==i&&(t=a(r,l,1,0-n,0,!1)),o.push(t);return o},getVisibleHours:function(e){var t,n,r,i=e.year(),o=e.month(),l=e.date(),s=[],c=e.utcOffset()/60;for(t=0;t<24;t++)n=a(i,o,l,t-c,0,!1),r=n.utcOffset()/60,r!==c&&(n=a(i,o,l,t-r,0,!1)),s.push(n);return s},isAfter:function(e,t){return e&&e.unix()>=t.unix()},isBefore:function(e,t){return e.unix()<=t.unix()},isSameYear:function(e,t){return e&&e.year()===t.year()},isSameMonth:function(e,t){return this.isSameYear(e,t)&&e.month()===t.month()},isSameDay:function(e,t){return this.isSameMonth(e,t)&&e.date()===t.date()},isSameHour:function(e,t){return this.isSameDay(e,t)&&e.hours()===t.hours()},isSameMinutes:function(e,t){return this.isSameHour(e,t)&&e.minutes()===t.minutes()},setParams:function(e){t=e},findFunction:function(e,t){var a=e;do if(a=a.$parent,angular.isFunction(a[t]))return a[t];while(a.$parent);return!1},findParam:function(e,t){var a=e;do if(a=a.$parent,a[t])return a[t];while(a.$parent);return!1},createMoment:function(a){return t?e.tz(a,t):e.isMoment(a)?e.unix(a.unix()):e(a)},getDate:function(e,t,a){var n=!1;return t[a]&&(n=this.createMoment(t[a]),n.isValid()||(n=this.findParam(e,t[a]),n&&(n=this.createMoment(n)))),n},eventIsForPicker:function(e,t){return angular.isArray(e)&&e.indexOf(t)>-1||e===t}}});var t=angular.module("datePicker");t.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(t,a,n){function r(t,a,r,i,o){return n.template(angular.extend(t,{ngModel:r,minDate:!(!i||!e.isMoment(i))&&i.format(),maxDate:!(!o||!e.isMoment(o))&&o.format()}),a)}function i(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(e,n,o){function l(t){e.$broadcast("pickerUpdate",d[0],{maxDate:t})}function s(t){e.$broadcast("pickerUpdate",d[1],{minDate:t})}var c=null,u=n[0].id,d=[i(),i()],f=a.createMoment,p=a.eventIsForPicker;e.dateChange=function(e,t){c&&c(e,t)},u&&e.$on("pickerUpdate",function(t,a,n){p(a,u)&&e.$broadcast("pickerUpdate",d,n)}),a.setParams(o.timezone),e.start=f(e.start),e.end=f(e.end),e.$watchGroup(["start","end"],function(e){s(e[0]),l(e[1])}),angular.isDefined(o.dateChange)&&(c=a.findFunction(e,o.dateChange)),o.onSetDate="dateChange";var m='<div><table class="date-range"><tr><td valign="top">'+r(o,d[0],"start",!1,e.end)+'</td><td valign="top">'+r(o,d[1],"end",e.start,!1)+"</td></tr></table></div>",g=t(m)(e);n.append(g)}}}]);var a="ng-pristine",n="ng-dirty",t=angular.module("datePicker");t.constant("dateTimeConfig",{template:function(e,t){return"<div "+(t?'id="'+t+'" ':"")+'date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.format?'format="'+e.format+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.maxDate?'max-date="'+e.maxDate+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.minDate?'min-date="'+e.minDate+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+(e.onSetDate?'date-change="'+e.onSetDate+'" ':"")+(e.ngModel?'ng-model="'+e.ngModel+'" ':"")+(e.timezone?'timezone="'+e.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils","$timeout",function(t,r,i,o,l,s,c){var u=r.find("body"),d=i("mFormat");return{require:"ngModel",scope:!0,link:function(r,i,c,f){function p(e){var t=d(e,C,E);return e||(f.$setViewValue(t),i.val(t)),t}function m(t){O=t,c.minDate=t?t.format():t,I=e.isMoment(t)}function g(t){j=t,c.maxDate=t?t.format():t,L=e.isMoment(t)}function h(){b=o.template(c)}function v(e){e.stopPropagation(),f.$pristine&&(f.$dirty=!0,f.$pristine=!1,i.removeClass(a).addClass(n),w&&w.$setDirty(),f.$render())}function $(){S&&(S.remove(),S=null),T&&(T.remove(),T=null)}function y(){if(!S){if(S=t(b)(r),r.$digest(),R||(r.$on("setDate",function(e,t,a){v(e),q&&q(c.ngModel,t),M&&D[D.length-1]===a&&$()}),r.$on("hidePicker",function(){i.triggerHandler("blur")}),r.$on("$destroy",$),R=!0),"absolute"===P){var e=angular.extend(i.offset(),{height:i[0].offsetHeight});S.css({top:e.top+e.height,left:e.left,display:"block",position:P}),u.append(S)}else T=angular.element("<div date-picker-wrapper></div>"),i[0].parentElement.insertBefore(T[0],i[0]),T.append(S),S.css({top:i[0].offsetHeight+"px",display:"block"});S.bind("mousedown",function(e){e.preventDefault()})}}var b,C=c.format||o.format,w=i.inheritedData("$formController"),D=l(c.views)(r)||o.views.concat(),k=c.view||D[0],x=D.indexOf(k),M=c.autoClose?l(c.autoClose)(r):o.autoClose,S=null,A=i[0].id,P=c.position||o.position,T=null,O=null,I=null,j=null,L=null,E=c.timezone||!1,F=s.eventIsForPicker,q=null,R=!1;x===-1&&D.splice(x,1),D.unshift(k),f.$formatters.push(p),f.$parsers.push(function(e){if(e)return c.format?d(e,_format):e.getTime()}),angular.isDefined(c.minDate)&&(m(s.findParam(r,c.minDate)),f.$validators.min=function(t){return!I||e.isMoment(t)&&(O.isSame(t)||O.isBefore(t))}),angular.isDefined(c.maxDate)&&(g(s.findParam(r,c.maxDate)),f.$validators.max=function(t){return!L||e.isMoment(t)&&(j.isSame(t)||j.isAfter(t))}),angular.isDefined(c.dateChange)&&(q=s.findFunction(r,c.dateChange)),A&&r.$on("pickerUpdate",function(e,t,a){if(F(t,A))if(S);else{var n=!1;angular.isDefined(a.minDate)&&(m(a.minDate),n=!0),angular.isDefined(a.maxDate)&&(g(a.maxDate),n=!0),angular.isDefined(a.minView)&&(c.minView=a.minView),angular.isDefined(a.maxView)&&(c.maxView=a.maxView),c.view=a.view||c.view,n&&f.$validate(),angular.isDefined(a.format)&&(C=c.format=a.format||o.format,f.$modelValue=-1),h()}}),i.bind("focus",y),i.bind("blur",$),h()}}}])}),define("main/controllers",["main/init"],function(){function e(e,t,a,n,r,i,o){function l(){if(e.mainConfig.getMainInfo){var a=e.mainConfig.getMainInfo;Config.serverPath&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&(a=e.mainConfig.serverPath+a),e.mainStatus.requestPath=Config.serverPath),$.ajax({url:a,type:"get",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){if(200==a.code){if(t.curUser=a.data,Config.applyBindUrl&&(!t.curUser.additional.OrganizationIds||0==t.curUser.additional.OrganizationIds.length))return void(window.location.href=Config.applyBindUrl);e.habbit={mainRole:e.getMainRole()},window.location.href.indexOf("#"+Config.indexPage)>-1&&e.goToMainRole(e.habbit.mainRole),angular.extend(e.mainStatus,a.data),e.$digest()}else 802==a.code?(alert(a.msg||"登录失败"),window.location.href=Config.loginHtmlUrl):alert(a.msg||"登录失败")}})}}t.store=r,e.mainStatus={navFold:document.body.clientWidth<1500,navigation:"",msgBubble:0},t.curUser={};var s=function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()};e.currentDate=s(),e.leftSideisShow=!0,e.$on("$locationChangeStart",function(t,a,n){a.indexOf("personalCenter")!==-1?e.leftSideisShow=!1:e.leftSideisShow=!0}),e.mainConfig=window.Config||{},e.pageTo=function(e){window.location.assign(e)},e.goTo=i.goTo,t.goTo=e.goTo,t.getObjectByKeyOfArr=i.getObjectByKeyOfArr,t.utils=i,t.modal=o,e.httpGet=function(t){return Config.serverPath&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&(t=e.mainConfig.serverPath+t),a.get(t)},e.logout=function(t){var a="";return Config.logoutUrl?(t||(t="POST"),Config.serverPath&&(a=Config.logoutUrl,0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&(a=e.mainConfig.serverPath+a)),void $.ajax({url:a,type:t,xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(e){window.location.href=Config.loginHtmlUrl}})):void alert("请设置注销接口")},e.hasAuthor=function(e){if(!t.curUser||!t.curUser.additional||!t.curUser.additional.Authoritys)return!1;var a=t.curUser.additional.Authoritys;return $.inArray(e,a)!=-1},t.hasAuthor=e.hasAuthor,l(),t.$on("loadMainInfo",function(){l()}),$(document).on("click",".top-nav-wrap .backBtn",function(){window.history.back()}),e.goToMainRole=function(t){switch(t||(t="客服"),e.habbit||(e.habbit={}),e.habbit.mainRole=t,r.set("habbit.mainRole",t),t){case"客服":e.goTo("#/main.html");break;case"销售":e.goTo("#/authorIndex/main-salemanager.html");break;case"总经理":e.goTo("#/authorIndex/main-generalmanager.html");break;case"采购":e.goTo("#/authorIndex/main-purchasemanager.html");break;case"库管":e.goTo("#/authorIndex/main-repertorymanager.html");break;case"验收":e.goTo("#/authorIndex/main-checkmanager.html");break;default:e.goTo("#/main.html")}},e.getMainRole=function(){var e=r.get("habbit.mainRole"),a="";if(t.hasAuthor("总经理")){if(a="总经理",e==a)return a}else if(t.hasAuthor("销售单查询")){if(a="销售",e==a)return a}else if(t.hasAuthor("采购单查询")){if(a="采购",e==a)return a}else if(t.hasAuthor("出入库单中心")){if(a="库管",e==a)return a}else if(t.hasAuthor("验单中心")){if(a="验收",e==a)return a}else if(t.hasAuthor("购需单查询")&&(a="客服",e==a))return a;return a}}function t(e){}function a(e,t,a,n){t.closeAll(),e.cancelThis=function(e,t,n){a(e,function(){window.history.go(-1)},t,n)},e.handleThisSubmit=function(t,n,r,i){a(t,function(){e.pageTo(i)},n,r,i)},e.easypiechart_options={animate:{duration:1e3,enabled:!0},barColor:"#f30",trackColor:"#ffe8ce",scaleColor:!1,lineWidth:8,lineCap:"round",size:125}}function n(e,t){t.closeAll()}angular.module("manageApp.main").controller("mainCtrl",["$scope","$rootScope","$http","$location","store","utils","modal",e]).controller("sideNav",["$scope",t]).controller("editCtrl",["$scope","modal",n]).controller("pageCtrl",["$scope","modal","dialogConfirm","$timeout",a])}),define("main/directives",["main/init"],function(){function ngView(e,t,a){return{restrict:"A",priority:-500,link:function(n,r){t.remove(e.current.loadedTemplateUrl),n.mainStatus.pageParams=a}}}function convertToDate(e){var t=e("date");return{require:"ngModel",link:function(e,a,n,r){var i=n.convertToDate?n.convertToDate:"yyyy-MM-dd";r.$parsers.push(function(e){if(e)return n.format?t(e,i):e.getTime()}),r.$formatters.push(function(){return r.$modelValue?n.timestamp?new Date(parseInt(r.$modelValue,10)).getTime():new Date(parseInt(r.$modelValue,10)):null})}}}function convertToNumber(){return{require:"ngModel",link:function(e,t,a,n){n.$parsers.push(function(e){return parseInt(e,10)}),n.$formatters.push(function(e){return""+e})}}}function convertJsonToObject(){return{require:"ngModel",link:function(e,t,a,n){n.$parsers.push(function(e){return e?angular.fromJson(e):null}),n.$formatters.push(function(e){return angular.toJson(e)})}}}function ajaxUrl(e,t,a,n,r){return{restrict:"AE",transclude:!0,link:function(e,i,o,l,s){function c(l){if(!angular.isDefined(o.ajaxIf)||o.ajaxIf){if(angular.isDefined(o.ajaxIfEval)){var s=e.$eval(o.ajaxIfEval);if(!s)return}e.isLoading=!0;var c=null;o.noshowLoading||(c=r(i)),o.scopeErrorMsg&&(e[o.scopeErrorMsg]=""),t(o.ajaxUrl,l).then(function(t){c&&c.hide();var n=t[0];e.ajaxUrlHandler&&(n=e.ajaxUrlHandler(n)),o.scopeResponse&&(e[o.scopeResponse]=t[1]),o.scopeData?e[o.scopeData]=n:e.scopeData=n,angular.isDefined(o.alertOk)&&a(t[1].msg),e.listCallback&&e.listCallback(t[1]),o.callback&&e.$eval(o.callback),e.isLoading=!1})["catch"](function(t){c&&c.hide(),o.errorCallback&&e.$eval(o.errorCallback),o.scopeErrorMsg&&(e[o.scopeErrorMsg]=t),angular.isDefined(o.alertError)&&n(t),$(".pr-full-loading").remove()})}}s(e,function(e){i.append(e)}),e.ajaxUrlHandler=e.$eval(o.ajaxUrlHandler);var u={};o.params?0===o.params.indexOf("{")?o.$observe("params",function(t){u=e.$eval(t),c(u)}):e.$watch(o.params,function(e){u=e,c(u)},!0):o.$observe("ajaxUrl",function(e){c({})}),e.$on("ajaxUrlReload",function(){c({})})}}}function formValidator(e,t,a,n,r,i){return{restrict:"A",link:function(i,o,l){function s(){if(c.submitting!==!0){c.submitting=!0;var r=!1;angular.isDefined(l.parameterBody)&&(r=!0,"false"==l.parameterBody&&(r=!1));var o=i.formData;l.formData&&(o=i[l.formData]),l.scopeErrorMsg&&(i[l.scopeErrorMsg]=""),l.scopeOkMsg&&(i[l.scopeOkMsg]="");var s="POST";l.httpMethod&&(s=l.httpMethod),e(l.action,o,s,r).then(function(e){var n=e[0],r=e[1];if(c.submitting=!1,c.submitInfo="",l.scopeResponse&&(i[l.scopeResponse]=e[1]),l.scopeData&&(i[l.scopeData]=n),angular.isDefined(l.alertOk)&&a(e[1].msg),l.scopeOkMsg&&(i[l.scopeOkMsg]=e[1].msg),"reset"==l.formSubmitAfter&&u.reset(),l.callback&&i.$eval(l.callback),l.broadcast&&(i.$broadcast(l.broadcast),i.$emit(l.broadcast)),!angular.isDefined(l.noCloseDialog)){if(r&&r.url)return void window.location.assign(r.url);angular.isFunction(i.submitCallBack)?i.submitCallBack.call(i,d,n):n&&n.url?window.location.assign(n.url):i.$broadcast("reloadList"),angular.isDefined(l.autoCloseDialog)&&t.close()}})["catch"](function(e){c.submitting=!1,c.submitInfo=e||"提交失败。",l.scopeErrorMsg&&(i[l.scopeErrorMsg]=e),angular.isDefined(l.alertError)&&n(e)})}}var c=i.formStatus={submitted:!1,submitting:!1,submitInfo:""},u=angular.element(o)[0],d=(i.$eval(l.name),i.ngDialogData);i.formData=angular.extend({},i.formData),i.$watch(l.source,function(e){e&&angular.isObject(e)&&angular.extend(i.formData,e)}),i.reset=function(){u.reset()},o.on("submit",function(e){e.preventDefault(),l.beforeConfirmMsg?r(l.beforeConfirmMsg,function(){s()},null):s()}),i.submitForm1=function(){o.trigger("submit")}}}}function tableList(e,t,a,n,r,i){return{restrict:"AE",scope:{listParams:"=?",listSelected:"=?",listSource:"=?"},transclude:!0,require:"?^ngModel",link:function(o,l,s,c,u){function d(t){if(s.listData){if(s.listSource)return void(o.listSource&&(o.tbodyList=angular.isArray(o.listSource)?o.listSource:o.listSource.list,o.listSource.options&&(m.totalCount=o.listSource.options.totalCount||m.totalCount,m.pageSize=o.listSource.options.pageSize||m.pageSize,m.totalPage=Math.ceil(m.totalCount/m.pageSize)),t&&t()));if(!angular.isDefined(s.ajaxIf)||s.ajaxIf){if(angular.isDefined(s.ajaxIfEval)){var a=o.$eval(s.ajaxIfEval);if(!a)return}if(!m.isLoading){m.isLoading=!0,o.isLoading=m.isLoading;var c=null;s.noshowLoading||(c=r(l)),e(s.listData,angular.merge({},g,{pageNo:m.currentPage})).then(function(e){c&&c.hide();var a=e[1];200==a.code?(m.totalCount=a.totalCount,m.pageSize=a.pageSize,m.totalCount&&m.pageSize&&(m.totalPage=Math.ceil(m.totalCount/m.pageSize)),a.thead&&(o.theadList=a.thead),o.resultsData=a,a.data&&a.data.length>0?o.tbodyList=a.data:m.isFinished=!0,m.loadFailMsg=a.message):(m.isFinished=!0,m.loadFailMsg=a.message),m.isLoading=!1,o.isLoading=!1,n(p),t&&t()})["catch"](function(e){c&&c.hide(),m.isLoading=!1,i(e),m.loadFailMsg=e,t&&t()})}}}}function f(){var e=[];o.listSelected.length=0,$(".selectOne:checked",l).each(function(){e.push(this.value)}),[].unshift.apply(o.listSelected,e);var t=[];angular.forEach(o.tbodyList,function(e){angular.forEach(o.listSelected,function(a){e.id==a&&t.push(e)})}),c&&c.$setViewValue(t)}function p(){$(".selectOne",l).on("click",function(e){e.stopPropagation();var t=$(".selectOne",l).length,a=$(".selectOne:checked",l).length;a>0&&a<t?$(".selectAll",l).prop("checked",!1).get(0).indeterminate=!0:t==a?$(".selectAll",l).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",l).prop("checked",!1).get(0).indeterminate=!1,f(),o.$apply()})}var m={currentPage:1,totalCount:0,pageSize:10,totalPage:1,isFinished:!1,isLoading:!1};o.mainStatus=o.$parent.mainStatus,o.parent=o.$parent,o.status=m,o.listData=s.listData,o.theadList=angular.fromJson(s.listThead),o.tbodyList=[],o.getListData=d,angular.isDefined(o.listParams)||(o.listParams={}),angular.isDefined(o.listSelected)||(o.listSelected=[]),o.delSelected=function(t){a("确定删除这些?",function(){e(t,{ids:o.listSelected.join(",")}).then(function(){o.$broadcast("reloadList")})["catch"](function(e){alert(e||"删除错误")})})},o.deleteThis=function(t,n){var r=this.tr;a("确定删除?",function(){e(t,{id:n},"POST").then(function(){o.tbodyList.splice(o.tbodyList.indexOf(r),1),0===o.tbodyList.length&&o.$broadcast("reloadList")})["catch"](function(e){alert(e||"删除错误")})})},o.dothing=function(t,n,r){var i=this.tr;a(r,function(){e(t,n,"POST").then(function(){o.tbodyList.splice(o.tbodyList.indexOf(i),1),0!==o.tbodyList.length&&o.$broadcast("reloadList")})["catch"](function(e){alert(e||"删除错误")})})},o.selectThis=function(){var e=this.tr,t=o.tbodyList.indexOf(e),a=l.find("tbody tr");a.removeClass("on").eq(t).addClass("on"),c&&c.$setViewValue(angular.copy(e))},o.changeStatus=function(t,n){var r=this.tr;a(n||"确定?",function(){e(t,{id:r.id}).then(function(e){var t=e[0],a=o.tbodyList.indexOf(r);o.tbodyList[a]=t})["catch"](function(e){alert(e||"请求失败!")})})},o.submitCallBack=function(e,a){t.closeAll(),a&&e?angular.forEach(o.tbodyList,function(t,n){t.id==e.id&&(o.tbodyList[n]=a)}):n(function(){o.$broadcast("reloadList")})};var g={};o.$on("deleteSelected",function(e,t){$(".selectOne[value="+t.id+"]",l).prop("checked",!1);var a=$(".selectOne",l).length,n=$(".selectOne:checked",l).length;n>0&&n<a?$(".selectAll",l).prop("checked",!1).get(0).indeterminate=!0:a==n?$(".selectAll",l).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",l).prop("checked",!1).get(0).indeterminate=!1;var r=[];o.listSelected.length=0,$(".selectOne:checked",l).each(function(){r.push(this.value)}),[].unshift.apply(o.listSelected,r),f()}),o.$watchCollection("listSource",function(e){e&&d(f)}),o.$watch("listParams",function(){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],g=angular.copy(o.listParams),g.q&&(g.q="(?i)"+g.q),d(f),$(".selectAll",l).length>0&&($(".selectAll",l).prop("checked",!1).get(0).indeterminate=!1)},!0),s.$observe("listData",function(e){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],g=angular.copy(o.listParams),d(f),$(".selectAll",l).length>0&&($(".selectAll",l).prop("checked",!1).get(0).indeterminate=!1)}),o.$on("reloadList",function(){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],g=angular.copy(o.listParams),d(f),$(".selectAll",l).length>0&&($(".selectAll",l).prop("checked",!1).get(0).indeterminate=!1)}),$(l).on("click",".selectAll",function(){this.indeterminate?(this.checked=!1,$(".selectOne",l).prop("checked",!1)):$(".selectOne",l).prop("checked",this.checked),f(),o.$apply()}),u(o,function(e){l.append(e)})}}}function tableCell(){return{restrict:"AE",scope:{row:"="},replace:!0,templateUrl:Config.tplPath+"tpl/table-cell.html",link:function(e,t,a){e.cells=[],angular.isString(e.row)||angular.isNumber(e.row)?e.cells.push({text:e.row}):angular.isArray(e.row)?angular.forEach(e.row,function(t){angular.isObject(t)?e.cells.push(t):e.cells.push({text:t})}):e.cells.push(e.row)}}}function pagination(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/pagination.html",link:function(e,t,a){function n(e,t,a){return{number:e,text:t,active:a}}function r(e,t){var a=[],r=1,l=t,s=angular.isDefined(i)&&i<t;s&&(o?(r=Math.max(e-Math.floor(i/2),1),l=r+i-1,l>t&&(l=t,r=l-i+1)):(r=(Math.ceil(e/i)-1)*i+1,l=Math.min(r+i-1,t)));for(var c=r;c<=l;c++){var u=n(c,c,c===e);a.push(u)}if(s&&!o){if(r>1){var d=n(r-1,"...",!1);a.unshift(d)}if(l<t){var f=n(l+1,"...",!1);a.push(f)}}return a}var i=angular.isDefined(a.maxSize)?e.$parent.$eval(a.maxSize):10,o=!angular.isDefined(a.rotate)||e.$parent.$eval(a.rotate);e.start=function(){1!=e.status.currentPage&&(e.status.currentPage=1,e.getListData())},e.prev=function(){e.status.currentPage<=1||(e.status.currentPage--,e.getListData())},e.next=function(){e.status.currentPage>=e.status.totalPage||(e.status.currentPage++,e.getListData())},e.end=function(){e.status.currentPage!=e.status.totalPage&&(e.status.currentPage=e.status.totalPage,e.getListData())},e["goto"]=function(t){e.status.currentPage=t,e.getListData()},e.$watch("status.totalPage",function(){e.pages=r(e.status.currentPage,e.status.totalPage)}),e.$watch("status.currentPage",function(){e.pages=r(e.status.currentPage,e.status.totalPage)})}}}function pagination2(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/pagination2.html",link:function(e,t,a){e.start=function(){1!=e.status.currentPage&&(e.status.currentPage=1,e.getListData())},e.prev=function(){e.status.currentPage<=1||(e.status.currentPage--,e.getListData())},e.next=function(){e.status.currentPage>=e.status.totalPage||(e.status.currentPage++,e.getListData())},e.end=function(){e.status.currentPage!=e.status.totalPage&&(e.status.currentPage=e.status.totalPage,e.getListData())}}}}function filterConditions(e){return{restrict:"AE",scope:{},transclude:!0,link:function(t,a,n,r,i){function o(){var e={};angular.forEach(t.filterConditions.list,function(t){e[t.type]=t.id}),t.filterParams=e}t.filterParams={},t.filterConditions={list:[]};var l=t.filterConditions;t.conditionList={},t.selectCondition=function(e,t){t.type=e,l[e]=t,l.list.push(t),o()},t.deleteCondition=function(e){var t=l.list.indexOf(e);l.list.splice(t,1),delete l[e.type],o()},n.filterConditions&&!function(){e(n.filterConditions).then(function(e){var a=e[0];t.conditionList=a})}(),i(t,function(e){a.append(e)})}}}function treeList(e,t,a){return{restrict:"AE",scope:{},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/tree.html",link:function(n,r,i,o){function l(){n.status.isLoading=!0,t(i.treeList).then(function(t){var o=t[0];n.treeList=e(o,i.pidKey),n.status.isLoading=!1,s&&angular.isDefined(i.selectFirst)&&(s=!1,a(function(){for(var e=r.find("em"),t=0,a=e.length;t<a&&(e.eq(t).trigger("click"),0!=e.eq(t).next("ul").length);t++);}))})["catch"](function(){n.status.isLoading=!1})}var s=!0;n.status={},n.treeList=[],n.curTree={},n.status.isLoading=!0,n.selectTree=function(e,t){var a=r.find("li"),n=$(t.currentTarget),i=n.parent("li"),l=angular.copy(e);0==l.nodes.length?(a.removeClass("on"),i.addClass("on"),o&&o.$setViewValue(l)):i.hasClass("fold")?i.removeClass("fold"):i.addClass("fold")},i.$observe("treeList",l)}}}function treeList2(e,t,a,n,r){return{restrict:"AE",require:"?^ngModel",link:function(n,i,o,l){function s(){n.status.isLoading=!0,t(o.treeList2,u).then(function(t){var a=t[0];n.treeList=e(a,o.pidKey),n.status.isLoading=!1})["catch"](function(){n.status.isLoading=!1})}var c=angular.isDefined(o.selectGroup);n.status={},n.treeList=[],n.curTree={},
n.status.isLoading=!0,angular.isDefined(n.listParams)||(n.listParams={});var u={};n.selectTree=function(e,t){var a=i.find("li"),n=$(t.currentTarget),r=n.parent("li"),o=angular.copy(e);0==o.nodes.length||c?(a.removeClass("on"),r.addClass("on"),delete o.nodes,l&&l.$setViewValue(o)):r.hasClass("fold")?r.removeClass("fold"):r.addClass("fold")},n.extendTree=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),a=t.parent().parent("li");a.hasClass("fold")?(a.removeClass("fold"),t.parent().next().hide()):(a.addClass("fold"),t.parent().next().show())},n.deleteTree=function(e,a){e.preventDefault(),e.stopPropagation(),r("是否删除?",function(){t(a).then(function(){s()})})},n.addTree=function(e,t){e.preventDefault(),e.stopPropagation(),a.closeAll(),a.open({template:t,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:!1,scope:n,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(400)}]})},n.$watch("listParams",function(){u=angular.copy(n.listParams),s()},!0),o.$observe("treeList2",s),n.submitCallBack=function(e,t){a.closeAll(),s()}}}}function navList(e){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(t,a,n,r,i){function o(a){return n.listSource?(t.tbodyList=t.listSource,void(a&&a())):(l.isLoading=!0,void e(n.navList).then(function(e){var a=e[0];t.isLoading=!1,t.listData=a.data,t.select(t.listData[0])})["catch"](function(){t.isLoading=!1}))}i(t,function(e){a.append(e)});var l={isLoading:!0};t.status=l,t.currentSelect={};t.select=function(e){t.currentSelect=e,r&&r.$setViewValue(e)},o()}}}function selectAsync(e){return{restrict:"A",scope:{},require:"?^ngModel",link:function(t,a,n,r){e(n.selectAsync).then(function(e){var t=e[0],n='<option value="">请选择</option>';t||(t=[]);for(var i=t.length,o=0;o<i;o++)n+='<option value="'+t[o].value+'">'+t[o].text+"</option>";a.html(n),r&&a.val(r.$viewValue)})}}}function relativeSelect(e,t){return{restrict:"A",scope:{},require:"?^ngModel",link:function(a,n,r,i){function o(){var e={};e[n[0].name]=n.val(),$(s).trigger("update",e)}function l(t){e(c,t).then(function(e){var t=e[0],a=u?"":'<option value="">请选择</option>';t||(t=[]);for(var r=t.length,l="",s=0;s<r;s++)(t[s].selected||u&&0==s)&&(l=t[s].value),a+="<option "+(0===t[s].enabled?' class="text-muted"':"")+' value="'+t[s].value+'">'+t[s].text+"</option>";n.html(a),n.val(l),i&&i.$setViewValue(l),o()})}var s=r.relativeTo,c=r.relativeSelect,u=angular.isDefined(r.selectFirst),d=angular.isDefined(r.relativeInitload);n.on("change",o),n.on("update",function(e,t){l(t)}),d&&t(o)}}}function eChart(requestData,dialogChart,alertError){return{restrict:"A",scope:{clickToUrl:"@",clickToDialog:"@",clickTopToUrl:"@",clickTopToDialog:"@",eChartKey:"@",eChartMap:"=",eChartMapData:"=",chartParams:"="},require:"?^ngModel",link:function($scope,$element,$attrs,ngModel){$scope.isLoading=!1,require(["echarts"],function(echarts){function reSize(){myChart.resize()}function loadChart(_url,_params){$scope.isLoading||($scope.isLoading=!0,myChart.showLoading(),Config.serverPath&&0!==_url.indexOf("http://")&&0!==_url.indexOf("https://")&&(_url=Config.serverPath+_url),$.ajax({url:_url,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"text",success:function(text){myChart.hideLoading(),$scope.isLoading=!1;var results=eval("("+text+")"),_data=results.data;_data&&($scope.eChartKey&&($scope.$parent.eChartMapData||($scope.$parent.eChartMapData={}),$scope.$parent.eChartMapData[$scope.eChartKey]=_data),_data.polar?_data.tooltip.formatter=function(e){var t=e[0].name;return angular.forEach(e,function(e){t+="<br>"+e.seriesName+": "+e.data}),t}:_data.tooltip&&_data.tooltip.formatter&&0===_data.tooltip.formatter.indexOf("function")&&(_data.tooltip.formatter=eval("("+_data.tooltip.formatter+")")),myChart.setOption(_data))},error:function(e){$scope.isLoading=!1}}))}var myChart=echarts.init($element[0]);$scope.eChartKey&&($scope.$parent.eChartMap||($scope.$parent.eChartMap={}),$scope.$parent.eChartMap[$scope.eChartKey]=myChart),$(window).on("resize",reSize),$scope.$on("$destroy",function(){$(window).off("resize",reSize),myChart.dispose()}),myChart.on("click",function(e){console.log(e),console.log($scope),e.data?$scope.clickToUrl?(ngModel&&ngModel.$setViewValue(e.data),window.location.assign($scope.clickToUrl)):$scope.clickToDialog&&(ngModel&&ngModel.$setViewValue(e.data),dialogChart($scope.$parent.mainConfig.viewsDir+$scope.clickToDialog)):$scope.clickTopToUrl?(ngModel&&ngModel.$setViewValue(e),window.location.assign($scope.clickTopToUrl)):$scope.clickTopToDialog&&(ngModel&&ngModel.$setViewValue(e),dialogChart($scope.$parent.mainConfig.viewsDir+$scope.clickTopToDialog))}),angular.isDefined($attrs.chartParams)?$scope.$watch("chartParams",function(e){loadChart($attrs.chart,e)},!0):$attrs.$observe("chart",function(e){loadChart($attrs.chart)}),loadChart($attrs.chart,$scope.chartParams)})}}}function angucomplete(e,t,a,n){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/autocomplete.html",link:function(e,r,i,o){e.lastSearchTerm=null,e.currentIndex=null,e.justChanged=!1,e.searchTimer=null,e.hideTimer=null,e.searching=!1,e.pause=300,e.minLength=1,e.searchStr=null;var l=function(t,a){return t.length>=e.minLength&&t!=a};e.processResults=function(t,n){if(t&&t.length>0){e.results=[];var r=[];e.titleField&&""!=e.titleField&&(r=e.titleField.split(","));for(var i=0;i<t.length;i++){for(var o=[],l=0;l<r.length;l++)o.push(t[i][r[l]]);var s="";e.descriptionField&&(s=t[i][e.descriptionField]);var c=o.join(" ");if(e.matchClass){var u=new RegExp(n,"i"),d=c.match(u)[0];c=a.trustAsHtml(c.replace(u,'<span class="'+e.matchClass+'">'+d+"</span>"))}var f={id:t[i].id,title:c,description:s,originalObject:t[i]};e.results[e.results.length]=f}}else e.results=[]},e.searchTimerComplete=function(a){if(a.length>=e.minLength)if(e.localData){for(var n=e.searchFields.split(","),r=[],i=0;i<e.localData.length;i++){for(var o=!1,l=0;l<n.length;l++)o=o||"string"==typeof e.localData[i][n[l]]&&"string"==typeof a&&e.localData[i][n[l]].toLowerCase().indexOf(a.toLowerCase())>=0;o&&(r[r.length]=e.localData[i])}e.searching=!1,e.processResults(r,a)}else t(e.url,{q:a}).then(function(t){var n=t[0];e.searching=!1,e.processResults(n,a)})["catch"](function(t){e.searching=!1,console.error(t)})},e.hideResults=function(){e.hideTimer=n(function(){e.showDropdown=!1},e.pause)},e.resetHideResults=function(){e.hideTimer&&n.cancel(e.hideTimer)},e.hoverRow=function(t){e.currentIndex=t},e.keyPressed=function(t){38!=t.which&&40!=t.which&&13!=t.which?e.searchStr&&""!=e.searchStr?l(e.searchStr,e.lastSearchTerm)&&(e.lastSearchTerm=e.searchStr,e.showDropdown=!0,e.currentIndex=-1,e.results=[],e.searchTimer&&n.cancel(e.searchTimer),e.searching=!0,e.searchTimer=n(function(){e.searchTimerComplete(e.searchStr)},e.pause)):(e.showDropdown=!1,e.lastSearchTerm=null):t.preventDefault()},e.selectResult=function(t){e.matchClass&&(t.title=t.title.toString().replace(/(<([^>]+)>)/gi,"")),e.searchStr=e.lastSearchTerm=t.title,e.selectedItem=t,e.showDropdown=!1,e.results=[],o&&o.$setViewValue(t.id)};var s=r.find("input");s.on("keyup",e.keyPressed),r.on("keyup",function(t){40===t.which?(e.results&&e.currentIndex+1<e.results.length&&(e.currentIndex++,e.$apply(),t.preventDefault,t.stopPropagation()),e.$apply()):38==t.which?e.currentIndex>=1&&(e.currentIndex--,e.$apply(),t.preventDefault,t.stopPropagation()):13==t.which?e.results&&e.currentIndex>=0&&e.currentIndex<e.results.length?(e.selectResult(e.results[e.currentIndex]),e.$apply(),t.preventDefault,t.stopPropagation()):(e.results=[],e.$apply(),t.preventDefault,t.stopPropagation()):27==t.which?(e.results=[],e.showDropdown=!1,e.$apply()):8==t.which&&(e.selectedItem=null,e.$apply())})}}}function checkboxGroup(){return{restrict:"A",scope:{checkboxGroup:"="},link:function(e,t,a){angular.isArray(e.checkboxGroup)||(e.checkboxGroup=[]),t.on("click",function(){var n=-1;angular.isArray(e.checkboxGroup)||(e.checkboxGroup=[]),angular.isArray(e.checkboxGroup)&&(n=e.checkboxGroup.indexOf(a.value)),t[0].checked?n===-1&&e.checkboxGroup.push(a.value):n!==-1&&e.checkboxGroup.splice(n,1),e.$apply()}),e.$watchCollection("checkboxGroup",function(n){n&&e.checkboxGroup.indexOf(a.value)!==-1&&(t[0].checked=!0)})}}}function chosen(e,t,a,n,r){return{restrict:"A",require:"?^ngModel",link:function(i,o,l,s){function c(){var e={};e.value=o.val(),i[l.selectCallBack](e)}var u={search_contains:!0,no_results_text:"没有找到",display_selected_options:!1};l.selectCallBack&&(o.on("change",c),o.on("update",function(e,t){getData(t)}));var d=null;l.width&&(u.width=l.width),require(["chosen"],function(){function c(e){try{e&&e.data("chosen").destroy()}catch(t){}}function f(e){l.params&&0===l.params.indexOf("{")&&(g=i.$eval(l.params));var t=null;$("option:selected",o).not(":empty").clone().attr("selected",!0);h&&(h.abort(),t&&t.hide()),t=r(o,"chosen"),g.q=e,g.id=s.$viewValue,h=$.ajax({url:D,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,data:g,dataType:"json",success:function(n){if(t&&t.hide(),200==n.code){a.isLoading=!1;var r="";n.data||(n.data=[]),0===n.data.length&&n.data.push({value:"",text:""});for(var i=n.data.length,c=angular.isArray(s.$viewValue)?s.$viewValue:[s.$viewValue],u=n.data,d=0;d<i;d++)r+='<option value="'+u[d].value+'"'+(c.indexOf(u[d].value)>-1?"selected":"")+">"+u[d].text+"</option>";o.html(r),o.trigger("chosen:updated");var f=$.Event("keydown");f.which=39,y.val(e).trigger(f),n.data.length>0?v.find(".no-results").hide():v.find(".no-results").show()}else angular.isDefined(l.alertError)&&alet(n.msg)},error:function(e){t&&t.hide()},complete:function(){i.$digest()}})}function p(e){var a=$(this);if(e.keyCode&&13===e.keyCode&&!s.$viewValue)try{s.$setViewValue(d[0][0].value)}catch(e){}if("paste"===e.type&&a.is(":not(:focus)")||e.keyCode&&(9===e.keyCode||13===e.keyCode||16===e.keyCode||17===e.keyCode||18===e.keyCode||19===e.keyCode||20===e.keyCode||27===e.keyCode||33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||44===e.keyCode||45===e.keyCode||144===e.keyCode||145===e.keyCode||91===e.keyCode||93===e.keyCode||224===e.keyCode||e.keyCode>=112&&e.keyCode<=123))return!1;if(C&&32!=e.keyCode&&(e.keyCode<48||e.keyCode>57))return!1;v.find(".no-results").hide();var n=$.trim(a.val());return!(!n&&b==n)&&(w=!0,i.searchTimer&&t.cancel(i.searchTimer),void(i.searchTimer=t(function(){w=!1,f(n)},500)))}function m(){if(angular.isDefined(l.ajaxIf)){if(0===l.ajaxIf.indexOf("{")){var t=i.$eval(l.ajaxIf);if(!t)return}if(!l.ajaxIf)return}if(angular.isDefined(l.ajaxIfEval)){var t=i.$eval(l.ajaxIfEval);if(!t)return}e(l.selectSource,g).then(function(e){var t=e[0],a="";t||(t=[]);var n=t.length,r=null,f=t[0]?t[0].value:null;r=angular.isDefined(l.multiple)?angular.isDefined(l.defaultEmpty)?s.$viewValue?s.$viewValue:[]:s.$viewValue?s.$viewValue:[f]:angular.isDefined(l.defaultEmpty)?s.$viewValue?s.$viewValue:"":s.$viewValue?s.$viewValue:f,null==r&&(r=""),angular.isDefined(l.defaultEmpty)&&(a+='<option value=""  >'+l.defaultEmpty+"</option>");for(var p=0;p<n;p++)a+='<option value="'+t[p].value+'"'+(r.indexOf(t[p].value)>-1?"selected":"")+">"+t[p].text+"</option>";o.html(a),c(d),d=o.chosen(i.chosen||u),s.$setViewValue(r)})["catch"](function(e){l.scopeErrorMsg&&(i[l.scopeErrorMsg]=e),angular.isDefined(l.alertError)&&n(e)})}if(l.selectSource){var g={};if(angular.isDefined(l.chosenAjax)){d=o.chosen(u);var h,v=o.next(),y=$("input",v),b="",C=!1,w=!1,D=l.selectSource;Config.serverPath&&0!==D.indexOf("http://")&&0!==D.indexOf("https://")&&(D=Config.serverPath+D),s.$viewValue&&f(""),$(".chosen-search > input, .chosen-choices .search-field input",v).on("keyup",p).on("paste",function(e){var t=this;setTimeout(function(){p.call(t,e)},500)}).on("keydown",function(e){C=229==e.keyCode}).on("blur",function(e){if(!s.$viewValue)try{d&&d.data("chosen").single_set_selected_text()}catch(e){}})}else{var k=l.selectSource;l.params?(k=l.params,0===l.params.indexOf("{")?(l.$observe("params",function(e){g=i.$eval(e),k!=e&&(s.$setViewValue(null),m(g))}),g=i.$eval(l.params)):(i.$watch(l.params,function(e){g=e,k!=e&&(s.$setViewValue(null),m(g))},!0),g=l.params)):l.$observe("selectSource",function(e){k!=e&&(s.$setViewValue(null),m())}),l.clearWatchScope&&i.$watch(l.clearWatchScope,function(e,t){d&&!e&&m()}),m()}}else o.append("<option value=''></option>"),o.chosen(i.chosen||u)})}}}function formItem(e){return{restrict:"AE",scope:!0,replace:!0,link:function(t,a,n){var r=t.$eval(n.src),i="";switch(r.type){case"text":i='<input type="'+r.type+'" name="'+r.key+'" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\" ng-model=\"formData['"+r.key+'\']" class="ipt" placeholder="'+r.placeholder+'" />';break;case"hidden":i='<input type="'+r.type+'" name="'+r.key+'" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\" ng-model=\"formData['"+r.key+"']\"/>";break;case"date":i='<input type="'+r.type+'" name="'+r.key+'" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\" ng-model=\"formData['"+r.key+'\']" class="ipt" placeholder="'+r.placeholder+'" convert-to-date/>';break;case"checkbox":i='<div class="form-ctrl" ng-init="formData[\''+r.key+"']=['"+(r.value||"")+"']\">",angular.forEach(r.options,function(e){i+='<label class="label"><input type="'+r.type+'" name="'+r.key+'" checkbox-group="formData[\''+r.key+'\']"  value="'+e+'" /> '+e+"</label>"}),i+="</div>";break;case"radio":i='<div class="form-ctrl" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\">",angular.forEach(r.options,function(e){i+='<label class="label"><input type="'+r.type+'" name="'+r.key+'" ng-model="formData[\''+r.key+'\']"  value="'+e+'" /> '+e+"</label>"}),i+="</div>";break;case"select":i='<select class="select select-w" name="'+r.key+'" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\" ng-model=\"formData['"+r.key+"']\"  >",i+='<option value="" >请选择</option>',angular.forEach(r.options,function(e){i+='<option value="'+e+'" >'+e+"</option>"}),i+="</select>";break;case"textarea":i='<textarea name="'+r.key+'" ng-init="formData[\''+r.key+"']='"+(r.value||"")+"'\" ng-model=\"formData['"+r.key+'\']"  class="textarea" placeholder="'+r.placeholder+'"></textarea>'}a.append(e(i)(t))}}}function customConfig(e){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(t,a,n,r,i){e(function(){r&&(t.dataList=r.$viewValue||[])}),t.$watchCollection("dataList",function(e){e&&r&&r.$setViewValue(e)}),t.addRow=function(){t.dataList.push({})},t.delRow=function(e){t.dataList.splice(e,1)},i(t,function(e){a.append(e)})}}}function autoComplete(){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(e,t,a,n,r){var i={parse:function(e){var t=[];if(!e||!e.data)return t;for(var a=e.data,n=0;n<a.length;n++){var r=$.trim(a[n]);r&&(row=r.split("|"),t[t.length]={data:r,value:row[0],result:row[0]})}return t},formatItem:function(e){return e},noRecord:"没匹配数据",dataType:"json"};require(["autocomplete"],function(){if(a.autoComplete){var e=a.autoComplete;Config.serverPath&&0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&(e=Config.serverPath+e);var n=null;t.focus(function(){null==n&&(i.width=t.css("width"),n=t.autocomplete(e,i),n.result(function(e,t,a){console.log(t)}))})}})}}}function selectAddress(e,t,a){var n,r,i;return r=t.defer(),i=Config.tplPath+"tpl/cascading-select-address/cascading-select-address.html",n=Config.tplPath+"tpl/cascading-select-address/city.min.js",e.get(n).success(function(e){return r.resolve(e)}),{restrict:"A",scope:{p:"=",a:"=",c:"=",d:"=",ngModel:"="},link:function(t,n,o){var l;return l={element:null,backdrop:null,show:function(){return this.element.addClass("active")},hide:function(){return this.element.removeClass("active"),!1},resize:function(){if(this.element)return this.element.css({top:-this.element.height()-30,"margin-left":-this.element.width()/2}),!1},focus:function(){return $('[ng-model="d"]').focus(),!1},init:function(){return n.on("click keydown",function(){return l.show(),event.stopPropagation(),!1}),this.element.on("click",function(){return event.stopPropagation()}),setTimeout(function(e){return function(){return e.element.show(),e.resize()}}(this),500)}},r.promise.then(function(n){return e.get(i).success(function(e){var r;return r=a(e)(t),$("body").append(r),l.element=$(r[2]),t.provinces=n,l.init()}),t.aSet={p:function(e){return t.p=e,t.c=null,t.a=null,t.d=null},c:function(e){return t.c=e,t.a=null,t.d=null},a:function(e){return t.a=e,t.d=null,l.focus()}},t.clear=function(){return t.p=null,t.c=null,t.a=null,t.d=null},t.submitAddress=function(){return l.hide()},t.$watch("p",function(e){var a,r,i,o;if(e)for(o=[],r=0,i=n.length;r<i;r++)a=n[r],a.p===e&&o.push(t.cities=a.c);return t.cities?o:(t.cities=[],t.cities)}),t.$watch("c",function(e){var a,n,r,i,o;if(e){for(i=t.cities,o=[],n=0,r=i.length;n<r;n++)a=i[n],a.n===e&&o.push(t.dists=a.a);return o}return t.dists=[]}),t.$watch(function(){return t.ngModel="",t.p&&(t.ngModel+=t.p),t.c&&(t.ngModel+=" "+t.c),t.a&&(t.ngModel+=" "+t.a),t.d&&(t.ngModel+=" "+t.d),l.resize()})})}}}function ajaxUrlSubmit(e,t,a,n,r,i){return{restrict:"AE",transclude:!0,link:function(e,o,l,s,c){function u(s){if(!angular.isDefined(l.ajaxIf)||l.ajaxIf){if(angular.isDefined(l.ajaxIfEval)){var c=e.$eval(l.ajaxIfEval);if(!c)return}e.isLoading=!0;var u=null;l.noshowLoading||(u=r(o));var d=!1;angular.isDefined(l.parameterBody)&&(d=!0),l.scopeErrorMsg&&(e[l.scopeErrorMsg]="");var f="POST";l.httpMethod&&(f=l.httpMethod),t(l.ajaxUrlSubmit,s,f,d).then(function(t){u&&u.hide(),e.isLoading=!1;var n=t[0];e.ajaxUrlHandler&&(n=e.ajaxUrlHandler(n)),l.scopeResponse&&(e.$parent[l.scopeResponse]=t[1]),l.scopeData?e.$parent[l.scopeData]=n:e.scopeData=n,angular.isDefined(l.alertOk)&&a(t[1].msg),e.listCallback&&e.listCallback(t[1]),l.callback&&e.$parent.$eval(l.callback),l.broadcast&&(e.$broadcast(l.broadcast),e.$emit(l.broadcast)),angular.isDefined(l.autoCloseDialog)&&i.close()})["catch"](function(t){u&&u.hide(),l.scopeErrorMsg&&(e.$parent[l.scopeErrorMsg]=t),angular.isDefined(l.alertError)&&n(t),l.errorCallback&&e.$parent.$eval(l.callback),$(".pr-full-loading").remove()})}}c(e,function(e){o.append(e)}),e.ajaxUrlHandler=e.$eval(l.ajaxUrlHandler),o.on("click",function(t){var a={};l.params&&(a=0===l.params.indexOf("{")?e.$eval(l.params):e.$parent[l.params]),u(a)})}}}function invalidPopover(){return{restrict:"A",scope:{popoverOptions:"@"},link:function(e,t,a){function n(e){t.data("isFocus")&&"true"==e?t.popover("show"):t.popover("hide")}t.popover(JSON.parse(e.popoverOptions||'{ "placement": "right", "trigger": "manual" }')),t.focus(function(){t.data("isFocus",!0),n(a.invalidPopover)}),a.$observe("invalidPopover",function(e){n(e)})}}}function watchFormChange(e){return{restrict:"AE",link:function(t,a,n,r){t.watchFormChange=function(a){e(a,t)}}}}function datepicker(e){var t={format:"YYYY-MM-DD"};return{restrict:"EA",require:"ngModel",link:function(e,a,n,r){var i=require("moment"),o=n.format||t.format;r.$parsers.push(function(e){if(e){var t=i(e,o).format("x");return t}}),r.$formatters.push(function(){if(!r.$modelValue)return null;var e=r.$modelValue,t=i(parseInt(e,10)).format(o);return t}),a.datepicker({changeYear:!0,changeMonth:!0,dateFormat:"yy-mm-dd",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],onSelect:function(t){e.$apply(function(){r.$setViewValue(t)})}})}}}convertJsonToObject.$inject=[],filterConditions.$inject=["requestData"],treeList.$inject=["buildTree","requestData","$timeout"],treeList2.$inject=["buildTree","requestData","modal","$timeout","dialogConfirm"],navList.$inject=["requestData"],selectAsync.$inject=["requestData"],relativeSelect.$inject=["requestData","$timeout"],eChart.$inject=["requestData","dialogChart","alertError"],angucomplete.$inject=["$parse","requestData","$sce","$timeout"],chosen.$inject=["requestData","$timeout","$rootScope","alertError","proLoading"],formItem.$inject=["$compile"],customConfig.$inject=["$timeout"],angular.module("manageApp.main").directive("datepicker",["$filter",datepicker]).directive("watchFormChange",["watchFormChange",watchFormChange]).directive("invalidPopover",["$route","$templateCache","$routeParams",invalidPopover]).directive("ngView",["$route","$templateCache","$routeParams",ngView]).directive("convertToDate",["$filter",convertToDate]).directive("convertToNumber",convertToNumber).directive("convertJsonToObject",convertJsonToObject).directive("ajaxUrlSubmit",["$timeout","requestData","alertOk","alertError","proLoading","modal",ajaxUrlSubmit]).directive("ajaxUrl",["$timeout","requestData","alertOk","alertError","proLoading",ajaxUrl]).directive("formValidator",["requestData","modal","alertOk","alertError","dialogConfirm","$timeout",formValidator]).directive("tableList",["requestData","modal","dialogConfirm","$timeout","proLoading","alertError",tableList]).directive("tableCell",tableCell).directive("pagination",pagination).directive("pagination2",pagination2).directive("filterConditions",filterConditions).directive("treeList",treeList).directive("treeList2",treeList2).directive("navList",navList).directive("selectAsync",selectAsync).directive("relativeSelect",relativeSelect).directive("chart",eChart).directive("angucomplete",angucomplete).directive("checkboxGroup",checkboxGroup).directive("chosen",chosen).directive("formItem",formItem).directive("autoComplete",autoComplete).directive("selectAddress",["$http","$q","$compile",selectAddress]).directive("customConfig",customConfig)}),define("main/filters",["main/init"],function(){angular.module("manageApp.main")}),define("main/init",["angular"],function(){angular.module("manageApp.main",[])}),define("main/services",["toastr","main/init"],function(e){function t(e,t){return{response:function(e){return"string"==typeof e.data&&/^<!DOCTYPE html>/.test(e.data)?(window.location.assign(e.config.url),e):e}}}function a(e,t,a){return function(n,r,i,o){var l=e.defer();i||(i="GET");Config.serverPath&&0!==n.indexOf("http://")&&0!==n.indexOf("https://")&&(n=Config.serverPath+n),r&&"GET"==i&&(n+=(n.indexOf("?")==-1?"?":"&")+a(r));var s={method:i,url:n,data:r||{},withCredentials:!0,headers:{"Content-Type":"application/json;charset=utf-8","X-Requested-With":"XMLHttpRequest"}};return o||(s.transformRequest=function(e){return a(e)},s.headers={"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}),t(s).success(function(e,t,a,r){200==t&&200==e.code?l.resolve([e.data,e]):(msg=e.msg,msg||(msg=n+"\n错误信息："+angular.toJson(e)),l.reject(msg))}).error(function(e,t){e||(e="提交失败!"),e="错误码："+t+"，"+e,l.reject(e)}),l.promise}}function n(e,t){return function(a,n,r,i,o,l,s){var c=e.$new(!1),u=r?"tpl/"+r:"tpl/dialog-confirm.html";c.confirmText=a||"确定删除?",c.confirmTitle=i||"确认操作?",c.confirmBtnTxt=o||"确定",c.cancelBtnTxt=l||"取消",c.extendOpt=s,t.openConfirm({template:Config.tplPath+u,scope:c}).then(n)}}function r(e,t){return function(a,n){var r=e.$new(!1);r.confirmText=a||"确定",t.openConfirm({template:Config.tplPath+"tpl/dialog-alert.html",scope:r}).then(n)}}function i(t,a){return function(t,a){e.success(t,"",{timeOut:3e3,positionClass:"toast-top-center"})}}function o(e,t){return function(a,n){var r=e.$new(!1);r.confirmText=a||"确定",t.openConfirm({template:Config.tplPath+"tpl/dialog-alert.html",scope:r}).then(n)}}function l(e,t){return function(a,n){var r=e.$new(!1);r.content=a,t.openConfirm({template:Config.tplPath+"tpl/dialog-center.html",scope:r}).then(n)}}function s(e,t,a){return function(a){var n=e.$new(!1),r={},i=a.split("?");i[1]&&angular.forEach(i[1].split("&"),function(e){var t=e.split("=");r[t[0]]=t[1]}),n.url=a,n.urlParams=r,t.open({template:Config.tplPath+"tpl/dialog-center.html",scope:n})}}function c(){return function(e,t){if(!e||0===e.length)return[];var a={},n=[],r=0;t||(t="pid");for(var r=0;r<e.length;r++){var i=e[r];i.nodes=[],a[i.id]=i}for(var r=0;r<e.length;r++){var i=e[r];if(null!=i)if(i[t]&&"0"!=i[t]){var o=a[i[t]];null==o?n.push(i):o.nodes.push(i)}else n.push(i)}return n}}function u(){return function(e,t,a){var n={maskId:"MaskId_"+(new Date).getTime(),hide:function(){$("#"+this.maskId).remove()}};e||(e=$("body"));var r='<div id="'+n.maskId+'" class="pr-spinner" style="position:absolute;top:20%;left:102%;" ><div class="bar1 cblack"></div><div class="bar2 cblack"></div><div class="bar3 cblack"></div><div class="bar4 cblack"></div><div class="bar5 cblack"></div><div class="bar6 cblack"></div><div class="bar7 cblack"></div><div class="bar8 cblack"></div><div class="bar9 cblack"></div><div class="bar10 cblack"></div><div class="bar11 cblack"></div><div class="bar12 cblack"></div></div>',i='<div id="'+n.maskId+'" class="pr-full-loading" style="width:80px;height:80px;position:fixed;_position:absolute;top:50%;left:50%;z-index:100;border-radius:5px;opacity:0.4;filter:alpha(opacity=30);background-color:#000;transform:translateX(-50%) translateY(-50%);"><div style="position:absolute;top:50%;left:50%;transform:translateX(-40%) translateY(-40%);" class="pr-spinner"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div><div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div><div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div></div></div>';return"chosen"==t?e.parent().append(r):e.append(i),n}}function d(){return{get:function(e){if(window.localStorage)return window.localStorage.getItem(e)},remove:function(e){window.localStorage&&localStorage.removeItem(e)},set:function(e,t){window.localStorage&&localStorage.setItem(e,t)},clear:function(){window.localStorage&&localStorage.clear()}}}function f(){var e={fromJson:function(e){var t=e.replace(/^\s*/,"")[0];return"{"===t||"["===t?angular.fromJson(e):new String(e)},getScopeExtend:function(t,a){if(angular.isObject(t[a]))return t[a];if(t.$parent)return e.getScopeExtend(t.$parent,a)},refreshHref:function(e){var t=window.location.href;t.indexOf("&")>-1&&(t=t.split("&")[0]),t+=(t.indexOf("?")>-1?"&":"?")+"t="+(new Date).getTime(),e?n(e,function(){window.location.assign(t)},null):window.location.assign(t)},goTo:function(e,t){e+=(e.indexOf("?")>-1?"&":"?")+"t="+(new Date).getTime(),t?n(t,function(){window.location.assign(e)},null):window.location.assign(e)},getcustomMenuByKeyOfArr:function(t,a){return e.getObjectByKeyOfArr(t,"type",a)},getObjectIndexByKeyOfArr:function(e,t,a){if(!angular.isArray(e))return-1;for(var n=0;n<e.length;n++)if(e[n][t]==a)return n;return-1},getObjectByKeyOfArr:function(t,a,n){var r=e.getObjectIndexByKeyOfArr(t,a,n);return r<0?null:t[r]},removeObjectByKeyOfArr:function(t,a,n){var r=e.getObjectIndexByKeyOfArr(t,a,n);return r>-1&&t.splice(r,1),r}};return e}function p(e){return function(t,a){e(function(){a.changeFlag=!1},500),a.$watch(t,function(e,t,n){a.changeFlag=!0},!0)}}t.$inject=["$q","$location"],a.$inject=["$q","$http","$httpParamSerializer"],n.$inject=["$rootScope","modal"],r.$inject=["$rootScope","modal"],l.$inject=["$rootScope","modal"],s.$inject=["$rootScope","modal","$http"],angular.module("manageApp.main").service("watchFormChange",["$timeout",p]).factory("redirectInterceptor",t).service("alertOk",["$rootScope","modal",i]).service("alertError",["$rootScope","modal",o]).service("alertWarn",["$rootScope","modal",o]).service("requestData",a).service("dialogConfirm",n).service("dialogAlert",r).service("dialog",l).service("dialogChart",s).service("buildTree",c).factory("store",d).factory("utils",f).factory("proLoading",u).config(["$httpProvider",function(e){e.interceptors.push("redirectInterceptor")}])}),define("modal/directives",["modal/init"],function(){function e(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,a,n){a.on("click",function(a){a.preventDefault();var r=angular.isDefined(t.modalScope)?t.modalScope:"noScope";angular.isDefined(n.ngDialogClosePrevious)&&e.close(n.ngDialogClosePrevious);var i=e.getDefaults();e.open({template:n.ngDialog,className:n.ngDialogClass||i.className,controller:n.ngDialogController,controllerAs:n.ngDialogControllerAs,bindToController:n.ngDialogBindToController,scope:r,data:n.ngDialogData,showClose:"false"!==n.ngDialogShowClose&&("true"===n.ngDialogShowClose||i.showClose),closeByDocument:"false"!==n.ngDialogCloseByDocument&&("true"===n.ngDialogCloseByDocument||i.closeByDocument),closeByEscape:"false"!==n.ngDialogCloseByEscape&&("true"===n.ngDialogCloseByEscape||i.closeByEscape),overlay:"false"!==n.ngDialogOverlay&&("true"===n.ngDialogOverlay||i.overlay),preCloseCallback:n.ngDialogPreCloseCallback||i.preCloseCallback})})}}}function t(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,a,n){var r=n.modalRight||"50%";a.on("click",function(a){a.preventDefault(),a.stopPropagation(),e.closeAll(),e.open({template:n.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:"true"==n.modalOverlay,data:n.modalData||t.modalScope.tr,scope:t.modalScope,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(r)}]})})}}}function a(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,a,n){var r=n.modalCenter||"50%";a.on("click",function(a){a.preventDefault(),e.open({template:n.modalUrl,cache:!1,trapFocus:!1,data:n.modalData||t.modalScope.tr,scope:t.modalScope,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(r)}]})})}}}e.$inject=["modal"],t.$inject=["modal"],a.$inject=["modal"],angular.module("manageApp.modal").directive("modal",e).directive("modalRight",t).directive("modalCenter",a)}),define("modal/init",["angular"],function(){angular.module("manageApp.modal",[])}),define("modal/services",["modal/init"],function(){"use strict";var e=angular.module("manageApp.modal"),t=angular.element,a=angular.isDefined,n=(document.body||document.documentElement).style,r=a(n.animation)||a(n.WebkitAnimation)||a(n.MozAnimation)||a(n.MsAnimation)||a(n.OAnimation),i="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",o="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",l="ngdialog-disabled-animation",s={html:!1,body:!1},c={},u=[],d=!1,f=!1;e.provider("modal",function(){var e=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){s.html=e||!1},this.setForceBodyReload=function(e){s.body=e||!1},this.setDefaults=function(t){angular.extend(e,t)},this.setOpenOnePerName=function(e){f=e||!1};var a,n=0,p=0,m={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(g,h,v,y,b,C,w,D,k,x){var M=[],S={onDocumentKeydown:function(e){27===e.keyCode&&A.close("$escape")},activate:function(e){var t=e.data("$ngDialogOptions");t.trapFocus&&(e.on("keydown",S.onTrapFocusKeydown),M.body.on("keydown",S.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",S.onTrapFocusKeydown),M.body.off("keydown",S.onTrapFocusKeydown)},deactivateAll:function(e){angular.forEach(e,function(e){var t=angular.element(e);S.deactivate(t)})},setBodyPadding:function(e){var t=parseInt(M.body.css("padding-right")||0,10);M.body.css("padding-right",t+e+"px"),M.body.data("ng-dialog-original-padding",t),C.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=M.body.data("ng-dialog-original-padding");e?M.body.css("padding-right",e+"px"):M.body.css("padding-right",""),C.$broadcast("ngDialog.setPadding",0);
},performCloseDialog:function(e,t){var n=e.data("$ngDialogOptions"),o=e.attr("id"),l=c[o];if(l){if("undefined"!=typeof D.Hammer){var s=l.hammerTime;s.off("tap",a),s.destroy&&s.destroy(),delete l.hammerTime}else e.unbind("click");1===p&&M.body.unbind("keydown",S.onDocumentKeydown),e.hasClass("ngdialog-closing")||(p-=1);var f=e.data("$ngDialogPreviousFocus");f&&f.focus&&f.focus(),C.$broadcast("ngDialog.closing",e,t),p=p<0?0:p,r&&!n.disableAnimation?(l.$destroy(),e.unbind(i).bind(i,function(){S.closeDialogElement(e,t)}).addClass("ngdialog-closing")):(l.$destroy(),S.closeDialogElement(e,t)),m[o]&&(m[o].resolve({id:o,value:t,$dialog:e,remainingDialogs:p}),delete m[o]),c[o]&&delete c[o],u.splice(u.indexOf(o),1),u.length||(M.body.unbind("keydown",S.onDocumentKeydown),d=!1)}},closeDialogElement:function(e,t){e.remove(),0===p&&(M.html.removeClass("ngdialog-open"),M.body.removeClass("ngdialog-open"),S.resetBodyPadding()),C.$broadcast("ngDialog.closed",e,t)},closeDialog:function(e,t){var a=e.data("$ngDialogPreCloseCallback");if(a&&angular.isFunction(a)){var n=a.call(e,t);angular.isObject(n)?n.closePromise?n.closePromise.then(function(){S.performCloseDialog(e,t)}):n.then(function(){S.performCloseDialog(e,t)},function(){}):n!==!1&&S.performCloseDialog(e,t)}else S.performCloseDialog(e,t)},onTrapFocusKeydown:function(e){var t,a=angular.element(e.currentTarget);if(a.hasClass("ngdialog"))t=a;else if(t=S.getActiveDialog(),null===t)return;var n=9===e.keyCode,r=e.shiftKey===!0;n&&S.handleTab(t,e,r)},handleTab:function(e,t,a){var n=S.getFocusableElements(e);if(0===n.length)return void(document.activeElement&&document.activeElement.blur());var r=document.activeElement,i=Array.prototype.indexOf.call(n,r),o=i===-1,l=0===i,s=i===n.length-1,c=!1;a?(o||l)&&(n[n.length-1].focus(),c=!0):(o||s)&&(n[0].focus(),c=!0),c&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(e){var a=e[0],n=a.querySelector("*[autofocus]");if(null===n||(n.focus(),document.activeElement!==n)){var r=S.getFocusableElements(e);if(r.length>0)return void r[0].focus();var i=S.filterVisibleElements(a.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(i.length>0){var o=i[0];t(o).attr("tabindex","-1").css("outline","0"),o.focus()}}},getFocusableElements:function(e){var t=e[0],a=t.querySelectorAll(o),n=S.filterTabbableElements(a);return S.filterVisibleElements(n)},filterTabbableElements:function(e){for(var a=[],n=0;n<e.length;n++){var r=e[n];"-1"!==t(r).attr("tabindex")&&a.push(r)}return a},filterVisibleElements:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];(n.offsetWidth>0||n.offsetHeight>0)&&t.push(n)}return t},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:t(e[e.length-1])},applyAriaAttributes:function(e,t){if(t.ariaAuto){if(!t.ariaRole){var a=S.getFocusableElements(e).length>0?"dialog":"alertdialog";t.ariaRole=a}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&e.attr("role",t.ariaRole),S.applyAriaAttribute(e,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector),S.applyAriaAttribute(e,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(e,a,n,r){if(n&&e.attr(a,n),r){var i=e.attr("id"),o=e[0].querySelector(r);if(!o)return;var l=i+"-"+a;return t(o).attr("id",l),e.attr(a,l),l}},detectUIRouter:function(){try{return angular.module("ui.router"),!0}catch(e){return!1}},getRouterLocationEventName:function(){return S.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},A={__PRIVATE__:S,open:function(r){function i(e,t){return C.$broadcast("ngDialog.templateLoading",e),b.get(e,t||{}).then(function(t){return C.$broadcast("ngDialog.templateLoaded",e),t.data||""})}function o(e){return e?angular.isString(e)&&g.plain?e:"boolean"!=typeof g.cache||g.cache?i(e,{cache:h}):i(e,{cache:!1}):"Empty template"}var s=null;if(r=r||{},!(f&&r.name&&(s=r.name+" dialog",this.isOpen(s)))){var g=angular.copy(e),$=++n;s=s||"ngdialog"+$,u.push(s),angular.extend(g,r);var P;m[s]=P=y.defer();var T;c[s]=T=angular.isObject(g.scope)?g.scope.$new():C.$new();var O,I,j=angular.extend({},g.resolve);return angular.forEach(j,function(e,t){j[t]=angular.isString(e)?x.get(e):x.invoke(e,null,null,t)}),y.all({template:o(g.template||g.templateUrl),locals:y.all(j)}).then(function(e){var n=e.template,r=e.locals;g.showClose&&(n+='<div class="ngdialog-close"></div>');var i=g.overlay?"":" ngdialog-no-overlay";if(O=t('<div id="'+s+'" class="ngdialog'+i+'"></div>'),O.html(g.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+n+"</div>":'<div class="ngdialog-content" role="document">'+n+"</div>"),O.data("$ngDialogOptions",g),T.ngDialogId=s,g.data&&angular.isString(g.data)){var o=g.data.replace(/^\s*/,"")[0];T.ngDialogData="{"===o||"["===o?angular.fromJson(g.data):new String(g.data),T.dialogData=angular.copy(T.ngDialogData),T.ngDialogData.ngDialogId=s}else g.data&&angular.isObject(g.data)&&(T.ngDialogData=g.data,T.dialogData=angular.copy(T.ngDialogData),T.ngDialogData.ngDialogId=s);if(g.className&&O.addClass(g.className),g.disableAnimation&&O.addClass(l),I=g.appendTo&&angular.isString(g.appendTo)?angular.element(document.querySelector(g.appendTo)):M.body,S.applyAriaAttributes(O,g),g.preCloseCallback){var c;angular.isFunction(g.preCloseCallback)?c=g.preCloseCallback:angular.isString(g.preCloseCallback)&&T&&(angular.isFunction(T[g.preCloseCallback])?c=T[g.preCloseCallback]:T.$parent&&angular.isFunction(T.$parent[g.preCloseCallback])?c=T.$parent[g.preCloseCallback]:C&&angular.isFunction(C[g.preCloseCallback])&&(c=C[g.preCloseCallback])),c&&O.data("$ngDialogPreCloseCallback",c)}if(T.closeThisDialog=function(e){S.closeDialog(O,e)},g.controller&&(angular.isString(g.controller)||angular.isArray(g.controller)||angular.isFunction(g.controller))){var u;g.controllerAs&&angular.isString(g.controllerAs)&&(u=g.controllerAs);var f=k(g.controller,angular.extend(r,{$scope:T,$element:O}),!0,u);g.bindToController&&angular.extend(f.instance,{ngDialogId:T.ngDialogId,ngDialogData:T.ngDialogData,closeThisDialog:T.closeThisDialog}),O.data("$ngDialogControllerController",f())}if(w(function(){var e=document.querySelectorAll(".ngdialog");S.deactivateAll(e),v(O)(T);var t=D.innerWidth-M.body.prop("clientWidth");M.html.addClass("ngdialog-open"),M.body.addClass("ngdialog-open");var a=t-(D.innerWidth-M.body.prop("clientWidth"));a>0&&S.setBodyPadding(a),I.append(O),S.activate(O),g.trapFocus&&S.autoFocus(O),g.name?C.$broadcast("ngDialog.opened",{dialog:O,name:g.name}):C.$broadcast("ngDialog.opened",O)}),d||(M.body.bind("keydown",S.onDocumentKeydown),d=!0),g.closeByNavigation){var m=S.getRouterLocationEventName();C.$on(m,function(){S.closeDialog(O)})}if(g.preserveFocus&&O.data("$ngDialogPreviousFocus",document.activeElement),a=function(e){var a=!!g.closeByDocument&&t(e.target).hasClass("ngdialog-overlay"),n=t(e.target).hasClass("ngdialog-close");(a||n)&&A.close(O.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof D.Hammer){var h=T.hammerTime=D.Hammer(O[0]);h.on("tap",a)}else O.bind("click",a);return p+=1,A}),{id:s,closePromise:P.promise,close:function(e){S.closeDialog(O,e)}}}},openConfirm:function(a){var n=y.defer(),r=angular.copy(e);a=a||{},angular.extend(r,a),r.scope=angular.isObject(r.scope)?r.scope.$new():C.$new(),r.scope.confirm=function(e){n.resolve(e);var a=t(document.getElementById(i.id));S.performCloseDialog(a,e)};var i=A.open(r);if(i)return i.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise},isOpen:function(e){var a=t(document.getElementById(e));return a.length>0},close:function(e,a){var n=t(document.getElementById(e));if(n.length)S.closeDialog(n,a);else if("$escape"===e){var r=u[u.length-1];n=t(document.getElementById(r)),n.data("$ngDialogOptions").closeByEscape&&S.closeDialog(n,"$escape")}else A.closeAll(a);return A},closeAll:function(e){$(".select-address.active").removeClass("active");for(var a=document.querySelectorAll(".ngdialog"),n=a.length-1;n>=0;n--){var r=a[n];S.closeDialog(t(r),e)}},getOpenDialogs:function(){return u},getDefaults:function(){return e}};return angular.forEach(["html","body"],function(e){if(M[e]=g.find(e),s[e]){var t=S.getRouterLocationEventName();C.$on(t,function(){M[e]=g.find(e)})}}),A}]})}),define("project/controllers",["project/init"],function(){function e(e,t,a,n){e.watchFormChange=function(t){n(t,e)},t.closeAll(),e.addDataItem={},e.customerAddressReload=function(){e.reloadTime=(new Date).getTime(),t.closeAll()},e.customerAddressGetCallBack=function(e,t){if(e.customerName=t.name,!t||!t.contacts||0===t.contacts.length)return void(e.contactsId=null);e.contactsId||(e.contactsId=t.defaultContactId);for(var a=!1,n=0;n<t.contacts.length;n++)e.contactsId==t.contacts[n].id&&(a=!0);a||(e.contactsId=t.defaultContactId)},e.caifenQuantity=function(e,t){e.quantity_noInvoice_show=!0,!t||e.quantity<t||(e.quantity_noInvoice&&0!==e.quantity_noInvoice||(e.quantity_noInvoice=e.quantity-t,e.quantity=t),e.quantity<=t&&(e.handleFlag=!0))},e.selectRelIdCallBack=function(t){e.addDataItem.relId=t.id,e.addDataItem.name=t.name,e.addDataItem.brand=t.brand,e.addDataItem.unit=t.unit,e.addDataItem.price=t.price,e.addDataItem.strike_price=t.price,e.addDataItem.headUrl=t.headUrl,e.addDataItem.specification=t.specification,e.addDataItem.manufacturer=t.manufacturer,e.addDataItem.handleFlag=!0,e.addDataItem.productionBatch="无",e.addDataItem.dosageForms=t.dosageForms,e.addDataItem.code=t.code,e.addDataItem.productionBatch=t.productionBatch,e.addDataItem.productionDate=t.productionDate,e.addDataItem.guaranteePeriod=t.guaranteePeriod,e.addDataItem.licenseNumber=t.licenseNumber,e.addDataItem.deliveryPlus=t.deliveryPlus,e.addDataItem.storageLocation=t.storageLocation,e.addDataItem.productionDate=t.productionDate,e.addDataItem.guaranteePeriod=t.guaranteePeriod,e.addDataItem.licenseNumber=t.licenseNumber,e.addDataItem.deliveryPlus=t.deliveryPlus,$("#addDataItem_quantity").trigger("focus")},e.addDataItemClick=function(t,n){if(!t.relId||!t.name)return void a("请选择药品。");if(!t.quantity||t.quantity<1)return void a("请输入大于0的数量。");if(!t.strike_price)return void a("请输入成交价格。");if(t.quantity>n.quantity&&(t.handleFlag=!1),e.formData.orderMedicalNos||(e.formData.orderMedicalNos=[]),0!==e.formData.orderMedicalNos.length){var r=e.formData.orderMedicalNos.length;console.log(r);for(var i=0;i<r;i++)if(t.relId===e.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表")}e.formData.orderMedicalNos.push(t),e.formData.totalPrice+=t.strike_price*t.quantity,e.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},e.submitFormAfter=function(){return e.formData.validFlag=!1,"exit"==e.submitForm_type?void e.goTo("#/salesOrder/query.html"):("submit"==e.submitForm_type&&e.goTo("#/salesOrder/confirm-order.html?id="+e.formData.id),void("save"==e.submitForm_type&&console.log(this)))},e.canSubmitForm=function(){for(var t=e.formData.orderMedicalNos,a=0;a<t.length;a++)if(t[a].handleFlag)return!0;return!1},e.submitForm=function(t,a){e.submitForm_type=a,"submit"==e.submitForm_type&&(e.formData.validFlag=!0),$("#"+t).trigger("submit")},e.cancelForm=function(e,t){a("cancelForm")}}function t(e,t,a,n,r,i){e.kuaidiSaveAfter=function(a){if(t.closeAll(),a){e.showData.kuaidiSet||(e.showData.kuaidiSet=[]);for(var n=e.showData.kuaidiSet,r=0;r<n.length;r++)if(n[r].id==a.id)return void(n[r]=a);n.push(a)}},e.deleteKuaidi=function(t,a){var o="rest/authen/invoicesOrder/kuaidi/delete",l={kuaidiId:t.id,invoicesOrderId:a};n(o,l,"POST").then(function(a){var n=a[1];r(n.message||"操作成功");for(var i=e.showData.kuaidiSet,o=0;o<i.length;o++)if(i[o].id==t.id)return void i.splice(o,1)})["catch"](function(e){i(e||"出错")})},e.submitFormAfter=function(){if("exit"==e.submitForm_type)return void e.goTo("#/invoicesOrder/query.html");if("submit"==e.submitForm_type){var t="rest/authen/invoicesOrder/updateStatus",a={id:e.formData.id,status:"待发货"};n(t,a,"POST").then(function(t){t[1];e.goTo("#/invoicesOrder/order-done.html?id="+e.formData.id)})["catch"](function(e){i(e||"出错")})}},e.submitForm=function(t,a){e.submitForm_type=a,$("#"+t).trigger("submit")}}function a(e,t,a,n,r,i,o,l){e.noticeClick=function(t){return requestRead(t.id,t),t.readFlag=!0,e.scopeResponse&&e.scopeResponse.totalCount&&e.scopeResponse.totalCount--,t.moduleType&&t.relId?void window.location.assign("#/"+t.moduleType+"/get.html?id="+t.relId):void r(t.subject)},o.startGetMsg=function(){Config.stopIntervalNotice!==!0&&(o.startGetMsgObj||(o.startGetMsgObj=l(function(){o.noticeRefreshTime=(new Date).getTime()},1e4)))},o.startGetMsg(),requestRead=function(e,t){var a="rest/authen/notice/read",r={id:e};n(a,r,"POST").then(function(e){})["catch"](function(e){})}}function n(e,t,a,n,r,i){t.closeAll(),e.addDataItem={},e.customerAddressReload=function(){e.reloadTime=(new Date).getTime(),t.closeAll()},e.customerAddressGetCallBack=function(e,t){e.customerName=t.name,e.contactsId||(e.contactsId=t.defaultContactId);for(var a=!1,n=0;n<t.contacts.length;n++)e.contactsId==t.contacts[n].id&&(a=!0);a||(e.contactsId=t.defaultContactId)},e.selectRelIdCallBack=function(t){e.addDataItem.relId=t.id,e.addDataItem.name=t.name,e.addDataItem.brand=t.brand,e.addDataItem.unit=t.unit,e.addDataItem.price=t.price,e.addDataItem.strike_price=t.price,e.addDataItem.headUrl=t.headUrl,e.addDataItem.specification=t.specification,e.addDataItem.manufacturer=t.manufacturer,e.addDataItem.handleFlag=!0,e.addDataItem.productionBatch="无",e.addDataItem.dosageForms=t.dosageForms,e.addDataItem.code=t.code,e.addDataItem.productionBatch=t.productionBatch,e.addDataItem.productionDate=t.productionDate,e.addDataItem.guaranteePeriod=t.guaranteePeriod,e.addDataItem.licenseNumber=t.licenseNumber,e.addDataItem.deliveryPlus=t.deliveryPlus,e.addDataItem.drugAdministrationCode=t.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},e.addDataItemClick=function(t,n){if(!t.relId||!t.name)return void a("请选择药品。");if(!t.quantity||t.quantity<1)return void a("请输入大于0的数量。");if(t.quantity>n.quantity&&(t.handleFlag=!1),e.formData.orderMedicalNos.length>0)for(var r=e.formData.orderMedicalNos.length,i=0;i<r;i++)if(t.relId===e.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");e.formData.orderMedicalNos||(e.formData.orderMedicalNos=[]),e.formData.orderMedicalNos.push(t),e.formData.totalPrice+=t.strike_price*t.quantity,e.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},e.submitFormAfter=function(){if(e.formData.validFlag=!1,"exit"==e.submitForm_type)return void e.goTo("#/purchaseOrder/query.html");if("submit"==e.submitForm_type){var t="rest/authen/purchaseOrder/updateStatus",a={id:e.formData.id,status:"待审批"};r(t,a,"POST").then(function(t){t[1];e.goTo("#/purchaseOrder/confirm-order-done.html?id="+e.formData.id)})["catch"](function(e){n(e||"出错")})}},e.submitForm=function(t,a){e.submitForm_type=a,"submit"==e.submitForm_type&&(e.formData.validFlag=!0),$("#"+t).trigger("submit")},e.cancelForm=function(e,t){a("cancelForm")},e.watchFormChange=function(t){i(t,e)}}function r(e,t,a,n,r,i,o,l){e.getCheckUserApplyArr=function(e,t){var a=[];if(!t||0===t.length)return a;for(var n=0;n<e.length;n++)t.indexOf(e[n].id)>-1&&e[n].formData&&a.push(e[n]);return a},e.batchAuditUserApplyOrganization=function(i,o,s,c,u){if(!o||0===o.length)return void a("请先勾选");for(var d=[],f=0;f<i.length;f++)o.indexOf(i[f].id)>-1&&i[f].formData&&(i[f].formData.status=s,i[f].formData.key=c,i[f].formData.message=u,d.push(i[f].formData));var p="rest/authen/distributor/batchAuditUserApplyOrganization",m=l();n(p,d,"POST",!0).then(function(a){m&&m.hide(),r(a[1].msg),e.$broadcast("reloadList"),e.$emit("reloadList"),t.close()})["catch"](function(e){m&&m.hide(),t.close(),a(e)})},o.startGetMsg=function(){o.startGetMsgObj||(o.startGetMsgObj=$interval(function(){o.noticeRefreshTime=(new Date).getTime()},1e4))},o.startGetMsg(),requestRead=function(e,t){var a="rest/authen/notice/read",r={id:e};n(a,r,"POST").then(function(e){})["catch"](function(e){})}}function i(e,t){e.watchFormChange=function(a){t(a,e)}}function o(e,t,a,n,r,i,o,l){}function l(e,t){e.watchFormChange=function(a){t(a,e)},e.submitForm=function(t,a){e.submitForm_type=a,"submit"==e.submitForm_type&&(e.formData.validFlag=!0),$("#"+t).trigger("submit")},e.submitFormAfter=function(t){"submit"===e.submitForm_type&&e.goTo(t+"?id="+e.formData.id)},e.resetThisItem=function(e){angular.isObject(e)&&(e.uploadUserName=null,e.uploadTime=null,e.guaranteePeriod=null,e.attachmentUrl=null,e.note=null)},e.addCustomExamineItem=function(){e.formData.addCustomExamineItem.name&&e.formData.attachments.push(e.formData.addCustomExamineItem)}}function s(e,t,a,n,r,i,o){e.switchButtons=function(e,t,a){var n=e[t];e[t]=e[a],e[a]=n},e.addEventButtons=function(e){e||(e={}),e.didateFilter||(e.didateFilter={}),e.didateFilter.buttons||(e.didateFilter.buttons=[]);var t={type:"通过",buttonName:"审核通过",requestMethod:"POST",requestMethod:"KeyValue",requestUrl:"rest/authen/workflowTask/run.json"};e.didateFilter.buttons.push(t)},e.saveEvent=function(a){e.formData.events||(e.formData.events=[]);var n=e.formData.events,r=!0;if(a.conditionType||(a.conditionType=null),a.id){var i=o.utils.getObjectIndexByKeyOfArr(n,"id",a.id);o.utils.getObjectByKeyOfArr(n,"id",a.id);i>-1&&(n[i]=a,r=!1)}r&&(a.id=a.name,n.push(a)),e.scopeExtend&&e.scopeExtend.workflow&&e.scopeExtend.workflow.reload(),t.closeAll()},e.deleteEvent=function(a){e.formData.events||(e.formData.events=[]);var n=e.formData.events,r=o.utils.removeObjectByKeyOfArr(n,"id",a);return r<0?void i("没有该节点，id="+event1.id):(e.scopeExtend&&e.scopeExtend.workflow&&e.scopeExtend.workflow.reload(),void t.closeAll())}}angular.module("manageApp.project").controller("editWorkFlowProcessCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope",s]).controller("QualificationApplyCtrl",["$scope","watchFormChange",l]).controller("watchFormCtrl",["$scope","watchFormChange",i]).controller("intervalCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",o]).controller("auditUserApplyOrganizationCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","proLoading",r]).controller("purchaseOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",n]).controller("noticeCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",a]).controller("invoicesOrderCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError",t]).controller("salesOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",e])}),define("project/directives",["project/init"],function(){function e(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNos.html"}}function t(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNosOfPurchaseOrder.html"}}function a(e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowRejectButton.html",link:function(t,a,n){n.customMenu&&(t.customMenu=e.fromJson(n.customMenu))}}}function n(e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowPassButton.html",link:function(t,a,n){n.customMenu&&(t.customMenu=e.fromJson(n.customMenu))}}}function r(e){return{restrict:"EA",scope:!0,templateUrl:Config.tplPath+"tpl/project/customMenuList.html",link:function(t,a,n){n.customMenuArr?t.customMenuArr=e.fromJson(n.customMenuArr):t.customMenuArr=n.customMenuArr,console.log(t.customMenuArr)}}}function i(e){return{restrict:"EA",scope:!0,templateUrl:Config.tplPath+"tpl/project/workflowTaskRunWithAttchments.html",link:function(t,a,n){n.customMenuArr?t.customMenuArr=e.fromJson(n.customMenuArr):t.customMenuArr=n.customMenuArr,n.returnButton&&(t.returnButton=e.fromJson(n.returnButton)),t.attchmentUsege=n.attchmentUsege,t.passButton=e.getcustomMenuByKeyOfArr(t.customMenuArr,"通过"),t.rejectButton=e.getcustomMenuByKeyOfArr(t.customMenuArr,"驳回"),t.showButton=t.passButton||t.rejectButton,console.log(t.customMenuArr)}}}function o(){"use strict";return{restrict:"A",link:function(e,t,a){require(["nicescroll"],function(){$("html").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"6",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0",zindex:"1000"}),$("#page-side").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"3",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0"}),$("#page-side").getNiceScroll(),$("body").hasClass("left-side-collapsed")&&$("#page-side").getNiceScroll().hide()})}}}function l(e){"use strict";return{restrict:"A",link:function(t,a,n){function r(e){var t=$(e);t.addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})}var i=e.path().split("/")[1];n.leftMenuChange&&n.leftMenuChange===i&&r(a),a.on("click",function(e){e.stopPropagation(),r(a)})}}}function s(e){"use strict";return{restrict:"A",link:function(t,a,n){0===$(a).next(".sub-menu-list").length&&e.absUrl().indexOf(n.href)!==-1&&$(a).parent().addClass("active").siblings().each(function(){$(this).removeClass("active")}),$(a).on("click",function(e){e&&e.stopPropagation&&e.stopPropagation();var t=$(this).parent();if(0!==$(this).next(".sub-menu-list").length){var a=$(this).next(".sub-menu-list");a.is(":visible")?a.slideUp(200,function(){$(this).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}):a.slideDown(200,function(){t.siblings().each(function(){$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}),$(this).prev().find("span.pr-arrow-down").removeClass("pr-arrow-down").addClass("pr-arrow-up")})}else t.addClass("active").siblings().each(function(){$(this).removeClass("active").find(".sub-menu-list > li").each(function(){$(this).removeClass("active")}),$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200)})})}}}function c(){"use strict";return{restrict:"A",link:function(e,t,a){t.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function u(){return{restrict:"EA",scope:{ngModel:"=",countMap:"="},require:"ngModel",replace:!0,templateUrl:Config.tplPath+"tpl/project/queryOrderStatusButton.html",link:function(e,t,a,n){e.key=a.key,e.showName=e.key,a.showName&&(e.showName=a.showName),t.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function d(){"use strict";return{restrict:"A",link:function(e,t,a){t.on("click",function(){$(this).hide(),$(this).siblings().show().on("click",function(){$(this).hide(),$(t).show()})})}}}function f(){"use strict";return{restrict:"A",link:function(e,t,a){$(".toggle-btn").on("click",function(){$(".left-side").getNiceScroll().hide(),$("body").hasClass("left-side-collapsed")&&$(".left-side").getNiceScroll().hide();var e=$("body"),t=e.css("position");"relative"!=t?e.hasClass("left-side-collapsed")?(e.removeClass("left-side-collapsed chat-view"),$(".custom-nav li.active ul").css({display:"block"}),$(this).removeClass("menu-collapsed")):(e.addClass("left-side-collapsed"),$(".custom-nav ul").attr("style",""),$(this).addClass("menu-collapsed")):e.hasClass("left-side-show")?e.removeClass("left-side-show"):(e.addClass("left-side-show"),mainContentHeightAdjust())})}}}function p(){"use strict";return{restrict:"A",link:function(e,t,a){$(t).on("click",function(e){if(e.stopPropagation(),$(this).hasClass("fa-times"))$(this).parents(".panel").parent().remove();else{var t=$(this).parents(".panel").children(".panel-body");$(this).hasClass("fa-chevron-up")?($(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"),t.slideUp(200)):($(this).removeClass("fa-chevron-down").addClass("fa-chevron-up"),t.slideDown(200))}})}}}function m(){"use strict";return{restrict:"A",link:function(e,t,a){require(["morris"],function(){var e=a.id,t=[];if(angular.isDefined(a.datavalue)&&angular.isDefined(a.datalabel)&&angular.isDefined(a.dataformatted))for(var n={},r=0,i=a.datavalue.split(","),o=a.datalabel.split(","),l=a.dataformatted.split(",");r<i.length;)n.value=i[r],n.label=o[r],n.formatted=l[r],t.push(n),n={},r++;var s=!!angular.isDefined(a.backgroundColor)&&a.backgroundColor,c=angular.isDefined(a.labelColor)?a.labelColor:"#666",u=angular.isDefined(a.colors)?a.colors.split(","):["#ff5f39","#fe9302","#e39a27"];Morris.Donut({element:e,data:t,backgroundColor:s,labelColor:c,colors:u,formatter:function(e,t){return t.formatted}})})}}}function g(){"use strict";return{restrict:"A",link:function(e,t,a){require(["icheck"],function(){$(t).children().iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square",increaseArea:"20%"})})}}}function h(){"use strict";return{restrict:"A",link:function(e,t,a){require(["sparkline"],function(){$(".sparkline").each(function(){var e=$(this).data();e.valueSpots={"0:":e.spotColor},$(this).sparkline(e.data||"html",e,{tooltipFormat:'<span style="display:block; padding:0px 10px 12px 0px;"><span style="color: {{color}}">&#9679;</span> {{offset:names}} ({{percent.1}}%)</span>'})}),$("#income").sparkline([5,6,7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#expense").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#expense2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#pro-refund").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#ffffff"}),$("#p-lead-1").sparkline([7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#p-lead-2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#p-lead-3").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#5ab5de"}),$("#visit-1").sparkline([5,6,7,9,9,5,3,2,4,6,7,5,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"}),$("#visit-2").sparkline([5,6,7,7,9,5,8,5,4,6,7,8,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"})})}}}function v(){"use strcit";return{restrict:"A",link:function(e,t,a){$("[data-toggle='tooltip']").tooltip()}}}function y(e){"use strict";return{restrict:"A",link:function(e,t,a){var n=$(t).next();$(t).hover(function(){n.show()},function(){n.hide()}),n.hover(function(){$(this).show()},function(){$(this).hide()})}}}function b(e,t,a,n,r){"use strict";return{restrict:"A",link:function(i,o,l){o.on("click",function(){function o(){var e=!1;angular.isDefined(l.parameterBody)&&(e=!0,"false"==l.parameterBody&&(e=!1));var t="POST";if(l.httpMethod&&(t=l.httpMethod),angular.isDefined(l.requestUrl)){var o={};return l.params&&0===l.params.indexOf("{")&&(o=i.$eval(l.params)),void a(f,o,t,e).then(function(e){var t=e[1];if(200===t.code&&n(t.message||"操作成功"),l.$scopeData&&(i[l.$scopeData]=data),l.callBack&&i.$eval(l.callBack),l.callback&&i.$eval(l.callback),l.parentCallback&&i.$parent.$eval(l.parentCallback),l.emitted)if(l.emitted.indexOf(",")!==-1){var a=l.emitted.split(","),r=a.length,o=0;for(o=0;o<r;o++)i.$emit(a[o])}else i.$emit(l.emitted)})["catch"](function(e){r(e||"出错")})}}var s=angular.isDefined(l.dialogTitle)?l.dialogTitle:"询问对话框",c=angular.isDefined(l.dialogContent)?l.dialogContent:"",u=angular.isDefined(l.dialogTemplate)?l.dialogTemplate:"tpl/dialog-confirm.html",d=angular.isDefined(l.jumpUrl)?l.jumpUrl:"",f=angular.isDefined(l.requestUrl)?l.requestUrl:"",p=angular.isDefined(l.confirmBtnTxt)?l.confirmBtnTxt:"确定",m=angular.isDefined(l.cancelBtnTxt)?l.cancelBtnTxt:"取消";return"pr-dialog-return.html"==u&&(angular.isDefined(l.dialogTitle)||(s="取消修改?"),angular.isDefined(l.dialogContent)||(c="有修改还未保存,是否保存?")),"false"==l.alertConfirm?void o():void t(c,function(t,a){return"cancel"==t?void(l.cancelCallback&&i.$eval(l.cancelCallback)):"nosave"==t?(l.nosaveCallback&&i.$eval(l.nosaveCallback),void(l.parentNosaveCallback&&i.$parent.$eval(l.parentNosaveCallback))):"save"==t?(l.saveCallback&&i.$eval(l.saveCallback),void(l.parentSaveCallback&&i.$parent.$eval(l.parentSaveCallback))):angular.isDefined(l.jumpUrl)?void e.location.assign(d):(o(),l.callBack&&(i.dialgForm=a,i.$eval(l.callBack)),void(l.callback&&(i.dialgForm=a,i.$eval(l.callback),l.parentCallback&&i.$parent.$eval(l.parentCallback))))},u,s,p,m,d)})}}}function C(e){var t={isStart:!1,routeMap:{},last1MenuShowObj:null,eleChangeEvent:function(e){!e||0==e.length;var a=$(e).parent();a.addClass("active").siblings().each(function(){$(this).removeClass("active")}),a.parent().parent().removeClass("active").siblings().each(function(){$(this).removeClass("active"),$(this).find(".sub-menu-list > li").each(function(){$(this).removeClass("active")})}),t.last1MenuShowObj&&t.last1MenuShowObj.hide(),a.parent().is(":visible")||(a.parent().show(),t.last1MenuShowObj=a.parent()),$(e).parents("ul.sub-menu-list").prev().children().eq(2).removeClass("pr-arrow-down").addClass("pr-arrow-up")},doRoute:function(e){var t=e;t=t.split("#")[1],t&&(elementMenu=this.routeMap[t],elementMenu&&0!==elementMenu.length||(t=t.split("?")[0],elementMenu=this.routeMap[t]),elementMenu&&0!==elementMenu.length||(t=t.split("/")[1],elementMenu=this.routeMap[t]),elementMenu&&0!==elementMenu.length&&this.eleChangeEvent(elementMenu))},startListen:function(e){this.isStart||(this.isStart=!0,e.$on("$locationChangeSuccess",function(e,a,n){t.doRoute(a)}))},add:function(e,t){if(e&&e.length>0)for(var a=0;a<e.length;a++)this.routeMap[e[a]]=t;var n=t.attr("href");n&&(n=n.split("#")[1],n&&(this.routeMap[n]=t),n=n.split("?")[0],n&&(this.routeMap[n]=t),n=n.split("/")[1],n&&(this.routeMap[n]=t))}};return{restrict:"A",link:function(a,n,r){var i=null;r.keyArr&&(i=a.$eval(r.keyArr)),t.add(i,n),t.startListen(a),t.doRoute("#"+e.path()),n.on("click",function(e){e&&e.stopPropagation&&e.stopPropagation(),t.eleChangeEvent(n)})}}}function w(e){"use strict";return{restrict:"A",link:function(t,a,n){n.href.indexOf(e.path().split("/")[2])!==-1&&$(a).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")}),$(a).on("click",function(e){$(this).hasClass("active")||$(this).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})})}}}function D(e){"use strict";return{restrict:"AE",scope:!1,link:function(t,a,n){t.countdown=function(a,n){t[a]=n;var r=e(function(){t[a]>0?t[a]-=1:e.cancel(r)},1e3)},t.$on("$destroy",function(){try{e.cancel(timeout_upd)}catch(t){}})}}}function k(e,t){"use strict";return{restrict:"AE",scope:{workflowTaskData:"=?",ngModel:"=?"},link:function(a,n,r){var i=a.ngModel;console.log(i),require(["WorkflowProcess"],function(n){function o(t,n){angular.isDefined(r.modalUrl)&&(e.closeAll(),a.$parent.currentEvent=n.currentNode.data,e.open({template:r.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:"true"==r.modalOverlay,data:n.currentNode.data,scope:a.$parent,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width("50%")}]}))}var l={showStatus:"true"==r.showStatus,node:{clickCallback:o}},s=new n(r.id,l);if(r.scopeExtend){var c=t.getScopeExtend(a,r.scopeExtend);c&&r.scopeExtendAttr&&(c[r.scopeExtendAttr]=s)}s.addWorkflowProcess(i),a.workflowTaskData&&s.addWorkflowTaskData(a.workflowTaskData)})}}}angular.module("manageApp.project").directive("canvasWorkflow",["modal","utils",k]).directive("queryOrderStatusButton",u).directive("intervalCountdown",["$interval",D]).directive("workflowRejectButton",["utils",a]).directive("workflowPassButton",["utils",n]).directive("customMenuList",["utils",r]).directive("workflowTaskRunWithAttchments",["utils",i]).directive("orderMedicalsPurchase",t).directive("orderMedicals",e).directive("niceScroll",o).directive("leftMenuChange",["$location",l]).directive("leftMenuToggle",["$location",s]).directive("orderStatusChoise",c).directive("orderListTips",d).directive("toggleLeftMenu",f).directive("togglePanel",p).directive("morris",m).directive("icheck",g).directive("sparkline",h).directive("runTooltips",v).directive("runPopovers",["$timeout",y]).directive("handleThisClick",["$window","dialogConfirm","requestData","alertOk","alertError",b]).directive("leftMenuSecondToggle",["$location",C]).directive("styleToggle",["$location",w]);
}),define("project/filters",["project/init"],function(){function e(){return function(e){if(!e)return"";var t=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],n=[["元","万","亿"],["","拾","佰","仟"]],r=e<0?"欠":"";e=Math.abs(e);for(var i="",o=0;o<t.length;o++)i+=(a[Math.floor(10*e*Math.pow(10,o))%10]+t[o]).replace(/零./,"");i=i||"整",e=Math.floor(e);for(var o=0;o<n[0].length&&e>0;o++){for(var l="",s=0;s<n[1].length&&e>0;s++)l=a[e%10]+n[1][s]+l,e=Math.floor(e/10);i=l.replace(/(零.)*零$/,"").replace(/^$/,"零")+n[0][o]+i}return r+i.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}}angular.module("manageApp.project").filter("upDigit",e)}),define("project/init",["angular"],function(){angular.module("manageApp.project",[])}),define(["JTopo"],function(e){function t(t,a){var n=document.getElementById(t),r=new e.Stage(n);new e.Scene(r);return r}return{newStage:t}}),define("project/registration",["angular"],function(){angular.module("manageApp.registration",[]).config(["$routeProvider",function(e){"use strict";e.when("/verify_phone",{templateUrl:"angular/tpl/registration/verify_phone.html",controller:"registrationCtrl"}).when("/send_info",{templateUrl:"angular/tpl/registration/send_info.html",controller:"registrationCtrl"}).when("/apply_bind",{templateUrl:"angular/tpl/registration/apply_bind.html",controller:"registrationCtrl"}).when("/bind_done",{templateUrl:"angular/tpl/registration/bind_done.html",controller:"registrationCtrl"}).when("/retrievepwd",{templateUrl:"angular/tpl/retrieve-pwd/retrievepwd.html",controller:"registrationCtrl"}).when("/resetpwd",{templateUrl:"angular/tpl/retrieve-pwd/resetpwd.html",controller:"registrationCtrl"}).otherwise({redirectTo:"/verify_phone"})}]).controller("registrationCtrl",["$scope","requestData","$interval","$rootScope","$location",function(e,t,a,n,r){"use strict";e.globalData={requestUrlHead:""},e.sendVerifyCodeStatus=!1,e.countdown=function(t){e.second=t,a(function(){e.second>=1?e.second-=1:(clearInterval(),e.sendVerifyCodeStatus=!1,n.verifyResult.phone=!0)},1e3)},e.sendRegVerifyCode=function(){if(e.regData.phone){e.sendVerifyCodeStatus=!0,e.countdown(59);var a="";"/verify_phone"===r.path()&&(a=e.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=true&tel="+e.regData.phone,t(a,{}).then(function(t){var a=t[0];e.validCode=a.code})["catch"](function(t){e.verifyResult.phone=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:$(".reg-info-prompt").fadeIn(500)})),"/retrievepwd"===r.path()&&(a=e.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=false&tel="+e.regData.phone,t(a,{}).then(function(t){var a=t[0];e.validCode=a.code})["catch"](function(t){e.verifyResult.phone=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:$(".reg-info-prompt").fadeIn(500)}))}},e.bind_done=function(){window.location.assign("#/bind_done")},e.regSubmit=function(){if(e.regData){var a=e.mainConfig.serverPath+"rest/index/register",n=e.regData,r="POST";t(a,n,r).then(function(e){var t=e[1];200===t.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){window.location.href="#/apply_bind"},1500))})["catch"](function(t){e.verifyResult.phone=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:$(".reg-info-prompt").fadeIn(500)})}},e.resetPwdSubmit=function(){if(e.regData){var a=e.mainConfig.serverPath+"rest/index/forgetPassword",n=e.regData,r="POST";t(a,n,r).then(function(t){var a=t[1];200===a.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){e.pageTo("login.html")},1500))})["catch"](function(t){e.verifyResult.phone=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:$(".reg-info-prompt").fadeIn(500)})}}}]).filter("registrationFilter",[function(){}]).service("registrationService",[function(){}]).value("registrationValue",[function(){}]).directive("regCheckPhone",["$rootScope","requestData",function(e,t){"use strict";return{restrict:"A",require:"ngModel",link:function(a,n,r,i){e.verifyResult||(e.verifyResult={}),n.on("keyup",function(){if(11===$(n).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var r=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;t(r,{},"GET").then(function(t){200===t[1].code&&(e.verifyResult.phone=!0,e.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled"))})["catch"](function(t){e.verifyResult.phone=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:($(".reg-info-prompt").fadeIn(500),$(n).focus())})}else e.verifyResult.phone=!1,e.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(n).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}]).directive("regCheckVerifyCode",["requestData","$rootScope",function(e,t){"use strict";return{restrict:"A",require:"ngModel",link:function(a,n,r,i){n.on("keyup",function(){var r=i.$viewValue.toString();if(4===r.length){var o=a.mainConfig.serverPath+"rest/sms/verifySmsCodey.json",l={tel:a.regData.phone,code:a.regData.verifyCode};e(o,l,"POST").then(function(e){200===e[1].code&&(t.verifyResult.verifyCode=!0,t.verifyResult.phone=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200))})["catch"](function(e){t.verifyResult.verifyCode=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:($(".reg-info-prompt").fadeIn(500),$(n).focus())})}})}}}]).directive("regCheckPassword",["$rootScope",function(e){"use strict";return{restrict:"A",require:"ngModel",link:function(t,a,n,r){e.verifyResult||(e.verifyResult={msg:"",password:!1,repassword:!1}),a.on("keyup",function(i){if(16!==i.keyCode){if("password"===n.name){e.verifyResult={msg:"密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线"};var o=$.trim($(a).val());if(o.length>=6)if(/[A-Za-z0-9_-]{6,32}/.test(r.$viewValue))e.verifyResult.password=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200);else if(e.verifyResult.password=!1,e.verifyResult.repassword=!1,"none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}if("repassword"===n.name)if(e.verifyResult.password===!1){if(e.verifyResult.msg="密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else{e.verifyResult={msg:"两次输入的密码不一致",password:!0,repassword:!1};var l=$.trim($(a).val());if(l.length>=6)if(t.regData.password!==t.regData.repassword){if(e.verifyResult.msg="两次输入的密码不一致","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else e.verifyResult.repassword=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)}}})}}}]).directive("regCheckName",["$rootScope",function(e){"use strict";return{restrict:"A",require:"ngModel",link:function(t,a,n,r){e.verifyResult||(e.verifyResult={}),a.on("keydown",function(){var t=r.$viewValue;return void 0!==t&&t.length>16?(e.verifyResult.name=!1,e.verifyResult.msg="用户名为必填项且长度应在1~16位之间",void("none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(a).focus()))):(e.verifyResult.name=!0,void("none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)))})}}}]).directive("repwdCheckPhone",["$rootScope","requestData",function(e,t){"use strict";return{restrict:"A",require:"ngModel",link:function(a,n,r,i){e.verifyResult||(e.verifyResult={}),n.on("keyup",function(){if(11===$(n).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var r=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;t(r,{},"GET").then(function(t){200===t[1].code&&(e.verifyResult.phone=!1,e.verifyResult.msg="该手机号码未注册","none"===$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeIn(200))})["catch"](function(t){e.verifyResult.phone=!0,e.verifyResult.msg="",e.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").hide(),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled")})}else e.verifyResult.phone=!1,e.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(n).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}])}),define("project/services",["project/init"],function(){function e(){return function(e,t,a){var n='<div class="pr-top-dialog-tips" style="position:fixed;left:50%;top:0;opacity:0;height:42px;line-height:42px;padding:0 15px;color:#fff;background-color:#64c213;animation:topIn 1s;">'+test+"</div>";$(html).append(n)}}angular.module("manageApp.project").factory("proMessageTips",[e])}),define("upload/directives",["upload/init"],function(){function e(){return{restrict:"EA",scope:{ngModel:"=",uploadMax:"@",uploadSize:"@",width:"@",height:"@"},replace:!0,templateUrl:Config.tplPath+"tpl/uploader.html",link:function(e,t,a){function n(){for(var t=o[0].files,a=0,n=t.length;a<n;a++){if(t[a].size/1024>e.uploadSize)return void alert("文件大小不能超过 "+e.uploadSize+" K");switch(l){case"*":var r={status:"uploading",file:t[a],progress:0,text:"上传中...",name:t[a].name,data:{}};e.fileList.push(r),i(r);break;case"image":if(/image/g.test(t[a].type)){var r={status:"uploading",file:t[a],progress:0,text:"上传中...",name:t[a].name,data:{},imgSrc:window.URL.createObjectURL(new Blob([t[a]],{type:t[a].type}))};e.fileList.push(r),e.$digest(),i(r)}else alert("只能上传图片");break;default:if(!t[a].type||new RegExp(l).test(t[a].type)){var r={status:"uploading",file:t[a],progress:0,text:"上传中...",data:{}};e.fileList.push(r),e.$digest(),i(r)}else alert("上传格式错误")}}}function r(t){var a=[],n=e.fileList.indexOf(t);n>-1&&e.fileList.splice(n,1),angular.forEach(e.fileList,function(e,t){a.push(e.data.id)}),e.ngModel=a}function i(t){var n=new XMLHttpRequest,r=new FormData;r.append("fileData",t.file),n.upload.addEventListener("progress",function(a){var n=Math.round(100*a.loaded/a.total);100==n&&(n=99),t.progress=n,e.$digest()},!1),n.addEventListener("load",function(a){var n=angular.fromJson(a.target.responseText);t.progress=100,t.status="finished",t.text="上传成功！",t.data=n.data,e.ngModel.push(n.data.id),e.$apply(),o.val("")},!1),n.addEventListener("loadend",function(a){200!=a.target.status&&(t.status="error",t.text="上传失败！",e.$apply())});var i=a.uploader;Config.serverPath&&0!==i.indexOf("http://")&&0!==i.indexOf("https://")&&(i=Config.serverPath+i),n.open("POST",i),n.withCredentials=!0,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(r)}var o=$('<input type="file" multiple/>'),l=a.uploadType||"image",s=angular.fromJson(a.files||[]);e.fileList=[],e.delFile=r,e.ngModel=e.ngModel||[],e.uploadMax=e.uploadMax||99,e.uploadSize=e.uploadSize||1e4,e.width=e.width?e.width:"120px",e.height=e.height?e.height:"100px",e.styleName=a.styleName||"styleName",angular.forEach(s,function(t){t.data=angular.copy(t),t.status="finished",/\.(jpe?g|png|gif)$/.test(t.url)&&(t.imgSrc=t.url),e.fileList.push(t),e.ngModel.push(t.id)}),e.$parent.resetPic=function(){e.ngModel=[],e.fileList=[]},e.uploadBtn_click=function(){o.trigger("click")};var c=$(".uploadBtn",t);c.on("click",function(){o.trigger("click")}),o.on("change",n)}}}function t(e){return{restrict:"EA",scope:{ngModel:"=",upFile:"=",uploadSize:"@",width:"@",height:"@"},link:function(t,a,n){function r(){for(var e=l[0].files,a=0,n=e.length;a<n;a++){if(e[a].size/1024>t.uploadSize)return void alert("文件大小不能超过 "+t.uploadSize+" K");switch(s){case"*":var r={status:"uploading",file:e[a],progress:0,text:"上传中...",name:e[a].name,data:""};t.upFile=r,o(r);break;case"image":if(/image/g.test(e[a].type)){var r={status:"uploading",file:e[a],progress:0,text:"上传中...",name:e[a].name,data:"",imgSrc:window.URL.createObjectURL(new Blob([e[a]],{type:e[a].type}))};t.upFile=r,t.$digest(),o(r)}else alert("只能上传图片");break;default:if(!e[a].type||new RegExp(s).test(e[a].type)){var r={status:"uploading",file:e[a],progress:0,text:"上传中...",data:{}};t.upFile=r,t.$digest(),o(r)}else alert("上传格式错误")}}}function i(e){t.ngModel=""}function o(a){var r=new XMLHttpRequest,i=new FormData;n.usege&&i.append("usege",n.usege),i.append("fileData",a.file),r.upload.addEventListener("progress",function(e){var n=Math.round(100*e.loaded/e.total);100==n&&(n=99),a.progress=n,t.$digest()},!1),r.addEventListener("load",function(r){l.val("");var i=angular.fromJson(r.target.responseText);return i&&200==i.code?(a.progress=100,a.status="finished",a.text="上传成功！",a.data=i.data,t.ngModel=i.data,n.callback&&t.$eval(n.callback),void t.$apply()):void e(i.msg||"出错了")},!1),r.addEventListener("loadend",function(e){200!=e.target.status&&(a.status="error",a.text="上传失败！")});var o=n.uploaderOne;Config.serverPath&&0!==o.indexOf("http://")&&0!==o.indexOf("https://")&&(o=Config.serverPath+o),r.open("POST",o),r.withCredentials=!0,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(i)}var l=$('<input type="file"/>'),s=n.uploadType||"*";t.delFile=i,t.ngModel=t.ngModel,t.uploadSize=t.uploadSize||1e4,t.width=t.width?t.width:"120px",t.height=t.height?t.height:"100px",t.styleName=n.styleName||"styleName",t.$parent.resetPic=function(){t.ngModel=[]},a.on("click",function(){l.trigger("click")}),l.on("change",r)}}}angular.module("manageApp.upload").directive("uploaderOne",["alertError",t]).directive("uploader",e)}),define("upload/init",["angular"],function(){angular.module("manageApp.upload",[])});