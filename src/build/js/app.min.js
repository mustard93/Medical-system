!function(){var t=document.getElementById("requirejs_baseUrlId");if(!t){var e=document.getElementsByTagName("srcript");t=e[e.length-1]}require.dir=t.src.match(/[^?#]*\//)[0],window.UEDITOR_HOME_URL=require.dir+"libs/ueditor1_4_3_3-utf8-jsp/",Config.tplPath||(Config.tplPath="")}(),require.config({map:{"*":{css:"../css.min"}},waitSeconds:0,baseUrl:require.dir+"modules",paths:{resizableColumns:"../libs/resizableColumns/jquery.resizableColumns.min",store:"../libs/store.min",ZeroClipboard:"../libs/ueditor1_4_3_3-utf8-jsp/third-party/zeroclipboard/ZeroClipboard",ueditor:"../libs/ueditor1_4_3_3-utf8-jsp/ueditor.all.min",ueditor_config:"../libs/ueditor1_4_3_3-utf8-jsp/ueditor.config",ueditor_lang:"../libs/ueditor1_4_3_3-utf8-jsp/lang/zh-cn/zh-cn",CanvasBusinessFlow:"../libs/project/CanvasBusinessFlow.min",WorkflowProcess:"../libs/project/WorkflowProcess.min",CanvasTreeLayout:"../libs/project/CanvasTreeLayout.min",LodopFuncs:"../libs/LodopFuncs_amd",JTopo:"../libs/jtopo-0.4.8.min",jQuery:"../libs/jquery.min",underscore:"../libs/underscore/underscore-1.5.2.min",moment:"../libs/moment.min",echarts:"../libs/echarts/echarts-3.2.3.min",chosen:"../libs/chosen.jquery.pg.min",angular:"../libs/angular.min",ngRoute:"../libs/angular-route.min",autocomplete:"../libs/jquery.autocomplete.min",bootstrap:"../libs/bootstrap.min","jquery-ui":"../libs/jquery-ui.min",nicescroll:"../libs/jquery-nicescroll.min",easypiechart:"../libs/easypiechart/angular.easypiechart",icheck:"../libs/jquery.icheck.min",morris:"../libs/morris-chart/morris.min",toastr:"../libs/toastr/toastr.min",raphael:"../libs/morris-chart/raphael.min",clndr:"../libs/calendar/clndr.min"},shim:{ueditor_config:{deps:["jQuery"]},ueditor:{deps:["jQuery","ZeroClipboard"],init:function(t){window.ZeroClipboard=t}},ueditor_lang:{deps:["ueditor","ueditor_config"],exports:"UM"},JTopo:{exports:"JTopo"},jQuery:{exports:"jQuery"},resizableColumns:{deps:["jQuery","css!../libs/resizableColumns/jquery.resizableColumns.css"]},underscore:{exports:"_"},toastr:{deps:["jQuery"]},chosen:{deps:["jQuery"]},echarts:{exports:"echarts"},angular:{deps:["jQuery"],exports:"angular"},ngRoute:{deps:["angular"],exports:"ngRoute"},autocomplete:{deps:["jQuery"],exports:"autocomplete"},bootstrap:{deps:["jQuery"],exports:"bootstrap"},"jquery-ui":{deps:["jQuery"],exports:"jquery-ui"},nicescroll:{deps:["jQuery"],exports:"nicescroll"},easypiechart:{deps:["jQuery"],exports:"easypiechart"},icheck:{deps:["jQuery"],exports:"icheck"},morris:{deps:["raphael"],exports:"morris"},clndr:{deps:["jQuery"],exports:"clndr"}},urlArgs:""}),require(["bootstrap","jquery-ui","nicescroll","easypiechart","icheck"],function(){}),define("manageApp.template",["angular"],function(){angular.module("manageApp.template",[])}),define("manageApp.main",["main/init","main/services","main/controllers","main/directives","main/filters"]),define("manageApp.project",["project/init","project/services","project/controllers","project/directives","project/filters"]),define("manageApp.modal",["modal/init","modal/services","modal/directives"]),define("manageApp.upload",["upload/init","upload/directives"]),define("datePicker",["datepicker/datepicker"]),define("manageApp",["angular","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker"],function(){return angular.module("manageApp",["ngRoute","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker","easypiechart"])}),require(["manageApp","ngRoute"],function(t){t.config(["$routeProvider","$templateRequestProvider","$sceDelegateProvider",function(t,e,a){a.resourceUrlWhitelist(["self","**","http://192.168.0.211:8080/**","http://localhost:8080/**"]),window.Config?t.when("/:page*",{templateUrl:function(t){var e=(Config.viewsDir||"")+t.page;delete t.page;var a=$.param(t);return a?e+"?"+a:e},resolve:{load:function(){}}}).otherwise({redirectTo:Config.indexPage}):t.when("/:page*",{templateUrl:function(t){var e=t.page;delete t.page;var a=$.param(t);return a?e+"?"+a:e},resolve:{load:function(){}}}),e.httpOptions({withCredentials:!0})}]),angular.bootstrap(document,["manageApp"])}),define("datepicker/datepicker",["moment","angular"],function(t){t.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"日_一_二_三_四_五_六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日Ah点mm分",LLLL:"YYYY年MMMD日ddddAh点mm分",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日Ah点mm分",llll:"YYYY年MMMD日ddddAh点mm分"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(t,e){return 12===t&&(t=0),"凌晨"===e||"早上"===e||"上午"===e?t:"下午"===e||"晚上"===e?t+12:t>=11?t:t+12},meridiem:function(t,e,a){var r=100*t+e;return r<600?"凌晨":r<900?"早上":r<1130?"上午":r<1230?"中午":r<1800?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var e,a;return e=t().startOf("week"),a=this.unix()-e.unix()>=604800?"[下]":"[本]",0===this.minutes()?a+"dddAh点整":a+"dddAh点mm"},lastWeek:function(){var e,a;return e=t().startOf("week"),a=this.unix()<e.unix()?"[上]":"[本]",0===this.minutes()?a+"dddAh点整":a+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(t,e){switch(e){case"d":case"D":case"DDD":return t+"日";case"M":return t+"月";case"w":case"W":return t+"周";default:return t}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});var e=angular.module("datePicker",[]);e.constant("datePickerConfig",{template:Config.tplPath+"tpl/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),e.filter("mFormat",function(){return function(e,a,r){return t.isMoment(e)?r?t.tz(e,r).format(a):e.format(a):t(e).format(a)}}),e.directive("datePicker",["datePickerConfig","datePickerUtils",function(e,a){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",dateSelect:"=?",dateMonth:"=?",statusList:"=?"},link:function(r,n,i,o){function s(){r.views=e.views.concat(),r.view=i.view||e.view,r.views=r.views.slice(r.views.indexOf(i.maxView||"year"),r.views.indexOf(i.minView||"minutes")+1),1!==r.views.length&&r.views.indexOf(r.view)!==-1||(r.view=r.views[0])}function l(t){return a.getDate(r,i,t)}function c(t){t&&(r.model=t,o&&o.$setViewValue(t.format(i.format))),r.$emit("setDate",r.model,r.view),r.callbackOnSetDate&&r.callbackOnSetDate(i.datePicker,r.date)}function d(){var t=r.view;a.setParams(y),r.model&&!v&&(r.date=D(r.model),v=!1);var e=r.date;switch(t){case"year":r.years=a.getVisibleYears(e);break;case"month":r.months=a.getVisibleMonths(e);break;case"date":r.weekdays=r.weekdays||a.getDaysOfWeek(),r.weeks=a.getVisibleWeeks(e);break;case"hours":r.hours=a.getVisibleHours(e);break;case"minutes":r.minutes=a.getVisibleMinutes(e,w)}f()}function u(){return"date"!==r.view?r.view:r.date?r.date.month():null}function f(){var t,n,i=r.view,o=r.date,s=[],l="";if(a.setParams(y),"date"===i){var c,d=r.weeks;for(t=0;t<d.length;t++)for(c=d[t],s.push([]),n=0;n<c.length;n++)l="",a.isSameDay(o,c[n])&&(l+="active"),g(c[n],i)&&(l+=" now"),c[n].month()===o.month()&&h(c[n])||(l+=" disabled"),s[t].push(l)}else{var u=e.viewConfig[i],f=r[u[0]],m=u[1];for(t=0;t<f.length;t++)l="",a[m](o,f[t])&&(l+="active"),g(f[t],i)&&(l+=" now"),h(f[t])||(l+=" disabled"),s.push(l)}r.classes=s}function h(t){var e=!0;return $&&$.isAfter(t)&&(e=m($,t)),k&&k.isBefore(t)&&(e&=m(k,t)),e}function m(t,a){return!!t.isSame(a,e.momentNames[r.view])}function p(t){return $&&$.isAfter(t)?$:k&&k.isBefore(t)?k:t}function g(t,e){var a=!0;switch(e){case"minutes":a&=~~(S.minutes()/w)===~~(t.minutes()/w);case"hours":a&=S.hours()===t.hours();case"date":a&=S.date()===t.date();case"month":a&=S.month()===t.month();case"year":a&=S.year()===t.year()}return a}a.setParams(i.timezone);var v=!1,y=r.tz=i.timezone,D=a.createMoment,b=a.eventIsForPicker,w=parseInt(i.step||e.step,10),C=!!i.partial,$=l("minDate"),k=l("maxDate"),I=n[0].id,S=r.now=D(),M=r.date=D(r.model||S),F="true"===i.autoClose;r.model||M.minute(Math.ceil(M.minute()/w)*w).second(0),r.template=i.template||e.template,r.watchDirectChanges=void 0!==i.watchDirectChanges,r.callbackOnSetDate=i.dateChange?a.findFunction(r,i.dateChange):void 0,s(),r.setView=function(t){r.views.indexOf(t)!==-1&&(r.view=t)},r.selectDate=function(t){if(i.disabled)return!1;if(m(r.date,t)&&(t=r.date),"date"==r.view&&r.dateSelect&&r.dateSelect(t),t=p(t),!t)return!1;r.date=t;var e=r.views[r.views.indexOf(r.view)+1];(!e||C||r.model)&&c(t),e?r.setView(e):F?(n.addClass("hidden"),r.$emit("hidePicker")):f()},r.$watch(u,d),r.watchDirectChanges&&r.$watch("model",function(){v=!1,d()}),r.next=function(e){var a=t(r.date);switch(e=e||1,r.view){case"year":case"month":a.year(a.year()+e);break;case"date":a.month(a.month()+e),r.dateMonth&&r.dateMonth(a);break;case"hours":case"minutes":a.hours(a.hours()+e)}a=p(a),a&&(r.date=a,c(a),v=!0,d())},r.prev=function(t){return r.next(-t||-1)},I&&r.$on("pickerUpdate",function(t,e,a){if(b(e,I)){var r=!1,n=!1;angular.isDefined(a.minDate)&&($=!!a.minDate&&a.minDate,n=!0),angular.isDefined(a.maxDate)&&(k=!!a.maxDate&&a.maxDate,n=!0),angular.isDefined(a.minView)&&(i.minView=a.minView,r=!0),angular.isDefined(a.maxView)&&(i.maxView=a.maxView,r=!0),i.view=a.view||i.view,r&&s(),n&&d()}})}}}]),angular.module("datePicker").factory("datePickerUtils",function(){var e,a=function(a,r,n,i,o){var s=Date.UTC(0|a,0|r,0|n,0|i,0|o);return e?t.tz(s,e):t(s)};return{getVisibleMinutes:function(t,e){var r,n,i=t.year(),o=t.month(),s=t.date(),l=t.hours(),c=t.utcOffset()/60,d=[];for(n=0;n<60;n+=e)r=a(i,o,s,l-c,n),d.push(r);return d},getVisibleWeeks:function(e){e=t(e);var a=e.year(),r=e.month();e.date(1);var n=e.day();0===n?e.date(-6):e.date(1-n);for(var i=[];i.length<6&&!(e.year()===a&&e.month()>r);)i.push(this.getDaysOfWeek(e)),e.add(7,"d");return i},getVisibleYears:function(e){var r=t(e),n=r.year();r.year(n-n%10),n=r.year();for(var i,o,s=r.utcOffset()/60,l=[],c=0;c<12;c++)i=a(n,0,1,0-s),o=i.utcOffset()/60,o!==s&&(i=a(n,0,1,0-o),s=o),l.push(i),n++;return l},getDaysOfWeek:function(r){r=r?r:e?t.tz(e).day(0):t().day(0);for(var n,i,o=r.year(),s=r.month(),l=r.date(),c=[],d=r.utcOffset()/60,u=0;u<7;u++)n=a(o,s,l,0-d,0,!1),i=n.utcOffset()/60,i!==d&&(n=a(o,s,l,0-i,0,!1)),c.push(n),l++;return c},getVisibleMonths:function(t){for(var e,r,n=t.year(),i=t.utcOffset()/60,o=[],s=0;s<12;s++)e=a(n,s,1,0-i,0,!1),r=e.utcOffset()/60,r!==i&&(e=a(n,s,1,0-r,0,!1)),o.push(e);return o},getVisibleHours:function(t){var e,r,n,i=t.year(),o=t.month(),s=t.date(),l=[],c=t.utcOffset()/60;for(e=0;e<24;e++)r=a(i,o,s,e-c,0,!1),n=r.utcOffset()/60,n!==c&&(r=a(i,o,s,e-n,0,!1)),l.push(r);return l},isAfter:function(t,e){return t&&t.unix()>=e.unix()},isBefore:function(t,e){return t.unix()<=e.unix()},isSameYear:function(t,e){return t&&t.year()===e.year()},isSameMonth:function(t,e){return this.isSameYear(t,e)&&t.month()===e.month()},isSameDay:function(t,e){return this.isSameMonth(t,e)&&t.date()===e.date()},isSameHour:function(t,e){return this.isSameDay(t,e)&&t.hours()===e.hours()},isSameMinutes:function(t,e){return this.isSameHour(t,e)&&t.minutes()===e.minutes()},setParams:function(t){e=t},findFunction:function(t,e){var a=t;do if(a=a.$parent,angular.isFunction(a[e]))return a[e];while(a.$parent);return!1},findParam:function(t,e){var a=t;do if(a=a.$parent,a[e])return a[e];while(a.$parent);return!1},createMoment:function(a){return e?t.tz(a,e):t.isMoment(a)?t.unix(a.unix()):t(a)},getDate:function(t,e,a){var r=!1;return e[a]&&(r=this.createMoment(e[a]),r.isValid()||(r=this.findParam(t,e[a]),r&&(r=this.createMoment(r)))),r},eventIsForPicker:function(t,e){return angular.isArray(t)&&t.indexOf(e)>-1||t===e}}});var e=angular.module("datePicker");e.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(e,a,r){function n(e,a,n,i,o){return r.template(angular.extend(e,{ngModel:n,minDate:!(!i||!t.isMoment(i))&&i.format(),maxDate:!(!o||!t.isMoment(o))&&o.format()}),a)}function i(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(t,r,o){function s(e){t.$broadcast("pickerUpdate",u[0],{maxDate:e})}function l(e){t.$broadcast("pickerUpdate",u[1],{minDate:e})}var c=null,d=r[0].id,u=[i(),i()],f=a.createMoment,h=a.eventIsForPicker;t.dateChange=function(t,e){c&&c(t,e)},d&&t.$on("pickerUpdate",function(e,a,r){h(a,d)&&t.$broadcast("pickerUpdate",u,r)}),a.setParams(o.timezone),t.start=f(t.start),t.end=f(t.end),t.$watchGroup(["start","end"],function(t){l(t[0]),s(t[1])}),angular.isDefined(o.dateChange)&&(c=a.findFunction(t,o.dateChange)),o.onSetDate="dateChange";var m='<div><table class="date-range"><tr><td valign="top">'+n(o,u[0],"start",!1,t.end)+'</td><td valign="top">'+n(o,u[1],"end",t.start,!1)+"</td></tr></table></div>",p=e(m)(t);r.append(p)}}}]);var a="ng-pristine",r="ng-dirty",e=angular.module("datePicker");e.constant("dateTimeConfig",{template:function(t,e){return"<div "+(e?'id="'+e+'" ':"")+'date-picker="'+t.ngModel+'" '+(t.view?'view="'+t.view+'" ':"")+(t.format?'format="'+t.format+'" ':"")+(t.maxView?'max-view="'+t.maxView+'" ':"")+(t.maxDate?'max-date="'+t.maxDate+'" ':"")+(t.autoClose?'auto-close="'+t.autoClose+'" ':"")+(t.template?'template="'+t.template+'" ':"")+(t.minView?'min-view="'+t.minView+'" ':"")+(t.minDate?'min-date="'+t.minDate+'" ':"")+(t.partial?'partial="'+t.partial+'" ':"")+(t.step?'step="'+t.step+'" ':"")+(t.onSetDate?'date-change="'+t.onSetDate+'" ':"")+(t.ngModel?'ng-model="'+t.ngModel+'" ':"")+(t.timezone?'timezone="'+t.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),e.directive("dateTimeAppend",function(){return{link:function(t,e){e.bind("click",function(){e.find("input")[0].focus()})}}}),e.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils","$timeout",function(e,n,i,o,s,l,c){var d=n.find("body"),u=i("mFormat");return{require:"ngModel",scope:!0,link:function(n,i,c,f){function h(t){var e=u(t,w,q);return t||(f.$setViewValue(e),i.val(e)),e}function m(e){T=e,c.minDate=e?e.format():e,P=t.isMoment(e)}function p(e){N=e,c.maxDate=e?e.format():e,x=t.isMoment(e)}function g(){b=o.template(c)}function v(t){t.stopPropagation(),f.$pristine&&(f.$dirty=!0,f.$pristine=!1,i.removeClass(a).addClass(r),C&&C.$setDirty(),f.$render())}function y(){M&&(M.remove(),M=null),O&&(O.remove(),O=null)}function D(){if(!M){if(M=e(b)(n),n.$digest(),B||(n.$on("setDate",function(t,e,a){v(t),E&&E(c.ngModel,e),S&&$[$.length-1]===a&&y()}),n.$on("hidePicker",function(){i.triggerHandler("blur")}),n.$on("$destroy",y),B=!0),"absolute"===A){var t=angular.extend(i.offset(),{height:i[0].offsetHeight});M.css({top:t.top+t.height,left:t.left,display:"block",position:A}),d.append(M)}else O=angular.element("<div date-picker-wrapper></div>"),i[0].parentElement.insertBefore(O[0],i[0]),O.append(M),M.css({top:i[0].offsetHeight+"px",display:"block"});M.bind("mousedown",function(t){t.preventDefault()})}}var b,w=c.format||o.format,C=i.inheritedData("$formController"),$=s(c.views)(n)||o.views.concat(),k=c.view||$[0],I=$.indexOf(k),S=c.autoClose?s(c.autoClose)(n):o.autoClose,M=null,F=i[0].id,A=c.position||o.position,O=null,T=null,P=null,N=null,x=null,q=c.timezone||!1,_=l.eventIsForPicker,E=null,B=!1;I===-1&&$.splice(I,1),$.unshift(k),f.$formatters.push(h),f.$parsers.push(function(t){if(t)return c.format?u(t,_format):t.getTime()}),angular.isDefined(c.minDate)&&(m(l.findParam(n,c.minDate)),f.$validators.min=function(e){return!P||t.isMoment(e)&&(T.isSame(e)||T.isBefore(e))}),angular.isDefined(c.maxDate)&&(p(l.findParam(n,c.maxDate)),f.$validators.max=function(e){return!x||t.isMoment(e)&&(N.isSame(e)||N.isAfter(e))}),angular.isDefined(c.dateChange)&&(E=l.findFunction(n,c.dateChange)),F&&n.$on("pickerUpdate",function(t,e,a){if(_(e,F))if(M);else{var r=!1;angular.isDefined(a.minDate)&&(m(a.minDate),r=!0),angular.isDefined(a.maxDate)&&(p(a.maxDate),r=!0),angular.isDefined(a.minView)&&(c.minView=a.minView),angular.isDefined(a.maxView)&&(c.maxView=a.maxView),c.view=a.view||c.view,r&&f.$validate(),angular.isDefined(a.format)&&(w=c.format=a.format||o.format,f.$modelValue=-1),g()}}),i.bind("focus",D),i.bind("blur",y),g()}}}])}),define("main/controllers",["main/init"],function(){function t(t,e,a,r,n,i,o,s,l,c,d){function u(){if(t.mainConfig.getMainInfo){var a=t.mainConfig.getMainInfo;Config.serverPath&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&(a=Config.serverPath+a),t.mainStatus.serverPath=Config.serverPath,t.mainStatus.requestPath=""),$.ajax({url:a,type:"get",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(a){if(200==a.code){if(e.curUser=a.data,Config.applyBindUrl){if(!e.curUser.additional.HabbitOrganizationId)return void(window.location.href=Config.applyBindUrl);if(!e.curUser.additional.DepartmentId)return void(window.location.href=Config.applyBindUrl)}t.habbit={mainRole:t.getMainRole()},window.location.href.indexOf("#"+Config.indexPage)>-1&&t.goToMainRole(t.habbit.mainRole),angular.extend(t.mainStatus,a.data),t.$digest()}else 802==a.code?(alert(a.msg||"登录失败"),Config.loginHtmlUrl&&(window.location.href=Config.loginHtmlUrl)):alert(a.msg||"登录失败")}})}}t.mainStatus={navFold:document.body.clientWidth<1500,navigation:"",msgBubble:0},e.curUser={};var f=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()};t.currentDate=f(),t.Math=window.Math;var h=function(){return{absUrl:r.absUrl(),url:r.url(),protocol:r.protocol(),port:r.port(),path:r.path(),hash:r.hash(),search:r.search()}};t.leftSideisShow=!0,t.$on("$locationChangeStart",function(e,a,r){t.urlInfo=h(),a.indexOf("personalCenter")!==-1?t.leftSideisShow=!1:t.leftSideisShow=!0,o.closeAll()}),t.mainConfig=window.Config||{},t.pageTo=function(t){window.location.assign(t)},t.goTo=i.goTo,e.goTo=t.goTo,e.getObjectByKeyOfArr=i.getObjectByKeyOfArr,e.utils=i,e.AjaxUtils=d,e.store=n,e.modal=o,e.OPrinter=s,e.UICustomTable=l,e.watchFormChange=c,e.curServerPath=i.getCurServerPath(),t.httpGet=function(t){return Config.serverPath&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&(t=Config.serverPath+t),a.get(t)},t.logout=function(t){var e="";return Config.logoutUrl?(t||(t="POST"),Config.serverPath&&(e=Config.logoutUrl,0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&(e=Config.serverPath+e)),void $.ajax({url:e,type:t,xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:function(t){window.location.href=Config.loginHtmlUrl}})):void alert("请设置注销接口")},t.hasAuthor=function(t){if(!t)return!0;if(!e.curUser||!e.curUser.additional||!e.curUser.additional.Authoritys)return!1;var a=e.curUser.additional.Authoritys;return $.inArray(t,a)!=-1},t.hasAuthorOr=function(e){if(angular.isArray(e)){if(0==e.length)return!0;for(var a=0;a<e.length;a++){e[a];if(t.hasAuthor(e[a]))return!0}return!1}return t.hasAuthor(e)},t.hasAuthorAnd=function(e){if(angular.isArray(e)){if(0==e.length)return!0;for(var a=0;a<e.length;a++){e[a];if(!t.hasAuthor(e[a]))return!1}return!0}return t.hasAuthor(e)},e.hasAuthor=t.hasAuthor,e.hasAuthorOr=t.hasAuthorOr,e.hasAuthorAnd=t.hasAuthorAnd,u(),e.$on("loadMainInfo",function(){u()}),$(document).on("click",".top-nav-wrap .backBtn",function(){window.history.back()}),t.goToMainRole=function(e){switch(e||(e="客服"),t.habbit||(t.habbit={}),t.habbit.mainRole=e,n.set("habbit.mainRole",e),e){case"客服":t.goTo("#/main.html");break;case"销售":t.goTo("#/authorIndex/main-salemanager.html");break;case"总经理":t.goTo("#/authorIndex/main-generalmanager.html");break;case"采购":t.goTo("#/authorIndex/main-purchasemanager.html");break;case"库管":t.goTo("#/authorIndex/main-repertorymanager.html");break;case"验收":t.goTo("#/authorIndex/main-checkmanager.html");break;default:t.goTo("#/main.html")}},t.getMainRole=function(){var t=n.get("habbit.mainRole"),a="";if(e.hasAuthor("总经理")){if(a="总经理",t==a)return a}else if(e.hasAuthor("销售单查询")){if(a="销售",t==a)return a}else if(e.hasAuthor("采购单查询")){if(a="采购",t==a)return a}else if(e.hasAuthor("出入库单中心")){if(a="库管",t==a)return a}else if(e.hasAuthor("验单中心")){if(a="验收",t==a)return a}else if(e.hasAuthor("购需单查询")&&(a="客服",t==a))return a;return a}}function e(t){}function a(t,e,a,r){e.closeAll(),t.cancelThis=function(t,e,r){a(t,function(){window.history.go(-1)},e,r)},t.handleThisSubmit=function(e,r,n,i){a(e,function(){t.pageTo(i)},r,n,i)},t.easypiechart_options={animate:{duration:1e3,enabled:!0},barColor:"#f30",trackColor:"#ffe8ce",scaleColor:!1,lineWidth:8,lineCap:"round",size:125}}function r(t,e){e.closeAll()}angular.module("manageApp.main").controller("mainCtrl",["$scope","$rootScope","$http","$location","store","utils","modal","OPrinter","UICustomTable","watchFormChange","AjaxUtils",t]).controller("sideNav",["$scope",e]).controller("editCtrl",["$scope","modal",r]).controller("pageCtrl",["$scope","modal","dialogConfirm","$timeout",a])}),define("main/directives",["main/init"],function(){function ngView(t,e,a){return{restrict:"A",priority:-500,link:function(r,n){e.remove(t.current.loadedTemplateUrl),r.mainStatus.pageParams=a}}}function convertToDate(t){var e=t("date");return{require:"ngModel",link:function(t,a,r,n){var i=r.convertToDate?r.convertToDate:"yyyy-MM-dd";n.$parsers.push(function(t){if(t)return r.format?e(t,i):t.getTime()}),n.$formatters.push(function(){return n.$modelValue?r.timestamp?new Date(parseInt(n.$modelValue,10)).getTime():new Date(parseInt(n.$modelValue,10)):null})}}}function convertToNumber(){return{require:"ngModel",link:function(t,e,a,r){r.$parsers.push(function(t){return parseInt(t,10)}),r.$formatters.push(function(t){return""+t})}}}function convertJsonToObject(){return{require:"ngModel",link:function(t,e,a,r){r.$parsers.push(function(t){return t?angular.fromJson(t):null}),r.$formatters.push(function(t){return angular.toJson(t)})}}}function ajaxUrl(t,e,a,r,n,i){return{restrict:"AE",transclude:!0,link:function(t,o,s,l,c){function d(l){if(!angular.isDefined(s.ajaxIf)||s.ajaxIf){if(angular.isDefined(s.ajaxIfEval)){var c=t.$eval(s.ajaxIfEval);if(!c)return}t.isLoading=!0;var d=null;s.noshowLoading||(d=n(o)),s.scopeErrorMsg&&(t[s.scopeErrorMsg]=""),e(s.ajaxUrl,l).then(function(e){d&&d.hide();var r=e[0];t.ajaxUrlHandler&&(r=t.ajaxUrlHandler(r)),s.scopeResponse&&(t[s.scopeResponse]=e[1]),s.scopeData&&(t[s.scopeData]||(angular.isArray(e[0])?t[s.scopeData]=[]:t[s.scopeData]={}),i.replaceObject(t[s.scopeData],e[0])),angular.isDefined(s.alertOk)&&a(e[1].msg),t.listCallback&&t.listCallback(e[1]),s.callback&&t.$eval(s.callback),t.isLoading=!1})["catch"](function(e){d&&d.hide(),s.errorCallback&&t.$eval(s.errorCallback),s.scopeErrorMsg&&(t[s.scopeErrorMsg]=e),angular.isDefined(s.alertError)&&r(e),$(".pr-full-loading").remove()})}}c(t,function(t){o.append(t)}),t.ajaxUrlHandler=t.$eval(s.ajaxUrlHandler);var u={};s.params?0===s.params.indexOf("{")?s.$observe("params",function(e){u=t.$eval(e),d(u)}):t.$watch(s.params,function(t){u=t,d(u)},!0):s.$observe("ajaxUrl",function(t){d({})}),t.$on("ajaxUrlReload",function(){d({})})}}}function formValidator(t,e,a,r,n,i,o){return{restrict:"A",link:function(i,s,l){function c(){if(f.submitting!==!0){f.submitting=!0;var n=!1;angular.isDefined(l.parameterBody)&&(n=!0,"false"==l.parameterBody&&(n=!1));var s=i.formData;l.formData&&(s=i[l.formData]),l.scopeErrorMsg&&(i[l.scopeErrorMsg]=""),l.scopeOkMsg&&(i[l.scopeOkMsg]="");var c="POST";l.httpMethod&&(c=l.httpMethod),t(l.action,s,c,n).then(function(t){var r=t[0],n=t[1];if(f.submitting=!1,f.submitInfo="",l.scopeResponse&&(i[l.scopeResponse]=t[1]),l.scopeData&&(i[l.scopeData]||(angular.isArray(t[0])?i[l.scopeData]=[]:i[l.scopeData]={}),o.replaceObject(i[l.scopeData],t[0])),angular.isDefined(l.alertOk)&&a(t[1].msg),l.scopeOkMsg&&(i[l.scopeOkMsg]=t[1].msg),"reset"==l.formSubmitAfter&&h.reset(),l.callback&&i.$eval(l.callback),l.broadcast&&(i.$broadcast(l.broadcast),i.$emit(l.broadcast)),!angular.isDefined(l.noCloseDialog)){if(n&&n.url)return void window.location.assign(n.url);angular.isFunction(i.submitCallBack)?i.submitCallBack.call(i,m,r):r&&r.url?window.location.assign(r.url):i.$broadcast("reloadList"),angular.isDefined(l.autoCloseDialog)&&e.close()}})["catch"](function(t){f.submitting=!1,f.submitInfo=t||"提交失败。",l.scopeErrorMsg&&(i[l.scopeErrorMsg]=t),angular.isDefined(l.alertError)&&r(t)})}}function d(t,e){if(t&&e){var a=e[t];a&&o.goTo(a)}}function u(e,a,n){var i=n.url,o=n.param;t(i,o,"POST").then(function(t){t[1];d(e,a)})["catch"](function(t){r(t||"出错")})}var f=i.formStatus={submitted:!1,submitting:!1,submitInfo:""},h=angular.element(s)[0],m=(i.$eval(l.name),i.ngDialogData);if(i.formData||(i.formData=angular.extend({},i.formData)),i.$watch(l.source,function(t){t&&angular.isObject(t)&&$.extend(!0,i.formData,t)}),s.on("submit",function(t){t.preventDefault(),l.beforeConfirmMsg?n(l.beforeConfirmMsg,function(){c()},null):c()}),i.submitForm1=function(){s.trigger("submit")},i.submitFormAfter1=function(t,e,a){if(i.formData.validFlag=!1,t)return a&&t==a.type?void u(t,e,a):void d(t,e)},i.reset=function(){h.reset()},l.scopeExtend){var p=o.getScopeExtend(i,l.scopeExtend);p&&(p.formValidator={},p.formValidator.reset=i.reset,p.formValidator.submitForm1=i.submitForm1)}}}}function tableList(t,e,a,r,n,i){return{restrict:"AE",scope:{listParams:"=?",listSelected:"=?",listSource:"=?",listObject:"=?"},transclude:!0,require:"?^ngModel",link:function(o,s,l,c,d){function u(e){if(l.listData){if(l.listSource)return void(o.listSource&&(o.tbodyList=angular.isArray(o.listSource)?o.listSource:o.listSource.list,o.listSource.options&&(m.totalCount=o.listSource.options.totalCount||m.totalCount,m.pageSize=o.listSource.options.pageSize||m.pageSize,m.totalPage=Math.ceil(m.totalCount/m.pageSize)),e&&e()));if(!angular.isDefined(l.ajaxIf)||l.ajaxIf){if(angular.isDefined(l.ajaxIfEval)){var a=o.$eval(l.ajaxIfEval);if(!a)return}if(!m.isLoading){m.isLoading=!0,o.isLoading=m.isLoading;var c=null;l.noshowLoading||(c=n(s)),m.currentPage>1||(g=(new Date).getTime()),t(l.listData,angular.merge({},p,{timestamp:g,pageNo:m.currentPage})).then(function(t){c&&c.hide();var a=t[1];200==a.code?(m.totalCount=a.totalCount,m.pageSize=a.pageSize,m.totalCount&&m.pageSize&&(m.totalPage=Math.ceil(m.totalCount/m.pageSize)),a.thead&&(o.theadList=a.thead),o.resultsData=a,a.data&&a.data.length>0?o.tbodyList=a.data:m.isFinished=!0,m.loadFailMsg=a.msg):(m.isFinished=!0,m.loadFailMsg=a.msg),l.callback&&o.$eval(l.callback),m.isLoading=!1,o.isLoading=!1,r(h),e&&e()})["catch"](function(t){c&&c.hide(),m.isLoading=!1,i(t),m.loadFailMsg=t,e&&e()})}}}}function f(){var t=[];o.listSelected.length=0,$(".selectOne:checked",s).each(function(){t.push(this.value)}),[].unshift.apply(o.listSelected,t);var e=[];angular.forEach(o.tbodyList,function(t){angular.forEach(o.listSelected,function(a){t.id==a&&e.push(t)})}),c&&c.$setViewValue(e)}function h(){$(".selectOne",s).on("click",function(t){t.stopPropagation();var e=$(".selectOne",s).length,a=$(".selectOne:checked",s).length;a>0&&a<e?$(".selectAll",s).prop("checked",!1).get(0).indeterminate=!0:e==a?$(".selectAll",s).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",s).prop("checked",!1).get(0).indeterminate=!1,f(),o.$apply()})}var m={currentPage:1,totalCount:0,pageSize:10,totalPage:1,isFinished:!1,isLoading:!1};o.mainStatus=o.$parent.mainStatus,o.parent=o.$parent,o.status=m,o.listData=l.listData,o.theadList=angular.fromJson(l.listThead),o.tbodyList=[],o.getListData=u,angular.isDefined(o.listParams)||(o.listParams={}),angular.isDefined(o.listSelected)||(o.listSelected=[]),angular.isDefined(o.listObject)||(o.listObject={}),o.delSelected=function(e){a("确定删除这些?",function(){t(e,{ids:o.listSelected.join(",")},"POST").then(function(){o.$broadcast("reloadList")})["catch"](function(t){alert(t||"删除错误")})})},o.deleteThis=function(e,r){var n=this.tr;a("确定删除?",function(){t(e,{id:r},"POST").then(function(){o.tbodyList.splice(o.tbodyList.indexOf(n),1),0===o.tbodyList.length&&o.$broadcast("reloadList")})["catch"](function(t){alert(t||"删除错误")})})},o.dothing=function(e,r,n){var i=this.tr;a(n,function(){t(e,r,"POST").then(function(){o.tbodyList.splice(o.tbodyList.indexOf(i),1),0!==o.tbodyList.length&&o.$broadcast("reloadList")})["catch"](function(t){alert(t||"删除错误")})})},o.selectThis=function(){var t=this.tr,e=o.tbodyList.indexOf(t),a=s.find("tbody tr");a.removeClass("on").eq(e).addClass("on"),c&&c.$setViewValue(angular.copy(t))},o.changeStatus=function(e,r){var n=this.tr;a(r||"确定?",function(){t(e,{id:n.id}).then(function(t){var e=t[0],a=o.tbodyList.indexOf(n);o.tbodyList[a]=e})["catch"](function(t){alert(t||"请求失败!")})})},o.submitCallBack=function(t,a){e.closeAll(),a&&t?angular.forEach(o.tbodyList,function(e,r){e.id==t.id&&(o.tbodyList[r]=a)}):r(function(){o.$broadcast("reloadList")})};var p={},g=null;o.$on("deleteSelected",function(t,e){$(".selectOne[value="+e.id+"]",s).prop("checked",!1);var a=$(".selectOne",s).length,r=$(".selectOne:checked",s).length;r>0&&r<a?$(".selectAll",s).prop("checked",!1).get(0).indeterminate=!0:a==r?$(".selectAll",s).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",s).prop("checked",!1).get(0).indeterminate=!1;var n=[];o.listSelected.length=0,$(".selectOne:checked",s).each(function(){n.push(this.value)}),[].unshift.apply(o.listSelected,n),f()}),o.$watchCollection("listSource",function(t){t&&u(f)}),o.$watch("listParams",function(){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],p=angular.copy(o.listParams),u(f),$(".selectAll",s).length>0&&($(".selectAll",s).prop("checked",!1).get(0).indeterminate=!1)},!0),l.$observe("listData",function(t){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],p=angular.copy(o.listParams),u(f),$(".selectAll",s).length>0&&($(".selectAll",s).prop("checked",!1).get(0).indeterminate=!1)}),o.$on("reloadList",function(){m.currentPage=1,m.isFinished=!1,o.tbodyList=[],p=angular.copy(o.listParams),u(f),$(".selectAll",s).length>0&&($(".selectAll",s).prop("checked",!1).get(0).indeterminate=!1)}),$(s).on("click",".selectAll",function(){this.indeterminate?(this.checked=!1,$(".selectOne",s).prop("checked",!1)):$(".selectOne",s).prop("checked",this.checked),f(),o.$apply()}),d(o,function(t){s.append(t)})}}}function tableCell(){return{restrict:"AE",scope:{row:"="},replace:!0,templateUrl:Config.tplPath+"tpl/table-cell.html",link:function(t,e,a){t.cells=[],angular.isString(t.row)||angular.isNumber(t.row)?t.cells.push({text:t.row}):angular.isArray(t.row)?angular.forEach(t.row,function(e){angular.isObject(e)?t.cells.push(e):t.cells.push({text:e})}):t.cells.push(t.row)}}}function pagination(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/pagination.html",link:function(t,e,a){function r(t,e,a){return{number:t,text:e,active:a}}function n(t,e){var a=[],n=1,s=e,l=angular.isDefined(i)&&i<e;l&&(o?(n=Math.max(t-Math.floor(i/2),1),s=n+i-1,s>e&&(s=e,n=s-i+1)):(n=(Math.ceil(t/i)-1)*i+1,s=Math.min(n+i-1,e)));for(var c=n;c<=s;c++){var d=r(c,c,c===t);a.push(d)}if(l&&!o){if(n>1){var u=r(n-1,"...",!1);a.unshift(u)}if(s<e){var f=r(s+1,"...",!1);a.push(f)}}return a}var i=angular.isDefined(a.maxSize)?t.$parent.$eval(a.maxSize):10,o=!angular.isDefined(a.rotate)||t.$parent.$eval(a.rotate);t.start=function(){1!=t.status.currentPage&&(t.status.currentPage=1,t.getListData())},t.prev=function(){t.status.currentPage<=1||(t.status.currentPage--,t.getListData())},t.next=function(){t.status.currentPage>=t.status.totalPage||(t.status.currentPage++,t.getListData())},t.end=function(){
t.status.currentPage!=t.status.totalPage&&(t.status.currentPage=t.status.totalPage,t.getListData())},t["goto"]=function(e){t.status.currentPage=e,t.getListData()},t.$watch("status.totalPage",function(){t.pages=n(t.status.currentPage,t.status.totalPage)}),t.$watch("status.currentPage",function(){t.pages=n(t.status.currentPage,t.status.totalPage)})}}}function pagination2(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/pagination2.html",link:function(t,e,a){t.start=function(){1!=t.status.currentPage&&(t.status.currentPage=1,t.getListData())},t.prev=function(){t.status.currentPage<=1||(t.status.currentPage--,t.getListData())},t.next=function(){t.status.currentPage>=t.status.totalPage||(t.status.currentPage++,t.getListData())},t.end=function(){t.status.currentPage!=t.status.totalPage&&(t.status.currentPage=t.status.totalPage,t.getListData())}}}}function filterConditions(t){return{restrict:"AE",scope:{},transclude:!0,link:function(e,a,r,n,i){function o(){var t={};angular.forEach(e.filterConditions.list,function(e){t[e.type]=e.id}),e.filterParams=t}e.filterParams={},e.filterConditions={list:[]};var s=e.filterConditions;e.conditionList={},e.selectCondition=function(t,e){e.type=t,s[t]=e,s.list.push(e),o()},e.deleteCondition=function(t){var e=s.list.indexOf(t);s.list.splice(e,1),delete s[t.type],o()},r.filterConditions&&!function(){t(r.filterConditions).then(function(t){var a=t[0];e.conditionList=a})}(),i(e,function(t){a.append(t)})}}}function treeList(t,e,a){return{restrict:"AE",scope:{},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/tree.html",link:function(r,n,i,o){function s(){r.status.isLoading=!0,e(i.treeList).then(function(e){var o=e[0];r.treeList=t(o,i.pidKey),r.status.isLoading=!1,l&&angular.isDefined(i.selectFirst)&&(l=!1,a(function(){for(var t=n.find("em"),e=0,a=t.length;e<a&&(t.eq(e).trigger("click"),0!=t.eq(e).next("ul").length);e++);}))})["catch"](function(){r.status.isLoading=!1})}var l=!0;r.status={},r.treeList=[],r.curTree={},r.status.isLoading=!0,r.selectTree=function(t,e){var a=n.find("li"),r=$(e.currentTarget),i=r.parent("li"),s=angular.copy(t);0==s.nodes.length?(a.removeClass("on"),i.addClass("on"),o&&o.$setViewValue(s)):i.hasClass("fold")?i.removeClass("fold"):i.addClass("fold")},i.$observe("treeList",s)}}}function treeList2(t,e,a,r,n){return{restrict:"AE",require:"?^ngModel",link:function(r,i,o,s){function l(){o.treeList2&&(r.status.isLoading=!0,e(o.treeList2,u).then(function(e){var a=e[0];r.treeList=t(a,o.pidKey),console.log(r.treeList),r.status.isLoading=!1})["catch"](function(){r.status.isLoading=!1}))}var c=angular.isDefined(o.selectGroup);r.status={},r.treeList=[],r.curTree={},r.status.isLoading=!0;var d="listParams";o.listParamsKey&&(d=o.listParamsKey),angular.isDefined(r[d])||(r[d]={});var u={};r.selectTree=function(t,e){var a=i.find("li"),r=$(e.currentTarget),n=r.parent("li"),o=angular.copy(t);0==o.nodes.length||c?(a.removeClass("on"),n.addClass("on"),delete o.nodes,s&&s.$setViewValue(o)):n.hasClass("fold")?n.removeClass("fold"):n.addClass("fold")},r.extendTree=function(t){t.preventDefault(),t.stopPropagation();var e=$(t.currentTarget),a=e.parent().parent("li");a.hasClass("fold")?(a.removeClass("fold"),e.parent().next().hide()):(a.addClass("fold"),e.parent().next().show())},r.extendTree2=function(t,e,a,r){r||(r="fold");var n=$("#"+a);n.hasClass(r)?(n.removeClass(r),$("#"+e).hide()):(n.addClass(r),$("#"+e).show())},r.deleteTree=function(t,a){t.preventDefault(),t.stopPropagation(),n("是否删除?",function(){e(a).then(function(){l()})})},r.addTree=function(t,e){t.preventDefault(),t.stopPropagation(),a.closeAll(),a.open({template:e,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:!1,scope:r,controller:["$scope","$element",function(t,e){$(".ngdialog-content",e).width(400)}]})},r.$watch(d,function(){u=angular.copy(r[d]),l()},!0),o.$observe("treeList2",l),r.submitCallBack=function(t,e){a.closeAll(),l()}}}}function navList(t){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(e,a,r,n,i){function o(a){return r.listSource?(e.tbodyList=e.listSource,void(a&&a())):(s.isLoading=!0,void t(r.navList).then(function(t){var a=t[0];e.isLoading=!1,e.listData=a.data,e.select(e.listData[0])})["catch"](function(){e.isLoading=!1}))}i(e,function(t){a.append(t)});var s={isLoading:!0};e.status=s,e.currentSelect={};e.select=function(t){e.currentSelect=t,n&&n.$setViewValue(t)},o()}}}function selectAsync(t){return{restrict:"A",scope:{},require:"?^ngModel",link:function(e,a,r,n){t(r.selectAsync).then(function(t){var e=t[0],r='<option value="">请选择</option>';e||(e=[]);for(var i=e.length,o=0;o<i;o++)r+='<option value="'+e[o].value+'">'+e[o].text+"</option>";a.html(r),n&&a.val(n.$viewValue)})}}}function relativeSelect(t,e){return{restrict:"A",scope:{},require:"?^ngModel",link:function(a,r,n,i){function o(){var t={};t[r[0].name]=r.val(),$(l).trigger("update",t)}function s(e){t(c,e).then(function(t){var e=t[0],a=d?"":'<option value="">请选择</option>';e||(e=[]);for(var n=e.length,s="",l=0;l<n;l++)(e[l].selected||d&&0===l)&&(s=e[l].value),a+="<option "+(0===e[l].enabled?' class="text-muted"':"")+' value="'+e[l].value+'">'+e[l].text+"</option>";r.html(a),r.val(s),i&&i.$setViewValue(s),o()})}var l=n.relativeTo,c=n.relativeSelect,d=angular.isDefined(n.selectFirst),u=angular.isDefined(n.relativeInitload);r.on("change",o),r.on("update",function(t,e){s(e)}),u&&e(o)}}}function eChart(requestData,dialogChart,alertError){return{restrict:"A",scope:{clickToUrl:"@",clickToDialog:"@",clickTopToUrl:"@",clickTopToDialog:"@",eChartKey:"@",eChartMap:"=",eChartMapData:"=",chartParams:"="},require:"?^ngModel",link:function($scope,$element,$attrs,ngModel){$scope.isLoading=!1,require(["echarts"],function(echarts){function reSize(){myChart.resize()}function loadChart(_url,_params){$scope.isLoading||($scope.isLoading=!0,myChart.showLoading(),Config.serverPath&&0!==_url.indexOf("http://")&&0!==_url.indexOf("https://")&&(_url=Config.serverPath+_url),$.ajax({url:_url,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"text",success:function(text){myChart.hideLoading(),$scope.isLoading=!1;var results=eval("("+text+")"),_data=results.data;_data&&($scope.eChartKey&&($scope.$parent.eChartMapData||($scope.$parent.eChartMapData={}),$scope.$parent.eChartMapData[$scope.eChartKey]=_data),_data.polar?_data.tooltip.formatter=function(t){var e=t[0].name;return angular.forEach(t,function(t){e+="<br>"+t.seriesName+": "+t.data}),e}:_data.tooltip&&_data.tooltip.formatter&&0===_data.tooltip.formatter.indexOf("function")&&(_data.tooltip.formatter=eval("("+_data.tooltip.formatter+")")),myChart.setOption(_data))},error:function(t){$scope.isLoading=!1}}))}var myChart=echarts.init($element[0]);$scope.eChartKey&&($scope.$parent.eChartMap||($scope.$parent.eChartMap={}),$scope.$parent.eChartMap[$scope.eChartKey]=myChart),$(window).on("resize",reSize),$scope.$on("$destroy",function(){$(window).off("resize",reSize),myChart.dispose()}),myChart.on("click",function(t){console.log(t),t.data?(ngModel&&($attrs.ngModelDataKey?ngModel.$setViewValue(t.data[$attrs.ngModelDataKey]):ngModel.$setViewValue(t.data)),$scope.clickToUrl?window.location.assign($scope.clickToUrl):$scope.clickToDialog&&dialogChart($scope.$parent.mainConfig.viewsDir+$scope.clickToDialog)):$scope.clickTopToUrl?(ngModel&&ngModel.$setViewValue(t),window.location.assign($scope.clickTopToUrl)):$scope.clickTopToDialog&&(ngModel&&ngModel.$setViewValue(t),dialogChart($scope.$parent.mainConfig.viewsDir+$scope.clickTopToDialog))}),angular.isDefined($attrs.chartParams)?$scope.$watch("chartParams",function(t){loadChart($attrs.chart,t)},!0):$attrs.$observe("chart",function(t){loadChart($attrs.chart)}),loadChart($attrs.chart,$scope.chartParams)})}}}function angucomplete(t,e,a,r){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",classDescription:"@",searchFields:"@",matchClass:"@",searchStrClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/autocomplete.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=n.searchFields,require(["project/angucomplete"],function(o){n.angucomplete1=new o(n,i,t,e,a,r,s)})}}}function checkboxGroup(){return{restrict:"A",scope:{checkboxGroup:"="},link:function(t,e,a){angular.isArray(t.checkboxGroup)||(t.checkboxGroup=[]),e.on("click",function(){var r=-1;angular.isArray(t.checkboxGroup)||(t.checkboxGroup=[]),angular.isArray(t.checkboxGroup)&&(r=t.checkboxGroup.indexOf(a.value)),e[0].checked?r===-1&&t.checkboxGroup.push(a.value):r!==-1&&t.checkboxGroup.splice(r,1),t.$apply()}),t.$watchCollection("checkboxGroup",function(r){r&&t.checkboxGroup.indexOf(a.value)!==-1&&(e[0].checked=!0)})}}}function chosen(t,e,a,r,n,i){return{restrict:"A",require:"?^ngModel",link:function(o,s,l,c){function d(t){var e=null,a=t[0]?t[0].value:null;return angular.isDefined(l.chosenAjax)&&(a=null),e=angular.isDefined(l.multiple)?angular.isDefined(l.defaultEmpty)?c.$viewValue?c.$viewValue:[]:c.$viewValue?c.$viewValue:[a]:angular.isDefined(l.defaultEmpty)?c.$viewValue?c.$viewValue:"":c.$viewValue?c.$viewValue:a,c.$setViewValue(e),null===e&&(e=""),e}function u(t,e){var a="";null===e&&(e=""),angular.isDefined(l.multiple)||(e+=""),angular.isDefined(l.defaultEmpty)&&(a+='<option value=""  >'+l.defaultEmpty+"</option>");var r=null;l.callbackFilterReturnData&&(r=o.$eval(l.callbackFilterReturnData));for(var n=0;n<t.length;n++){var s=!1;if(s=angular.isArray(e)?e.indexOf(t[n].value)>-1:e==t[n].value,!(!s&&r&&r.indexOf(t[n].value)>-1)){var c=t[n].text;p&&(suffixKeyVal=i.getObjectVal(t[n],p),null==suffixKeyVal&&void 0==suffixKeyVal||(c+=m+suffixKeyVal)),a+='<option value="'+t[n].value+'" '+(s?"selected":"")+">"+c+"</option>"}}return a}function f(){var t={};t.value=s.val(),o[l.selectCallBack](t)}var h={search_contains:!0,no_results_text:"没有找到",display_selected_options:!1},m=l.suffixConnection||"",p=l.suffixKey||"";angular.isDefined(l.isDisabledThis)&&l.$observe("isDisabledThis",function(t,e){}),l.selectCallBack&&(s.on("change",f),s.on("update",function(t,e){getData(e)}));var g=null;l.width&&(h.width=l.width);var v=null;require(["chosen"],function(){function f(t){l.ngModel&&!angular.isDefined(l.multiple)&&o.$watch(l.ngModel,function(e,a){if(g&&e!=a)try{var r=g.data("chosen");if(!r)return;if(!r.results_data||r.current_selectedIndex<0)return;if(r.results_data[r.current_selectedIndex],t&&t(),l.selectData){var n=i.getObjectByKeyOfArr(v,"value",e);o[l.selectData]=n}l.callback&&o.$eval(l.callback)}catch(s){}})}function m(t){try{t&&t.data("chosen").destroy()}catch(e){}}function p(t){l.params&&0===l.params.indexOf("{")&&(b=o.$eval(l.params));var e=null;$("option:selected",s).not(":empty").clone().attr("selected",!0);w&&(w.abort(),e&&e.hide()),e=n(s,"chosen"),t||(t=""),b.q=t,b.id=c.$viewValue,w=$.ajax({url:F,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,data:b,dataType:"json",success:function(r){if(e&&e.hide(),200==r.code){a.isLoading=!1,r.data||(r.data=[]),v=r.data,0===r.data.length&&r.data.push({value:"",text:""});var n=(r.data.length,r.data),i=d(n),o=u(n,i);s.html(o),s.trigger("chosen:updated");var c=$.Event("keydown");c.which=39,I=t,k.val(t).trigger(c),r.data.length>0?C.find(".no-results").hide():C.find(".no-results").show()}else angular.isDefined(l.alertError)&&alet(r.msg)},error:function(t){e&&e.hide()},complete:function(){o.$digest()}})}function y(t){var a=$(this);if(t.keyCode&&13===t.keyCode&&!c.$viewValue)try{c.$setViewValue(g[0][0].value)}catch(t){}if("paste"===t.type&&a.is(":not(:focus)")||t.keyCode&&(9===t.keyCode||13===t.keyCode||16===t.keyCode||17===t.keyCode||18===t.keyCode||19===t.keyCode||20===t.keyCode||27===t.keyCode||33===t.keyCode||34===t.keyCode||35===t.keyCode||36===t.keyCode||37===t.keyCode||38===t.keyCode||39===t.keyCode||40===t.keyCode||44===t.keyCode||45===t.keyCode||144===t.keyCode||145===t.keyCode||91===t.keyCode||93===t.keyCode||224===t.keyCode||t.keyCode>=112&&t.keyCode<=123))return!1;if(S&&32!=t.keyCode&&(t.keyCode<48||t.keyCode>57))return!1;C.find(".no-results").hide();var r=$.trim(a.val());return I!=r&&(M=!0,o.searchTimer&&e.cancel(o.searchTimer),void(o.searchTimer=e(function(){M=!1,p(r)},500)))}function D(){if(angular.isDefined(l.ajaxIf)){if(0===l.ajaxIf.indexOf("{")){var e=o.$eval(l.ajaxIf);if(!e)return}if(!l.ajaxIf)return}if(angular.isDefined(l.ajaxIfEval)){var e=o.$eval(l.ajaxIfEval);if(!e)return}t(l.selectSource,b).then(function(t){var e=t[0];l.callBack&&o.$eval(l.callBack),e||(e=[]),v=e;var a=(e.length,d(e)),r=u(e,a);s.html(r),m(g),g=s.chosen(o.chosen||h),c.$setViewValue(a)})["catch"](function(t){l.scopeErrorMsg&&(o[l.scopeErrorMsg]=t),angular.isDefined(l.alertError)&&r(t)})}if(l.selectSource){var b={};if(angular.isDefined(l.chosenAjax)){g=s.chosen(h);var w,C=s.next(),k=$("input",C),I="",S=!1,M=!1,F=l.selectSource;Config.serverPath&&0!==F.indexOf("http://")&&0!==F.indexOf("https://")&&(F=Config.serverPath+F),c.$viewValue&&p(""),$(".chosen-search > input, .chosen-choices .search-field input",C).on("keyup",y).on("paste",function(t){var e=this;setTimeout(function(){y.call(e,t)},500)}).on("keydown",function(t){S=229==t.keyCode}).on("blur",function(t){if(!c.$viewValue)try{g&&g.data("chosen").single_set_selected_text()}catch(t){}}),"true"==l.isEmptyQuery&&p(""),f(p)}else{var A=l.selectSource;l.params?(A=l.params,0===l.params.indexOf("{")?(l.$observe("params",function(t){b=o.$eval(t),A!=t&&(A=t,c.$setViewValue(null),D(b))}),b=o.$eval(l.params)):(o.$watch(l.params,function(t){b=t,A!=t&&(c.$setViewValue(null),D(b))},!0),b=l.params)):l.$observe("selectSource",function(t){A!=t&&(c.$setViewValue(null),D())}),f(D),o.$watch(l.clearWatchScope,function(t,e){g&&D()}),D()}}else s.append("<option value=''></option>"),s.chosen(o.chosen||h)})}}}function formItem(t){return{restrict:"AE",scope:!0,replace:!0,link:function(e,a,r){var n=e.$eval(r.src),i="";switch(n.type){case"text":i='<input type="'+n.type+'" name="'+n.key+'" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\" ng-model=\"formData['"+n.key+'\']" class="ipt" placeholder="'+n.placeholder+'" />';break;case"hidden":i='<input type="'+n.type+'" name="'+n.key+'" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\" ng-model=\"formData['"+n.key+"']\"/>";break;case"date":i='<input type="'+n.type+'" name="'+n.key+'" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\" ng-model=\"formData['"+n.key+'\']" class="ipt" placeholder="'+n.placeholder+'" convert-to-date/>';break;case"checkbox":i='<div class="form-ctrl" ng-init="formData[\''+n.key+"']=['"+(n.value||"")+"']\">",angular.forEach(n.options,function(t){i+='<label class="label"><input type="'+n.type+'" name="'+n.key+'" checkbox-group="formData[\''+n.key+'\']"  value="'+t+'" /> '+t+"</label>"}),i+="</div>";break;case"radio":i='<div class="form-ctrl" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\">",angular.forEach(n.options,function(t){i+='<label class="label"><input type="'+n.type+'" name="'+n.key+'" ng-model="formData[\''+n.key+'\']"  value="'+t+'" /> '+t+"</label>"}),i+="</div>";break;case"select":i='<select class="select select-w" name="'+n.key+'" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\" ng-model=\"formData['"+n.key+"']\"  >",i+='<option value="" >请选择</option>',angular.forEach(n.options,function(t){i+='<option value="'+t+'" >'+t+"</option>"}),i+="</select>";break;case"textarea":i='<textarea name="'+n.key+'" ng-init="formData[\''+n.key+"']='"+(n.value||"")+"'\" ng-model=\"formData['"+n.key+'\']"  class="textarea" placeholder="'+n.placeholder+'"></textarea>'}a.append(t(i)(e))}}}function customConfig(t){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(e,a,r,n,i){t(function(){n&&(e.dataList=n.$viewValue||[])}),e.$watchCollection("dataList",function(t){t&&n&&n.$setViewValue(t)}),e.addRow=function(){e.dataList.push({})},e.delRow=function(t){e.dataList.splice(t,1)},i(e,function(t){a.append(t)})}}}function autoComplete(){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(t,e,a,r,n){var i={cacheLength:0,parse:function(t){var e=[];if(!t||!t.data)return e;for(var a=t.data,r=0;r<a.length;r++){var n=$.trim(a[r]);n&&(row=n.split("|"),e[e.length]={data:n,value:row[0],result:row[0]})}return e},formatItem:function(t){return t},noRecord:"没匹配数据",dataType:"json"};require(["autocomplete"],function(){if(a.autoComplete){var t=a.autoComplete;Config.serverPath&&0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&(t=Config.serverPath+t);var r=null;e.focus(function(){null==r&&(i.width=e.css("width"),r=e.autocomplete(t,i),r.result(function(t,e,a){console.log(e)}))})}})}}}function selectAddress(t,e,a){var r,n,i;return n=e.defer(),i=Config.tplPath+"tpl/cascading-select-address/cascading-select-address.html",r=Config.tplPath+"tpl/cascading-select-address/city.min.js",t.get(r).success(function(t){return n.resolve(t)}),{restrict:"A",scope:{p:"=",a:"=",c:"=",d:"=",ngModel:"="},link:function(e,r,o){var s,l=function(t){0==$(t.target).closest(".select-address").length&&s&&s.hide()};return s={element:null,backdrop:null,show:function(){return $(document).on("click",l),this.element.addClass("active")},hide:function(){return this.element.removeClass("active"),$(document).unbind("click",l),!1},resize:function(){if(this.element)return this.element.css({top:-this.element.height()-30,"margin-left":-this.element.width()/2}),!1},focus:function(){return $('[ng-model="d"]').focus(),!1},init:function(){return r.on("click keydown",function(){return s.show(),event.stopPropagation(),!1}),setTimeout(function(t){return function(){return t.element.show(),t.resize()}}(this),500)}},n.promise.then(function(r){return t.get(i).success(function(t){var n;return n=a(t)(e),$("body").append(n),s.element=$(n[2]),e.provinces=r,s.init()}),e.aSet={p:function(t){return e.p=t,e.c=null,e.a=null,e.d=null},c:function(t){return e.c=t,e.a=null,e.d=null},a:function(t){return e.a=t,e.d=null,s.focus()}},e.clear=function(){e.p=null,e.c=null,e.a=null,e.d=null,e.cities=[],e.dists=[]},e.submitAddress=function(){return s.hide()},e.$watch("p",function(t){var a,n,i,o;if(o=[],t)for(n=0,i=r.length;n<i;n++)a=r[n],a.p===t&&o.push(e.cities=a.c);return e.cities?o:(e.cities=[],e.cities)}),e.$watch("c",function(t){var a,r,n,i,o;if(t){for(i=e.cities,o=[],r=0,n=i.length;r<n;r++)a=i[r],a.n===t&&o.push(e.dists=a.a);return o}return e.dists=[]}),e.$watch(function(){return e.ngModel="",e.p&&(e.ngModel+=e.p),e.c&&(e.ngModel+=" "+e.c),e.a&&(e.ngModel+=" "+e.a),e.d&&(e.ngModel+=" "+e.d),s.resize()})})}}}function ajaxUrlSubmit(t,e,a,r,n,i,o){return{restrict:"AE",link:function(t,s,l,c,d){function u(c){if(!angular.isDefined(l.ajaxIf)||l.ajaxIf){if(angular.isDefined(l.ajaxIfEval)){var d=t.$eval(l.ajaxIfEval);if(!d)return}t.isLoading=!0;var u=null;l.noshowLoading||(u=n(s));var f=!1;angular.isDefined(l.parameterBody)&&(f=!0),l.scopeErrorMsg&&(t[l.scopeErrorMsg]="");var h="POST";l.httpMethod&&(h=l.httpMethod),e(l.ajaxUrlSubmit,c,h,f).then(function(e){u&&u.hide(),t.isLoading=!1;var r=e[0];t.ajaxUrlHandler&&(r=t.ajaxUrlHandler(r)),l.scopeResponse&&(t[l.scopeResponse]=e[1]),l.scopeData&&(t[l.scopeData]||(angular.isArray(e[0])?t[l.scopeData]=[]:t[l.scopeData]={}),o.replaceObject(t[l.scopeData],e[0])),angular.isDefined(l.alertOk)&&a(e[1].msg),t.listCallback&&t.listCallback(e[1]),l.callback&&t.$eval(l.callback),l.broadcast&&(t.$broadcast(l.broadcast),t.$emit(l.broadcast)),angular.isDefined(l.autoCloseDialog)&&i.close()})["catch"](function(e){u&&u.hide(),l.scopeErrorMsg&&(t[l.scopeErrorMsg]=e),angular.isDefined(l.alertError)&&r(e),l.errorCallback&&t.$eval(l.callback),$(".pr-full-loading").remove()})}}t.ajaxUrlHandler=t.$eval(l.ajaxUrlHandler),s.on("click",function(){var e={};l.params&&(e=0===l.params.indexOf("{")?t.$eval(l.params):t.$parent[l.params]),u(e)})}}}function invalidPopover(){return{restrict:"A",scope:{isFocus:"@?",ngModel:"=?",popoverOptions:"@",validValue:"@",popoverShow:"=?"},link:function(t,e,a){function r(t){e.data("isFocus")&&"true"==t?e.popover("show"):e.popover("hide")}t.isFocus&&e.data("isFocus",!0);var n=a.placement?a.placement:"right",i='{ "placement": "'+n+'", "trigger": "manual" }';a.popoverOptions&&(i=a.popoverOptions),e.popover(JSON.parse(i)),angular.isDefined(a.validValue)&&t.$watch("ngModel",function(t,r){"true"==a.validValue?e.popover("show"):e.popover("hide")}),a.popoverShow?t.$watch("popoverShow",function(t,a){t?e.popover("show"):e.popover("hide")}):(e.focus(function(){e.data("isFocus",!0),angular.isDefined(a.validValue)?"true"==a.validValue?e.popover("show"):e.popover("hide"):r(a.invalidPopover)}),a.$observe("invalidPopover",function(t){r(t)}))}}}function watchFormChange(t){return{restrict:"AE",link:function(e,a,r,n){e.watchFormChange=function(a){t(a,e)}}}}function datepicker(t){var e={format:"YYYY-MM-DD"};return{restrict:"EA",require:"ngModel",link:function(t,a,r,n){if("true"!=r.noParser){var i=require("moment"),o=r.format||e.format;n.$parsers.push(function(t){if(t){var e=i(t,o).format("x");return e}}),n.$formatters.push(function(){if(!n.$modelValue)return null;var t=n.$modelValue,e=i(parseInt(t,10)).format(o);return e})}a.datepicker({changeYear:!0,changeMonth:!0,dateFormat:"yy-mm-dd",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],onSelect:function(e){t.$apply(function(){n.$setViewValue(e)})}})}}}function textInterception(){"use strcit";return{restrict:"A",scope:!0,link:function(t,e,a){var r=e.width();e.css({width:r,height:"auto","margin-left":"auto","margin-right":"auto"});var n,i=parseInt(r/19,10),o=a.textInterception;o.length>i&&(n=o.slice(0,i)+"...",t.tr.firstMedical.name=n)}}}function ngCompile2(t){return function(e,a,r){e.$watch(function(t){return t.$eval(r.ngCompile2)},function(r){a.html(r),t(a.contents())(e)})}}convertJsonToObject.$inject=[],filterConditions.$inject=["requestData"],treeList.$inject=["buildTree","requestData","$timeout"],treeList2.$inject=["buildTree","requestData","modal","$timeout","dialogConfirm"],navList.$inject=["requestData"],selectAsync.$inject=["requestData"],relativeSelect.$inject=["requestData","$timeout"],eChart.$inject=["requestData","dialogChart","alertError"],formItem.$inject=["$compile"],customConfig.$inject=["$timeout"],angular.module("manageApp.main").directive("textInterception",textInterception).directive("ngCompile2",["$compile",ngCompile2]).directive("datepicker",["$filter",datepicker]).directive("watchFormChange",["watchFormChange",watchFormChange]).directive("invalidPopover",["$route","$templateCache","$routeParams",invalidPopover]).directive("ngView",["$route","$templateCache","$routeParams",ngView]).directive("convertToDate",["$filter",convertToDate]).directive("convertToNumber",convertToNumber).directive("convertJsonToObject",convertJsonToObject).directive("ajaxUrlSubmit",["$timeout","requestData","alertOk","alertError","proLoading","modal","utils",ajaxUrlSubmit]).directive("ajaxUrl",["$timeout","requestData","alertOk","alertError","proLoading","utils",ajaxUrl]).directive("formValidator",["requestData","modal","alertOk","alertError","dialogConfirm","$timeout","utils",formValidator]).directive("tableList",["requestData","modal","dialogConfirm","$timeout","proLoading","alertError",tableList]).directive("tableCell",tableCell).directive("pagination",pagination).directive("pagination2",pagination2).directive("filterConditions",filterConditions).directive("treeList",treeList).directive("treeList2",treeList2).directive("navList",navList).directive("selectAsync",selectAsync).directive("relativeSelect",relativeSelect).directive("chart",eChart).directive("angucomplete",["$parse","requestData","$sce","$timeout",angucomplete]).directive("checkboxGroup",checkboxGroup).directive("chosen",["requestData","$timeout","$rootScope","alertError","proLoading","utils",chosen]).directive("formItem",formItem).directive("autoComplete",autoComplete).directive("selectAddress",["$http","$q","$compile",selectAddress]).directive("customConfig",customConfig)}),define("main/filters",["main/init"],function(){var t=["$sce",function(t){return function(e){return t.trustAsHtml(e)}}],e=["utils",function(t){return function(e){var a=null;if(!e)return a;try{a=JSON.stringify(e,null,"\t")}catch(r){a=t.toJson(e)}return a}}];angular.module("manageApp.main").filter("jsonFormat",e).filter("to_trusted",t)}),define("main/init",["angular"],function(){angular.module("manageApp.main",[])}),define("main/services",["toastr","main/init"],function(toastr){function redirectInterceptor(t,e){return{response:function(t){return"string"==typeof t.data&&/^<!DOCTYPE html>/.test(t.data)?(window.location.assign(t.config.url),t):t}}}function requestData(t,e,a,r){return function(n,i,o,s){var l=t.defer();o||(o="GET");if(Config.serverPath&&0!==n.indexOf("http://")&&0!==n.indexOf("https://")&&(n=Config.serverPath+n),n.indexOf("?")>-1){var c=r.parseQueryString(n);n=n.split("?")[0],i||(i={}),i=$.extend(!0,i,c)}!i||"GET"!=o&&"get"!=o||(n+=(n.indexOf("?")==-1?"?":"&")+a(i));var d={method:o,url:n,cache:!1,data:i||{},withCredentials:!0,headers:{"Content-Type":"application/json;charset=utf-8","X-Requested-With":"XMLHttpRequest"}};return s||(d.transformRequest=function(t){return a(t)},d.headers={"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}),e(d).success(function(t,e,a,r){200==e&&200==t.code?l.resolve([t.data,t]):(msg=t.msg,msg||(msg=n+"\n错误信息："+angular.toJson(t)),l.reject(msg))}).error(function(t,e){t||(t="提交失败!"),t="错误码："+e+"，"+t,l.reject(t)}),l.promise}}function dialogConfirm(t,e){return function(a,r,n,i,o,s,l){var c=t.$new(!1),d=n?"tpl/"+n:"tpl/dialog-confirm.html";c.confirmText=a||"确定删除?",c.confirmTitle=i||"确认操作?",c.confirmBtnTxt=o||"确定",c.cancelBtnTxt=s||"取消",c.extendOpt=l,e.openConfirm({template:Config.tplPath+d,scope:c}).then(r)}}function dialogAlert(t,e){return function(a,r){var n=t.$new(!1);n.confirmText=a||"确定",e.openConfirm({template:Config.tplPath+"tpl/dialog-alert.html",scope:n}).then(r)}}function alertOk(t,e){return function(t,e){toastr.success(t,"",{timeOut:3e3,positionClass:"toast-top-center"})}}function alertError(t,e){return function(a,r){var n=t.$new(!1);n.confirmText=a||"确定",e.openConfirm({template:Config.tplPath+"tpl/dialog-alert.html",scope:n}).then(r)}}function alertWarn(t,e){return function(t,e){toastr.warning(t,"",{timeOut:3e3,positionClass:"toast-top-center"})}}function dialog(t,e){return function(a,r){var n=t.$new(!1);n.content=a,e.openConfirm({template:Config.tplPath+"tpl/dialog-center.html",scope:n}).then(r)}}function dialogChart(t,e,a){return function(a){var r=t.$new(!1),n={},i=a.split("?");i[1]&&angular.forEach(i[1].split("&"),function(t){var e=t.split("=");n[e[0]]=e[1]}),r.url=a,r.urlParams=n,e.open({template:Config.tplPath+"tpl/dialog-center.html",scope:r})}}function buildTree(){return function(t,e){if(!t||0===t.length)return[];var a={},r=[],n=0;e||(e="pid");for(var n=0;n<t.length;n++){var i=t[n];i.nodes=[],a[i.id]=i}for(var n=0;n<t.length;n++){var i=t[n];if(null!=i)if(i[e]&&"0"!=i[e]){var o=a[i[e]];null==o?r.push(i):o.nodes.push(i)}else r.push(i)}return r}}function proLoading(){return function(t,e,a){var r={maskId:"MaskId_"+(new Date).getTime(),hide:function(){$("#"+this.maskId).remove()}};t||(t=$("body"));var n='<div id="'+r.maskId+'" class="pr-spinner" style="position:absolute;top:20%;left:102%;" ><div class="bar1 cblack"></div><div class="bar2 cblack"></div><div class="bar3 cblack"></div><div class="bar4 cblack"></div><div class="bar5 cblack"></div><div class="bar6 cblack"></div><div class="bar7 cblack"></div><div class="bar8 cblack"></div><div class="bar9 cblack"></div><div class="bar10 cblack"></div><div class="bar11 cblack"></div><div class="bar12 cblack"></div></div>',i='<div id="'+r.maskId+'" class="pr-full-loading" style="width:80px;height:80px;position:fixed;_position:absolute;top:50%;left:50%;z-index:100;border-radius:5px;opacity:0.4;filter:alpha(opacity=30);background-color:#000;transform:translateX(-50%) translateY(-50%);"><div style="position:absolute;top:50%;left:50%;transform:translateX(-40%) translateY(-40%);" class="pr-spinner"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div><div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div><div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div></div></div>';return"chosen"==e?t.parent().append(n):t.append(i),r}}function store(){return{get:function(t){if(window.localStorage)return window.localStorage.getItem(t)},remove:function(t){window.localStorage&&localStorage.removeItem(t)},set:function(t,e){window.localStorage&&localStorage.setItem(t,e)},clear:function(){window.localStorage&&localStorage.clear()}}}function utils($timeout){function getObjectValByKeyArr(t,e,a){if(!e)return null;if(e.length-a==1){var r=e[a];return r?t[r]:null}var r=e[a];return r&&t[r]?getObjectValByKeyArr(t[r],e,1+a):null}var utilsObj={getNumberArrayByMaxNum:function(t,e){var a=[];if("number"==typeof t&&"number"==typeof e)for(var r=t;r<=e;r++)a.push(r);return console.log("getNumberArrayByMaxNum",arguments,a),a},parseQueryString:function(t){var e=/^[^\?]+\?([\w\W]+)$/,a=/([^&=]+)=([\w\W]*?)(&|$)/g,r=e.exec(t),n={};if(r&&r[1])for(var i,o=r[1];null!=(i=a.exec(o));)n[i[1]]=i[2];return n},switchArrayOrder:function(t,e,a){var r=t[e];t[e]=t[a],t[a]=r},getCurServerPath:function(){var t=window.location.pathname.split("/")[1],e=window.location.protocol+"//"+window.location.host+"/"+t+"/";return e},getNowTime:function(t){return(new Date).getTime()},focusByInputId:function(t){$timeout(function(){$("#"+t).trigger("focus")},0)},getwindowHeight:function(){var t=$(window).height();return t},getwindowWidth:function(){var t=$(window).width();return t},getMainBodyWidth:function(){var t=$("#main_body").width();return t},fromJson:function(t){var e=t.replace(/^\s*/,"")[0];return"{"===e||"["===e?angular.fromJson(t):new String(t)},toJson:function(t){return angular.toJson(t)},getAppointScope:function(t,e){return t[e]?t:t.$parent?utilsObj.getAppointScope(t.$parent,e):null},getScopeExtend:function(t,e){return angular.isObject(t[e])?t[e]:t.$parent?utilsObj.getScopeExtend(t.$parent,e):null},goOrRefreshHref:function(t,e){return t?void utilsObj.goTo(t,e):void utilsObj.refreshHref(e)},refreshHref:function(t){var e=window.location.href;e.indexOf("refreshTime=")>-1&&(e=e.split("refreshTime=")[0]),e+=(e.indexOf("?")>-1?"&":"?")+"refreshTime="+(new Date).getTime(),t?dialogConfirm(t,function(){window.location.assign(e)},null):window.location.assign(e)},goTo:function(t,e){t+=(t.indexOf("?")>-1?"&":"?")+"t="+(new Date).getTime(),e?dialogConfirm(e,function(){window.location.assign(t)},null):window.location.assign(t)},getObjectVal:function(t,e){if(!e)return null;var a=e.split(".");return getObjectValByKeyArr(t,a,0)},getPropertysArrayOfObject:function(t){var e=[];if(!t)return e;for(var a in t)e.push(a);return e},sumTotalByArray:function(t,e,a,r){var n={};if(!angular.isArray(t))return-1;for(var i=0;i<t.length;i++){var o=t[i];if(o){if(a){var s=utilsObj.getObjectVal(o,a);if(s!=r)continue}for(var l=0;l<e.length;l++){var c=e[l];n[c]||(n[c]=0);var d=utilsObj.getObjectVal(o,c);d&&(n[c]=utilsObj.numberAdd(n[c],d))}}}return n},sumTotalByArrayMul:function(t,e,a,r){var n=0;if(!angular.isArray(t))return 0;for(var i=0;i<t.length;i++){var o=t[i];if(o){for(var s=0,l=1,c=0;c<e.length;c++){if(a){var d=utilsObj.getObjectVal(o,a);if(d!=r)continue}var u=e[c],f=utilsObj.getObjectVal(o,u);f||(f=0),s=utilsObj.numberMul(l,f),l=s}n=utilsObj.numberAdd(n,s)}}return n},getcustomMenuByKeyOfArr:function(t,e){return utilsObj.getObjectByKeyOfArr(t,"type",e)},getObjectIndexByKeyOfArr:function(t,e,a){if(!angular.isArray(t))return-1;for(var r=0;r<t.length;r++){var n=utilsObj.getObjectVal(t[r],e);if(n==a)return r}return-1},
getObjectByKeyOfArr:function(t,e,a){var r=utilsObj.getObjectIndexByKeyOfArr(t,e,a);return r<0?null:t[r]},getGroupArrayByKeyOfArr:function(t,e){console.log("getGroupArrayByKeyOfArr",t,e);var a={keyArr:[],map:{}};if(!angular.isArray(t))return a;for(var r=0;r<t.length;r++){var n=utilsObj.getObjectVal(t[r],e);n+="",void 0!==n&&""!==n||(n="null"),tmpMapArray=a.map[n],tmpMapArray||(tmpMapArray=[],a.map[n]=tmpMapArray),tmpMapArray.push(t[r])}for(var i in a.map)a.keyArr.push(i);return a},removeObjectByKeyOfArr:function(t,e,a){var r=utilsObj.getObjectIndexByKeyOfArr(t,e,a);return r>-1&&t.splice(r,1),r},numberDiv:function(arg1,arg2){if(!arg1||!arg2)return 0;var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math){r1=Number(arg1.toString().replace(".","")),r2=Number(arg2.toString().replace(".",""));var tmp=utilsObj.numberMul(r1/r2,pow(10,t2-t1));return tmp}},numberMul:function(t,e){t||(t=0),e||(e=0);var a=0,r=t.toString(),n=e.toString();try{a+=r.split(".")[1].length}catch(i){}try{a+=n.split(".")[1].length}catch(i){}var o=Number(r.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,a);return o},numberAdd:function(t,e){t||(t=0),e||(e=0);var a,r,n;try{a=t.toString().split(".")[1].length}catch(i){a=0}try{r=e.toString().split(".")[1].length}catch(i){r=0}n=Math.pow(10,Math.max(a,r));var o=utilsObj.numberMul(t,n),s=utilsObj.numberMul(e,n);return(o+s)/n},numberSub:function(t,e){t||(t=0),e||(e=0);try{r1=t.toString().split(".")[1].length}catch(a){r1=0}try{r2=e.toString().split(".")[1].length}catch(a){r2=0}m=Math.pow(10,Math.max(r1,r2)),n=r1>=r2?r1:r2;var r=utilsObj.numberMul(t,m),i=utilsObj.numberMul(e,m);return((r-i)/m).toFixed(n)},isPicture:function(t){if(!t)return!1;var e=new RegExp("(.png)|(.jpg)|(.jpeg)|(.gif)",["i"]);return!!e.exec(t)},clearObject:function(t){for(var e in t)delete t[e]},replaceObject:function(t,e){if(angular.isArray(e)){angular.isArray(t)||(t=[]),t.splice(0,t.length);for(var a=0;a<e.length;a++)t.push(e[a]);return t}if(t||(t={}),utilsObj.clearObject(t),e)return $.extend(!0,t,e),t},parseVariableString:function(t,e){var a="";if(!t)return a;if(a=t,"function"!=typeof t.match)return a;var r=t.match(/(\{\{){1}[^\{\}]+(\}\}){1}/);if(!r)return a;e||(e={});for(var n=0;n<r.length;n++){var i=r[n];if(!(i.length<5)){var o=i.substring(2,i.length-2),s=e[o];s||(s=""),a=a.replace(i,s)}}return a},transformToNumber:function(t){return angular.isString(t)?Number(t):t}};return utilsObj}function watchFormChange(t){return function(e,a){a&&(t(function(){a.changeFlag=!1},500),a._watchFn||(a._watchFn=a.$watch(e,function(t,e,r){a.changeFlag=!0},!0)))}}function OPrinter(){function t(){return!a&&e&&(a=e.getLodop(document.getElementById("LODOP_OB_Id"),document.getElementById("LODOP_EM_Id"))),a}var e=null,a=null,r={LODOP:null,print_param_defualt:{print_orient:0,paper_top:0,paper_left:0,paper_width:2100,paper_height:2970,html_top:0,html_left:0,html_width:"100%",html_height:"100%"},print_param:null,_pageSize:{intOrient:1,intPageWidth:2160,intPageHeight:1400},init:function(){this.print_param=$.extend({},this.print_param_defualt),console.log(this.print_param),a||require(["LodopFuncs"],function(t){e=t,t.loadCLodop()})},setPrint_paramByUICustomHtml:function(t){if(t){var e=$.extend({},this.print_param_defualt);for(var a in e)t[a]&&(e[a]=t[a]);console.log(e),this.print_param=e}},setRect:function(t,e,a,r){this.print_param.html_top=t,this.print_param.html_left=e,this.print_param.html_width=a,this.print_param.html_height=r},_PrintDivId:null,setPrintDivId:function(t){this._PrintDivId=t},_PrintHtml:null,setPrintHtmlContent:function(t){this._PrintHtml=t},getPrintHtmlContent:function(t){return this._PrintDivId&&(this._PrintHtml=document.getElementById(this._PrintDivId).innerHTML),this._PrintHtml},_printBeforePrint:function(e,r){a||(a=t(),this.LODOP=a,a||console.log("need exe:$root.OPrinter.init()")),r||(r="");var n=this.print_param;return a.PRINT_INITA(n.paper_top,n.paper_left,n.paper_width,n.paper_height,r),a.SET_PRINT_PAGESIZE(n.print_orient,n.paper_width,n.paper_height,r),e||(e=this.getPrintHtmlContent()),a.ADD_PRINT_HTM(n.html_top,n.html_left,n.html_width,n.html_height,e),console.log(n),a},preview:function(t,e){a=this._printBeforePrint(t,e),a.PREVIEW()},print:function(t,e){a=this._printBeforePrint(t,e),a.PRINT()},printSetup:function(t,e){a=this._printBeforePrint(t,e),a.PRINT_SETUP()},printDesign:function(t,e){a=this._printBeforePrint(t,e),a.PRINT_DESIGN()},setPrintStyle:function(e,r){a=t(),a.SET_PRINT_STYLE(e,r)}};return r}function UICustomTable(t,e){var a=(t("date"),{getShowItemArray:function(t){if(!t)return t;for(var e=[],a=0;a<t.length;a++)t[a].showFlag&&e.push(t[a]);return e},getShowValue:function(a,r,n){if(!r)return"";if("$index"==r.propertyKey)return n+1;var i=e.getObjectVal(a,r.propertyKey);if(r.filterName){var o=t(r.filterName);o?i=o(i,r.format):console.log("filterName is null.filterName="+r.filterName)}return i}});return a}function AjaxUtils(t,e,a){var r={ajaxSubmit:function(r,n,i,o){return!!i&&void t(r,n,"POST",o).then(function(t){var a=t[1];e(a.message||"操作成功")})["catch"](function(t){a(t)})}};return r}redirectInterceptor.$inject=["$q","$location"],dialogConfirm.$inject=["$rootScope","modal"],dialogAlert.$inject=["$rootScope","modal"],dialog.$inject=["$rootScope","modal"],dialogChart.$inject=["$rootScope","modal","$http"],angular.module("manageApp.main").factory("OPrinter",OPrinter).service("watchFormChange",["$timeout",watchFormChange]).factory("redirectInterceptor",redirectInterceptor).service("alertOk",["$rootScope","modal",alertOk]).service("alertError",["$rootScope","modal",alertError]).service("alertWarn",["$rootScope","modal",alertWarn]).service("requestData",["$q","$http","$httpParamSerializer","utils",requestData]).service("dialogConfirm",dialogConfirm).service("dialogAlert",dialogAlert).service("dialog",dialog).service("dialogChart",dialogChart).service("buildTree",buildTree).factory("store",store).factory("utils",["$timeout",utils]).factory("AjaxUtils",["requestData","alertOk","alertError",AjaxUtils]).factory("UICustomTable",["$filter","utils",UICustomTable]).factory("proLoading",proLoading).config(["$httpProvider",function(t){t.interceptors.push("redirectInterceptor")}])}),define("modal/directives",["modal/init"],function(){function t(t){return{restrict:"A",scope:{modalScope:"="},link:function(e,a,r){a.on("click",function(a){a.preventDefault();var n=angular.isDefined(e.modalScope)?e.modalScope:"noScope";angular.isDefined(r.ngDialogClosePrevious)&&t.close(r.ngDialogClosePrevious);var i=t.getDefaults();t.open({template:r.ngDialog,className:r.ngDialogClass||i.className,controller:r.ngDialogController,controllerAs:r.ngDialogControllerAs,bindToController:r.ngDialogBindToController,scope:n,data:r.ngDialogData,showClose:"false"!==r.ngDialogShowClose&&("true"===r.ngDialogShowClose||i.showClose),closeByDocument:"false"!==r.ngDialogCloseByDocument&&("true"===r.ngDialogCloseByDocument||i.closeByDocument),closeByEscape:"false"!==r.ngDialogCloseByEscape&&("true"===r.ngDialogCloseByEscape||i.closeByEscape),overlay:"false"!==r.ngDialogOverlay&&("true"===r.ngDialogOverlay||i.overlay),preCloseCallback:r.ngDialogPreCloseCallback||i.preCloseCallback})})}}}function e(t,e){return{restrict:"A",scope:{modalScope:"="},link:function(a,r,n){var i=n.modalRight||"50%",o=function(){return a.modalScope&&(a.modalScope.pageParams=e.parseQueryString(n.modalUrl)),t.open({template:n.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!1,overlay:"true"==n.modalOverlay,data:n.modalData||a.modalScope.tr,scope:a.modalScope,controller:["$scope","$element",function(t,e){$(".ngdialog-content",e).width(i)}]})};angular.isDefined(n.modalOpenAuto)&&"true"==n.modalOpenAuto&&o(),r.on("click",function(e){e.preventDefault(),e.stopPropagation(),t.closeAll(),o()})}}}function a(t,e){return{restrict:"A",scope:{modalScope:"="},link:function(a,r,n){var i=n.modalCenter||"50%";r.on("click",function(r){r.preventDefault(),a.modalScope&&(a.modalScope.pageParams=e.parseQueryString(n.modalUrl)),t.open({template:n.modalUrl,cache:!1,trapFocus:!1,data:n.modalData||a.modalScope.tr,scope:a.modalScope,controller:["$scope","$element",function(t,e){$(".ngdialog-content",e).width(i)}]})})}}}t.$inject=["modal"],angular.module("manageApp.modal").directive("modal",t).directive("modalRight",["modal","utils",e]).directive("modalCenter",["modal","utils",a])}),define("modal/init",["angular"],function(){angular.module("manageApp.modal",[])}),define("modal/services",["modal/init"],function(){"use strict";var t=angular.module("manageApp.modal"),e=angular.element,a=angular.isDefined,r=(document.body||document.documentElement).style,n=a(r.animation)||a(r.WebkitAnimation)||a(r.MozAnimation)||a(r.MsAnimation)||a(r.OAnimation),i="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",o="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",s="ngdialog-disabled-animation",l={html:!1,body:!1},c={},d=[],u=!1,f=!1;t.provider("modal",function(){var t=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(t){l.html=t||!1},this.setForceBodyReload=function(t){l.body=t||!1},this.setDefaults=function(e){angular.extend(t,e)},this.setOpenOnePerName=function(t){f=t||!1};var a,r=0,h=0,m={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(p,g,v,y,D,b,w,C,k,I){var S=[],M={onDocumentKeydown:function(t){27===t.keyCode&&F.close("$escape")},activate:function(t){var e=t.data("$ngDialogOptions");e.trapFocus&&(t.on("keydown",M.onTrapFocusKeydown),S.body.on("keydown",M.onTrapFocusKeydown))},deactivate:function(t){t.off("keydown",M.onTrapFocusKeydown),S.body.off("keydown",M.onTrapFocusKeydown)},deactivateAll:function(t){angular.forEach(t,function(t){var e=angular.element(t);M.deactivate(e)})},setBodyPadding:function(t){var e=parseInt(S.body.css("padding-right")||0,10);S.body.css("padding-right",e+t+"px"),S.body.data("ng-dialog-original-padding",e),b.$broadcast("ngDialog.setPadding",t)},resetBodyPadding:function(){var t=S.body.data("ng-dialog-original-padding");t?S.body.css("padding-right",t+"px"):S.body.css("padding-right",""),b.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(t,e){var r=t.data("$ngDialogOptions"),o=t.attr("id"),s=c[o];if(s){if("undefined"!=typeof C.Hammer){var l=s.hammerTime;l.off("tap",a),l.destroy&&l.destroy(),delete s.hammerTime}else t.unbind("click");1===h&&S.body.unbind("keydown",M.onDocumentKeydown),t.hasClass("ngdialog-closing")||(h-=1);var f=t.data("$ngDialogPreviousFocus");f&&f.focus&&f.focus(),b.$broadcast("ngDialog.closing",t,e),h=h<0?0:h,n&&!r.disableAnimation?(s.$destroy(),t.unbind(i).bind(i,function(){M.closeDialogElement(t,e)}).addClass("ngdialog-closing")):(s.$destroy(),M.closeDialogElement(t,e)),m[o]&&(m[o].resolve({id:o,value:e,$dialog:t,remainingDialogs:h}),delete m[o]),c[o]&&delete c[o],d.splice(d.indexOf(o),1),d.length||(S.body.unbind("keydown",M.onDocumentKeydown),u=!1)}},closeDialogElement:function(t,e){t.remove(),0===h&&(S.html.removeClass("ngdialog-open"),S.body.removeClass("ngdialog-open"),M.resetBodyPadding()),b.$broadcast("ngDialog.closed",t,e)},closeDialog:function(t,e){var a=t.data("$ngDialogPreCloseCallback");if(a&&angular.isFunction(a)){var r=a.call(t,e);angular.isObject(r)?r.closePromise?r.closePromise.then(function(){M.performCloseDialog(t,e)}):r.then(function(){M.performCloseDialog(t,e)},function(){}):r!==!1&&M.performCloseDialog(t,e)}else M.performCloseDialog(t,e)},onTrapFocusKeydown:function(t){var e,a=angular.element(t.currentTarget);if(a.hasClass("ngdialog"))e=a;else if(e=M.getActiveDialog(),null===e)return;var r=9===t.keyCode,n=t.shiftKey===!0;r&&M.handleTab(e,t,n)},handleTab:function(t,e,a){var r=M.getFocusableElements(t);if(0===r.length)return void(document.activeElement&&document.activeElement.blur());var n=document.activeElement,i=Array.prototype.indexOf.call(r,n),o=i===-1,s=0===i,l=i===r.length-1,c=!1;a?(o||s)&&(r[r.length-1].focus(),c=!0):(o||l)&&(r[0].focus(),c=!0),c&&(e.preventDefault(),e.stopPropagation())},autoFocus:function(t){var a=t[0],r=a.querySelector("*[autofocus]");if(null===r||(r.focus(),document.activeElement!==r)){var n=M.getFocusableElements(t);if(n.length>0)return void n[0].focus();var i=M.filterVisibleElements(a.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(i.length>0){var o=i[0];e(o).attr("tabindex","-1").css("outline","0"),o.focus()}}},getFocusableElements:function(t){var e=t[0],a=e.querySelectorAll(o),r=M.filterTabbableElements(a);return M.filterVisibleElements(r)},filterTabbableElements:function(t){for(var a=[],r=0;r<t.length;r++){var n=t[r];"-1"!==e(n).attr("tabindex")&&a.push(n)}return a},filterVisibleElements:function(t){for(var e=[],a=0;a<t.length;a++){var r=t[a];(r.offsetWidth>0||r.offsetHeight>0)&&e.push(r)}return e},getActiveDialog:function(){var t=document.querySelectorAll(".ngdialog");return 0===t.length?null:e(t[t.length-1])},applyAriaAttributes:function(t,e){if(e.ariaAuto){if(!e.ariaRole){var a=M.getFocusableElements(t).length>0?"dialog":"alertdialog";e.ariaRole=a}e.ariaLabelledBySelector||(e.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),e.ariaDescribedBySelector||(e.ariaDescribedBySelector="article,section,p")}e.ariaRole&&t.attr("role",e.ariaRole),M.applyAriaAttribute(t,"aria-labelledby",e.ariaLabelledById,e.ariaLabelledBySelector),M.applyAriaAttribute(t,"aria-describedby",e.ariaDescribedById,e.ariaDescribedBySelector)},applyAriaAttribute:function(t,a,r,n){if(r&&t.attr(a,r),n){var i=t.attr("id"),o=t[0].querySelector(n);if(!o)return;var s=i+"-"+a;return e(o).attr("id",s),t.attr(a,s),s}},detectUIRouter:function(){try{return angular.module("ui.router"),!0}catch(t){return!1}},getRouterLocationEventName:function(){return M.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},F={__PRIVATE__:M,open:function(n){function i(t,e){return b.$broadcast("ngDialog.templateLoading",t),D.get(t,e||{}).then(function(e){return b.$broadcast("ngDialog.templateLoaded",t),e.data||""})}function o(t){return t?angular.isString(t)&&p.plain?t:"boolean"!=typeof p.cache||p.cache?i(t,{cache:g}):i(t,{cache:!1}):"Empty template"}var l=null;if(n=n||{},!(f&&n.name&&(l=n.name+" dialog",this.isOpen(l)))){var p=angular.copy(t),$=++r;l=l||"ngdialog"+$,d.push(l),angular.extend(p,n);var A;m[l]=A=y.defer();var O;c[l]=O=angular.isObject(p.scope)?p.scope.$new():b.$new();var T,P,N=angular.extend({},p.resolve);return angular.forEach(N,function(t,e){N[e]=angular.isString(t)?I.get(t):I.invoke(t,null,null,e)}),y.all({template:o(p.template||p.templateUrl),locals:y.all(N)}).then(function(t){var r=t.template,n=t.locals;p.showClose&&(r+='<div class="ngdialog-close"></div>');var i=p.overlay?"":" ngdialog-no-overlay";if(T=e('<div id="'+l+'" class="ngdialog'+i+'"></div>'),T.html(p.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+r+"</div>":'<div class="ngdialog-content" role="document">'+r+"</div>"),T.data("$ngDialogOptions",p),O.ngDialogId=l,p.data&&angular.isString(p.data)){var o=p.data.replace(/^\s*/,"")[0];O.ngDialogData="{"===o||"["===o?angular.fromJson(p.data):new String(p.data),O.dialogData=angular.copy(O.ngDialogData),O.ngDialogData.ngDialogId=l}else p.data&&angular.isObject(p.data)&&(O.ngDialogData=p.data,O.dialogData=angular.copy(O.ngDialogData),O.ngDialogData.ngDialogId=l);if(p.className&&T.addClass(p.className),p.disableAnimation&&T.addClass(s),P=p.appendTo&&angular.isString(p.appendTo)?angular.element(document.querySelector(p.appendTo)):S.body,M.applyAriaAttributes(T,p),p.preCloseCallback){var c;angular.isFunction(p.preCloseCallback)?c=p.preCloseCallback:angular.isString(p.preCloseCallback)&&O&&(angular.isFunction(O[p.preCloseCallback])?c=O[p.preCloseCallback]:O.$parent&&angular.isFunction(O.$parent[p.preCloseCallback])?c=O.$parent[p.preCloseCallback]:b&&angular.isFunction(b[p.preCloseCallback])&&(c=b[p.preCloseCallback])),c&&T.data("$ngDialogPreCloseCallback",c)}if(O.closeThisDialog=function(t){M.closeDialog(T,t)},p.controller&&(angular.isString(p.controller)||angular.isArray(p.controller)||angular.isFunction(p.controller))){var d;p.controllerAs&&angular.isString(p.controllerAs)&&(d=p.controllerAs);var f=k(p.controller,angular.extend(n,{$scope:O,$element:T}),!0,d);p.bindToController&&angular.extend(f.instance,{ngDialogId:O.ngDialogId,ngDialogData:O.ngDialogData,closeThisDialog:O.closeThisDialog}),T.data("$ngDialogControllerController",f())}if(w(function(){var t=document.querySelectorAll(".ngdialog");M.deactivateAll(t),v(T)(O);var e=C.innerWidth-S.body.prop("clientWidth");S.html.addClass("ngdialog-open"),S.body.addClass("ngdialog-open");var a=e-(C.innerWidth-S.body.prop("clientWidth"));a>0&&M.setBodyPadding(a),P.append(T),M.activate(T),p.trapFocus&&M.autoFocus(T),p.name?b.$broadcast("ngDialog.opened",{dialog:T,name:p.name}):b.$broadcast("ngDialog.opened",T)}),u||(S.body.bind("keydown",M.onDocumentKeydown),u=!0),p.closeByNavigation){var m=M.getRouterLocationEventName();b.$on(m,function(){M.closeDialog(T)})}if(p.preserveFocus&&T.data("$ngDialogPreviousFocus",document.activeElement),a=function(t){var a=!!p.closeByDocument&&e(t.target).hasClass("ngdialog-overlay"),r=e(t.target).hasClass("ngdialog-close");(a||r)&&F.close(T.attr("id"),r?"$closeButton":"$document")},"undefined"!=typeof C.Hammer){var g=O.hammerTime=C.Hammer(T[0]);g.on("tap",a)}else T.bind("click",a);return h+=1,F}),{id:l,closePromise:A.promise,close:function(t){M.closeDialog(T,t)}}}},openConfirm:function(a){var r=y.defer(),n=angular.copy(t);a=a||{},angular.extend(n,a),n.scope=angular.isObject(n.scope)?n.scope.$new():b.$new(),n.scope.confirm=function(t){r.resolve(t);var a=e(document.getElementById(i.id));M.performCloseDialog(a,t)};var i=F.open(n);if(i)return i.closePromise.then(function(t){return t?r.reject(t.value):r.reject()}),r.promise},isOpen:function(t){var a=e(document.getElementById(t));return a.length>0},close:function(t,a){var r=e(document.getElementById(t));if(r.length)M.closeDialog(r,a);else if("$escape"===t){var n=d[d.length-1];r=e(document.getElementById(n)),r.data("$ngDialogOptions").closeByEscape&&M.closeDialog(r,"$escape")}else F.closeAll(a);return F},closeAll:function(t){$(".select-address.active").removeClass("active");for(var a=document.querySelectorAll(".ngdialog"),r=a.length-1;r>=0;r--){var n=a[r];M.closeDialog(e(n),t)}},getOpenDialogs:function(){return d},getDefaults:function(){return t}};return angular.forEach(["html","body"],function(t){if(S[t]=p.find(t),l[t]){var e=M.getRouterLocationEventName();b.$on(e,function(){S[t]=p.find(t)})}}),F}]})}),define(["project/angucomplete"],function(){function t(t,e,a,r,n,i,o,s){function l(t,e,a){if(!e)return null;if(e.length-a==1){var r=e[a];return r?t[r]:null}var r=e[a];return r&&t[r]?l(t[r],e,1+a):null}var c={getObjectVal:function(t,e){if(!e)return null;var a=e.split(".");return l(t,a,0)}},d=function(e,a){return e.length>=t.minLength&&e!=a},u=function(e,a){if(e&&e.length>0){t.results=[];var r=[];t.titleField&&""!=t.titleField&&(r=t.titleField.split(","));for(var i=0;i<e.length;i++){for(var o=[],s=0;s<r.length;s++)o.push(e[i][r[s]]);var l="";t.descriptionField&&(l=c.getObjectVal(e[i],t.descriptionField));var d=o.join(" ");if(t.matchClass){var u=new RegExp(a,"i"),f=d.match(u)[0];d=n.trustAsHtml(d.replace(u,'<span class="'+t.matchClass+'">'+f+"</span>"))}var h={id:e[i].id,title:d,description:l,data:e[i]};t.results[t.results.length]=h}}else t.results=[]},f=function(e){if(e.length>=t.minLength)if(t.localData){for(var a=t.searchFields.split(","),n=[],i=0;i<t.localData.length;i++){for(var o=!1,s=0;s<a.length;s++)o=o||"string"==typeof t.localData[i][a[s]]&&"string"==typeof e&&t.localData[i][a[s]].toLowerCase().indexOf(e.toLowerCase())>=0;o&&(n[n.length]=t.localData[i])}t.searching=!1,u(n,e)}else r(t.url,{q:e}).then(function(a){var r=a[0];t.searching=!1,u(r,e)})["catch"](function(e){t.searching=!1,console.error(e)})},h=function(){t.hideTimer=i(function(){t.showDropdown=!1},t.pause)},m=function(){t.hideTimer&&i.cancel(t.hideTimer)},p=function(e){t.currentIndex=e},g=function(e){38!=e.which&&40!=e.which&&13!=e.which?t.searchStr&&""!==t.searchStr?d(t.searchStr,t.lastSearchTerm)&&(t.lastSearchTerm=t.searchStr,t.showDropdown=!0,t.currentIndex=-1,t.results=[],t.searchTimer&&i.cancel(t.searchTimer),t.searching=!0,t.searchTimer=i(function(){f(t.searchStr)},t.pause)):(t.showDropdown=!1,t.lastSearchTerm=null):e.preventDefault()},v=function(e){s&&!s(e)||(t.matchClass&&(e.title=e.title.toString().replace(/(<([^>]+)>)/gi,"")),t.searchStr=t.lastSearchTerm=e.title,t.selectedItem=e,t.showDropdown=!1,t.results=[],o&&o.$setViewValue(e))},y=function(){var t=$(".angucomplete-selected-row");if(0===t.length)return void console.log(".angucomplete-selected-row length=0");var e,a,r,n,i,o=$(".angucomplete-dropdown");return r=parseInt(o.css("maxHeight"),10),i=o.scrollTop(),n=r+i,a=t.position().top+i,e=a+t.outerHeight(),e>=n?o.scrollTop(e-r>0?e-r:0):a<i?o.scrollTop(a):void 0},D=function(){i(function(){y()},0)},b=function(e){40===e.which?(t.results&&t.currentIndex+1<t.results.length&&(t.currentIndex++,t.$apply(),e.preventDefault(),e.stopPropagation()),t.$apply(),D()):38==e.which?(t.currentIndex>=1&&(t.currentIndex--,t.$apply(),e.preventDefault(),e.stopPropagation()),D()):13==e.which?t.results&&t.currentIndex>=0&&t.currentIndex<t.results.length?(v(t.results[t.currentIndex]),t.$apply(),e.preventDefault(),e.stopPropagation()):(t.results=[],t.$apply(),e.preventDefault(),e.stopPropagation()):27==e.which?(t.results=[],t.showDropdown=!1,t.$apply()):8==e.which&&(t.selectedItem=null,t.$apply())},w=e.find("input");return w.on("keyup",g),e.on("keyup",b),this.$scope=t,this.processResults=u,this.searchTimerComplete=f,this.hoverRow=p,this.hideResults=h,this.resetHideResults=m,this.keyPressed=g,this.selectResult=v,this}return t}),define("project/controllers",["project/init"],function(){function t(t,e,a,r){function n(t){var n="rest/authen/imTaobaoUserInfo/getMy.json";e(n).then(function(e){e[0];r.MyImTaobaoUserInfo=e[0],t&&t()})["catch"](function(t){a(t||"出错")})}t.openIm=function(e,a){var i=r.MyImTaobaoUserInfo;if(!i)return void n(function(){t.openIm(e)});e||(e=""),a||(a="");var o="?uid="+i.userid+"&to="+e+"&toUserName="+a+"&appkey=23588140&pwd="+i.password+"&fullscreen";window.open("imtaobao/kit.html"+o,"webcall","toolbar=no, status=no,scrollbars=0,resizable=0,menubar＝0,location=0,width=700,height=530")}}function e(t,e,a,r,n,i,o,s,l,c,d,u,f,h,m){e.bottomButtonList=c,e.saleOrderUtils=d,e.purchaseOrderUtils=u,e.requestPurchaseOrderUtils=f,e.queryItemCardButtonList=h,e.customMenuUtils=m}function a(t,e,a,r){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.storageLocation=e.storageLocation,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(!e.strike_price)return void a("请输入成交价格。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.newAddDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.csmQuantity||e.csmQuantity<1)return void a("请输入大于0的数量。");if(t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");e.priceWithoutTax=e.price-e.price*e.taxRate,e.quantity=e.csmQuantity,t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){return t.formData.validFlag=!1,"exit"==t.submitForm_type?void t.goTo("#/salesOrder/query.html"):("submit"==t.submitForm_type&&t.goTo("#/salesOrder/confirm-order.html?id="+t.formData.id),void("save"==t.submitForm_type))},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function r(t,e,a,r,n){e.closeAll(),t.addDataItem={},t.isShowCancelBtn=!1,t.$watch("initFlag",function(e){if(e){var a="rest/authen/salesOrder/isCanClose?id="+t.formData.id;n(a,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})["catch"](function(t){})}}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(document.getElementById("angucompleteMedical_searchInputId").focus(),0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.watchFormChange=function(e){r(e,t)},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.quantity=e.quantity,i.discountPrice="0",i.discountRate="100",i.relId=r.id,i.strike_price=i.price,i.id=null,!i.relId||!i.name)return a("请选择药品。"),!1;if(!i.quantity||i.quantity<1)return a("请输入大于0的数量。"),!1;if(i.quantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=销售",c={};n(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/edit-from-salesOrder.html?id="+a.confirmOrder.id)})["catch"](function(t){})}if("save"==t.submitForm_type){var r="rest/authen/salesOrder/isCanClose?id="+t.formData.id;n(r,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})["catch"](function(t){})}},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function n(t,e,a,r,n){t.$watch("initFlag",function(){var e=[],a=[];if(console.log(t.tbodyList),t.showData||t.tr){if(t.showData.operationFlowSet||t.tr.operationFlowSet)for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.orderStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}}),t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/get2.html?id="+a.confirmOrder.id)})["catch"](function(t){})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),
$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.hideThisBtn=function(){$(".sales-order-item-delbtn").hide(),t.showHandleArea=!1}}function i(t,e,a,r,n){t.watchFormChange=function(e){r(e,t)},t.$watch("initFlag",function(){var e=[],a=[];if(t.showData){for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.orderStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}}),e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/get2.html?id="+a.confirmOrder.id)})["catch"](function(t){})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.hideThisBtn=function(){$(".sales-order-item-delbtn").hide(),t.showHandleArea=!1}}function o(t,e,a,r,n,i,o){t.logistics=!0,t.isShowConfirmInfo=!1,t.$watch("initFlag",function(){var e=[],a=[];if(t.formData.operationFlowSet){for(var r=0;r<t.formData.operationFlowSet.length;r++)t.formData.operationFlowSet[r].status==t.formData.orderStatus&&(e.push(t.formData.operationFlowSet[r].message),a.push(t.formData.operationFlowSet[r].key));return t.formData.operationFlowSet.message=e[e.length-1],void(t.formData.operationFlowSet.key=a[a.length-1])}}),t.$watch("formData.orderBusinessType",function(e){"直运销售"===e&&t.formData.orderMedicalNos.length&&angular.forEach(t.formData.orderMedicalNos,function(t,e){t.handleFlag=!0})}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(t.logistics=!1,0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.$watch("formData.orderMedicalNos",function(e){var a=0;t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(e,r){if(e.stockBatchs)for(var n=0;n<e.stockBatchs.length;n++)a+=parseInt(e.stockBatchs[n].quantity,10);t.isShowConfirmInfo=a<t.formData.orderMedicalNos[r].planQuantity&&0!==a})},!0),t.deleteQuantity=function(e){angular.forEach(t.formData.orderMedicalNos,function(t,e){t.quantityAndbatchNumber&&(t.quantityAndbatchNumber="",t.otherQuantity="",t.otherSterilizationBatchNumber="",t.otherWarehouseName="",t.validTill=" ")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/confirmOrder/query.html");if("exit-allocate"==t.submitForm_type)return void t.goTo("#/allocateOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=confirmOrderPrint&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||i("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}if("submit-allocate"==t.submitForm_type){var a="rest/authen/allocateOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/allocateOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var n=e.data.data,i=$.extend(!0,{},n);if(i.relId=n.id,i.discountPrice="0",i.discountRate="100",i.strike_price=i.price,i.id=null,i.logistics=!0,i.planQuantity||(i.planQuantity=e.quantity),!i.relId||!i.name)return a("请选择药品。"),!1;if(!e.quantity||e.quantity<1)return a("请输入大于0的数量。"),!1;if(i.planQuantity>n.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i.stockBatchs=[],i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&customerId="+t.formData.customerId+"&type=销售";t.initFlag&&r(l).then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.planQuantity,!0},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.confirmOrderCalculaTotal=function(e,a){if(e){var r=0;angular.forEach(e,function(t,e){if("普通销售"===a&&t.stockBatchs){for(var n=0,i=0;i<t.stockBatchs.length;i++)n+=t.stockBatchs[i].quantity*t.strike_price*(t.discountRate/100);r+=n}"直运销售"===a&&(r+=t.planQuantity*t.strike_price*(t.discountRate/100))}),t.formData.totalPrice=r}},t.$watch("formData.logisticsCenterId",function(e,a){e&&a&&e!==a&&o("切换物流中心后,所有批号信息需要重新选择.确认切换?",function(){t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(t,e){t.stockBatchs=[]})},"pr-dialog-confirm.html","确认提示","确定")})}function s(t,e,a,r,n,i,o,s){t.$watch("initFlag",function(){var e=[],a=[];if(t.scopeData){for(var r=0;r<t.scopeData.operationFlowSet.length;r++)t.scopeData.operationFlowSet[r].status==t.scopeData.orderStatus&&(e.push(t.scopeData.operationFlowSet[r].message),a.push(t.scopeData.operationFlowSet[r].key));return t.scopeData.operationFlowSet.message=e[e.length-1],void(t.scopeData.operationFlowSet.key=a[a.length-1])}}),t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/invoicesOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/confirmOrderPrint.html?id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||i("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleThischoise=function(e){var a=0;e.handleFlag?(angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag===!0&&a++}),t.choiseStatus=t.orderMedicalNos.length===a):t.choiseStatus=!1},t.chkIsChoiseAll=function(){var e=0;angular.forEach(t.orderMedicalNos,function(t,a){console.log(t.handleFlag),t.handleFlag===!0&&e++}),t.choiseStatus=t.orderMedicalNos.length===e},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e}}function l(t){t.choiseProductionBatch=function(e,a,r){a&&!a.quantity&&(e.quantity||(e.quantity=0),a.quantity=e.planQuantity-e.quantity,r&&(r.note||(r.note={}),r.note.salesQuantity||(r.note.salesQuantity=0)),r&&r.note&&r.note.salesQuantity?a.quantity>r.note.salesQuantity&&(a.quantity=r.note.salesQuantity,t.item.handleFlag=!0):a.quantity=null)},t.$watch("item.stockBatchs",function(e,a){if(void 0!==e){var r=t.item;r.quantity=0,e||(e=[{}]);for(var n=-1,i=0;i<e.length;i++)e[i].batchNumber||(e[i].quantity=0,n=i),e[i].quantity&&(r.quantity+=e[i].quantity);r.quantity<r.planQuantity?n==-1&&r.stockBatchs.push({}):n>-1&&r.stockBatchs.splice(n,1),r.quantity>0&&(r.handleFlag=!0)}},!0),t.getAllBatchTotal=function(t){if(t&&angular.isArray(t)){var e=0;return angular.forEach(t,function(t,a){e+=parseInt(t.quantity,10)}),e}return 0}}function c(t,e,a,r,n,i,o){t.kuaidiSaveAfter=function(a){if(e.closeAll(),a){t.showData.kuaidiSet||(t.showData.kuaidiSet=[]);for(var r=t.showData.kuaidiSet,n=0;n<r.length;n++)if(r[n].id==a.id)return void(r[n]=a);r.push(a)}},t.deleteKuaidi=function(e,a){var o="rest/authen/invoicesOrder/kuaidi/delete",s={kuaidiId:e.id,invoicesOrderId:a};r(o,s,"POST").then(function(a){var r=a[1];n(r.message||"操作成功");for(var i=t.showData.kuaidiSet,o=0;o<i.length;o++)if(i[o].id==e.id)return void i.splice(o,1)})["catch"](function(t){i(t||"出错")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/invoicesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/invoicesOrder/updateStatus",a={id:t.formData.id,status:"待发货"};r(e,a,"POST").then(function(e){e[1];t.goTo("#/invoicesOrder/order-done.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,$("#"+e).trigger("submit")}}function d(t,e,a,r,n,i,o,s){function l(){o.noticeRefreshTime=(new Date).getTime()}t.noticeClick=function(e){return requestRead(e.id,e),e.readFlag=!0,t.scopeResponse&&t.scopeResponse.totalCount&&t.scopeResponse.totalCount--,e.moduleType&&e.relId?void window.location.assign("#/"+e.moduleType+"/get.html?id="+e.relId):void n(e.subject)},o.startGetMsg=function(){Config.stopIntervalNotice!==!0&&(o.startGetMsgObj||(o.startGetMsgObj=s(function(){l()},1e4)))},o.startGetMsg(),requestRead=function(t,e){var a="rest/authen/notice/read",n={id:t};r(a,n,"POST").then(function(t){l()})["catch"](function(t){})}}function u(t,e,a,r,n,i){t.$watch("initFlag",function(e){if(e&&t.formData.orderMedicalNos)for(var a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleItemClickEvent=function(e){var a=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.handleFlag?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){t.customerName=e.name,t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.taxRate="17",n.batchRequirement="无",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/arrivalNoticeOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/arrivalNoticeOrder/updateStatus",a={id:t.formData.id,status:"待审核"};n(e,a,"POST").then(function(e){e[1];t.goTo("#/arrivalNoticeOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))}}function f(t,e,a,r,n,i,o){t.isShowPurchaseInfo=!1,t.isDisabledNextStep=!1,t.$watch("initFlag",function(e){var a,r=[],n=[];if(e&&t.scopeData){for(a=0;a<t.scopeData.operationFlowSet.length;a++)t.scopeData.operationFlowSet[a].status==t.scopeData.orderStatus&&(r.push(t.scopeData.operationFlowSet[a].message),n.push(t.scopeData.operationFlowSet[a].key));t.scopeData.operationFlowSet.message=r[r.length-1],t.scopeData.operationFlowSet.key=n[n.length-1]}if(e&&t.formData&&t.formData.operationFlowSet){for(a=0;a<t.formData.operationFlowSet.length;a++)t.formData.operationFlowSet[a].status==t.formData.orderStatus&&(r.push(t.formData.operationFlowSet[a].message),n.push(t.formData.operationFlowSet[a].key));t.formData.operationFlowSet.message=r[r.length-1],t.formData.operationFlowSet.key=n[n.length-1]}if(e&&t.tr&&t.tr.operationFlowSet){for(a=0;a<t.tr.operationFlowSet.length;a++)t.tr.operationFlowSet[a].status==t.tr.orderStatus&&(r.push(t.tr.operationFlowSet[a].message),n.push(t.tr.operationFlowSet[a].key));t.tr.operationFlowSet.message=r[r.length-1],t.tr.operationFlowSet.key=n[n.length-1]}if(e&&t.formData&&e&&t.formData.orderMedicalNos)for(a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.$watch("formData.supplier.id",function(e,a){e&&a&&a!==e&&0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[])}),t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleItemClickEvent=function(e){var a=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.handleFlag?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){t.customerName=e.name,t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.quantity=e.quantity,i.discountPrice="0",i.discountRate="100",i.strick_price=i.purchasePrice,i.taxRate="17",i.batchRequirement="无",i.relId=r.id,i.strike_price=i.price,i.id=null,!i.relId||!i.name)return a("请选择药品。"),!1;if(!i.quantity||i.quantity<1)return a("请输入大于0的数量。"),!1;if(i.quantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&supplierId="+t.formData.supplier.id+"&type=采购";n(l).then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.quantity,!0},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/purchaseOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=purchaseVoucher&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||r("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/purchaseOrder/startProcessInstance",i={businessKey:t.formData.id};n(a,i,"POST").then(function(e){e[1];t.goTo("#/purchaseOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))},t.createPurVoBtnClick=function(e){var a="rest/authen/purchaseVoucher/save",i={purchaseOrderId:e};n(a,i,"POST").then(function(e){var a=e[1].data;console.log(a),t.goTo("#/purchaseVoucher/get.html?id="+a.id)})["catch"](function(t){r(t||"出错")})},t.handleMessageShow=function(t){t.operationFlowSet&&angular.forEach(t.operationFlowSet,function(e,a){e.status===t.orderStatus&&(t.note=e.key)})},t.diffPurchaseNumber=function(e){e&&angular.forEach(e,function(e,a){t.isShowPurchaseInfo=e.planQuantity>e.quantity,t.isDisabledNextStep=e.quantity>e.planQuantity})},t.chkSupplierInfo=function(t){t.contact||o("供应商地址信息不完整，请完善",function(){window.location.assign("#/supplier/edit-contact.html?id="+t.id)})}}function h(t,e,a,r,n,i){t.logistics=!0,t.$watch("initFlag",function(){var e=[],a=[];if(t.tr.operationFlowSet){for(var r=0;r<t.tr.operationFlowSet.length;r++)t.tr.operationFlowSet[r].status==t.tr.orderStatus&&(e.push(t.tr.operationFlowSet[r].message),a.push(t.tr.operationFlowSet[r].key));return t.tr.operationFlowSet.message=e[e.length-1],void(t.tr.operationFlowSet.key=a[a.length-1])}}),t.$watch("formData.orderBusinessType",function(e){"直运销售"===e&&t.formData.orderMedicalNos.length&&angular.forEach(t.formData.orderMedicalNos,function(t,e){t.handleFlag=!0})}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(t.logistics=!1,0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.deleteQuantity=function(e){angular.forEach(t.formData.orderMedicalNos,function(t,e){t.quantityAndbatchNumber&&(t.quantityAndbatchNumber="",t.otherQuantity="",t.otherSterilizationBatchNumber="",t.otherWarehouseName="",t.validTill=" ")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/confirmOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=confirmOrderPrint&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||r("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",i={businessKey:t.formData.id};n(a,i,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.relId=r.id,i.discountPrice="0",i.discountRate="100",i.strike_price=i.price,i.id=null,i.logistics=!0,i.planQuantity||(i.planQuantity=e.quantity),!i.relId||!i.name)return a("请选择药品。"),!1;if(!e.quantity||e.quantity<1)return a("请输入大于0的数量。"),!1;if(i.planQuantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i.stockBatchs=[],i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=销售",c={};n(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.planQuantity,!0},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.confirmOrderCalculaTotal=function(e,a){if(e){var r=0;angular.forEach(e,function(t,e){if("普通销售"===a&&t.stockBatchs){for(var n=0,i=0;i<t.stockBatchs.length;i++)n+=t.stockBatchs[i].quantity*t.strike_price*(t.discountRate/100);r+=n}"直运销售"===a&&(r+=t.planQuantity*t.strike_price*(t.discountRate/100))}),t.formData.localTotalPrice=r}}}function m(t,e,a,r,n,i,o){t.isShowCancelBtn=!1,t.isGoNextStep=!1,t.showSaveNoteInfo=!1,t.$watch("initFlag",function(e){if(e){var a="rest/authen/requestPurchaseOrder/isCanClose?id="+t.formData.id;n(a,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})}}),e.closeAll(),t.addDataItem={},t.$watch("formData.note",function(e,a){e&&void 0!==a&&o(function(){var e="rest/authen/requestPurchaseOrder/save",a=t.formData;n(e,a,"POST","parameterBody").then(function(e){200===e[1].code&&(t.showSaveNoteInfo=!0)})["catch"](function(t){if(t)throw new Error(t||"出错!")})},1e3)}),t.$watch("showSaveNoteInfo",function(e){e&&o(function(){t.showSaveNoteInfo=!1},1500)}),t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/requestPurchaseOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/requestPurchaseOrder/confirm",a={id:t.formData.id};n(e,a,"POST").then(function(e){var a=e[1];t.goTo("#/purchaseOrder/edit.html?id="+a.data.purchaseOrder.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){function r(t){if(t.length>0){var e=t.every(function(e,a,r){return e===t[0]});return e}}t._supplierArray||(t._supplierArray=[]),e.handleFlag?(t._supplierArray.push(e.supplierId),e.handleFlag=!0,t.isGoNextStep=!!r(t._supplierArray)):(angular.forEach(t._supplierArray,function(a,r){a===e.supplierId&&t._supplierArray.splice(r,1)}),e.handleFlag=!1,t.isGoNextStep=!!r(t._supplierArray))},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,
t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))}}function p(t,e,a,r,n,i,o,s){t.getCheckUserApplyArr=function(t,e){var a=[];if(!e||0===e.length)return a;for(var r=0;r<t.length;r++)e.indexOf(t[r].id)>-1&&t[r].formData&&a.push(t[r]);return a},t.batchAuditUserApplyOrganization=function(i,o,l,c,d){if(!o||0===o.length)return void a("请先勾选");for(var u=[],f=0;f<i.length;f++)o.indexOf(i[f].id)>-1&&i[f].formData&&(i[f].formData.status=l,i[f].formData.key=c,i[f].formData.message=d,u.push(i[f].formData));var h="rest/authen/distributor/batchAuditUserApplyOrganization",m=s();r(h,u,"POST",!0).then(function(a){m&&m.hide(),n(a[1].msg),t.$broadcast("reloadList"),t.$emit("reloadList"),e.close()})["catch"](function(t){m&&m.hide(),e.close(),a(t)})},o.startGetMsg=function(){o.startGetMsgObj||(o.startGetMsgObj=$interval(function(){o.noticeRefreshTime=(new Date).getTime()},1e4))},o.startGetMsg(),requestRead=function(t,e){var a="rest/authen/notice/read",n={id:t};r(a,n,"POST").then(function(t){})["catch"](function(t){})}}function g(t,e){t.watchFormChange=function(a){e(a,t)}}function v(t,e,a,r,n,i,o,s){}function y(t,e,a,r,n,i){t.$watch("initFlag",function(e){var a,r=[],n=[];if(e&&t.tr&&t.tr.operationFlowSet){for(a=0;a<t.tr.operationFlowSet.length;a++)t.tr.operationFlowSet[a].status==t.tr.orderStatus&&(r.push(t.tr.operationFlowSet[a].message),n.push(t.tr.operationFlowSet[a].key));t.tr.operationFlowSet.message=r[r.length-1],t.tr.operationFlowSet.key=n[n.length-1]}if(t.formData&&e&&t.formData.orderMedicalNos)for(a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1);if(t.formData)for(var i in t.formData.attachments){var o=[];o.push(t.formData.attachments[i]),o[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-enterprise"==t.submitForm_type&&a("rest/authen/firstEnterpriseApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/firstEnterpriseApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/firstEnterpriseApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-medical"==t.submitForm_type&&a("rest/authen/firstMedicalApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/firstMedicalApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/firstMedicalApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-hospital"==t.submitForm_type&&a("rest/authen/hospitalApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/hospitalApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/hospitalApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-otherCustomer"==t.submitForm_type&&a("rest/authen/otherCustomerApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/otherCustomerApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/otherCustomerApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.choiceCommodityType=function(e){e.value&&(null===t.formData.commodityType&&(t.formData.commodityType=[]),t.formData.commodityType.push(e.text))},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/hospitalPurchaseMedical/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)})}function D(t,e,a,r,n,i){t.$watch("!initFlag",function(e){var a=[];for(var r in t.scopeData)if(a.push(t.scopeData[r]),t.formData.commodityType)for(j=0;j<t.formData.commodityType.length;j++)t.formData.commodityType[j]==t.scopeData[r].value&&(t.scopeData[r].value=!0)}),t.watchFormChange=function(a){e(a,t)}}function b(t,e,a,r,n,i,o){t._tmpDelList=[],t.$watch("tbodyList",function(e,a){e&&e!==a&&(t.tbodyListChange=!0)}),t.$watch("initFlag",function(e){if(e&&t.formData.orderMedicalNos)for(var a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.watchFormChange=function(a){e(a,t)},t.$watch("tbodyList",function(e,a){e&&e!==a&&(t.changeFlag=!0)},!0),t.modifiedThisMedicalItem=function(e){t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),angular.forEach(t.formData.orderMedicalNos,function(a,r){a.id===e.id&&t.formData.orderMedicalNos.splice(r,1)}),t.formData.orderMedicalNos.push(e)},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.submitFormAfter=function(){t.formData.validFlag=!1,"submit"==t.submitForm_type&&r.goTo("#/hospitalPurchaseContents/get.html?id="+t.formData.id)},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/hospitalPurchaseMedical/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.handleItemClickEvent=function(e){t.changeFlag=!1,e.handleFlag?t._tmpDelList.push(e.id):angular.forEach(t._tmpDelList,function(a,r){a===e.id&&t._tmpDelList.splice(r,1)})},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){t.changeFlag=!1,t.isChoiseAll?t.tbodyList&&angular.forEach(t.tbodyList,function(e,a){t._tmpDelList.push(e.id)}):(t._tmpDelList=[],t.formData["delete"].ids=[])},t.handleBatchDel=function(){t._tmpDelList.length&&angular.forEach(t._tmpDelList,function(e,a){for(var r=0;r<t.tbodyList.length;r++)e===t.tbodyList[r].id&&t.tbodyList.splice(r,1);t.formData["delete"].ids.push(e),t._tmpDelList=[],t.changeFlag=!0})},t.hospitalPurchaseContents_flashAddDataCallbackFn=function(e){var a;if(!e||!e.data||!e.data.data)return void i("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.relId=r.id,n.discountPrice="0",n.discountRate="100",n.planQuantity||(n.planQuantity=e.quantity),!n.relId||!n.name)return i("请选择药品。"),!1;if(n.planQuantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.tbodyList)for(a=0;a<t.tbodyList.length;a++)if(n.id===t.tbodyList[a].relId)return void i("此药械已添加到列表");if(0!==t.formData.orderMedicalNos.length){var o=t.formData.orderMedicalNos.length;for(a=0;a<o;a++)if(n.relId===t.formData.orderMedicalNos[a].relId)return i("此药械已添加到列表"),!1}return n.stockBatchs=[],t.formData.orderMedicalNos.push(n),t.tbodyList&&t.tbodyList.push(n),t.formData.totalPrice+=n.strike_price*n.planQuantity,!0}}function w(t,e,a,r,n,i){t.$watch("initFlag",function(e){var a=[],r=[];if(t.showData){if(t.showData.operationFlowSet)for(var n=0;n<t.showData.operationFlowSet.length;n++)t.showData.operationFlowSet[n].status==t.showData.businessApplication.businessStatus&&(a.push(t.showData.operationFlowSet[n].message),r.push(t.showData.operationFlowSet[n].key));return t.showData.operationFlowSet.message=a[a.length-1],void(t.showData.operationFlowSet.key=r[r.length-1])}if(e&&t.formData.orderMedicalNos)for(j=0;j<t.formData.orderMedicalNos.length;j++)t.formData.orderMedicalNos[j].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[j].handleFlag||(t.isChoiseAll=!1);if(t.formData)for(var i in t.formData.attachments){var o=[];o.push(t.formData.attachments[i]),o[0].certificateNumber?(console.log(o[0].certificateNumber),o[0].isAdmin=!1):o[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-medical"==t.submitForm_type&&(a("rest/authen/medicalStock/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/medicalStock/get.html?id="+t.formData.id)),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.medical.isBasicMedicine="是",r.purchasePrice=r.price,a("rest/authen/medicalStock/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void i("请选择药品");var a=e.data.data,r=$.extend(!0,{},a);if(r.relId=a.id,r.discountPrice="0",r.discountRate="100",r.id=null,r.planQuantity||(r.planQuantity=e.quantity),!r.relId||!r.name)return i("请选择药品。"),!1;if(r.planQuantity>a.quantity&&(r.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,o=0;o<n;o++)if(r.relId===t.formData.orderMedicalNos[o].relId)return i("此药械已添加到列表"),!1;return r.stockBatchs=[],t.formData.orderMedicalNos.push(r),t.formData.totalPrice+=r.strike_price*r.planQuantity,!0}}function C(t,e,a,r,n,i){t.$watch("initFlag",function(){var e=[],a=[];if(t.showData){if(t.showData.operationFlowSet)for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.businessApplication.businessStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}if(t.formData)for(var n in t.formData.attachments){var i=[];i.push(t.formData.attachments[n]),i[0].certificateNumber?(console.log(i[0].certificateNumber),i[0].isAdmin=!1):i[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-hospital"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/hospitalManagement/get.html?id="+t.formData.id)),"submit-supplier"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/supplier/get.html?id="+t.formData.id)),"submit-otherCustomer"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/otherCustomerManagement/get.html?id="+t.formData.id)),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.choiceCommodityType=function(e){e.value&&(null==t.formData.commodityType&&(t.formData.commodityType=[]),t.formData.commodityType.push(e.text))},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/customerAddress/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void i("请选择药品");var a=e.data.data,r=$.extend(!0,{},a);if(r.relId=a.id,r.discountPrice="0",r.discountRate="100",r.id=null,r.planQuantity||(r.planQuantity=e.quantity),!r.relId||!r.name)return i("请选择药品。"),!1;if(r.planQuantity>a.quantity&&(r.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,o=0;o<n;o++)if(r.relId===t.formData.orderMedicalNos[o].relId)return i("此药械已添加到列表"),!1;return r.stockBatchs=[],t.formData.orderMedicalNos.push(r),t.formData.totalPrice+=r.strike_price*r.planQuantity,!0}}function k(t,e,a,r,n,i,o){function s(t,e,a){for(var r=0;r<t.length;r++)t[r].sourceRef==e&&(t[r].sourceRef=a),t[r].targetRef==e&&(t[r].targetRef=a)}t.switchButtons=function(t,e,a){var r=t[e];t[e]=t[a],t[a]=r},t.addEventButtons=function(t){t||(t={}),t.buttons||(t.buttons=[]);var e={type:"通过",buttonName:"审核通过",requestMethod:"POST",conditionType:"通过",requestParam:"KeyValue",requestUrl:"rest/authen/workflowTask/run.json"};t.buttons.push(e)},t.saveEvent=function(a){t.formData.events||(t.formData.events=[]);var r=t.formData.events,n=!0;if(a.conditionType||(a.conditionType=null),a.id){var i=o.utils.getObjectIndexByKeyOfArr(r,"id",a.id);a.id!=a.name&&s(r,a.id,a.name),a.id=a.name,i>-1&&(r[i]=a,n=!1)}n&&(a.id=a.name,r.push(a)),console.log(a),e.closeAll()},t.deleteEvent=function(a){t.formData.events||(t.formData.events=[]);var r=t.formData.events,n=o.utils.removeObjectByKeyOfArr(r,"id",a);return n<0?void i("没有该节点，id="+event1.id):(s(r,a,null),void e.closeAll())}}function I(t,e,a,r,n){t.$watch("tr.strike_price",function(e,a){e!==a&&(t.tr.discountPrice=0,t.tr.discountRate=100)}),t.getCurrentProductionDate=function(e,a){if(e&&a){var i="rest/authen/medicalStock/getStockBatch?relMedicalStockId="+e+"&p_and_s="+a,o={};n(i,o,"get").then(function(e){var a=e[1];t.tr.productionDate=a.data.productionDate,t.tr.validTill=a.data.validTill})["catch"](function(t){r(t||"出错")})}}}function S(t,e,a,r,n){t.deleteUploader=function(t){if(t){var e="rest/authen/fileUpload/delete",a={key:t};n(e,a,"post").then(function(t){})["catch"](function(t){r(t||"出错")})}}}function M(t){t.tr.operationFlowSet&&angular.forEach(t.tr.operationFlowSet,function(e,a){"待付款"===e.status&&(t.tr.approvalPayUser=e)})}function F(t,e,a,r,n,i,o,s){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.submitFormAfter=function(e){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return t.goTo("#/saleReturnOrder/query.html"),void o(scopeResponse.msg);if("submit"==t.submitForm_type){var r="rest/authen/saleReturnOrder/startProcessInstance",i={businessKey:t.formData.id};return void n(r,i,"POST").then(function(e){200!==e[1].code?a(e[1].msg||"未知错误!"):t.goTo("#/saleReturnOrder/get.html?id="+t.formData.id)})["catch"](function(t){if(t)return void a(t||"未知错误!")})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function A(t,e,a,r,n,i,o,s){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.submitFormAfter=function(e){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return t.goTo("#/purchaseReturnOrder/query.html"),void o(e.msg);if("submit"==t.submitForm_type){var r="rest/authen/purchaseReturnOrder/startProcessInstance",i={businessKey:t.formData.id};return console.log(t.formData),void n(r,i,"POST").then(function(e){200!==e[1].code?a(e[1].msg||"未知错误!"):t.goTo("#/purchaseReturnOrder/get.html?id="+t.formData.id)})["catch"](function(t){if(t)return void a(t||"未知错误!")})}"save"==t.submitForm_type&&e&&o(e.msg)},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function O(t,e,a,r,n,i){t.addDataObj={},t.hasReturnList=!1,t.$watch("addDataObj.orderMedicalNos",function(e){e&&(t.hasReturnList=!1,angular.forEach(e,function(e,a,r){0!==e.returnQuantity&&(t.hasReturnList=!0)}))}),t.initChoisedMedicalList=function(e,a){var r=[],n=0;return e?(angular.forEach(e,function(e,i){if(a)for(var o=0;o<a.length;o++)e.relId===a[o].relId&&e.productionBatch===a[o].productionBatch&&e.sterilizationBatchNumber===a[o].sterilizationBatchNumber&&(e.itemSelected=!0,r.push(e),n++);e.itemSelected||(t.isChoiseAll=!1)}),n===e.length&&(t.isChoiseAll=!0),r):r},t.handleItemClickEvent=function(e){var a=t.addDataObj.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.itemSelected?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&a.productionBatch===e.productionBatch&&a.sterilizationBatchNumber===e.sterilizationBatchNumber&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},t.handleChoiseAllEvent=function(){t.choisedMedicalList=[];var e=t.addDataObj.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.itemSelected=!0,0!==e.returnQuantity&&t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.itemSelected=!1,t.choisedMedicalList=[]})},t.handleAddData=function(e,r,o,s){if(e&&r&&o&&0!==o.length){t.formData.salesDepartmentId=s.salesDepartmentId,t.formData.salesDepartmentName=s.salesDepartmentName,t.formData.purchaseType=s.purchaseType,t.formData.orderBusinessType=s.orderBusinessType,t.formData.saleUser=s.saleUser,t.formData.relId=e,t.formData.orderMedicalNos=[];var l={arrivalNoticeOrderNo:"",orderMedicalNoSet:[]};l.arrivalNoticeOrderNo=r,angular.forEach(o,function(t,e){l.orderMedicalNoSet.push(t)});var c="rest/authen/purchaseReturnOrder/splitOrderMedicalNos";n(c,l,"POST","parameter-body").then(function(e){var r=e[1].data;angular.forEach(r,function(e,a){t.formData.orderMedicalNos.push(e)}),a.closeAll()})["catch"](function(t){t&&i(t||"出错")})}},t.handleAddDataArray=function(e,n,i){if(e&&n&&0!==n.length){if(t.formData.orderMedicalNos.length?(t.formData.orderMedicalNos=[],t.formData.orderMedicalNos=n):(t.formData.relId=e,t.formData.orderMedicalNos=n),t.formData.salesDepartmentId=i.salesDepartmentId,t.formData.salesDepartmentName=i.salesDepartmentName,t.formData.salesType=i.salesType,t.formData.orderBusinessType=i.orderBusinessType,t.formData.saleUser=i.saleUser,t.formData.relId!=e)t.formData.orderMedicalNos=[];else for(var o=t.formData.orderMedicalNos.length-1;o>=0;o--){var s=t.formData.orderMedicalNos[o];r.getObjectIndexByKeyOfArr(n,"relId",s.relId)==-1&&t.formData.orderMedicalNos.splice(o,1)}a.closeAll()}}}function T(t){t.quantityError=!1,t.$watch("item.quantity",function(e){t.item.returnQuantity>=0&&(e>t.item.returnQuantity?(t.quantityError=!0,t.$parent.$parent.quantityError=!0):(t.quantityError=!1,t.$parent.$parent.quantityError=!1))})}function P(t,e,a){t.saveExpressInfo=function(t){var r=angular.isObject(t)?t:"",n="rest/authen/wOutstockOrder/kuaidi/save";r&&e(n,r,"POST").then(function(t){200===t[1].code&&a.goOrRefreshHref()})["catch"](function(t){console.log(t||"出错")})},t.editThisAreaInfo=function(e){t.addAreaisShow=!0,t.formData.type=e.type,t.formData.nu=e.nu,t.formData.id=e.id}}function N(t,e){var a=t.dialogData.kuaidiSet,r="rest/index/kuaidi/query2.json";t.expressInfoArray=[],angular.forEach(a,function(a,n){e(r+"?type="+a.type+"&nu="+a.nu,{},"get").then(function(e){var r=e[1];r.index=n,r.type=a.type,r.nu=a.nu,t.expressInfoArray.push(r)})})}function x(t,e){}function q(t,e){t.relMedicalStockIdSet="",t.handleChoiseAllEvent=function(e){t.isChoiseAll&&angular.isArray(e)?angular.forEach(e,function(e,a){e.handleFlag=!0,t.relMedicalStockIdSet?t.relMedicalStockIdSet+=","+e.id:t.relMedicalStockIdSet+=e.id}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.relMedicalStockIdSet=""})},t.handleItemClickEvent=function(e,a){if(e.handleFlag){var r=e.supplierId;angular.forEach(a,function(t,e){t.supplierId!==r&&(t.isCloseChiose=!0)}),t.relMedicalStockIdSet?t.relMedicalStockIdSet+=","+e.id:t.relMedicalStockIdSet+=e.id}else{var n=t.relMedicalStockIdSet.split(",");angular.forEach(n,function(t,a){if(t===e.id)return n.splice(a,1),!1}),t.relMedicalStockIdSet=n.toString(),t.relMedicalStockIdSet||angular.forEach(a,function(t,e){t.isCloseChiose=!1})}}}function _(t,e){t.choiseThisItem=function(e,a){t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(t,r){t.relId===a&&(t.strike_price=e.value)})}}function E(t,e,a){t.$watchCollection("listParams",function(e,r){if(t.listParams){t.dialogData.sourceId&&(t.listParams.warehouseId=t.dialogData.sourceId);var n="rest/authen/medicalStock/queryStockBatch",i={relMedicalStockId:t.dialogData.id,logisticsCenterId:t.dialogData.logisticsCenterId,warehouseId:t.listParams.warehouseId,createAtBeg:t.listParams.createAtBeg,createAtEnd:t.listParams.createAtEnd,q:t.listParams.q};a(n,i,"GET").then(function(e){e[1].data&&(t.stockBatchList=e[1].data)})}}),t.getChoisedBatchsId=function(e){e&&(t.choisedBatchsIdList=[],angular.forEach(e,function(e,a){e.stockBatchId&&t.choisedBatchsIdList.push(e.stockBatchId)}))},t.choseBatch=function(e,a,r){var n={stockBatchId:e.id,batchNumber:e.productionBatch,quantity:e.stockModel.salesQuantity,productionBatch:e.productionBatch,validTill:e.validTill,sterilizationBatchNumber:e.sterilizationBatchNumber,warehouseName:e.warehouseName,warehouseId:e.warehouseId,warehouseType:e.warehouseType},i=0;a&&angular.forEach(a,function(t,e){t.batchNumber&&(i+=parseInt(t.quantity,10))}),e.stockModel.salesQuantity+i>t.dialogData.planQuantity&&(n.quantity=t.dialogData.planQuantity-i),t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(e,a){e.relId==r&&t.formData.orderMedicalNos[a].stockBatchs.push(n)})}}function B(t,e){t.queryItemClick=function(t){var a="#/otherOutstockOrder/get.html?orderNo=";switch(t.type){case"采购入库单":a="#/purchaseInstockOrder/get.html?orderNo=";break;case"采购入库单_红字":a="#/purchaseInstockOrder/get.html?orderNo=";break;case"销售出库单":a="#/saleOutstockOrder/get.html?orderNo=";break;case"销售出库单_红字":a="#/saleOutstockOrder/get.html?orderNo=";break;default:a=t.inoutType?"出库"==t.inoutType?"#/otherOutstockOrder/get.html?orderNo=":"#/otherInstockOrder/get.html?orderNo=":t.type.indexOf("出")>-1?"#/otherOutstockOrder/get.html?orderNo=":"#/otherInstockOrder/get.html?orderNo="}return a+=t.orderNo,e.goTo(a),a}}function L(t){t.buildMapping=function(e,a,r){if(t.formData[a]&&t.formData[r]){if(t.formData[e]){var n=Object.keys(t.formData[e]);if(n.indexOf(t.formData[a])!=-1)return void alert("选择的属性已存在");for(var i in t.formData[e])if(t.formData[e][i]==t.formData[r])return void alert("选择的值已存在")}t.formData[e][t.formData[a]]=t.formData[r],t.formData[e]&&(t.formData[a]="",t.formData[r]="")}},t.initExtendedAttribute=function(e){if(angular.isObject(e)){t.extendedAttrList=[];for(var a in e){var r={name:a,val:e[a]};t.extendedAttrList.push(r)}}},t.handleChoiseEvent=function(e,a){angular.forEach(e,function(e,r){a==e.name&&(t.formData.extendedAttributeValue=e.val)})},t.saveExtendedAttribute=function(){for(var e in t.formData.extendedAttribute)e==t.formData.extendedAttributeKey.name&&(t.formData.extendedAttribute[e]=t.formData.extendedAttributeValue)}}angular.module("manageApp.project").controller("infrastructureController",["$scope",L]).controller("inoutstockDetailQueryCtr",["$scope","utils",B]).controller("historicalPriceController",["$scope","utils",_]).controller("editStockbatchNumberCtrl",["$scope","utils","requestData",E]).controller("indexPurchaseSuppleController",["$scope","utils",q]).controller("indexPageController",["$scope","utils",x]).controller("getAllExpressController",["$scope","requestData",N]).controller("saleOutstockOrderController",["$scope","requestData","utils",P]).controller("imTaobaoCtr",["$scope","requestData","alertError","$rootScope",t]).controller("saleReturnMedicalItemController",["$scope",T]).controller("returnOrderAddController",["$scope","$rootScope","modal","utils","requestData","alertError",O]).controller("mainCtrlProject",["$scope","$rootScope","$http","$location","store","utils","modal","OPrinter","UICustomTable","bottomButtonList","saleOrderUtils","purchaseOrderUtils","requestPurchaseOrderUtils","queryItemCardButtonList","customMenuUtils",e]).controller("ScreenFinanceApprovalController",["$scope",M]).controller("ConfirmOrderMedicalController",["$scope",l]).controller("confirmOrderEditCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","dialogConfirm",o]).controller("confirmOrderEditCtrl2",["$scope","modal","alertWarn","requestData","alertOk","alertError","watchFormChange","saleOrderUtils",s]).controller("SalesOrderDetailsController",["$scope","$timeout","alertOk","alertError","requestData",I]).controller("editWorkFlowProcessCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope",k]).controller("QualificationApplyCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",y]).controller("SelectedCommodityEditCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",D]).controller("hospitalPurchaseContentsCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn","$timeout",b]).controller("medicalStockCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",w]).controller("customerAddressCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",C]).controller("watchFormCtrl",["$scope","watchFormChange",g]).controller("intervalCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",v]).controller("auditUserApplyOrganizationCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","proLoading",p]).controller("purchaseOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange","dialogConfirm",f]).controller("allocateOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",h]).controller("arrivalNoticeOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",u]).controller("requestPurchaseOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange","$timeout",m]).controller("noticeCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",d]).controller("invoicesOrderCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$timeout",c]).controller("salesOrderEditCtrl2",["$scope","modal","alertWarn","watchFormChange","requestData",r]).controller("salesOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",a]).controller("freezeThawOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",i]).controller("lossOverOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",n]).controller("returnOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange","requestData","$rootScope","alertOk","utils",F]).controller("purchasereturnOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange","requestData","$rootScope","alertOk","utils",A]).controller("deleteUploaderController",["$scope","$timeout","alertOk","alertError","requestData",S])}),define("project/directives",["project/init"],function(){function t(t,e){return{restrict:"EA",scope:{ngModel:"="},templateUrl:Config.tplPath+"tpl/project/textareaJson.html",link:function(a,r,n){a.jsonFromNgModel=function(){try{a.jsonString=JSON.stringify(a.ngModel,null,"\t")}catch(e){console.log(e),a.jsonString=t.toJson(a.ngModel)}},a.jsonToNgModel=function(r){try{t.replaceObject(a.ngModel,$.parseJSON(r)),a.jsonString=""}catch(n){console.log(n),e("转换错误："+n.message)}}}}}function e(){return{restrict:"EA",scope:{ngModel:"=",openButtonId:"@?",divId:"@"},templateUrl:Config.tplPath+"tpl/project/htmlEdit.html",link:function(t,e,a){t.htmlFromDivId=function(){
t._htmlString=$("#"+t.divId).html()},t.openButtonId&&$("#"+t.openButtonId).on("click",function(e){t.htmlFromDivId(),t.$digest()}),t.cancel=function(){t._htmlString="",t.ngModel=t._htmlString},t.htmlToNgModel=function(){t._htmlString=t.umeditor.getContent(),console.log("$scope._htmlString",t._htmlString),t.ngModel=t._htmlString,t._htmlString=""}}}}function a(){return{restrict:"EA",scope:{attachmentsItemExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsItemShow.html"}}function r(){return{restrict:"EA",scope:{attachmentsExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsShow.html"}}function n(){return{restrict:"EA",scope:{attachmentsExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsEdit.html"}}function i(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNos.html"}}function o(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNosOfPurchaseOrder.html"}}function s(t){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowRejectButton.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu))}}}function l(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowPassButton.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu)),r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxParameterBody&&(e.beforeAjaxParameterBody=r.beforeAjaxParameterBody),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function c(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowButtonQueryCard.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu)),r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxParameterBody&&(e.beforeAjaxParameterBody=r.beforeAjaxParameterBody),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function d(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},templateUrl:Config.tplPath+"tpl/project/customMenuList.html",link:function(e,a,r){r.customMenuArr?e.customMenuArr=t.fromJson(r.customMenuArr):e.customMenuArr=r.customMenuArr,r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function u(t){return{restrict:"EA",scope:{workflowBottomButton:"=?"},templateUrl:Config.tplPath+"tpl/project/workflowTaskRunWithAttchments.html",link:function(e,a,r){r.customMenuArr?e.customMenuArr=t.fromJson(r.customMenuArr):e.customMenuArr=r.customMenuArr,r.returnButton&&(e.returnButton=t.fromJson(r.returnButton)),e.attchmentUsege=r.attchmentUsege,e.passButton=t.getcustomMenuByKeyOfArr(e.customMenuArr,"通过"),e.rejectButton=t.getcustomMenuByKeyOfArr(e.customMenuArr,"驳回"),e.showButton=e.passButton||e.rejectButton,e.showButton&&(e.formData=e.showButton.params),e.formData||(e.formData={}),e.formData.attachments=[],e.scopeExtend={},console.log(e.customMenuArr)}}}function f(){"use strict";return{restrict:"A",link:function(t,e,a){require(["nicescroll"],function(){$("html").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"6",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0",zindex:"1000"}),$("#page-side").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"3",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0"}),$("#page-side").getNiceScroll(),$("body").hasClass("left-side-collapsed")&&$("#page-side").getNiceScroll().hide()})}}}function h(t){"use strict";return{restrict:"A",link:function(e,a,r){function n(t){var e=$(t);e.addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})}var i=t.path().split("/")[1];r.leftMenuChange&&r.leftMenuChange===i&&n(a),a.on("click",function(t){t.stopPropagation(),n(a)})}}}function m(t){"use strict";return{restrict:"A",link:function(e,a,r){0===$(a).next(".sub-menu-list").length&&t.absUrl().indexOf(r.href)!==-1&&$(a).parent().addClass("active").siblings().each(function(){$(this).removeClass("active")}),$(a).on("click",function(t){t&&t.stopPropagation&&t.stopPropagation();var e=$(this).parent();if(0!==$(this).next(".sub-menu-list").length){var a=$(this).next(".sub-menu-list");a.is(":visible")?a.slideUp(200,function(){$(this).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}):a.slideDown(200,function(){e.siblings().each(function(){$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}),$(this).prev().find("span.pr-arrow-down").removeClass("pr-arrow-down").addClass("pr-arrow-up")})}else e.addClass("active").siblings().each(function(){$(this).removeClass("active").find(".sub-menu-list > li").each(function(){$(this).removeClass("active")}),$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200)})})}}}function p(){"use strict";return{restrict:"A",link:function(t,e,a){e.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function g(){return{restrict:"EA",scope:{ngModel:"=",countMap:"="},require:"ngModel",replace:!0,templateUrl:Config.tplPath+"tpl/project/queryOrderStatusButton.html",link:function(t,e,a,r){t.key=a.key,t.showName=t.key,a.showName&&(t.showName=a.showName),e.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function v(){"use strict";return{restrict:"A",link:function(t,e,a){e.on("click",function(){$(this).hide(),$(this).siblings().show().on("click",function(){$(this).hide(),$(e).show()})})}}}function y(){"use strict";return{restrict:"A",link:function(t,e,a){$(".toggle-btn").on("click",function(){$(".left-side").getNiceScroll().hide(),$("body").hasClass("left-side-collapsed")&&$(".left-side").getNiceScroll().hide();var t=$("body"),e=t.css("position");"relative"!=e?t.hasClass("left-side-collapsed")?(t.removeClass("left-side-collapsed chat-view"),$(".custom-nav li.active ul").css({display:"block"}),$(this).removeClass("menu-collapsed")):(t.addClass("left-side-collapsed"),$(".custom-nav ul").attr("style",""),$(this).addClass("menu-collapsed")):t.hasClass("left-side-show")?t.removeClass("left-side-show"):(t.addClass("left-side-show"),mainContentHeightAdjust())})}}}function D(){"use strict";return{restrict:"A",link:function(t,e,a){$(e).on("click",function(t){if(t.stopPropagation(),$(this).hasClass("fa-times"))$(this).parents(".panel").parent().remove();else{var e=$(this).parents(".panel").children(".panel-body");$(this).hasClass("fa-chevron-up")?($(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"),e.slideUp(200)):($(this).removeClass("fa-chevron-down").addClass("fa-chevron-up"),e.slideDown(200))}})}}}function b(){"use strict";return{restrict:"A",link:function(t,e,a){require(["morris"],function(){var t=a.id,e=[];if(angular.isDefined(a.datavalue)&&angular.isDefined(a.datalabel)&&angular.isDefined(a.dataformatted))for(var r={},n=0,i=a.datavalue.split(","),o=a.datalabel.split(","),s=a.dataformatted.split(",");n<i.length;)r.value=i[n],r.label=o[n],r.formatted=s[n],e.push(r),r={},n++;var l=!!angular.isDefined(a.backgroundColor)&&a.backgroundColor,c=angular.isDefined(a.labelColor)?a.labelColor:"#666",d=angular.isDefined(a.colors)?a.colors.split(","):["#ff5f39","#fe9302","#e39a27"];Morris.Donut({element:t,data:e,backgroundColor:l,labelColor:c,colors:d,formatter:function(t,e){return e.formatted}})})}}}function w(){"use strict";return{restrict:"A",link:function(t,e,a){require(["icheck"],function(){$(e).children().iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square",increaseArea:"20%"})})}}}function C(){"use strict";return{restrict:"A",link:function(t,e,a){require(["sparkline"],function(){$(".sparkline").each(function(){var t=$(this).data();t.valueSpots={"0:":t.spotColor},$(this).sparkline(t.data||"html",t,{tooltipFormat:'<span style="display:block; padding:0px 10px 12px 0px;"><span style="color: {{color}}">&#9679;</span> {{offset:names}} ({{percent.1}}%)</span>'})}),$("#income").sparkline([5,6,7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#expense").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#expense2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#pro-refund").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#ffffff"}),$("#p-lead-1").sparkline([7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#p-lead-2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#p-lead-3").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#5ab5de"}),$("#visit-1").sparkline([5,6,7,9,9,5,3,2,4,6,7,5,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"}),$("#visit-2").sparkline([5,6,7,7,9,5,8,5,4,6,7,8,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"})})}}}function k(){"use strcit";return{restrict:"A",link:function(t,e,a){$("[data-toggle='tooltip']").tooltip()}}}function I(t){"use strict";return{restrict:"A",link:function(t,e,a){var r=$(e).next();$(e).hover(function(){r.show()},function(){r.hide()}),r.hover(function(){$(this).show()},function(){$(this).hide()})}}}function S(t,e,a,r,n,i){"use strict";return{restrict:"A",link:function(o,s,l){s.on("click",function(){function s(){if(l.callbackScopeKey){var t=i.getAppointScope(o,l.callbackScopeKey);null!==t&&(l.callback&&t.$eval(l.callback),l.callBack&&t.$eval(l.callBack))}l.callback&&o.$eval(l.callback),l.parentCallback&&o.$parent.$eval(l.parentCallback)}function c(){function t(t){var e=t[1];if(200===e.code&&r(e.msg||"操作成功"),l.$scopeData&&(o[l.$scopeData]=data),s(),l.emitted)if(l.emitted.indexOf(",")!==-1){var a=l.emitted.split(","),n=a.length,i=0;for(i=0;i<n;i++)o.$emit(a[i])}else o.$emit(l.emitted)}var e=!1;angular.isDefined(l.parameterBody)&&(e=!0,"false"==l.parameterBody&&(e=!1));var i="POST";if(l.httpMethod&&(i=l.httpMethod),!l.requestUrl)return void s();var c=l.requestUrl,d={};return l.params&&0===l.params.indexOf("{")&&(d=o.$eval(l.params)),void a(c,d,i,e).then(t)["catch"](function(t){n(t||"出错")})}function d(){function t(t){t[1];c()}var e=!1;angular.isDefined(l.beforeAjaxParameterBody)&&(e=!0,"false"==l.parameterBody&&(e=!1));var r="POST";l.beforeAjaxHttpMethod&&(r=l.beforeAjaxHttpMethod);var i=l.beforeAjaxUrlSubmit,s={};return l.beforeAjaxParams&&(s=0===l.beforeAjaxParams.indexOf("{")?o.$eval(l.beforeAjaxParams):o[l.beforeAjaxParams]),void a(i,s,r,e).then(t)["catch"](function(t){n(t||"出错")})}var u=angular.isDefined(l.dialogTitle)?l.dialogTitle:"询问对话框",f=angular.isDefined(l.dialogContent)?l.dialogContent:"",h=angular.isDefined(l.dialogTemplate)?l.dialogTemplate:"tpl/dialog-confirm.html",m=angular.isDefined(l.jumpUrl)?l.jumpUrl:"",p=(angular.isDefined(l.requestUrl)?l.requestUrl:"",angular.isDefined(l.confirmBtnTxt)?l.confirmBtnTxt:"确定"),g=angular.isDefined(l.cancelBtnTxt)?l.cancelBtnTxt:"取消";if("pr-dialog-return.html"==h&&(angular.isDefined(l.dialogTitle)||(u="取消修改?"),angular.isDefined(l.dialogContent)||(f="有修改还未保存,是否保存?")),"false"==l.alertConfirm){if(angular.isDefined(l.beforeIfEval)&&l.beforeAjaxUrlSubmit){var v=o.$eval(l.beforeIfEval);if(v)return void d()}return void c()}e(f,function(e,a){if("cancel"==e)return void(l.cancelCallback&&o.$eval(l.cancelCallback));if("nosave"==e)return l.nosaveCallback&&o.$eval(l.nosaveCallback),void(l.parentNosaveCallback&&o.$parent.$eval(l.parentNosaveCallback));if("save"==e)return l.saveCallback&&o.$eval(l.saveCallback),void(l.parentSaveCallback&&o.$parent.$eval(l.parentSaveCallback));if(angular.isDefined(l.jumpUrl))return void t.location.assign(m);if(angular.isDefined(l.beforeIfEval)&&l.beforeAjaxUrlSubmit){var r=o.$eval(l.beforeIfEval);if(r)return void d()}c()},h,u,p,g,m)})}}}function M(){return{restrict:"EA",scope:{noAuthorFilter:"@?",leftNavigationMenu:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/leftNavigationMenu.html"}}function F(t,e){var a={isStart:!1,routeMap:{},last1MenuShowObj:null,eleChangeEvent:function(t){!t||0===t.length;var e=$(t).parent();e.addClass("active").siblings().each(function(){$(this).removeClass("active")}),e.parent().parent().removeClass("active").siblings().each(function(){$(this).removeClass("active"),$(this).find("ul.sub-menu-list").slideUp(200),$(this).find(".sub-menu-list > li").each(function(){$(this).removeClass("active")})}),a.last1MenuShowObj&&a.last1MenuShowObj.hide(),e.parent().is(":visible")||(e.parent().show(),a.last1MenuShowObj=e.parent()),$(t).parents("ul.sub-menu-list").prev().children().eq(2).removeClass("pr-arrow-down").addClass("pr-arrow-up")},doRoute:function(t){var e=t;e=e.split("#")[1],e&&(elementMenu=this.routeMap[e],elementMenu&&0!==elementMenu.length||(e=e.split("?")[0],elementMenu=this.routeMap[e]),elementMenu&&0!==elementMenu.length||(e=e.split("/")[1],elementMenu=this.routeMap[e]),elementMenu&&0!==elementMenu.length&&this.eleChangeEvent(elementMenu))},startListen:function(t){this.isStart||(this.isStart=!0,t.$on("$locationChangeSuccess",function(t,e,r){a.doRoute(e)}))},add:function(t,e,a){if(t&&t.length>0)for(var r=0;r<t.length;r++)this.routeMap[t[r]]=e;var n=e.attr("href");a&&(n=a),n&&(n=n.split("#")[1],n&&(this.routeMap[n]=e),n&&(n=n.split("?")[0]),n&&(this.routeMap[n]=e),n&&(n=n.split("/")[1]),n&&(this.routeMap[n]=e))}};return{restrict:"A",scope:{leftMenuSecondToggle:"=?",leftNavigationMenu:"="},link:function(r,n,i){var o=null;i.keyArr&&(o=r.$eval(i.keyArr)),a.add(o,n,r.leftMenuSecondToggle),a.startListen(e),a.doRoute("#"+t.path()),n.on("click",function(t){t&&t.stopPropagation&&t.stopPropagation(),a.eleChangeEvent(n)})}}}function A(t){"use strict";return{restrict:"A",link:function(e,a,r){r.href.indexOf(t.path().split("/")[2])!==-1&&$(a).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")}),$(a).on("click",function(t){$(this).hasClass("active")||$(this).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})})}}}function O(t){"use strict";return{restrict:"AE",scope:!1,link:function(e,a,r){e.countdown=function(a,r){e[a]=r;var n=t(function(){e[a]>0?e[a]-=1:t.cancel(n)},1e3)},e.$on("$destroy",function(){try{t.cancel(timeout_upd)}catch(e){}})}}}function T(t,e){"use strict";return{restrict:"AE",scope:{workflowTaskData:"=?",ngModel:"=?"},link:function(a,r,n){var i=null;a.$watch("ngModel",function(t){console.log("watch.workflow.ngModel",t),i&&i.reload(t)},!0);var o=a.ngModel;console.log(o),require(["WorkflowProcess"],function(r){function s(e,r){angular.isDefined(n.modalUrl)&&(t.closeAll(),a.$parent.currentEvent=r.currentNode.data,t.open({template:n.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:"true"==n.modalOverlay,data:r.currentNode.data,scope:a.$parent,controller:["$scope","$element",function(t,e){$(".ngdialog-content",e).width("50%")}]}))}var l={showStatus:"true"==n.showStatus,node:{clickCallback:s}};if(i=new r(n.id,l),n.scopeExtend){var c=e.getScopeExtend(a,n.scopeExtend);c&&n.scopeExtendAttr&&(c[n.scopeExtendAttr]=i)}i.addWorkflowProcess(o),a.workflowTaskData&&i.addWorkflowTaskData(a.workflowTaskData)})}}}function P(){return{restrict:"EA",scope:{businessKey:"@",businessType:"@"},templateUrl:Config.tplPath+"tpl/project/businessFlowShow.html",link:function(t,e,a,r){}}}function N(t,e){"use strict";return{restrict:"AE",scope:{ngModel:"=?"},link:function(t,a,r){var n=t.ngModel,i=r.curRelId;require(["CanvasBusinessFlow"],function(a){function o(t,a){if(!angular.isDefined(r.disableClick)){var n=a.currentNode.data.moduleType,o=a.currentNode.data.relId,s=a.currentNode.data.subModuleAttribute;if(!n||!o)return void console.log("moduleType="+n+",relId="+o);if(i!=o){var l="#/"+n+"/get.html?id="+o;"lossOrder"==n?l="#/lossOverOrder/get-reimburse.html?id="+o:"overOrder"==n?l="#/lossOverOrder/get-overflow.html?id="+o:"outstockOrder"==n?l="销售出库单"==s||"销售出库单_红字"==s?"#/saleOutstockOrder/get.html?id="+o:"#/otherOutstockOrder/get.html?id="+o:"instockOrder"==n&&(l="采购入库单"==s||"采购入库单_红字"==s?"#/purchaseInstockOrder/get.html?id="+o:"#/otherInstockOrder/get.html?id="+o),e.goTo(l)}}}var s={node:{clickCallback:o}};r.baseImageUrl&&(s.baseImageUrl=r.baseImageUrl),r.spacingWidth&&(s.spacingWidth=parseInt(r.spacingWidth)),r.spacingHeight&&(s.spacingWidth=parseInt(r.spacingHeight));var l=new a(r.id,s);if(r.scopeExtend){var c=e.getScopeExtend(t,r.scopeExtend);c&&r.scopeExtendAttr&&(c[r.scopeExtendAttr]=l)}l.addCanvasBusinessFlow(n,i)})}}}function x(t,e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/lodopFuncs.html",link:function(t,e,a){var r=null;require(["LodopFuncs"],function(e){function a(){return r||(r=e.getLodop(document.getElementById(t.LODOP_OB_Id),document.getElementById(t.LODOP_EM_Id))),r}function n(){a(),r.PRINT_INIT("打印控件功能演示_Lodop功能_表单一"),r.SET_PRINT_STYLE("FontSize",18),r.SET_PRINT_STYLE("Bold",1),r.ADD_PRINT_TEXT(50,231,260,39,"打印页面部分内容"),r.ADD_PRINT_HTM(88,200,350,600,document.getElementById(t.Print_Div_id).innerHTML)}t.LODOP_OB_Id="LODOP_OB_"+(new Date).getTime(),t.LODOP_EM_Id="LODOP_EM"+(new Date).getTime(),t.Print_Div_id="Print_Div_"+(new Date).getTime(),t.prn1_preview=function(){a(),n(),r.PREVIEW()},t.$digest()})}}}function q(){return{restrict:"A",scope:{},link:function(t,e,a){$(e).find("a.edit-link-icon").on("click",function(){$(this).hide().next().show(),$(e).find("span.notEdit").hide(),$(e).find("span.comeInEdit").show()})}}}function _(){return{restrict:"A",scope:{},link:function(t,e,a){var r=0,n=parseInt(a.modalLength),i=n;$(e).mouseenter(function(t){r=$(this).children("ul").children("li").length,liWidth=$(this).children("ul").children("li").width()+42,console.log(liWidth),console.log(),r>parseInt(n/liWidth)&&($(this).children("span").css("display","block"),$(".button-left").off("click").on("click",function(){$(".button-right").removeAttr("disabled","disabled"),i<n*Math.ceil(r/parseInt(n/liWidth))&&($(".kuaidiul").animate({"margin-left":"-"+i+"px"}),i+=n)}),$(".button-right").off("click").on("click",function(){$(".button-left").removeAttr("disabled","disabled"),i>=n&&(i-=n,$(".kuaidiul").animate({"margin-left":"-"+i+"px"}))})),i<n&&($(".button-right").attr("disabled","disabled"),$(".button-right:before").css("color","#e5e5e5")),i>=n*Math.ceil(r/parseInt(n/liWidth))&&($(".button-left").attr("disabled","disabled"),$(".button-left:before").css("color","#e5e5e5"))}),$(e).mouseleave(function(t){$(this).children("span").css({display:"none"})})}}}function E(t){return{restrict:"A",link:function(e,a,r){var n=0,i=null,o=e.$eval(r.mouseOverButtonsJson);o&&o.length>0&&(i=$("<div id='moveBtnDiv'></div>"),n=o.length);for(var s=0;s<o.length;s++){var l=o[s];if("0"==l.progress)return;var c="<a style='width:32px;height:32px;display:inline-block;margin-top:8px;' href='"+l.url+"' title='"+l.title+"'><span class='"+l.className+"'></span></a>",d=$(c);i.append(d)}$(a).mouseenter(function(e){if(a.addClass("bg-c"),i){moveBtnDivWidth=34*n;var r=a.offset().top-document.body.scrollTop,o=t.getwindowWidth()-60-moveBtnDivWidth-document.body.scrollLeft;i.css({position:"fixed",width:moveBtnDivWidth,height:a.height(),top:r,left:o}),$(this).append(i)}}),$(a).mouseleave(function(){$(this).removeClass("bg-c"),i.remove()})}}}function B(t){return{scope:{},restrict:"A",link:function(t,e,a){$(e).addClass("first-medical-nav");var r=0,n=t.$eval(a.stepFlowArrowJson);r=n.length;var i=($(e).width()-30*(r-1))/r;if(n&&n.length>0){for(var o=0;o<n.length;o++){var s=n[o],l="<div class='"+s.className+"'><span><em class='circle-step mgr-m'>"+(o+1)+"</em>"+s.arrowText+"</span></div>";$(e).append($(l)),o>0&&o<n.length-1&&($(e).children("div").eq(o).hasClass("visited")?($(e).children("div").eq(o).append("<div class='triangle1'></div><div class='triangle2'></div>"),$(e).children("div").eq(o).prepend("<div></div><div></div>")):($(e).children("div").eq(o).append("<div></div>"),$(e).children("div").eq(o).prepend("<div></div>")))}$(".first-medical-nav>div").css({width:i}),$(e).children("div").first().append("<div></div><div></div>"),$(e).children("div").last().prepend("<div></div>")}$(window).resize(function(){$(".first-medical-nav>div").css({width:($(e).width()-30*(r-1))/r})})}}}function j(t){return{scope:{},restrict:"A",link:function(t,e,a){var r,n=a.maxlength;t.$watch(t.initFlag,function(){r='<span class="strResult">(<em class="remainWords">0</em>/'+n+")</span>",$(e).after(r),a.top?$(".strResult").css({position:"absolute",top:a.top+"px",right:"35px","z-index":"100",color:"#999"}):$(".strResult").css({position:"absolute",top:"63px",right:"35px","z-index":"100",color:"#999"})}),$(e).bind("input propertychange change",function(t){$(".remainWords").html($(e).val().length)})}}}function L(){return{restrict:"A",link:function(t,e,a){$(e).on("click","li a",function(t){($("li").hasClass("actived")||$("a").hasClass("actived")||$("span").hasClass("actived"))&&($("li").removeClass("actived"),$("a").removeClass("actived"),$("span").removeClass("actived")),$(t.target).addClass("actived")})}}}function R(){return{restrict:"A",scope:{},link:function(t,e,a){if(!a.type)throw new Error("params type is must defined");if("line"===a.type){var r=$(e).width()?$(e).width():"100%",n=a.height;$(e).attr("style","width:"+r+";height:"+n+";").addClass("overhide").addClass("w-space-nowrap")}if("block"===a.type){var i=$(e).width(),o=$(e).height();$(e).attr("style","width:"+i+"px;height:"+o+"px;").addClass("text-ellips-block")}}}}function U(){"use strict";return{restrict:"A",scope:!0,link:function(t,e,a){var r=e.children().last();e.hover(function(){$(r).find("div.sales-order-item-delbtn").each(function(){$(this).css("z-index","110").show()})},function(){$(r).find("div.sales-order-item-delbtn").each(function(){$(this).css("z-index","100").hide()})}),$(r).find("div.sales-order-item-delbtn").each(function(){$(this).on("click",function(){$(this).find("div.sales-order-confirm-del-area").show()}),e.on("mouseleave",function(){$(this).find("div.sales-order-confirm-del-area").hide()})})}}}function V(t){"use strict";return{restrict:"A",scope:!0,link:function(e,a,r){var n=$(a).find("div.table-item-handle-btn"),i=$(a).find("div.table-item-confirm-del-area");n.on("click",function(){i.show()}),a.hover(function(){var i=(r.tableItemIndex,e.formData.orderMedicalNos,$(a).offset().top-document.body.scrollTop),o=t.getMainBodyWidth()+65;n.css({position:"fixed",top:i,left:o}).show()},function(){n.css({position:"absolute",top:0,left:0}).hide(),i.hide()}),e.cancelHandle=function(){n.hide(),i.hide()}}}}function W(t){var e={toolbar:["source undo redo bold italic underline"],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,autoHeightEnabled:!1,initialFrameHeight:400};return{restrict:"A",scope:{ngModel:"=?",config:"=",umeditor:"="},require:"ngModel",link:function(t,a,r,n){var i=a[0];t.umStyle={width:"1000px",height:"440px"},r.umStyle&&0===r.umStyle.indexOf("{")&&(t.umStyle=t.$eval(r.umStyle)),t.editorId=r.umeditor;require(["ueditor_lang"],function(a){function o(){if(!c){var a="_"+Math.floor(100*Math.random()).toString()+(new Date).getTime().toString(),o=r.placeholder;o||(o="");var s='<p style="font-size:14px;color:#ccc;">'+o+"</p>",l=null;l=t.config?jQuery.extend(!0,{},e,t.config):jQuery.extend(!0,{},e),i.setAttribute("id",a);var c=UE.getEditor(a,l);t.umeditor=c;var d=function(){c.hasContents()?n.$setViewValue(c.getContent()):n.$setViewValue(void 0)};c.ready(function(){return r.initHtmlContentId?(c.setContent($("#"+r.initHtmlContentId).html()),void n.$setViewValue(c.getContent())):(n.$viewValue?c.setContent(n.$viewValue):c.setContent(s),void c.addListener("contentChange",d))}),c.addListener("focus",function(){n.$viewValue||c.addListener("contentChange",d)}),c.addListener("blur",function(){c.hasContents()||(c.removeListener("contentChange",d),c.setContent(s))})}}o()})}}}function Q(){return{scope:{startTime:"=",endTime:"=",ngModel:"="},restrict:"A",link:function(t,e,a){function r(e){var a=require("moment"),r=a().format("x"),n=a().format("x");switch(e){case"最近7天":r=a().subtract(1,"weeks").format("x");break;case"最近10天":r=a().subtract(10,"days").format("x");break;case"最近一个月":r=a().subtract(1,"months").format("x")}t.startTime=r,t.endTime=n}t.$watch("ngModel",function(t){r(t)})}}}function H(t,e){return{restrict:"A",link:function(a,r,n){r.on("click",function(r){var i=n.ngSrc||n.src;if(!i)return void console.log("url is null");i=i.split("@")[0];var o='{"url":"'+i+'"}';console.log(o),t.open({template:Config.tplPath+"tpl/show-original-image.html",cache:!1,trapFocus:!1,data:o,scope:a,controller:["$scope","$element",function(t,a){$(".ngdialog-content",a).width(e.getMainBodyWidth()),$(".ngdialog-content",a).height(e.getwindowHeight())}]}),r.preventDefault()})}}}function G(t,e,a,r){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-medicalStockBatch.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=null,require(["project/angucomplete"],function(o){n.angucomplete1=new o(n,i,t,e,a,r,s)})}}}function z(t,e,a,r){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",ngModelId:"=?",ngModel:"=",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-supplier.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=n.searchFields,o.ngModelId&&n.$watch("ngModel",function(t){t&&(n.ngModelId=t.id,n.searchStr=t.data.name)},!0),require(["project/angucomplete"],function(o){n.angucomplete1=new o(n,i,t,e,a,r,s)})}}}function K(t,e,a,r){return{restrict:"EA",scope:{id:"@?",placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-medicalStock.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=null,require(["project/angucomplete"],function(o){var l=function(t){try{if("已冻结"==t.data.businessApplication.businessStatus)return!1}catch(e){}return!0};n.angucomplete1=new o(n,i,t,e,a,r,s,l)})}}}function J(t,e){return{restrict:"EA",scope:{id:"@?",ngModel:"=",addDataCallbackFn:"&?",formData:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/flashAddMedical.html",link:function(a,r,n,i){angular.isDefined(n.hideQuantity)&&(a.hideQuantity=!0),angular.isDefined(n.hideImport)&&(a.hideImport=!0),n.$observe("ajaxUrl",function(t,e){a.ajaxUrl=t}),angular.isDefined(n.isDisabledThis)||(a.isCustomerId=!0),n.$observe("isDisabledThis",function(t,e){t&&(a.isCustomerId=!0)}),a.angucompleteMedicalOnChange=function(){if(a.hideQuantity)a.addDataFn();else{var e="flashAddMedical_input_count";a.id&&(e+=a.id),t.focusByInputId(e)}},a.addDataFn=function(){if(a.addDataCallbackFn){var r=t.replaceObject({},a.ngModel),n=a.addDataCallbackFn(r);if("function"==typeof n&&(n=n(r)),!n)return!1}else console.log("scope.addDataCallback function is null!");a.ngModel={};var i="#angucompleteMedical_searchInputId";return a.id&&(i+=a.id),e(function(){$(i).val(""),$(i).trigger("focus")},0),!1},a.handleAddThisItem=function(t){var e=window.event?t.keyCode:t.which;return 13==e&&a.addDataFn(),!1}}}}function Y(){return{restrict:"EA",replace:!0,templateUrl:Config.tplPath+"tpl/project/customTable.html",link:function(t,e,a,r,n){a.checkboxShow&&(t._checkboxShow=a.checkboxShow),a.customTable&&(t._customTableName=a.customTable),a.customTrMenus&&(t._customTrMenus=a.customTrMenus)}}}function X(t,e,a){return{restrict:"A",link:function(r,n,i){var o=$("<div></div>");$(n).mouseenter(function(s){var l=r[i.tableTrMouseOverMenu],c=r[i.businessData];r._tableTrMouseOverMenus=a.parseVariableMenuList(l,c);var d='<span query-item-card-button-list="_tableTrMouseOverMenus"></span>';o.html(d),e(o.contents())(r);var u=0;if(r._tableTrMouseOverMenus&&(u=r._tableTrMouseOverMenus.length),n.addClass("bg-c"),o){moveBtnDivWidth=34*u;var f=n.offset().top-document.body.scrollTop,h=t.getwindowWidth()-10-moveBtnDivWidth;h<0&&(h=0),o.css({position:"fixed",width:moveBtnDivWidth,height:n.height(),top:f,left:h}),$(this).append(o)}}),$(n).mouseleave(function(){$(this).removeClass("bg-c"),o.remove()})}}}function Z(){return{restrict:"EA",scope:!1,replace:!0,templateUrl:Config.tplPath+"tpl/project/customTablePrint.html",link:function(t,e,a){a.customTablePrint&&(t.customTablePrintName=a.customTablePrint)}}}function tt(t){t.ngClick2=function(e){var a=t.$parent.$eval(e);console.log("ngClick2",e,a)},t.cancelCallback=function(e){var a=t.$parent.$eval(e);console.log("cancelCallback",e,a)},t.ngShow2=function(e){if(!e)return!0;var a=t.$parent.$eval(e);return a},t.ngDisabled2=function(e){if(!e)return!1;var a=t.$parent.$eval(e);return console.log("ngDisabled2",e,a),a}}function et(){return{restrict:"EA",scope:{spanClass:"=?",bottomButtonList:"=?"},templateUrl:Config.tplPath+"tpl/project/bottomButtonList.html",link:function(t,e,a){tt(t),t.spanClass||(t.spanClass="mgl"),t.defalutItemClass="btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg"}}}function at(){return{restrict:"EA",scope:{spanClass:"=?",queryItemCardButtonList:"=?"},templateUrl:Config.tplPath+"tpl/project/queryItemCardButtonList.html",link:function(t,e,a){tt(t),t.spanClass||(t.spanClass="mgl"),t.defalutItemClass="btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg"}}}function rt(){return{restrict:"EA",link:function(t,e,a){require(["store","resizableColumns"],function(t){e.resizableColumns({store:t})})}}}function nt(t,e){"use strict";return{restrict:"EA",scope:{formData:"=?",requestUrl:"@",createAddressType:"@",requestDataId:"@",invoicesGetCallBack:"&",reloadTime:"@",modifyModalTitle:"@",createModalTitle:"@",compnentTitle:"@",scopeDataPrefix:"@",modifyModalUrl:"@",createModalUrl:"@",setDefaultAddressRequesturl:"@",delThisAddressRequesturl:"@",contactsNull:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/addressManageComponent.html",link:function(e,a,r){e.contactsNull=!1,e.$watch("requestDataId",function(t,a){t&&t!==a&&n(e)}),r.$observe("logisticsCenterId",function(t,a){t&&t!=a&&(e.logisticsCenterId=t)});var n=function(e){var a=e.requestUrl+"?id="+e.requestDataId+"&type="+e.createAddressType;t(a,{},"get").then(function(t){var a=t[1];200===a.code&&e.returnAddressObj&&(e.returnAddressObj.contacts=a.data.contacts,a.data.contacts||(e.formData.contactsNull=!0))})["catch"](function(t){console.log(t||"出错")})};e.$on("reloadAddressList",function(){n(e)})},controller:["$scope","$element",function(e,a){e.choisedItemId="",e.chkDefaultChoise=function(t){if(e.formData.id){if(e.returnAddressObj.defaultContactId===t)return!0}else{if(e.returnAddressObj.choisedItemId&&e.returnAddressObj.choisedItemId===t)return!0;if(e.returnAddressObj.defaultContactId===t)return!0}},e.addressGetCallBack=function(){
if(!e.returnAddressObj)return!1;e.scopeDataId=e.scopeDataPrefix+"Id",e.scopeDataContacts=e.scopeDataPrefix+"Contacts",e.formData[e.scopeDataId]||(e.formData[e.scopeDataId]=e.returnAddressObj.defaultContactId);var t=e.returnAddressObj.contacts;if(t&&!e.choisedItemId)for(var a=0;a<t.length;a++)e.returnAddressObj.defaultContactId===t[a].id&&(e.formData[e.scopeDataContacts]=t[a]);e.returnAddressObj.contacts&&1===e.returnAddressObj.contacts.length&&(e.formData[e.scopeDataContacts]=e.returnAddressObj.contacts[0],e.formData.contactsNull=!1),e.choisedItemId&&(e.returnAddressObj.choisedItemId=e.choisedItemId)},e.getCurrentIndexAddress=function(t){if(!e.returnAddressObj)return!1;var a={},r=e.returnAddressObj.contacts[t],n=e.scopeDataPrefix+"AddressId";return a[n]=e.returnAddressObj.id,a.defaultContactId=e.returnAddressObj.defaultContactId,a.contact=r,a.type=e.createAddressType,a.title=e.modifyModalTitle,a.logisticsCenterId=e.logisticsCenterId,a},e.returnCreateNewAddressObj=function(){var t={},a=e.scopeDataPrefix+"AddressId";return e.returnAddressObj&&(t[a]=e.returnAddressObj.id),t.type=e.createAddressType,t.title=e.createModalTitle,t.logisticsCenterId=e.logisticsCenterId,t.contact={},t},e.choiseOtherItem=function(t,a){e.formData[e.scopeDataId]=a,e.formData[e.scopeDataContacts]=t,e.choisedItemId=t.id},e.setThisAddressToDefault=function(a){var r={};r.id=e.returnAddressObj.id,r.contactId=a,t(e.setDefaultAddressRequesturl,r,"POST").then(function(t){})["catch"](function(t){t&&console.log(t||"出错!")})}}]}}function it(t,e){"use strict";return{restrict:"EA",scope:{expressData:"=?",saveExpressUrl:"@",delExpressUrl:"@",orderId:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/expressManageComponent.html",link:function(t,e,a){if(!angular.isDefined(a.expressData))throw new Error("Attr expressData must be defined!");t.editThisAreaInfo=function(t,e){var a="express-details-"+e;$("#"+a).find("div.show-express-info").hide(),$("#"+a).find("div.edit-express-info").css("top",0)},t.cancelEditExpress=function(t){var e="express-details-"+t;$("#"+e).find("div.show-express-info").show(),$("#"+e).find("div.edit-express-info").css("top","-9999px")}},controller:["$scope","$element",function(a,r){a.saveExpressInfo=function(r){var n=angular.isObject(r)?r:"",i=a.saveExpressUrl;n&&t(i,n,"POST").then(function(t){200===t[1].code&&e.goOrRefreshHref()})["catch"](function(t){console.log(t||"出错")})}}]}}function ot(){"use strict";return{restrict:"EA",scope:{listParams:"=?",crumbsNav:"@",componentTitle:"@",createNewUrl:"@",getStatusNumUrl:"@",statusGroupData:"@",getBusinessTypeUrl:"@",isShowSelectItem:"@",searchPlaceholderInfo:"@",getWarehouseListUrl:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/pageMainHeaderComponent.html",link:function(t,e,a){if(t.crumbsNav){var r=angular.fromJson(t.crumbsNav);t.crumbsCode="",angular.forEach(r,function(e,a){a+1!==r.length?t.crumbsCode+='<span class="mgr-s '+e.style+'">'+e.name+'</span><span class="fa fa-angle-right mgr-s"></span>':t.crumbsCode+='<span class="mgr-s '+e.style+'">'+e.name+"</span>"}),$("#crumbsNav").append(t.crumbsCode)}t.statusGroupData&&(t.statusGroupList=angular.fromJson(t.statusGroupData)),t.splitStringData=function(t){var e=t.split("-");return e[1]=Boolean(e[1]),e},t.isShowSelectItem&&(t.selectObj=angular.fromJson(t.isShowSelectItem),t.itemChooise=t.selectObj[0].link),t.isShowCreateBtn=!!angular.isDefined(a.isShowCreateBtn)&&a.isShowCreateBtn,t.isShowTypeFilter=!!angular.isDefined(a.isShowTypeFilter)&&a.isShowTypeFilter,t.isShowWarehouseFilter=!!angular.isDefined(a.isShowWarehouseFilter)&&a.isShowWarehouseFilter,t.isShowDateFilter=!!angular.isDefined(a.isShowDateFilter)&&a.isShowDateFilter,t.isShowKeyFilter=!!angular.isDefined(a.isShowKeyFilter)&&a.isShowKeyFilter,t.isShowBusinessBtnGroup=!!angular.isDefined(a.isShowBusinessBtnGroup)&&a.isShowBusinessBtnGroup,t.searchPlaceholderInfo=angular.isDefined(a.searchPlaceholderInfo)?a.searchPlaceholderInfo:"客户名 / 单据编号"}}}function st(){"use strict";return{restrict:"A",scope:!0,link:function(t,e,a){$(e).find("a.origin-ele").hover(function(){$(this).next().show()},function(){$(this).next().hide()}),$(e).find("div.edit-del-btn").hover(function(){$(this).show()},function(){$(this).hide()}),$(e).find("a.handle-edit-info").on("click",function(t){t.stopPropagation(),$(e).find("div.show-express-info").hide(),$(e).find("div.edit-express-info").css("top",0)}),$(e).find("a.cancel-edit-express").on("click",function(t){t.stopPropagation(),$(e).find("div.show-express-info").show(),$(e).find("div.edit-express-info").css("top","-9999px")})}}}function lt(t,e){"use strict";return{restrict:"A",scope:{expressInfoList:"="},link:function(t,e,a){$(e).on("click",function(t){t.stopPropagation(),$(this).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")});var r=[];$(e).parent().siblings().each(function(){var t=$(this).children().attr("id");r.push("tabContent"+t)}),angular.forEach(r,function(t,e){$("#"+t).addClass("pr-dpy-none")}),$("#tabContent"+a.id).removeClass("pr-dpy-none")})}}}function ct(t,e){"use strict";return{restrict:"A",scope:!0,link:function(a,r,n){var i=$(r).find("div.table-item-multiple-btn"),o=$(r).find("div.del-details-btn"),s=$(r).find("div.other-handle-btn");$(r).find(".hide-this-area");o.on("click",function(){$(".del-confirm-area").show()}),s.on("click",function(){$(".handle-area-show").show()}),$(r).find(".hide-this-area").on("click",function(t){t.stopPropagation(),$(r).find("div.del-confirm-area").hide()}),r.hover(function(){var e=$(r).offset().top-document.body.scrollTop+23,a=t.getMainBodyWidth()-23;i.css({position:"fixed",top:e,left:a}).show()},function(){i.css({position:"absolute",top:0,left:0}).hide(),$(".del-confirm-area").hide(),$(".handle-area-show").hide()}),a.handleDelDetails=function(a,r,n){if(a&&r&&n){var i=r+"?id="+a;e(i,{},"POST").then(function(e){200==e[1].code&&t.goTo(n)})["catch"](function(t){if(t)throw new Error(t)})}}}}}angular.module("manageApp.project").directive("tableItemMultipleBtn",["utils","requestData",ct]).directive("pageMainHeaderComponent",ot).directive("expressManageComponent",["requestData","utils",it]).directive("tableItemHandlebtnComponent",["utils",V]).directive("requestExpressInfoTab",["requestData","alertError",lt]).directive("expressBtnToggle",[st]).directive("htmlEdit",[e]).directive("textareaJson",["utils","alertError",t]).directive("addressManageComponent",["requestData","utils",nt]).directive("attachmentsItemShow",[a]).directive("attachmentsShow",[r]).directive("attachmentsEdit",[n]).directive("bottomButtonList",[et]).directive("queryItemCardButtonList",[at]).directive("customTablePrint",[Z]).directive("resizableColumns",[rt]).directive("customTable",[Y]).directive("flashAddMedical",["utils","$timeout",J]).directive("angucompleteMedicalStockBatch",["$parse","requestData","$sce","$timeout",G]).directive("angucompleteMedical",["$parse","requestData","$sce","$timeout",K]).directive("angucompleteSupplier",["$parse","requestData","$sce","$timeout",z]).directive("modalImgShow",["modal","utils",H]).directive("datePeriodSelect",[Q]).directive("umeditor",["$timeout",W]).directive("salesorderEditShowDelbtn",[U]).directive("handleTextOverflow",[R]).directive("hospitalPurchaseComeinEdit",[q]).directive("saleOutStockKuaDi",[_]).directive("lodopFuncs",["modal","utils",x]).directive("canvasBusinessFlow",["modal","utils",N]).directive("businessFlowShow",[P]).directive("canvasWorkflow",["modal","utils",T]).directive("queryOrderStatusButton",g).directive("intervalCountdown",["$interval",O]).directive("workflowRejectButton",["utils",s]).directive("workflowPassButton",["utils",l]).directive("workflowButtonQueryCard",["utils",c]).directive("customMenuList",["utils",d]).directive("workflowTaskRunWithAttchments",["utils",u]).directive("orderMedicalsPurchase",o).directive("orderMedicals",i).directive("niceScroll",f).directive("leftMenuChange",["$location",h]).directive("leftMenuToggle",["$location",m]).directive("orderStatusChoise",p).directive("orderListTips",v).directive("toggleLeftMenu",y).directive("togglePanel",D).directive("morris",b).directive("icheck",w).directive("sparkline",C).directive("runTooltips",k).directive("runPopovers",["$timeout",I]).directive("handleThisClick",["$window","dialogConfirm","requestData","alertOk","alertError","utils",S]).directive("leftMenuSecondToggle",["$location","$rootScope",F]).directive("leftNavigationMenu",[M]).directive("styleToggle",["$location",A]).directive("leftSideActive",[L]).directive("tableTrMouseOverMenu",["utils","$compile","customMenuUtils",X]).directive("medicalStockMouseOver",["utils",E]).directive("stepFlowArrowShow",["utils",B]).directive("limitWordShow",["utils",j])}),define("project/filters",["project/init"],function(){function t(){return function(t){if(!t)return"";var e=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],r=[["元","万","亿"],["","拾","佰","仟"]],n=t<0?"欠":"";t=Math.abs(t);for(var i="",o=0;o<e.length;o++)i+=(a[Math.floor(10*t*Math.pow(10,o))%10]+e[o]).replace(/零./,"");for(i=i||"整",t=Math.floor(t),o=0;o<r[0].length&&t>0;o++){for(var s="",l=0;l<r[1].length&&t>0;l++)s=a[t%10]+r[1][l]+s,t=Math.floor(t/10);i=s.replace(/(零.)*零$/,"").replace(/^$/,"零")+r[0][o]+i}return n+i.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}}function e(){return function(t){var e=[];return angular.forEach(t,function(t,a){0!==t.returnQuantity&&e.push(t)}),e}}angular.module("manageApp.project").filter("upDigit",t).filter("repeatFilter",e)}),define("project/init",["angular"],function(){angular.module("manageApp.project",[])}),define("project/registration",["angular"],function(){angular.module("manageApp.registration",[]).config(["$routeProvider",function(t){"use strict";t.when("/verify_phone",{templateUrl:"angular/tpl/registration/verify_phone.html",controller:"registrationCtrl"}).when("/send_info",{templateUrl:"angular/tpl/registration/send_info.html",controller:"registrationCtrl"}).when("/apply_bind",{templateUrl:"angular/tpl/registration/apply_bind.html",controller:"registrationCtrl"}).when("/bind_done",{templateUrl:"angular/tpl/registration/bind_done.html",controller:"registrationCtrl"}).when("/retrievepwd",{templateUrl:"angular/tpl/retrieve-pwd/retrievepwd.html",controller:"registrationCtrl"}).when("/resetpwd",{templateUrl:"angular/tpl/retrieve-pwd/resetpwd.html",controller:"registrationCtrl"}).otherwise({redirectTo:"/verify_phone"})}]).controller("registrationCtrl",["$scope","requestData","$interval","$rootScope","$location",function(t,e,a,r,n){"use strict";t.globalData={requestUrlHead:""},t.sendVerifyCodeStatus=!1,t.countdown=function(e){t.second=e,a(function(){t.second>=1?t.second-=1:(clearInterval(),t.sendVerifyCodeStatus=!1,r.verifyResult.phone=!0)},1e3)},t.sendRegVerifyCode=function(){if(t.regData.phone){t.sendVerifyCodeStatus=!0,t.countdown(59);var a="";"/verify_phone"===n.path()&&(a=t.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=true&tel="+t.regData.phone,e(a,{}).then(function(e){var a=e[0];t.validCode=a.code})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})),"/retrievepwd"===n.path()&&(a=t.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=false&tel="+t.regData.phone,e(a,{}).then(function(e){var a=e[0];t.validCode=a.code})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)}))}},t.bind_done=function(){window.location.assign("#/bind_done")},t.regSubmit=function(){if(t.regData){var a=t.mainConfig.serverPath+"rest/index/register",r=t.regData,n="POST";e(a,r,n).then(function(t){var e=t[1];200===e.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){window.location.href="#/apply_bind"},1500))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})}},t.resetPwdSubmit=function(){if(t.regData){var a=t.mainConfig.serverPath+"rest/index/forgetPassword",r=t.regData,n="POST";e(a,r,n).then(function(e){var a=e[1];200===a.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){t.pageTo("login.html")},1500))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})}}}]).filter("registrationFilter",[function(){}]).service("registrationService",[function(){}]).value("registrationValue",[function(){}]).directive("regCheckPhone",["$rootScope","requestData",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){t.verifyResult||(t.verifyResult={}),r.on("keyup",function(){if(11===$(r).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var n=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;e(n,{},"GET").then(function(e){200===e[1].code&&(t.verifyResult.phone=!0,t.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled"))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:($(".reg-info-prompt").fadeIn(500),$(r).focus())})}else t.verifyResult.phone=!1,t.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(r).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}]).directive("regCheckVerifyCode",["requestData","$rootScope",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){r.on("keyup",function(){var n=i.$viewValue.toString();if(4===n.length){var o=a.mainConfig.serverPath+"rest/sms/verifySmsCodey.json",s={tel:a.regData.phone,code:a.regData.verifyCode};t(o,s,"POST").then(function(t){200===t[1].code&&(e.verifyResult.verifyCode=!0,e.verifyResult.phone=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200))})["catch"](function(t){e.verifyResult.verifyCode=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:($(".reg-info-prompt").fadeIn(500),$(r).focus())})}})}}}]).directive("regCheckPassword",["$rootScope",function(t){"use strict";return{restrict:"A",require:"ngModel",link:function(e,a,r,n){t.verifyResult||(t.verifyResult={msg:"",password:!1,repassword:!1}),a.on("keyup",function(i){if(16!==i.keyCode){if("password"===r.name){t.verifyResult={msg:"密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线"};var o=$.trim($(a).val());if(o.length>=6)if(/[A-Za-z0-9_-]{6,32}/.test(n.$viewValue))t.verifyResult.password=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200);else if(t.verifyResult.password=!1,t.verifyResult.repassword=!1,"none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}if("repassword"===r.name)if(t.verifyResult.password===!1){if(t.verifyResult.msg="密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else{t.verifyResult={msg:"两次输入的密码不一致",password:!0,repassword:!1};var s=$.trim($(a).val());if(s.length>=6)if(e.regData.password!==e.regData.repassword){if(t.verifyResult.msg="两次输入的密码不一致","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else t.verifyResult.repassword=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)}}})}}}]).directive("regCheckName",["$rootScope",function(t){"use strict";return{restrict:"A",require:"ngModel",link:function(e,a,r,n){t.verifyResult||(t.verifyResult={}),a.on("keydown",function(){var e=n.$viewValue;return void 0!==e&&e.length>16?(t.verifyResult.name=!1,t.verifyResult.msg="用户名为必填项且长度应在1~16位之间",void("none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(a).focus()))):(t.verifyResult.name=!0,void("none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)))})}}}]).directive("repwdCheckPhone",["$rootScope","requestData",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){t.verifyResult||(t.verifyResult={}),r.on("keyup",function(){if(11===$(r).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var n=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;e(n,{},"GET").then(function(e){200===e[1].code&&(t.verifyResult.phone=!1,t.verifyResult.msg="该手机号码未注册","none"===$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeIn(200))})["catch"](function(e){t.verifyResult.phone=!0,t.verifyResult.msg="",t.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").hide(),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled")})}else t.verifyResult.phone=!1,t.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(r).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}])}),define("project/services",["project/init"],function(){function t(){return function(t,e,a){var r='<div class="pr-top-dialog-tips" style="position:fixed;left:50%;top:0;opacity:0;height:42px;line-height:42px;padding:0 15px;color:#fff;background-color:#64c213;animation:topIn 1s;">'+test+"</div>";$(html).append(r)}}function e(t){var e={canShowButton:function(e){return!e.authority||!!t.hasAuthor(e.authority)},get_ButtonListDemo:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),r={authority:"采购单新建权限",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"新建权限"},e.canShowButton(r)&&a.push(r),r={type:"modalRight",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"右侧弹出层"},e.canShowButton(r)&&a.push(r),r={type:"modalCenter",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"中间弹出层"},e.canShowButton(r)&&a.push(r),r={type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"$root.goTo('#/hospitalApplication/query.html?tt='+showData.id)",showName:"自定义方法"},e.canShowButton(r)&&a.push(r),r={showName:"自定义ctr方法",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"ngDisabled_button",type:"button",modalWidth:"1000",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"!!ngShow",showName:"ngShow",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"handleThisClick",type:"handleThisClick",alertTemplate:"pr-dialog-return.html",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"editForm.$valid",showName:"保存",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),t&&(r={aclass:"btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg",ahref:Config.serverPath+"rest/authen/firstEnterpriseApplication/exportWord?id="+t.id,showName:"打印"},e.canShowButton(r)&&a.push(r)),console.log(a),a},get_confirmOrder:function(t){var a=[],r={aclass:"mgr-l",ahref:"#/confirmOrder/query.html",showName:"返回销售单列表"};return e.canShowButton(r)&&a.push(r),r={ngShow:"formData.orderStatus=='待处理' && formData.inputUserId==mainStatus.id",showName:"删除",type:"handleThisClick",alertTemplate:"dialog-confirm.html",requestUrl:"rest/authen/salesOrder/delete?id="+t.id,aclass:"pr-color-red mgr",alertTitle:"确认删除?",alertMsg:"您确认删除这条销售单吗?",ngClick:"$root.goTo('#/confirmOrder/query.html')"},e.canShowButton(r)&&a.push(r),r={aclass:"pr-btn-save-glodbg mgr color-white",ahref:"indexOfPrint.html#/print/confirmOrderPrint.html?id="+t.id,target:"_blank",showName:"打印预览"},e.canShowButton(r)&&a.push(r),a},get_firstEnterpriseApplication:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_firstMedicalApplication:function(t){var a=[],r={aclass:"",ahref:"#/firstMedicalApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_medicalStock:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_customerAddress:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_hospitalApplication:function(t){var a=[],r={aclass:"",ahref:"#/hospitalApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_hospitalPurchaseContents:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_otherCustomerApplication:function(t){var a=[],r={aclass:"",ahref:"#/otherCustomerApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a}};return e}function a(t){var e={canShowButton:function(e){return!e.authority||!!t.hasAuthor(e.authority)},get_ButtonListDemo:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),r={authority:"采购单新建权限",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"新建权限"},e.canShowButton(r)&&a.push(r),r={type:"modalRight",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"右侧弹出层"},e.canShowButton(r)&&a.push(r),r={type:"modalCenter",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"中间弹出层"},e.canShowButton(r)&&a.push(r),r={type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"$root.goTo('#/hospitalApplication/query.html?tt='+showData.id)",showName:"自定义方法"},e.canShowButton(r)&&a.push(r),r={showName:"自定义ctr方法",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"ngDisabled_button",type:"button",modalWidth:"1000",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"!!ngShow",showName:"ngShow",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"handleThisClick",type:"handleThisClick",alertTemplate:"pr-dialog-return.html",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"editForm.$valid",showName:"保存",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),t&&(r={aclass:"btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg",ahref:Config.serverPath+"rest/authen/firstEnterpriseApplication/exportWord?id="+t.id,showName:"打印"},e.canShowButton(r)&&a.push(r)),console.log(a),a},getQuery_salesOrder:function(t){var a=[],r={iconClass:"View-Logistics-icon",showName:"查看物流",ngShow:"tr.orderStatus=='已发货'",aclass:"btn-link pd-m rect-s mr--4",ahref:"#/salesOrder/get.html?openWuliu=true&id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus!='已处理' && $root.hasAuthor('购需单编辑')",aclass:"btn-link pd-m rect-s",ahref:"#/salesOrder/edit2.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus=='已处理' || !$root.hasAuthor('购需单编辑')",aclass:"btn-link pd-m rect-s",ahref:"#/salesOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='待处理' && tr.inputUserId==mainStatus.id",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/salesOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/salesOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_confirmOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'||tr.orderStatus=='未通过'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"examine-approve",showName:"立即审核",ngShow:"tr.orderStatus=='待审核'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus!='待审核'&&tr.orderStatus!='未提交'&&tr.orderStatus!='未通过'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'||tr.orderStatus=='未通过'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/confirmOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/confirmOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_invoicesOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/invoicesOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus!='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/invoicesOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/invoicesOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/invoicesOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_saleReturnOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/saleReturnOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus=='处理中' || tr.orderStatus=='已处理'",aclass:"btn-link pd-m rect-s",ahref:"#/saleReturnOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/saleReturnOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/saleReturnOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_hospitalPurchaseContents:function(t){var a=[];r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"",aclass:"btn-link pd-m rect-s",ahref:"#/hospitalPurchaseContents/get.html?id="+t.id},e.canShowButton(r)&&a.push(r);var r={ngShow:"tr.businessApplication.businessStatus!='已冻结' || tr.businessApplication.businessStatus!='已终止'",iconClass:"edit-link-icon",showName:"编辑",aclass:"btn-link pd-m rect-s",ahref:"#/hospitalPurchaseContents/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/saleReturnOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/saleReturnOrder/query.html')"},e.canShowButton(r)&&a.push(r),a}};return e}function r(t){var e={getHanShuiDanJian:function(e){var a;return a=t.numberDiv(e.discountRate,100),a=t.numberMul(e.strike_price,a)},getWuSuiDanJian:function(a){var r;return r=t.numberDiv(a.tax,100),r=1+r,r=t.numberDiv(e.getHanShuiDanJian(a),r)},getWuSuiJinE:function(a,r){var n;return n=e.getWuSuiDanJian(a),n=r?t.numberMul(n,a.planQuantity):t.numberMul(n,a.quantity)},getSuiE:function(a,r){var n,i=e.getWuSuiDanJian(a);return r?(i=t.numberMul(i,a.planQuantity),n=e.getJiaSuiHeJi(a,r),i=t.numberSub(n,i)):(i=t.numberMul(i,a.quantity),n=e.getJiaSuiHeJi(a),i=t.numberSub(n,i))},getJiaSuiHeJi:function(a,r){var n;return n=e.getHanShuiDanJian(a),n=r?t.numberMul(n,a.planQuantity):t.numberMul(n,a.quantity)}};return e}function n(t){var e={getWuSuiDanJian:function(e){var a;return a=t.numberDiv(e.tax,100),a=1+a,a=t.numberDiv(e.strike_price,a)},getWuSuiJinE:function(a){var r;return r=e.getWuSuiDanJian(a),r=t.numberMul(r,a.quantity)},getJiaSuiHeJi:function(e){var a;return a=t.numberMul(e.strike_price,e.quantity)},getSuiE:function(a,r){var n,i=e.getWuSuiDanJian(a);return r?(i=t.numberMul(i,a.planQuantity),n=e.getJiaSuiHeJi(a,r),i=t.numberSub(n,i)):(i=t.numberMul(i,a.quantity),n=e.getJiaSuiHeJi(a),i=t.numberSub(n,i))}};return e}function i(t){var e={getWuSuiDanJian:function(e){var a;return a=t.numberDiv(e.taxRate,100),a=1+a,a=t.numberDiv(e.purchasePrice,a)},getWuSuiJinE:function(a){var r;return r=e.getWuSuiDanJian(a),r=t.numberMul(r,a.quantity)},getJiaSuiHeJi:function(e){var a;return a=t.numberMul(e.purchasePrice,e.quantity)}};return e}function o(t){var e={parseVariableMenuList:function(e,a){if(!e)return e;for(var r=[],n=0;n<e.length;n++){var i=$.extend(!0,{},e[n]);for(var o in i){var s=t.parseVariableString(i[o],a);i[o]=s}r.push(i)}return r}};return e}angular.module("manageApp.project").factory("customMenuUtils",["utils",o]).factory("saleOrderUtils",["utils",r]).factory("purchaseOrderUtils",["utils",n]).factory("requestPurchaseOrderUtils",["utils",i]).factory("bottomButtonList",["$rootScope",e]).factory("queryItemCardButtonList",["$rootScope",a]).factory("proMessageTips",[t])}),define(["project/angucomplete"],function(){function t(t,e,a,r,n,i,o,s){function l(t,e,a){if(!e)return null;if(e.length-a==1){var r=e[a];return r?t[r]:null}var r=e[a];return r&&t[r]?l(t[r],e,1+a):null}var c={getObjectVal:function(t,e){if(!e)return null;var a=e.split(".");return l(t,a,0)}},d=function(e,a){return e.length>=t.minLength&&e!=a},u=function(e,a){if(e&&e.length>0){t.results=[];var r=[];t.titleField&&""!=t.titleField&&(r=t.titleField.split(","));for(var i=0;i<e.length;i++){for(var o=[],s=0;s<r.length;s++)o.push(e[i][r[s]]);var l="";t.descriptionField&&(l=c.getObjectVal(e[i],t.descriptionField));var d=o.join(" ");if(t.matchClass){var u=new RegExp(a,"i"),f=d.match(u)[0];d=n.trustAsHtml(d.replace(u,'<span class="'+t.matchClass+'">'+f+"</span>"))}var h={id:e[i].id,title:d,description:l,data:e[i]};t.results[t.results.length]=h}}else t.results=[]},f=function(e){if(e.length>=t.minLength)if(t.localData){for(var a=t.searchFields.split(","),n=[],i=0;i<t.localData.length;i++){for(var o=!1,s=0;s<a.length;s++)o=o||"string"==typeof t.localData[i][a[s]]&&"string"==typeof e&&t.localData[i][a[s]].toLowerCase().indexOf(e.toLowerCase())>=0;o&&(n[n.length]=t.localData[i])}t.searching=!1,u(n,e)}else r(t.url,{q:e}).then(function(a){
var r=a[0];t.searching=!1,u(r,e)})["catch"](function(e){t.searching=!1,console.error(e)})},h=function(){t.hideTimer=i(function(){t.showDropdown=!1},t.pause)},m=function(){t.hideTimer&&i.cancel(t.hideTimer)},p=function(e){t.currentIndex=e},g=function(e){38!=e.which&&40!=e.which&&13!=e.which?t.searchStr&&""!==t.searchStr?d(t.searchStr,t.lastSearchTerm)&&(t.lastSearchTerm=t.searchStr,t.showDropdown=!0,t.currentIndex=-1,t.results=[],t.searchTimer&&i.cancel(t.searchTimer),t.searching=!0,t.searchTimer=i(function(){f(t.searchStr)},t.pause)):(t.showDropdown=!1,t.lastSearchTerm=null):e.preventDefault()},v=function(e){s&&!s(e)||(t.matchClass&&(e.title=e.title.toString().replace(/(<([^>]+)>)/gi,"")),t.searchStr=t.lastSearchTerm=e.title,t.selectedItem=e,t.showDropdown=!1,t.results=[],o&&o.$setViewValue(e))},y=function(){var t=$(".angucomplete-selected-row");if(0===t.length)return void console.log(".angucomplete-selected-row length=0");var e,a,r,n,i,o=$(".angucomplete-dropdown");return r=parseInt(o.css("maxHeight"),10),i=o.scrollTop(),n=r+i,a=t.position().top+i,e=a+t.outerHeight(),e>=n?o.scrollTop(e-r>0?e-r:0):a<i?o.scrollTop(a):void 0},D=function(){i(function(){y()},0)},b=function(e){40===e.which?(t.results&&t.currentIndex+1<t.results.length&&(t.currentIndex++,t.$apply(),e.preventDefault(),e.stopPropagation()),t.$apply(),D()):38==e.which?(t.currentIndex>=1&&(t.currentIndex--,t.$apply(),e.preventDefault(),e.stopPropagation()),D()):13==e.which?t.results&&t.currentIndex>=0&&t.currentIndex<t.results.length?(v(t.results[t.currentIndex]),t.$apply(),e.preventDefault(),e.stopPropagation()):(t.results=[],t.$apply(),e.preventDefault(),e.stopPropagation()):27==e.which?(t.results=[],t.showDropdown=!1,t.$apply()):8==e.which&&(t.selectedItem=null,t.$apply())},w=e.find("input");return w.on("keyup",g),e.on("keyup",b),this.$scope=t,this.processResults=u,this.searchTimerComplete=f,this.hoverRow=p,this.hideResults=h,this.resetHideResults=m,this.keyPressed=g,this.selectResult=v,this}return t}),define("project/controllers",["project/init"],function(){function t(t,e,a,r){function n(t){var n="rest/authen/imTaobaoUserInfo/getMy.json";e(n).then(function(e){e[0];r.MyImTaobaoUserInfo=e[0],t&&t()})["catch"](function(t){a(t||"出错")})}t.openIm=function(e,a){var i=r.MyImTaobaoUserInfo;if(!i)return void n(function(){t.openIm(e)});e||(e=""),a||(a="");var o="?uid="+i.userid+"&to="+e+"&toUserName="+a+"&appkey=23588140&pwd="+i.password+"&fullscreen";window.open("imtaobao/kit.html"+o,"webcall","toolbar=no, status=no,scrollbars=0,resizable=0,menubar＝0,location=0,width=700,height=530")}}function e(t,e,a,r,n,i,o,s,l,c,d,u,f,h,m){e.bottomButtonList=c,e.saleOrderUtils=d,e.purchaseOrderUtils=u,e.requestPurchaseOrderUtils=f,e.queryItemCardButtonList=h,e.customMenuUtils=m}function a(t,e,a,r){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.storageLocation=e.storageLocation,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(!e.strike_price)return void a("请输入成交价格。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.newAddDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.csmQuantity||e.csmQuantity<1)return void a("请输入大于0的数量。");if(t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");e.priceWithoutTax=e.price-e.price*e.taxRate,e.quantity=e.csmQuantity,t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){return t.formData.validFlag=!1,"exit"==t.submitForm_type?void t.goTo("#/salesOrder/query.html"):("submit"==t.submitForm_type&&t.goTo("#/salesOrder/confirm-order.html?id="+t.formData.id),void("save"==t.submitForm_type))},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function r(t,e,a,r,n){e.closeAll(),t.addDataItem={},t.isShowCancelBtn=!1,t.$watch("initFlag",function(e){if(e){var a="rest/authen/salesOrder/isCanClose?id="+t.formData.id;n(a,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})["catch"](function(t){})}}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(document.getElementById("angucompleteMedical_searchInputId").focus(),0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.watchFormChange=function(e){r(e,t)},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.quantity=e.quantity,i.discountPrice="0",i.discountRate="100",i.relId=r.id,i.strike_price=i.price,i.id=null,!i.relId||!i.name)return a("请选择药品。"),!1;if(!i.quantity||i.quantity<1)return a("请输入大于0的数量。"),!1;if(i.quantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=销售",c={};n(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/edit-from-salesOrder.html?id="+a.confirmOrder.id)})["catch"](function(t){})}if("save"==t.submitForm_type){var r="rest/authen/salesOrder/isCanClose?id="+t.formData.id;n(r,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})["catch"](function(t){})}},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function n(t,e,a,r,n){t.$watch("initFlag",function(){var e=[],a=[];if(console.log(t.tbodyList),t.showData||t.tr){if(t.showData.operationFlowSet||t.tr.operationFlowSet)for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.orderStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}}),t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/get2.html?id="+a.confirmOrder.id)})["catch"](function(t){})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.hideThisBtn=function(){$(".sales-order-item-delbtn").hide(),t.showHandleArea=!1}}function i(t,e,a,r,n){t.watchFormChange=function(e){r(e,t)},t.$watch("initFlag",function(){var e=[],a=[];if(t.showData){for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.orderStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}}),e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/salesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/salesOrder/confirmSalesOrder",a={id:t.formData.id,status:"待审批"};n(e,a,"POST").then(function(e){var a=e[1].data;t.goTo("#/confirmOrder/get2.html?id="+a.confirmOrder.id)})["catch"](function(t){})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.hideThisBtn=function(){$(".sales-order-item-delbtn").hide(),t.showHandleArea=!1}}function o(t,e,a,r,n,i){t.logistics=!0,t.isShowConfirmInfo=!1,t.$watch("initFlag",function(){var e=[],a=[];if(t.formData.operationFlowSet){for(var r=0;r<t.formData.operationFlowSet.length;r++)t.formData.operationFlowSet[r].status==t.formData.orderStatus&&(e.push(t.formData.operationFlowSet[r].message),a.push(t.formData.operationFlowSet[r].key));return t.formData.operationFlowSet.message=e[e.length-1],void(t.formData.operationFlowSet.key=a[a.length-1])}}),t.$watch("formData.orderBusinessType",function(e){"直运销售"===e&&t.formData.orderMedicalNos.length&&angular.forEach(t.formData.orderMedicalNos,function(t,e){t.handleFlag=!0})}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(t.logistics=!1,0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.$watch("formData.orderMedicalNos",function(e){var a=0;t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(e,r){if(e.stockBatchs)for(var n=0;n<e.stockBatchs.length;n++)a+=parseInt(e.stockBatchs[n].quantity,10);t.isShowConfirmInfo=a<t.formData.orderMedicalNos[r].planQuantity&&0!==a})},!0),t.deleteQuantity=function(e){angular.forEach(t.formData.orderMedicalNos,function(t,e){t.quantityAndbatchNumber&&(t.quantityAndbatchNumber="",t.otherQuantity="",t.otherSterilizationBatchNumber="",t.otherWarehouseName="",t.validTill=" ")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/confirmOrder/query.html");if("exit-allocate"==t.submitForm_type)return void t.goTo("#/allocateOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=confirmOrderPrint&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||i("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}if("submit-allocate"==t.submitForm_type){var a="rest/authen/allocateOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/allocateOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var n=e.data.data,i=$.extend(!0,{},n);if(i.relId=n.id,i.discountPrice="0",i.discountRate="100",i.strike_price=i.price,i.id=null,i.logistics=!0,i.planQuantity||(i.planQuantity=e.quantity),!i.relId||!i.name)return a("请选择药品。"),!1;if(!e.quantity||e.quantity<1)return a("请输入大于0的数量。"),!1;if(i.planQuantity>n.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i.stockBatchs=[],i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=销售",c={};r(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.planQuantity,!0},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.confirmOrderCalculaTotal=function(e,a){if(e){var r=0;angular.forEach(e,function(t,e){if("普通销售"===a&&t.stockBatchs){for(var n=0,i=0;i<t.stockBatchs.length;i++)n+=t.stockBatchs[i].quantity*t.strike_price*(t.discountRate/100);r+=n}"直运销售"===a&&(r+=t.planQuantity*t.strike_price*(t.discountRate/100))}),t.formData.totalPrice=r}}}function s(t,e,a,r,n,i,o,s){t.$watch("initFlag",function(){var e=[],a=[];if(t.scopeData){for(var r=0;r<t.scopeData.operationFlowSet.length;r++)t.scopeData.operationFlowSet[r].status==t.scopeData.orderStatus&&(e.push(t.scopeData.operationFlowSet[r].message),a.push(t.scopeData.operationFlowSet[r].key));return t.scopeData.operationFlowSet.message=e[e.length-1],void(t.scopeData.operationFlowSet.key=a[a.length-1])}}),t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/invoicesOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/confirmOrderPrint.html?id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||i("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",n={businessKey:t.formData.id};r(a,n,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleThischoise=function(e){var a=0;e.handleFlag?(angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag===!0&&a++}),t.choiseStatus=t.orderMedicalNos.length===a):t.choiseStatus=!1},t.chkIsChoiseAll=function(){var e=0;angular.forEach(t.orderMedicalNos,function(t,a){console.log(t.handleFlag),t.handleFlag===!0&&e++}),t.choiseStatus=t.orderMedicalNos.length===e},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e}}function l(t){t.choiseProductionBatch=function(e,a,r){a&&!a.quantity&&(e.quantity||(e.quantity=0),a.quantity=e.planQuantity-e.quantity,r&&(r.note||(r.note={}),r.note.salesQuantity||(r.note.salesQuantity=0)),r&&r.note&&r.note.salesQuantity?a.quantity>r.note.salesQuantity&&(a.quantity=r.note.salesQuantity,t.item.handleFlag=!0):a.quantity=null)},t.$watch("item.stockBatchs",function(e,a){if(void 0!==e){var r=t.item;r.quantity=0,e||(e=[{}]);for(var n=-1,i=0;i<e.length;i++)e[i].batchNumber||(e[i].quantity=0,n=i),e[i].quantity&&(r.quantity+=e[i].quantity);r.quantity<r.planQuantity?n==-1&&r.stockBatchs.push({}):n>-1&&r.stockBatchs.splice(n,1),r.quantity>0&&(r.handleFlag=!0)}},!0),t.getAllBatchTotal=function(t){if(t&&angular.isArray(t)){var e=0;return angular.forEach(t,function(t,a){e+=parseInt(t.quantity,10)}),e}return 0}}function c(t,e,a,r,n,i,o){t.kuaidiSaveAfter=function(a){if(e.closeAll(),a){t.showData.kuaidiSet||(t.showData.kuaidiSet=[]);for(var r=t.showData.kuaidiSet,n=0;n<r.length;n++)if(r[n].id==a.id)return void(r[n]=a);r.push(a)}},t.deleteKuaidi=function(e,a){var o="rest/authen/invoicesOrder/kuaidi/delete",s={kuaidiId:e.id,invoicesOrderId:a};r(o,s,"POST").then(function(a){var r=a[1];n(r.message||"操作成功");for(var i=t.showData.kuaidiSet,o=0;o<i.length;o++)if(i[o].id==e.id)return void i.splice(o,1)})["catch"](function(t){i(t||"出错")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/invoicesOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/invoicesOrder/updateStatus",a={id:t.formData.id,status:"待发货"};r(e,a,"POST").then(function(e){e[1];t.goTo("#/invoicesOrder/order-done.html?id="+t.formData.id)})["catch"](function(t){i(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,$("#"+e).trigger("submit")}}function d(t,e,a,r,n,i,o,s){function l(){o.noticeRefreshTime=(new Date).getTime()}t.noticeClick=function(e){return requestRead(e.id,e),e.readFlag=!0,t.scopeResponse&&t.scopeResponse.totalCount&&t.scopeResponse.totalCount--,e.moduleType&&e.relId?void window.location.assign("#/"+e.moduleType+"/get.html?id="+e.relId):void n(e.subject)},o.startGetMsg=function(){Config.stopIntervalNotice!==!0&&(o.startGetMsgObj||(o.startGetMsgObj=s(function(){l()},1e4)))},o.startGetMsg(),requestRead=function(t,e){var a="rest/authen/notice/read",n={id:t};r(a,n,"POST").then(function(t){l()})["catch"](function(t){})}}function u(t,e,a,r,n,i){t.$watch("initFlag",function(e){if(e&&t.formData.orderMedicalNos)for(var a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleItemClickEvent=function(e){var a=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.handleFlag?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){t.customerName=e.name,t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.taxRate="17",n.batchRequirement="无",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/arrivalNoticeOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/arrivalNoticeOrder/updateStatus",a={id:t.formData.id,status:"待审核"};n(e,a,"POST").then(function(e){e[1];t.goTo("#/arrivalNoticeOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))}}function f(t,e,a,r,n,i){t.isShowPurchaseInfo=!1,t.$watch("initFlag",function(e){var a,r=[],n=[];if(e&&t.scopeData){for(a=0;a<t.scopeData.operationFlowSet.length;a++)t.scopeData.operationFlowSet[a].status==t.scopeData.orderStatus&&(r.push(t.scopeData.operationFlowSet[a].message),n.push(t.scopeData.operationFlowSet[a].key));t.scopeData.operationFlowSet.message=r[r.length-1],t.scopeData.operationFlowSet.key=n[n.length-1]}if(e&&t.formData&&t.formData.operationFlowSet){for(a=0;a<t.formData.operationFlowSet.length;a++)t.formData.operationFlowSet[a].status==t.formData.orderStatus&&(r.push(t.formData.operationFlowSet[a].message),n.push(t.formData.operationFlowSet[a].key));t.formData.operationFlowSet.message=r[r.length-1],t.formData.operationFlowSet.key=n[n.length-1]}if(e&&t.tr&&t.tr.operationFlowSet){for(a=0;a<t.tr.operationFlowSet.length;a++)t.tr.operationFlowSet[a].status==t.tr.orderStatus&&(r.push(t.tr.operationFlowSet[a].message),n.push(t.tr.operationFlowSet[a].key));t.tr.operationFlowSet.message=r[r.length-1],t.tr.operationFlowSet.key=n[n.length-1]}if(e&&t.formData&&e&&t.formData.orderMedicalNos)for(a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.$watch("formData.supplier.id",function(e,a){e&&a&&a!==e&&0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[])}),t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleItemClickEvent=function(e){var a=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.handleFlag?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},e.closeAll(),t.addDataItem={},t.customerAddressReload=function(){t.reloadTime=(new Date).getTime(),e.closeAll()},t.customerAddressGetCallBack=function(t,e){t.customerName=e.name,t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.quantity=e.quantity,i.discountPrice="0",i.discountRate="100",i.strick_price=i.purchasePrice,i.taxRate="17",i.batchRequirement="无",i.relId=r.id,i.strike_price=i.price,i.id=null,!i.relId||!i.name)return a("请选择药品。"),
!1;if(!i.quantity||i.quantity<1)return a("请输入大于0的数量。"),!1;if(i.quantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=采购",c={};n(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.quantity,!0},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.selectRelIdCallBack=function(e){t.addDataItem.relId=e.id,t.addDataItem.name=e.name,t.addDataItem.brand=e.brand,t.addDataItem.unit=e.unit,t.addDataItem.price=e.price,t.addDataItem.strike_price=e.price,t.addDataItem.headUrl=e.headUrl,t.addDataItem.specification=e.specification,t.addDataItem.manufacturer=e.manufacturer,t.addDataItem.handleFlag=!0,t.addDataItem.productionBatch="无",t.addDataItem.dosageForms=e.dosageForms,t.addDataItem.code=e.code,t.addDataItem.productionBatch=e.productionBatch,t.addDataItem.productionDate=e.productionDate,t.addDataItem.guaranteePeriod=e.guaranteePeriod,t.addDataItem.licenseNumber=e.licenseNumber,t.addDataItem.deliveryPlus=e.deliveryPlus,t.addDataItem.drugAdministrationCode=e.drugAdministrationCode,$("#addDataItem_quantity").trigger("focus")},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/purchaseOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=purchaseVoucher&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||r("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/purchaseOrder/startProcessInstance",i={businessKey:t.formData.id};n(a,i,"POST").then(function(e){e[1];t.goTo("#/purchaseOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){if(e.handleFlag){t.choisedMedicals=!0;for(var r=0;r<a.length;r++)if(a[r].handleFlag===!1)return void(t.isChoiseAll=!1);t.isChoiseAll=!0}else{t.isChoiseAll=!1;for(var n=0;n<a.length;n++)if(a[n].handleFlag===!0)return void(t.choisedMedicals=!0);t.choisedMedicals=!1}},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))},t.createPurVoBtnClick=function(e){var a="rest/authen/purchaseVoucher/save",i={purchaseOrderId:e};n(a,i,"POST").then(function(e){var a=e[1].data;console.log(a),t.goTo("#/purchaseVoucher/get.html?id="+a.id)})["catch"](function(t){r(t||"出错")})},t.handleMessageShow=function(t){t.operationFlowSet&&angular.forEach(t.operationFlowSet,function(e,a){e.status===t.orderStatus&&(t.note=e.key)})},t.diffPurchaseNumber=function(e){e&&angular.forEach(e,function(e,a){e.planQuantity>e.quantity?t.isShowPurchaseInfo=!0:t.isShowPurchaseInfo=!1})}}function h(t,e,a,r,n,i){t.logistics=!0,t.$watch("initFlag",function(){var e=[],a=[];if(t.tr.operationFlowSet){for(var r=0;r<t.tr.operationFlowSet.length;r++)t.tr.operationFlowSet[r].status==t.tr.orderStatus&&(e.push(t.tr.operationFlowSet[r].message),a.push(t.tr.operationFlowSet[r].key));return t.tr.operationFlowSet.message=e[e.length-1],void(t.tr.operationFlowSet.key=a[a.length-1])}}),t.$watch("formData.orderBusinessType",function(e){"直运销售"===e&&t.formData.orderMedicalNos.length&&angular.forEach(t.formData.orderMedicalNos,function(t,e){t.handleFlag=!0})}),t.$watch("formData.customerId",function(e,a){e&&a&&a!==e&&(t.logistics=!1,0!==t.formData.orderMedicalNos.length&&(t.formData.orderMedicalNos=[]))}),t.deleteQuantity=function(e){angular.forEach(t.formData.orderMedicalNos,function(t,e){t.quantityAndbatchNumber&&(t.quantityAndbatchNumber="",t.otherQuantity="",t.otherSterilizationBatchNumber="",t.otherWarehouseName="",t.validTill=" ")})},t.submitFormAfter=function(){if("exit"==t.submitForm_type)return void t.goTo("#/confirmOrder/query.html");if("print"==t.submitForm_type){var e="indexOfPrint.html#/print/index.html?key=confirmOrderPrint&id="+t.formData.id;return win1=window.open(e),void(win1&&win1.location||r("被浏览器拦截了，请设置浏览器允许弹出窗口！"))}if("submit"==t.submitForm_type){var a="rest/authen/confirmOrder/startProcessInstance",i={businessKey:t.formData.id};n(a,i,"POST").then(function(e){e[1];t.goTo("#/confirmOrder/get.html?id="+t.formData.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"save"===t.submitForm_type&&t.formData.validFlag===!0&&(t.formData.validFlag=!1),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.caifenQuantity=function(t,e){t.quantity_noInvoice_show=!0,!e||t.quantity<e||(t.quantity_noInvoice&&0!==t.quantity_noInvoice||(t.quantity_noInvoice=t.quantity-e,t.quantity=e),t.quantity<=e&&(t.handleFlag=!0))},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,i=$.extend(!0,{},r);if(i.relId=r.id,i.discountPrice="0",i.discountRate="100",i.strike_price=i.price,i.id=null,i.logistics=!0,i.planQuantity||(i.planQuantity=e.quantity),!i.relId||!i.name)return a("请选择药品。"),!1;if(!e.quantity||e.quantity<1)return a("请输入大于0的数量。"),!1;if(i.planQuantity>r.quantity&&(i.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var o=t.formData.orderMedicalNos.length,s=0;s<o;s++)if(i.relId===t.formData.orderMedicalNos[s].relId)return a("此药械已添加到列表"),!1;if(i.stockBatchs=[],i){var l="rest/authen/historicalPrice/batchGetByrelIds?id="+i.relId+"&type=销售",c={};n(l,c,"GET").then(function(t){var e=t[1].data;for(var a in e)a===i.relId&&e[a]?i.strike_price=e[a].value:i.strike_price=""})["catch"](function(t){t&&console.log(t||"出错!")})}return t.formData.orderMedicalNos.push(i),t.formData.totalPrice+=i.strike_price*i.planQuantity,!0},t.getProductionBatchValueArray=function(t){var e=[];if(!t)return e;for(var a=0;a<t.length;a++)e.push(t[a].batchNumber);return e},t.customerAddressGetCallBack=function(t,e){if(t.customerName=e.name,!e||!e.contacts||0===e.contacts.length)return void(t.contactsId=null);t.contactsId||(t.contactsId=e.defaultContactId);for(var a=!1,r=0;r<e.contacts.length;r++)t.contactsId==e.contacts[r].id&&(a=!0);a||(t.contactsId=e.defaultContactId)},t.invoicesGetCallBack=function(e,a){e.invoicesId||(t.formData.invoicesId=a.defaultContactId);for(var r=a.contacts,n=0;n<r.length;n++)a.defaultContactId===r[n].id&&(e.invoicesContacts=r[n])},t.confirmOrderCalculaTotal=function(e,a){if(e){var r=0;angular.forEach(e,function(t,e){if("普通销售"===a&&t.stockBatchs){for(var n=0,i=0;i<t.stockBatchs.length;i++)n+=t.stockBatchs[i].quantity*t.strike_price*(t.discountRate/100);r+=n}"直运销售"===a&&(r+=t.planQuantity*t.strike_price*(t.discountRate/100))}),t.formData.localTotalPrice=r}}}function m(t,e,a,r,n,i,o){t.isShowCancelBtn=!1,t.isGoNextStep=!1,t.showSaveNoteInfo=!1,t.$watch("initFlag",function(e){if(e){var a="rest/authen/requestPurchaseOrder/isCanClose?id="+t.formData.id;n(a,{},"get").then(function(e){200===e[1].code&&(t.isShowCancelBtn=!0)})}}),e.closeAll(),t.addDataItem={},t.$watch("formData.note",function(e,a){e&&void 0!==a&&o(function(){var e="rest/authen/requestPurchaseOrder/save",a=t.formData;n(e,a,"POST","parameterBody").then(function(e){200===e[1].code&&(t.showSaveNoteInfo=!0)})["catch"](function(t){if(t)throw new Error(t||"出错!")})},1e3)}),t.$watch("showSaveNoteInfo",function(e){e&&o(function(){t.showSaveNoteInfo=!1},1500)}),t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void a("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.quantity=e.quantity,n.discountPrice="0",n.discountRate="100",n.relId=r.id,n.strike_price=n.price,n.id=null,!n.relId||!n.name)return a("请选择药品。"),!1;if(!n.quantity||n.quantity<1)return a("请输入大于0的数量。"),!1;if(n.quantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var i=t.formData.orderMedicalNos.length,o=0;o<i;o++)if(n.relId===t.formData.orderMedicalNos[o].relId)return a("此药械已添加到列表"),!1;return t.formData.orderMedicalNos.push(n),t.formData.totalPrice+=n.strike_price*n.quantity,!0},t.addDataItemClick=function(e,r){if(!e.relId||!e.name)return void a("请选择药品。");if(!e.quantity||e.quantity<1)return void a("请输入大于0的数量。");if(e.quantity>r.quantity&&(e.handleFlag=!1),t.formData.orderMedicalNos.length>0)for(var n=t.formData.orderMedicalNos.length,i=0;i<n;i++)if(e.relId===t.formData.orderMedicalNos[i].relId)return void a("此药械已添加到列表");t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.formData.orderMedicalNos.push(e),t.formData.totalPrice+=e.strike_price*e.quantity,t.addDataItem={},$("input","#addDataItem_relId_chosen").trigger("focus")},t.submitFormAfter=function(){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return void t.goTo("#/requestPurchaseOrder/query.html");if("submit"==t.submitForm_type){var e="rest/authen/requestPurchaseOrder/confirm",a={id:t.formData.id};n(e,a,"POST").then(function(e){var a=e[1];t.goTo("#/purchaseOrder/edit.html?id="+a.data.purchaseOrder.id)})["catch"](function(t){r(t||"出错")})}},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.watchFormChange=function(e){i(e,t)},t.chkChoiseMedicals=function(e,a){function r(t){if(t.length>0){var e=t.every(function(e,a,r){return e===t[0]});return e}}t._supplierArray||(t._supplierArray=[]),e.handleFlag?(t._supplierArray.push(e.supplierId),e.handleFlag=!0,t.isGoNextStep=!!r(t._supplierArray)):(angular.forEach(t._supplierArray,function(a,r){a===e.supplierId&&t._supplierArray.splice(r,1)}),e.handleFlag=!1,t.isGoNextStep=!!r(t._supplierArray))},t.handleChoiseAllEvent=function(e){e&&angular.isArray(e)&&(t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicals=!0}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicals=!1}))}}function p(t,e,a,r,n,i,o,s){t.getCheckUserApplyArr=function(t,e){var a=[];if(!e||0===e.length)return a;for(var r=0;r<t.length;r++)e.indexOf(t[r].id)>-1&&t[r].formData&&a.push(t[r]);return a},t.batchAuditUserApplyOrganization=function(i,o,l,c,d){if(!o||0===o.length)return void a("请先勾选");for(var u=[],f=0;f<i.length;f++)o.indexOf(i[f].id)>-1&&i[f].formData&&(i[f].formData.status=l,i[f].formData.key=c,i[f].formData.message=d,u.push(i[f].formData));var h="rest/authen/distributor/batchAuditUserApplyOrganization",m=s();r(h,u,"POST",!0).then(function(a){m&&m.hide(),n(a[1].msg),t.$broadcast("reloadList"),t.$emit("reloadList"),e.close()})["catch"](function(t){m&&m.hide(),e.close(),a(t)})},o.startGetMsg=function(){o.startGetMsgObj||(o.startGetMsgObj=$interval(function(){o.noticeRefreshTime=(new Date).getTime()},1e4))},o.startGetMsg(),requestRead=function(t,e){var a="rest/authen/notice/read",n={id:t};r(a,n,"POST").then(function(t){})["catch"](function(t){})}}function g(t,e){t.watchFormChange=function(a){e(a,t)}}function v(t,e,a,r,n,i,o,s){}function y(t,e,a,r,n,i){t.$watch("initFlag",function(e){var a,r=[],n=[];if(e&&t.tr&&t.tr.operationFlowSet){for(a=0;a<t.tr.operationFlowSet.length;a++)t.tr.operationFlowSet[a].status==t.tr.orderStatus&&(r.push(t.tr.operationFlowSet[a].message),n.push(t.tr.operationFlowSet[a].key));t.tr.operationFlowSet.message=r[r.length-1],t.tr.operationFlowSet.key=n[n.length-1]}if(t.formData&&e&&t.formData.orderMedicalNos)for(a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1);if(t.formData)for(var i in t.formData.attachments){var o=[];o.push(t.formData.attachments[i]),o[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-enterprise"==t.submitForm_type&&a("rest/authen/firstEnterpriseApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/firstEnterpriseApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/firstEnterpriseApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-medical"==t.submitForm_type&&a("rest/authen/firstMedicalApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/firstMedicalApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/firstMedicalApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-hospital"==t.submitForm_type&&a("rest/authen/hospitalApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/hospitalApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/hospitalApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit-otherCustomer"==t.submitForm_type&&a("rest/authen/otherCustomerApplication/saveBaseInfo",t.formData,"POST","parameterBody").then(function(e){if(200===e[1].code){var r="rest/authen/otherCustomerApplication/startProcessInstance",i={businessKey:t.formData.id};a(r,i,"POST").then(function(e){e[1];t.goTo("#/otherCustomerApplication/get.html?id="+t.formData.id)})["catch"](function(t){n(t||"出错")})}})["catch"](function(t){}),"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.choiceCommodityType=function(e){e.value&&(null===t.formData.commodityType&&(t.formData.commodityType=[]),t.formData.commodityType.push(e.text))},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/hospitalPurchaseMedical/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)})}function D(t,e,a,r,n,i){t.$watch("!initFlag",function(e){var a=[];for(var r in t.scopeData)if(a.push(t.scopeData[r]),t.formData.commodityType)for(j=0;j<t.formData.commodityType.length;j++)t.formData.commodityType[j]==t.scopeData[r].value&&(t.scopeData[r].value=!0)}),t.watchFormChange=function(a){e(a,t)}}function b(t,e,a,r,n,i,o){t._tmpDelList=[],t.$watch("tbodyList",function(e,a){e&&e!==a&&(t.tbodyListChange=!0)}),t.$watch("initFlag",function(e){if(e&&t.formData.orderMedicalNos)for(var a=0;a<t.formData.orderMedicalNos.length;a++)t.formData.orderMedicalNos[a].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[a].handleFlag||(t.isChoiseAll=!1)}),t.watchFormChange=function(a){e(a,t)},t.$watch("tbodyList",function(e,a){e&&e!==a&&(t.changeFlag=!0)},!0),t.modifiedThisMedicalItem=function(e){t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),angular.forEach(t.formData.orderMedicalNos,function(a,r){a.id===e.id&&t.formData.orderMedicalNos.splice(r,1)}),t.formData.orderMedicalNos.push(e)},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.submitFormAfter=function(){t.formData.validFlag=!1,"submit"==t.submitForm_type&&r.goTo("#/hospitalPurchaseContents/get.html?id="+t.formData.id)},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/hospitalPurchaseMedical/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.handleItemClickEvent=function(e){t.changeFlag=!1,e.handleFlag?t._tmpDelList.push(e.id):angular.forEach(t._tmpDelList,function(a,r){a===e.id&&t._tmpDelList.splice(r,1)})},t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){t.changeFlag=!1,t.isChoiseAll?t.tbodyList&&angular.forEach(t.tbodyList,function(e,a){t._tmpDelList.push(e.id)}):(t._tmpDelList=[],t.formData["delete"].ids=[])},t.handleBatchDel=function(){t._tmpDelList.length&&angular.forEach(t._tmpDelList,function(e,a){for(var r=0;r<t.tbodyList.length;r++)e===t.tbodyList[r].id&&t.tbodyList.splice(r,1);t.formData["delete"].ids.push(e),t._tmpDelList=[],t.changeFlag=!0})},t.hospitalPurchaseContents_flashAddDataCallbackFn=function(e){var a;if(!e||!e.data||!e.data.data)return void i("请选择药品");var r=e.data.data,n=$.extend(!0,{},r);if(n.relId=r.id,n.discountPrice="0",n.discountRate="100",n.planQuantity||(n.planQuantity=e.quantity),!n.relId||!n.name)return i("请选择药品。"),!1;if(n.planQuantity>r.quantity&&(n.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),t.tbodyList)for(a=0;a<t.tbodyList.length;a++)if(n.id===t.tbodyList[a].relId)return void i("此药械已添加到列表");if(0!==t.formData.orderMedicalNos.length){var o=t.formData.orderMedicalNos.length;for(a=0;a<o;a++)if(n.relId===t.formData.orderMedicalNos[a].relId)return i("此药械已添加到列表"),!1}return n.stockBatchs=[],t.formData.orderMedicalNos.push(n),t.tbodyList&&t.tbodyList.push(n),t.formData.totalPrice+=n.strike_price*n.planQuantity,!0}}function w(t,e,a,r,n,i){t.$watch("initFlag",function(e){var a=[],r=[];if(t.showData){if(t.showData.operationFlowSet)for(var n=0;n<t.showData.operationFlowSet.length;n++)t.showData.operationFlowSet[n].status==t.showData.businessApplication.businessStatus&&(a.push(t.showData.operationFlowSet[n].message),r.push(t.showData.operationFlowSet[n].key));return t.showData.operationFlowSet.message=a[a.length-1],void(t.showData.operationFlowSet.key=r[r.length-1])}if(e&&t.formData.orderMedicalNos)for(j=0;j<t.formData.orderMedicalNos.length;j++)t.formData.orderMedicalNos[j].handleFlag&&(t.choisedMedicals=!0),t.formData.orderMedicalNos[j].handleFlag||(t.isChoiseAll=!1);if(t.formData)for(var i in t.formData.attachments){var o=[];o.push(t.formData.attachments[i]),o[0].certificateNumber?(console.log(o[0].certificateNumber),o[0].isAdmin=!1):o[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-medical"==t.submitForm_type&&(a("rest/authen/medicalStock/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/medicalStock/get.html?id="+t.formData.id)),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.medical.isBasicMedicine="是",r.purchasePrice=r.price,a("rest/authen/medicalStock/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void i("请选择药品");var a=e.data.data,r=$.extend(!0,{},a);if(r.relId=a.id,r.discountPrice="0",r.discountRate="100",r.id=null,r.planQuantity||(r.planQuantity=e.quantity),!r.relId||!r.name)return i("请选择药品。"),!1;if(r.planQuantity>a.quantity&&(r.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,o=0;o<n;o++)if(r.relId===t.formData.orderMedicalNos[o].relId)return i("此药械已添加到列表"),!1;return r.stockBatchs=[],t.formData.orderMedicalNos.push(r),t.formData.totalPrice+=r.strike_price*r.planQuantity,!0}}function C(t,e,a,r,n,i){t.$watch("initFlag",function(){var e=[],a=[];if(t.showData){if(t.showData.operationFlowSet)for(var r=0;r<t.showData.operationFlowSet.length;r++)t.showData.operationFlowSet[r].status==t.showData.businessApplication.businessStatus&&(e.push(t.showData.operationFlowSet[r].message),a.push(t.showData.operationFlowSet[r].key));return t.showData.operationFlowSet.message=e[e.length-1],void(t.showData.operationFlowSet.key=a[a.length-1])}if(t.formData)for(var n in t.formData.attachments){var i=[];i.push(t.formData.attachments[n]),i[0].certificateNumber?(console.log(i[0].certificateNumber),i[0].isAdmin=!1):i[0].isAdmin=!0}}),t.watchFormChange=function(a){e(a,t)},t.submitForm=function(e,r){t.submitForm_type=r,"submit-hospital"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/hospitalManagement/get.html?id="+t.formData.id)),"submit-supplier"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/supplier/get.html?id="+t.formData.id)),"submit-otherCustomer"==t.submitForm_type&&(a("rest/authen/customerAddress/save",t.formData,"POST","parameterBody").then(function(t){200===t[1].code})["catch"](function(t){}),t.formData.validFlag=!1,t.goTo("#/otherCustomerManagement/get.html?id="+t.formData.id)),$("#"+e).trigger("submit")},t.submitFormAfter=function(e){"submit"===t.submitForm_type&&t.goTo(e+"?id="+t.formData.id)},t.choiceCommodityType=function(e){e.value&&(null==t.formData.commodityType&&(t.formData.commodityType=[]),t.formData.commodityType.push(e.text))},t.showAuditOpinion=function(t,e){if(angular.isArray(t)){var a,r;for(r=t.length,a=0;a<r;a++)if(t[a].event.status!==e)return!0;return!1}},t.addMedicinalDataItem=function(e){if(!t.medical||!t.medical.id)return void i("请选择药械");var r=$.extend(!0,{},t.medical);r.hospitalId=e,r.relId=t.medical.id,r.id=null,r.purchasePrice=r.price,a("rest/authen/customerAddress/save",r,"POST","parameterBody").then(function(e){200===e[1].code?t.$broadcast("reloadList"):n("出错!")})["catch"](function(t){n("此药械已添加")})},t.chkQuoteAndRetail=function(){t.formData.firstMedical.quoteprice&&t.$watch(t.formData.firstMedical.retailPrice,function(){parseInt(t.formData.firstMedical.retailPrice)>parseInt(t.formData.firstMedical.quoteprice)&&i("当前输入的零售价大于输入的牌价!")})},t.$watch("listParams.guaranteePeriod",function(e){void 0!==e&&(t.showData.guaranteePeriod=e,a("rest/authen/customerAddress/save",t.showData,"POST","parameter-body").then(function(t){})["catch"](function(t){t&&n(t||"出错")}))}),t.$watch("formData.firstMedical.isBasicMedicine",function(e){"否"===e&&(t.formData.firstMedical.quoteprice=0)}),t.isChoiseAll=function(e){e?angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag||(t.handleFlag=!0)}):angular.forEach(t.orderMedicalNos,function(t,e){t.handleFlag&&(t.handleFlag=!1)})},t.handleChoiseAllEvent=function(){var e=t.formData.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.handleFlag=!0,t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.choisedMedicalList=[]})},t.flashAddDataCallbackFn=function(e){if(!e||!e.data||!e.data.data)return void i("请选择药品");var a=e.data.data,r=$.extend(!0,{},a);if(r.relId=a.id,r.discountPrice="0",r.discountRate="100",r.id=null,r.planQuantity||(r.planQuantity=e.quantity),!r.relId||!r.name)return i("请选择药品。"),!1;if(r.planQuantity>a.quantity&&(r.handleFlag=!1),t.formData.orderMedicalNos||(t.formData.orderMedicalNos=[]),0!==t.formData.orderMedicalNos.length)for(var n=t.formData.orderMedicalNos.length,o=0;o<n;o++)if(r.relId===t.formData.orderMedicalNos[o].relId)return i("此药械已添加到列表"),!1;return r.stockBatchs=[],t.formData.orderMedicalNos.push(r),t.formData.totalPrice+=r.strike_price*r.planQuantity,!0}}function k(t,e,a,r,n,i,o){function s(t,e,a){for(var r=0;r<t.length;r++)t[r].sourceRef==e&&(t[r].sourceRef=a),t[r].targetRef==e&&(t[r].targetRef=a)}t.switchButtons=function(t,e,a){var r=t[e];t[e]=t[a],t[a]=r},t.addEventButtons=function(t){t||(t={}),t.buttons||(t.buttons=[]);var e={type:"通过",buttonName:"审核通过",requestMethod:"POST",conditionType:"通过",requestParam:"KeyValue",requestUrl:"rest/authen/workflowTask/run.json"};t.buttons.push(e)},t.saveEvent=function(a){t.formData.events||(t.formData.events=[]);var r=t.formData.events,n=!0;if(a.conditionType||(a.conditionType=null),a.id){var i=o.utils.getObjectIndexByKeyOfArr(r,"id",a.id);a.id!=a.name&&s(r,a.id,a.name),a.id=a.name,i>-1&&(r[i]=a,n=!1)}n&&(a.id=a.name,r.push(a)),console.log(a),e.closeAll()},t.deleteEvent=function(a){t.formData.events||(t.formData.events=[]);var r=t.formData.events,n=o.utils.removeObjectByKeyOfArr(r,"id",a);return n<0?void i("没有该节点，id="+event1.id):(s(r,a,null),void e.closeAll())}}function I(t,e,a,r,n){t.$watch("tr.strike_price",function(e,a){e!==a&&(t.tr.discountPrice=0,t.tr.discountRate=100)}),t.getCurrentProductionDate=function(e,a){if(e&&a){var i="rest/authen/medicalStock/getStockBatch?relMedicalStockId="+e+"&p_and_s="+a,o={};n(i,o,"get").then(function(e){var a=e[1];t.tr.productionDate=a.data.productionDate,t.tr.validTill=a.data.validTill})["catch"](function(t){r(t||"出错")})}}}function S(t,e,a,r,n){t.deleteUploader=function(t){if(t){var e="rest/authen/fileUpload/delete",a={key:t};n(e,a,"post").then(function(t){})["catch"](function(t){r(t||"出错")})}}}function M(t){t.tr.operationFlowSet&&angular.forEach(t.tr.operationFlowSet,function(e,a){"待付款"===e.status&&(t.tr.approvalPayUser=e)})}function F(t,e,a,r,n,i,o,s){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.submitFormAfter=function(e){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return t.goTo("#/saleReturnOrder/query.html"),void o(scopeResponse.msg);if("submit"==t.submitForm_type){var r="rest/authen/saleReturnOrder/startProcessInstance",i={businessKey:t.formData.id};return void n(r,i,"POST").then(function(e){200!==e[1].code?a(e[1].msg||"未知错误!"):t.goTo("#/saleReturnOrder/get.html?id="+t.formData.id)})["catch"](function(t){if(t)return void a(t||"未知错误!")})}"save"==t.submitForm_type},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit")},t.cancelForm=function(t,e){a("cancelForm")}}function A(t,e,a,r,n,i,o,s){t.watchFormChange=function(e){r(e,t)},e.closeAll(),t.addDataItem={},t.submitFormAfter=function(e){if(t.formData.validFlag=!1,"exit"==t.submitForm_type)return t.goTo("#/purchaseReturnOrder/query.html"),void o(e.msg);if("submit"==t.submitForm_type){var r="rest/authen/purchaseReturnOrder/startProcessInstance",i={businessKey:t.formData.id};return console.log(t.formData),void n(r,i,"POST").then(function(e){200!==e[1].code?a(e[1].msg||"未知错误!"):t.goTo("#/purchaseReturnOrder/get.html?id="+t.formData.id)})["catch"](function(t){if(t)return void a(t||"未知错误!")})}"save"==t.submitForm_type&&e&&o(e.msg)},t.canSubmitForm=function(){for(var e=t.formData.orderMedicalNos,a=0;a<e.length;a++)if(e[a].handleFlag)return!0;return!1},t.submitForm=function(e,a){t.submitForm_type=a,"submit"==t.submitForm_type&&(t.formData.validFlag=!0),$("#"+e).trigger("submit");
},t.cancelForm=function(t,e){a("cancelForm")}}function O(t,e,a,r,n,i){t.addDataObj={},t.hasReturnList=!1,t.$watch("addDataObj.orderMedicalNos",function(e){e&&(t.hasReturnList=!1,angular.forEach(e,function(e,a,r){0!==e.returnQuantity&&(t.hasReturnList=!0)}))}),t.initChoisedMedicalList=function(e,a){var r=[],n=0;return e?(angular.forEach(e,function(e,i){if(a)for(var o=0;o<a.length;o++)e.relId===a[o].relId&&e.productionBatch===a[o].productionBatch&&e.sterilizationBatchNumber===a[o].sterilizationBatchNumber&&(e.itemSelected=!0,r.push(e),n++);e.itemSelected||(t.isChoiseAll=!1)}),n===e.length&&(t.isChoiseAll=!0),r):r},t.handleItemClickEvent=function(e){var a=t.addDataObj.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),e.itemSelected?(t.choisedMedicalList.push(e),t.choisedMedicalList.length===a.length&&(t.isChoiseAll=!0)):(angular.forEach(t.choisedMedicalList,function(a,r){a.relId===e.relId&&a.productionBatch===e.productionBatch&&a.sterilizationBatchNumber===e.sterilizationBatchNumber&&t.choisedMedicalList.splice(r,1)}),t.isChoiseAll=!1)},t.handleChoiseAllEvent=function(){t.choisedMedicalList=[];var e=t.addDataObj.orderMedicalNos;t.choisedMedicalList||(t.choisedMedicalList=[]),t.isChoiseAll?angular.forEach(e,function(e,a){e.itemSelected=!0,0!==e.returnQuantity&&t.choisedMedicalList.push(e)}):angular.forEach(e,function(e,a){e.itemSelected=!1,t.choisedMedicalList=[]})},t.handleAddData=function(e,r,o,s){if(e&&r&&o&&0!==o.length){t.formData.salesDepartmentId=s.salesDepartmentId,t.formData.salesDepartmentName=s.salesDepartmentName,t.formData.purchaseType=s.purchaseType,t.formData.orderBusinessType=s.orderBusinessType,t.formData.saleUser=s.saleUser,t.formData.relId=e,t.formData.orderMedicalNos=[];var l={arrivalNoticeOrderNo:"",orderMedicalNoSet:[]};l.arrivalNoticeOrderNo=r,angular.forEach(o,function(t,e){l.orderMedicalNoSet.push(t)});var c="rest/authen/purchaseReturnOrder/splitOrderMedicalNos";n(c,l,"POST","parameter-body").then(function(e){var r=e[1].data;angular.forEach(r,function(e,a){t.formData.orderMedicalNos.push(e)}),a.closeAll()})["catch"](function(t){t&&i(t||"出错")})}},t.handleAddDataArray=function(e,n,i){if(e&&n&&0!==n.length){if(t.formData.orderMedicalNos.length?(t.formData.orderMedicalNos=[],t.formData.orderMedicalNos=n):(t.formData.relId=e,t.formData.orderMedicalNos=n),t.formData.salesDepartmentId=i.salesDepartmentId,t.formData.salesDepartmentName=i.salesDepartmentName,t.formData.salesType=i.salesType,t.formData.orderBusinessType=i.orderBusinessType,t.formData.saleUser=i.saleUser,t.formData.relId!=e)t.formData.orderMedicalNos=[];else for(var o=t.formData.orderMedicalNos.length-1;o>=0;o--){var s=t.formData.orderMedicalNos[o];r.getObjectIndexByKeyOfArr(n,"relId",s.relId)==-1&&t.formData.orderMedicalNos.splice(o,1)}a.closeAll()}}}function T(t){t.quantityError=!1,t.$watch("item.quantity",function(e){t.item.returnQuantity>=0&&(e>t.item.returnQuantity?(t.quantityError=!0,t.$parent.$parent.quantityError=!0):(t.quantityError=!1,t.$parent.$parent.quantityError=!1))})}function P(t,e,a){t.saveExpressInfo=function(t){var r=angular.isObject(t)?t:"",n="rest/authen/wOutstockOrder/kuaidi/save";r&&e(n,r,"POST").then(function(t){200===t[1].code&&a.goOrRefreshHref()})["catch"](function(t){console.log(t||"出错")})},t.editThisAreaInfo=function(e){t.addAreaisShow=!0,t.formData.type=e.type,t.formData.nu=e.nu,t.formData.id=e.id}}function N(t,e){var a=t.dialogData.kuaidiSet,r="rest/index/kuaidi/query2.json";t.expressInfoArray=[],angular.forEach(a,function(a,n){e(r+"?type="+a.type+"&nu="+a.nu,{},"get").then(function(e){var r=e[1];r.index=n,r.type=a.type,r.nu=a.nu,t.expressInfoArray.push(r)})})}function x(t,e){}function q(t,e){t.relMedicalStockIdSet="",t.handleChoiseAllEvent=function(e){t.isChoiseAll&&angular.isArray(e)?angular.forEach(e,function(e,a){e.handleFlag=!0,t.relMedicalStockIdSet?t.relMedicalStockIdSet+=","+e.id:t.relMedicalStockIdSet+=e.id}):angular.forEach(e,function(e,a){e.handleFlag=!1,t.relMedicalStockIdSet=""})},t.handleItemClickEvent=function(e,a){if(e.handleFlag){var r=e.supplierId;angular.forEach(a,function(t,e){t.supplierId!==r&&(t.isCloseChiose=!0)}),t.relMedicalStockIdSet?t.relMedicalStockIdSet+=","+e.id:t.relMedicalStockIdSet+=e.id}else{var n=t.relMedicalStockIdSet.split(",");angular.forEach(n,function(t,a){if(t===e.id)return n.splice(a,1),!1}),t.relMedicalStockIdSet=n.toString(),t.relMedicalStockIdSet||angular.forEach(a,function(t,e){t.isCloseChiose=!1})}}}function _(t,e){t.choiseThisItem=function(e,a){t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(t,r){t.relId===a&&(t.strike_price=e.value)})}}function E(t,e,a){t.$watchCollection("listParams",function(e,r){if(t.listParams){t.dialogData.sourceId&&(t.listParams.warehouseId=t.dialogData.sourceId);var n="rest/authen/medicalStock/queryStockBatch",i={relMedicalStockId:t.dialogData.id,logisticsCenterId:t.dialogData.logisticsCenterId,warehouseId:t.listParams.warehouseId,createAtBeg:t.listParams.createAtBeg,createAtEnd:t.listParams.createAtEnd,q:t.listParams.q};a(n,i,"GET").then(function(e){e[1].data&&(t.stockBatchList=e[1].data)})}}),t.chkCurrentBtachAdded=function(t,e){if(angular.isArray(t)&&angular.isArray(e)){var a,r,n=t.length,i=e.length;for(a=0;a<n;a++)for(r=0;r<i;r++)t[a].productionBatch==i[r].batchNumber&&t[a].stockModel.salesQuantity==i[r].quantity&&(t[a].choised=!0)}},t.choseBatch=function(e,a){var r={stockBatchId:e.id,batchNumber:e.productionBatch,quantity:e.stockModel.salesQuantity,productionBatch:e.productionBatch,validTill:e.validTill,sterilizationBatchNumber:e.sterilizationBatchNumber,warehouseName:e.warehouseName,warehouseId:e.warehouseId,warehouseType:e.warehouseType},n=0;t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(t,e){if(t.stockBatchs)for(var a=0;a<t.stockBatchs.length;a++)t.stockBatchs[a].batchNumber&&(n+=parseInt(t.stockBatchs[a].quantity,10))}),e.stockModel.salesQuantity+n>t.dialogData.planQuantity&&(r.quantity=t.dialogData.planQuantity-n),t.formData.orderMedicalNos&&angular.forEach(t.formData.orderMedicalNos,function(e,n){e.relId==a&&t.formData.orderMedicalNos[n].stockBatchs.push(r)})}}function B(t,e){t.queryItemClick=function(t){var a="#/otherOutstockOrder/get.html?orderNo=";switch(t.type){case"采购入库单":a="#/purchaseInstockOrder/get.html?orderNo=";break;case"采购入库单_红字":a="#/purchaseInstockOrder/get.html?orderNo=";break;case"销售出库单":a="#/saleOutstockOrder/get.html?orderNo=";break;case"销售出库单_红字":a="#/saleOutstockOrder/get.html?orderNo=";break;default:a=t.inoutType?"出库"==t.inoutType?"#/otherOutstockOrder/get.html?orderNo=":"#/otherInstockOrder/get.html?orderNo=":t.type.indexOf("出")>-1?"#/otherOutstockOrder/get.html?orderNo=":"#/otherInstockOrder/get.html?orderNo="}return a+=t.orderNo,e.goTo(a),a}}function L(t){t.buildMapping=function(e,a,r){if(t.formData[a]&&t.formData[r]){if(t.formData[e]){var n=Object.keys(t.formData[e]);if(n.indexOf(t.formData[a])!=-1)return void alert("选择的属性已存在");for(var i in t.formData[e])if(t.formData[e][i]==t.formData[r])return void alert("选择的值已存在")}t.formData[e][t.formData[a]]=t.formData[r],t.formData[e]&&(t.formData[a]="",t.formData[r]="")}},t.initExtendedAttribute=function(e){if(angular.isObject(e)){t.extendedAttrList=[];for(var a in e){var r={name:a,val:e[a]};t.extendedAttrList.push(r)}}},t.handleChoiseEvent=function(e,a){angular.forEach(e,function(e,r){a==e.name&&(t.formData.extendedAttributeValue=e.val)})},t.saveExtendedAttribute=function(){for(var e in t.formData.extendedAttribute)e==t.formData.extendedAttributeKey.name&&(t.formData.extendedAttribute[e]=t.formData.extendedAttributeValue)}}angular.module("manageApp.project").controller("infrastructureController",["$scope",L]).controller("inoutstockDetailQueryCtr",["$scope","utils",B]).controller("historicalPriceController",["$scope","utils",_]).controller("editStockbatchNumberCtrl",["$scope","utils","requestData",E]).controller("indexPurchaseSuppleController",["$scope","utils",q]).controller("indexPageController",["$scope","utils",x]).controller("getAllExpressController",["$scope","requestData",N]).controller("saleOutstockOrderController",["$scope","requestData","utils",P]).controller("imTaobaoCtr",["$scope","requestData","alertError","$rootScope",t]).controller("saleReturnMedicalItemController",["$scope",T]).controller("returnOrderAddController",["$scope","$rootScope","modal","utils","requestData","alertError",O]).controller("mainCtrlProject",["$scope","$rootScope","$http","$location","store","utils","modal","OPrinter","UICustomTable","bottomButtonList","saleOrderUtils","purchaseOrderUtils","requestPurchaseOrderUtils","queryItemCardButtonList","customMenuUtils",e]).controller("ScreenFinanceApprovalController",["$scope",M]).controller("ConfirmOrderMedicalController",["$scope",l]).controller("confirmOrderEditCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError",o]).controller("confirmOrderEditCtrl2",["$scope","modal","alertWarn","requestData","alertOk","alertError","watchFormChange","saleOrderUtils",s]).controller("SalesOrderDetailsController",["$scope","$timeout","alertOk","alertError","requestData",I]).controller("editWorkFlowProcessCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope",k]).controller("QualificationApplyCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",y]).controller("SelectedCommodityEditCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",D]).controller("hospitalPurchaseContentsCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn","$timeout",b]).controller("medicalStockCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",w]).controller("customerAddressCtrl",["$scope","watchFormChange","requestData","utils","alertError","alertWarn",C]).controller("watchFormCtrl",["$scope","watchFormChange",g]).controller("intervalCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",v]).controller("auditUserApplyOrganizationCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","proLoading",p]).controller("purchaseOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",f]).controller("allocateOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",h]).controller("arrivalNoticeOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange",u]).controller("requestPurchaseOrderEditCtrl",["$scope","modal","alertWarn","alertError","requestData","watchFormChange","$timeout",m]).controller("noticeCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$rootScope","$interval",d]).controller("invoicesOrderCtrl",["$scope","modal","alertWarn","requestData","alertOk","alertError","$timeout",c]).controller("salesOrderEditCtrl2",["$scope","modal","alertWarn","watchFormChange","requestData",r]).controller("salesOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",a]).controller("freezeThawOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",i]).controller("lossOverOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange",n]).controller("returnOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange","requestData","$rootScope","alertOk","utils",F]).controller("purchasereturnOrderEditCtrl",["$scope","modal","alertWarn","watchFormChange","requestData","$rootScope","alertOk","utils",A]).controller("deleteUploaderController",["$scope","$timeout","alertOk","alertError","requestData",S])}),define("project/directives",["project/init"],function(){function t(t,e){return{restrict:"EA",scope:{ngModel:"="},templateUrl:Config.tplPath+"tpl/project/textareaJson.html",link:function(a,r,n){a.jsonFromNgModel=function(){try{a.jsonString=JSON.stringify(a.ngModel,null,"\t")}catch(e){console.log(e),a.jsonString=t.toJson(a.ngModel)}},a.jsonToNgModel=function(r){try{t.replaceObject(a.ngModel,$.parseJSON(r)),a.jsonString=""}catch(n){console.log(n),e("转换错误："+n.message)}}}}}function e(){return{restrict:"EA",scope:{ngModel:"=",openButtonId:"@?",divId:"@"},templateUrl:Config.tplPath+"tpl/project/htmlEdit.html",link:function(t,e,a){t.htmlFromDivId=function(){t._htmlString=$("#"+t.divId).html()},t.openButtonId&&$("#"+t.openButtonId).on("click",function(e){t.htmlFromDivId(),t.$digest()}),t.cancel=function(){t._htmlString="",t.ngModel=t._htmlString},t.htmlToNgModel=function(){t._htmlString=t.umeditor.getContent(),console.log("$scope._htmlString",t._htmlString),t.ngModel=t._htmlString,t._htmlString=""}}}}function a(){return{restrict:"EA",scope:{attachmentsItemExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsItemShow.html"}}function r(){return{restrict:"EA",scope:{attachmentsExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsShow.html"}}function n(){return{restrict:"EA",scope:{attachmentsExtend:"=",ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/attachmentsEdit.html"}}function i(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNos.html"}}function o(){return{restrict:"EA",scope:{ngModel:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/orderMedicalNosOfPurchaseOrder.html"}}function s(t){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowRejectButton.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu))}}}function l(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowPassButton.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu)),r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxParameterBody&&(e.beforeAjaxParameterBody=r.beforeAjaxParameterBody),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function c(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},replace:!0,templateUrl:Config.tplPath+"tpl/project/workflowButtonQueryCard.html",link:function(e,a,r){r.customMenu&&(e.customMenu=t.fromJson(r.customMenu)),r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxParameterBody&&(e.beforeAjaxParameterBody=r.beforeAjaxParameterBody),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function d(t){return{restrict:"EA",scope:{beforeAjaxParams:"=?",beforeIfEval:"=?"},templateUrl:Config.tplPath+"tpl/project/customMenuList.html",link:function(e,a,r){r.customMenuArr?e.customMenuArr=t.fromJson(r.customMenuArr):e.customMenuArr=r.customMenuArr,r.passCallback&&(e.passCallback=r.passCallback),r.beforeAjaxUrlSubmit&&(e.beforeAjaxUrlSubmit=r.beforeAjaxUrlSubmit)}}}function u(t){return{restrict:"EA",scope:{workflowBottomButton:"=?"},templateUrl:Config.tplPath+"tpl/project/workflowTaskRunWithAttchments.html",link:function(e,a,r){r.customMenuArr?e.customMenuArr=t.fromJson(r.customMenuArr):e.customMenuArr=r.customMenuArr,r.returnButton&&(e.returnButton=t.fromJson(r.returnButton)),e.attchmentUsege=r.attchmentUsege,e.passButton=t.getcustomMenuByKeyOfArr(e.customMenuArr,"通过"),e.rejectButton=t.getcustomMenuByKeyOfArr(e.customMenuArr,"驳回"),e.showButton=e.passButton||e.rejectButton,e.showButton&&(e.formData=e.showButton.params),e.formData||(e.formData={}),e.formData.attachments=[],e.scopeExtend={},console.log(e.customMenuArr)}}}function f(){"use strict";return{restrict:"A",link:function(t,e,a){require(["nicescroll"],function(){$("html").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"6",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0",zindex:"1000"}),$("#page-side").niceScroll({styler:"fb",cursorcolor:"#65cea7",cursorwidth:"3",cursorborderradius:"0px",background:"#424f63",spacebarenabled:!1,cursorborder:"0"}),$("#page-side").getNiceScroll(),$("body").hasClass("left-side-collapsed")&&$("#page-side").getNiceScroll().hide()})}}}function h(t){"use strict";return{restrict:"A",link:function(e,a,r){function n(t){var e=$(t);e.addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})}var i=t.path().split("/")[1];r.leftMenuChange&&r.leftMenuChange===i&&n(a),a.on("click",function(t){t.stopPropagation(),n(a)})}}}function m(t){"use strict";return{restrict:"A",link:function(e,a,r){0===$(a).next(".sub-menu-list").length&&t.absUrl().indexOf(r.href)!==-1&&$(a).parent().addClass("active").siblings().each(function(){$(this).removeClass("active")}),$(a).on("click",function(t){t&&t.stopPropagation&&t.stopPropagation();var e=$(this).parent();if(0!==$(this).next(".sub-menu-list").length){var a=$(this).next(".sub-menu-list");a.is(":visible")?a.slideUp(200,function(){$(this).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}):a.slideDown(200,function(){e.siblings().each(function(){$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200).prev().find("span.pr-arrow-up").removeClass("pr-arrow-up").addClass("pr-arrow-down")}),$(this).prev().find("span.pr-arrow-down").removeClass("pr-arrow-down").addClass("pr-arrow-up")})}else e.addClass("active").siblings().each(function(){$(this).removeClass("active").find(".sub-menu-list > li").each(function(){$(this).removeClass("active")}),$(this).children(".sub-menu-list").is(":visible")&&$(this).children(".sub-menu-list").hide(200)})})}}}function p(){"use strict";return{restrict:"A",link:function(t,e,a){e.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function g(){return{restrict:"EA",scope:{ngModel:"=",countMap:"="},require:"ngModel",replace:!0,templateUrl:Config.tplPath+"tpl/project/queryOrderStatusButton.html",link:function(t,e,a,r){t.key=a.key,t.showName=t.key,a.showName&&(t.showName=a.showName),e.on("click",function(){$(this).addClass("pr-btn-bg-gold").siblings().each(function(){$(this).removeClass("pr-btn-bg-gold")}),$(this).parent().siblings().each(function(){$(this).children().each(function(){$(this).removeClass("pr-btn-bg-gold")})})})}}}function v(){"use strict";return{restrict:"A",link:function(t,e,a){e.on("click",function(){$(this).hide(),$(this).siblings().show().on("click",function(){$(this).hide(),$(e).show()})})}}}function y(){"use strict";return{restrict:"A",link:function(t,e,a){$(".toggle-btn").on("click",function(){$(".left-side").getNiceScroll().hide(),$("body").hasClass("left-side-collapsed")&&$(".left-side").getNiceScroll().hide();var t=$("body"),e=t.css("position");"relative"!=e?t.hasClass("left-side-collapsed")?(t.removeClass("left-side-collapsed chat-view"),$(".custom-nav li.active ul").css({display:"block"}),$(this).removeClass("menu-collapsed")):(t.addClass("left-side-collapsed"),$(".custom-nav ul").attr("style",""),$(this).addClass("menu-collapsed")):t.hasClass("left-side-show")?t.removeClass("left-side-show"):(t.addClass("left-side-show"),mainContentHeightAdjust())})}}}function D(){"use strict";return{restrict:"A",link:function(t,e,a){$(e).on("click",function(t){if(t.stopPropagation(),$(this).hasClass("fa-times"))$(this).parents(".panel").parent().remove();else{var e=$(this).parents(".panel").children(".panel-body");$(this).hasClass("fa-chevron-up")?($(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"),e.slideUp(200)):($(this).removeClass("fa-chevron-down").addClass("fa-chevron-up"),e.slideDown(200))}})}}}function b(){"use strict";return{restrict:"A",link:function(t,e,a){require(["morris"],function(){var t=a.id,e=[];if(angular.isDefined(a.datavalue)&&angular.isDefined(a.datalabel)&&angular.isDefined(a.dataformatted))for(var r={},n=0,i=a.datavalue.split(","),o=a.datalabel.split(","),s=a.dataformatted.split(",");n<i.length;)r.value=i[n],r.label=o[n],r.formatted=s[n],e.push(r),r={},n++;var l=!!angular.isDefined(a.backgroundColor)&&a.backgroundColor,c=angular.isDefined(a.labelColor)?a.labelColor:"#666",d=angular.isDefined(a.colors)?a.colors.split(","):["#ff5f39","#fe9302","#e39a27"];Morris.Donut({element:t,data:e,backgroundColor:l,labelColor:c,colors:d,formatter:function(t,e){return e.formatted}})})}}}function w(){"use strict";return{restrict:"A",link:function(t,e,a){require(["icheck"],function(){$(e).children().iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square",increaseArea:"20%"})})}}}function C(){"use strict";return{restrict:"A",link:function(t,e,a){require(["sparkline"],function(){$(".sparkline").each(function(){var t=$(this).data();t.valueSpots={"0:":t.spotColor},$(this).sparkline(t.data||"html",t,{tooltipFormat:'<span style="display:block; padding:0px 10px 12px 0px;"><span style="color: {{color}}">&#9679;</span> {{offset:names}} ({{percent.1}}%)</span>'})}),$("#income").sparkline([5,6,7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#expense").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#expense2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#pro-refund").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#ffffff"}),$("#p-lead-1").sparkline([7,5,9,6,4,9,8,5,6,7],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#65cea7"}),$("#p-lead-2").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#fc8675"}),$("#p-lead-3").sparkline([3,2,5,8,4,7,5,8,4,6],{type:"bar",height:"35",barWidth:5,barSpacing:2,barColor:"#5ab5de"}),$("#visit-1").sparkline([5,6,7,9,9,5,3,2,4,6,7,5,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"}),$("#visit-2").sparkline([5,6,7,7,9,5,8,5,4,6,7,8,6,8,7,9,5],{type:"line",width:"100",height:"25",lineColor:"#55accc",fillColor:"#edf7f9"})})}}}function k(){"use strcit";return{restrict:"A",link:function(t,e,a){$("[data-toggle='tooltip']").tooltip()}}}function I(t){"use strict";return{restrict:"A",link:function(t,e,a){var r=$(e).next();$(e).hover(function(){r.show()},function(){r.hide()}),r.hover(function(){$(this).show()},function(){$(this).hide()})}}}function S(t,e,a,r,n,i){"use strict";return{restrict:"A",link:function(o,s,l){s.on("click",function(){function s(){if(l.callbackScopeKey){var t=i.getAppointScope(o,l.callbackScopeKey);null!==t&&(l.callback&&t.$eval(l.callback),l.callBack&&t.$eval(l.callBack))}l.callback&&o.$eval(l.callback),l.parentCallback&&o.$parent.$eval(l.parentCallback)}function c(){function t(t){var e=t[1];if(200===e.code&&r(e.msg||"操作成功"),l.$scopeData&&(o[l.$scopeData]=data),s(),l.emitted)if(l.emitted.indexOf(",")!==-1){var a=l.emitted.split(","),n=a.length,i=0;for(i=0;i<n;i++)o.$emit(a[i])}else o.$emit(l.emitted)}var e=!1;angular.isDefined(l.parameterBody)&&(e=!0,"false"==l.parameterBody&&(e=!1));var i="POST";if(l.httpMethod&&(i=l.httpMethod),!l.requestUrl)return void s();var c=l.requestUrl,d={};return l.params&&0===l.params.indexOf("{")&&(d=o.$eval(l.params)),void a(c,d,i,e).then(t)["catch"](function(t){n(t||"出错")})}function d(){function t(t){t[1];c()}var e=!1;angular.isDefined(l.beforeAjaxParameterBody)&&(e=!0,"false"==l.parameterBody&&(e=!1));var r="POST";l.beforeAjaxHttpMethod&&(r=l.beforeAjaxHttpMethod);var i=l.beforeAjaxUrlSubmit,s={};return l.beforeAjaxParams&&(s=0===l.beforeAjaxParams.indexOf("{")?o.$eval(l.beforeAjaxParams):o[l.beforeAjaxParams]),void a(i,s,r,e).then(t)["catch"](function(t){n(t||"出错")})}var u=angular.isDefined(l.dialogTitle)?l.dialogTitle:"询问对话框",f=angular.isDefined(l.dialogContent)?l.dialogContent:"",h=angular.isDefined(l.dialogTemplate)?l.dialogTemplate:"tpl/dialog-confirm.html",m=angular.isDefined(l.jumpUrl)?l.jumpUrl:"",p=(angular.isDefined(l.requestUrl)?l.requestUrl:"",angular.isDefined(l.confirmBtnTxt)?l.confirmBtnTxt:"确定"),g=angular.isDefined(l.cancelBtnTxt)?l.cancelBtnTxt:"取消";if("pr-dialog-return.html"==h&&(angular.isDefined(l.dialogTitle)||(u="取消修改?"),angular.isDefined(l.dialogContent)||(f="有修改还未保存,是否保存?")),"false"==l.alertConfirm){if(angular.isDefined(l.beforeIfEval)&&l.beforeAjaxUrlSubmit){var v=o.$eval(l.beforeIfEval);if(v)return void d()}return void c()}e(f,function(e,a){if("cancel"==e)return void(l.cancelCallback&&o.$eval(l.cancelCallback));if("nosave"==e)return l.nosaveCallback&&o.$eval(l.nosaveCallback),void(l.parentNosaveCallback&&o.$parent.$eval(l.parentNosaveCallback));if("save"==e)return l.saveCallback&&o.$eval(l.saveCallback),void(l.parentSaveCallback&&o.$parent.$eval(l.parentSaveCallback));if(angular.isDefined(l.jumpUrl))return void t.location.assign(m);if(angular.isDefined(l.beforeIfEval)&&l.beforeAjaxUrlSubmit){var r=o.$eval(l.beforeIfEval);if(r)return void d()}c()},h,u,p,g,m)})}}}function M(){return{restrict:"EA",scope:{noAuthorFilter:"@?",leftNavigationMenu:"="},replace:!0,templateUrl:Config.tplPath+"tpl/project/leftNavigationMenu.html"}}function F(t,e){var a={isStart:!1,routeMap:{},last1MenuShowObj:null,eleChangeEvent:function(t){!t||0===t.length;var e=$(t).parent();e.addClass("active").siblings().each(function(){$(this).removeClass("active")}),e.parent().parent().removeClass("active").siblings().each(function(){$(this).removeClass("active"),$(this).find("ul.sub-menu-list").slideUp(200),$(this).find(".sub-menu-list > li").each(function(){$(this).removeClass("active")})}),a.last1MenuShowObj&&a.last1MenuShowObj.hide(),e.parent().is(":visible")||(e.parent().show(),a.last1MenuShowObj=e.parent()),$(t).parents("ul.sub-menu-list").prev().children().eq(2).removeClass("pr-arrow-down").addClass("pr-arrow-up")},doRoute:function(t){var e=t;e=e.split("#")[1],e&&(elementMenu=this.routeMap[e],elementMenu&&0!==elementMenu.length||(e=e.split("?")[0],elementMenu=this.routeMap[e]),elementMenu&&0!==elementMenu.length||(e=e.split("/")[1],elementMenu=this.routeMap[e]),elementMenu&&0!==elementMenu.length&&this.eleChangeEvent(elementMenu))},startListen:function(t){this.isStart||(this.isStart=!0,t.$on("$locationChangeSuccess",function(t,e,r){a.doRoute(e)}))},add:function(t,e,a){if(t&&t.length>0)for(var r=0;r<t.length;r++)this.routeMap[t[r]]=e;var n=e.attr("href");a&&(n=a),n&&(n=n.split("#")[1],n&&(this.routeMap[n]=e),n&&(n=n.split("?")[0]),n&&(this.routeMap[n]=e),n&&(n=n.split("/")[1]),n&&(this.routeMap[n]=e))}};return{restrict:"A",scope:{leftMenuSecondToggle:"=?",leftNavigationMenu:"="},link:function(r,n,i){var o=null;i.keyArr&&(o=r.$eval(i.keyArr)),a.add(o,n,r.leftMenuSecondToggle),a.startListen(e),a.doRoute("#"+t.path()),n.on("click",function(t){t&&t.stopPropagation&&t.stopPropagation(),a.eleChangeEvent(n)})}}}function A(t){"use strict";return{restrict:"A",link:function(e,a,r){r.href.indexOf(t.path().split("/")[2])!==-1&&$(a).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")}),$(a).on("click",function(t){$(this).hasClass("active")||$(this).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")})})}}}function O(t){"use strict";return{restrict:"AE",scope:!1,link:function(e,a,r){e.countdown=function(a,r){e[a]=r;var n=t(function(){e[a]>0?e[a]-=1:t.cancel(n)},1e3)},e.$on("$destroy",function(){try{t.cancel(timeout_upd)}catch(e){}})}}}function T(t,e){"use strict";return{restrict:"AE",scope:{workflowTaskData:"=?",ngModel:"=?"},link:function(a,r,n){var i=null;a.$watch("ngModel",function(t){console.log("watch.workflow.ngModel",t),i&&i.reload(t)},!0);var o=a.ngModel;console.log(o),require(["WorkflowProcess"],function(r){function s(e,r){angular.isDefined(n.modalUrl)&&(t.closeAll(),a.$parent.currentEvent=r.currentNode.data,t.open({template:n.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:"true"==n.modalOverlay,data:r.currentNode.data,scope:a.$parent,controller:["$scope","$element",function(t,e){$(".ngdialog-content",e).width("50%")}]}))}var l={showStatus:"true"==n.showStatus,node:{clickCallback:s}};if(i=new r(n.id,l),n.scopeExtend){var c=e.getScopeExtend(a,n.scopeExtend);c&&n.scopeExtendAttr&&(c[n.scopeExtendAttr]=i)}i.addWorkflowProcess(o),a.workflowTaskData&&i.addWorkflowTaskData(a.workflowTaskData)})}}}function P(){return{restrict:"EA",scope:{businessKey:"@",businessType:"@"},templateUrl:Config.tplPath+"tpl/project/businessFlowShow.html",link:function(t,e,a,r){}}}function N(t,e){"use strict";return{restrict:"AE",scope:{ngModel:"=?"},link:function(t,a,r){var n=t.ngModel,i=r.curRelId;require(["CanvasBusinessFlow"],function(a){function o(t,a){if(!angular.isDefined(r.disableClick)){var n=a.currentNode.data.moduleType,o=a.currentNode.data.relId,s=a.currentNode.data.subModuleAttribute;if(!n||!o)return void console.log("moduleType="+n+",relId="+o);if(i!=o){var l="#/"+n+"/get.html?id="+o;"lossOrder"==n?l="#/lossOverOrder/get-reimburse.html?id="+o:"overOrder"==n?l="#/lossOverOrder/get-overflow.html?id="+o:"outstockOrder"==n?l="销售出库单"==s||"销售出库单_红字"==s?"#/saleOutstockOrder/get.html?id="+o:"#/otherOutstockOrder/get.html?id="+o:"instockOrder"==n&&(l="采购入库单"==s||"采购入库单_红字"==s?"#/purchaseInstockOrder/get.html?id="+o:"#/otherInstockOrder/get.html?id="+o),e.goTo(l)}}}var s={node:{clickCallback:o}};r.baseImageUrl&&(s.baseImageUrl=r.baseImageUrl),r.spacingWidth&&(s.spacingWidth=parseInt(r.spacingWidth)),r.spacingHeight&&(s.spacingWidth=parseInt(r.spacingHeight));var l=new a(r.id,s);if(r.scopeExtend){var c=e.getScopeExtend(t,r.scopeExtend);c&&r.scopeExtendAttr&&(c[r.scopeExtendAttr]=l)}l.addCanvasBusinessFlow(n,i)})}}}function x(t,e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:Config.tplPath+"tpl/lodopFuncs.html",link:function(t,e,a){var r=null;require(["LodopFuncs"],function(e){function a(){return r||(r=e.getLodop(document.getElementById(t.LODOP_OB_Id),document.getElementById(t.LODOP_EM_Id))),r}function n(){a(),r.PRINT_INIT("打印控件功能演示_Lodop功能_表单一"),r.SET_PRINT_STYLE("FontSize",18),r.SET_PRINT_STYLE("Bold",1),r.ADD_PRINT_TEXT(50,231,260,39,"打印页面部分内容"),r.ADD_PRINT_HTM(88,200,350,600,document.getElementById(t.Print_Div_id).innerHTML)}t.LODOP_OB_Id="LODOP_OB_"+(new Date).getTime(),t.LODOP_EM_Id="LODOP_EM"+(new Date).getTime(),t.Print_Div_id="Print_Div_"+(new Date).getTime(),t.prn1_preview=function(){a(),n(),r.PREVIEW()},t.$digest()})}}}function q(){return{restrict:"A",scope:{},link:function(t,e,a){$(e).find("a.edit-link-icon").on("click",function(){$(this).hide().next().show(),$(e).find("span.notEdit").hide(),$(e).find("span.comeInEdit").show()})}}}function _(){return{restrict:"A",scope:{},link:function(t,e,a){var r=0,n=parseInt(a.modalLength),i=n;$(e).mouseenter(function(t){r=$(this).children("ul").children("li").length,liWidth=$(this).children("ul").children("li").width()+42,console.log(liWidth),console.log(),r>parseInt(n/liWidth)&&($(this).children("span").css("display","block"),$(".button-left").off("click").on("click",function(){$(".button-right").removeAttr("disabled","disabled"),i<n*Math.ceil(r/parseInt(n/liWidth))&&($(".kuaidiul").animate({"margin-left":"-"+i+"px"}),i+=n)}),$(".button-right").off("click").on("click",function(){$(".button-left").removeAttr("disabled","disabled"),i>=n&&(i-=n,$(".kuaidiul").animate({"margin-left":"-"+i+"px"}))})),i<n&&($(".button-right").attr("disabled","disabled"),$(".button-right:before").css("color","#e5e5e5")),i>=n*Math.ceil(r/parseInt(n/liWidth))&&($(".button-left").attr("disabled","disabled"),$(".button-left:before").css("color","#e5e5e5"))}),$(e).mouseleave(function(t){$(this).children("span").css({display:"none"})})}}}function E(t){return{restrict:"A",link:function(e,a,r){var n=0,i=null,o=e.$eval(r.mouseOverButtonsJson);o&&o.length>0&&(i=$("<div id='moveBtnDiv'></div>"),n=o.length);for(var s=0;s<o.length;s++){var l=o[s];if("0"==l.progress)return;var c="<a style='width:32px;height:32px;display:inline-block;margin-top:8px;' href='"+l.url+"' title='"+l.title+"'><span class='"+l.className+"'></span></a>",d=$(c);i.append(d)}$(a).mouseenter(function(e){if(a.addClass("bg-c"),i){moveBtnDivWidth=34*n;
var r=a.offset().top-document.body.scrollTop,o=t.getwindowWidth()-60-moveBtnDivWidth-document.body.scrollLeft;i.css({position:"fixed",width:moveBtnDivWidth,height:a.height(),top:r,left:o}),$(this).append(i)}}),$(a).mouseleave(function(){$(this).removeClass("bg-c"),i.remove()})}}}function B(t){return{scope:{},restrict:"A",link:function(t,e,a){$(e).addClass("first-medical-nav");var r=0,n=t.$eval(a.stepFlowArrowJson);r=n.length;var i=($(e).width()-30*(r-1))/r;if(n&&n.length>0){for(var o=0;o<n.length;o++){var s=n[o],l="<div class='"+s.className+"'><span><em class='circle-step mgr-m'>"+(o+1)+"</em>"+s.arrowText+"</span></div>";$(e).append($(l)),o>0&&o<n.length-1&&($(e).children("div").eq(o).hasClass("visited")?($(e).children("div").eq(o).append("<div class='triangle1'></div><div class='triangle2'></div>"),$(e).children("div").eq(o).prepend("<div></div><div></div>")):($(e).children("div").eq(o).append("<div></div>"),$(e).children("div").eq(o).prepend("<div></div>")))}$(".first-medical-nav>div").css({width:i}),$(e).children("div").first().append("<div></div><div></div>"),$(e).children("div").last().prepend("<div></div>")}$(window).resize(function(){$(".first-medical-nav>div").css({width:($(e).width()-30*(r-1))/r})})}}}function j(t){return{scope:{},restrict:"A",link:function(t,e,a){var r,n=a.maxlength;t.$watch(t.initFlag,function(){r='<span class="strResult">(<em class="remainWords">0</em>/'+n+")</span>",$(e).after(r),a.top?$(".strResult").css({position:"absolute",top:a.top+"px",right:"35px","z-index":"100",color:"#999"}):$(".strResult").css({position:"absolute",top:"63px",right:"35px","z-index":"100",color:"#999"})}),$(e).bind("input propertychange change",function(t){$(".remainWords").html($(e).val().length)})}}}function L(){return{restrict:"A",link:function(t,e,a){$(e).on("click","li a",function(t){($("li").hasClass("actived")||$("a").hasClass("actived")||$("span").hasClass("actived"))&&($("li").removeClass("actived"),$("a").removeClass("actived"),$("span").removeClass("actived")),$(t.target).addClass("actived")})}}}function R(){return{restrict:"A",scope:{},link:function(t,e,a){if(!a.type)throw new Error("params type is must defined");if("line"===a.type){var r=$(e).width()?$(e).width():"100%",n=a.height;$(e).attr("style","width:"+r+";height:"+n+";").addClass("overhide").addClass("w-space-nowrap")}if("block"===a.type){var i=$(e).width(),o=$(e).height();$(e).attr("style","width:"+i+"px;height:"+o+"px;").addClass("text-ellips-block")}}}}function U(){"use strict";return{restrict:"A",scope:!0,link:function(t,e,a){var r=e.children().last();e.hover(function(){$(r).find("div.sales-order-item-delbtn").each(function(){$(this).css("z-index","110").show()})},function(){$(r).find("div.sales-order-item-delbtn").each(function(){$(this).css("z-index","100").hide()})}),$(r).find("div.sales-order-item-delbtn").each(function(){$(this).on("click",function(){$(this).find("div.sales-order-confirm-del-area").show()}),e.on("mouseleave",function(){$(this).find("div.sales-order-confirm-del-area").hide()})})}}}function V(t){"use strict";return{restrict:"A",scope:!0,link:function(e,a,r){var n=$(a).find("div.table-item-handle-btn"),i=$(a).find("div.table-item-confirm-del-area");n.on("click",function(){i.show()}),a.hover(function(){var i=(r.tableItemIndex,e.formData.orderMedicalNos,$(a).offset().top-document.body.scrollTop),o=t.getMainBodyWidth()+65;n.css({position:"fixed",top:i,left:o}).show()},function(){n.css({position:"absolute",top:0,left:0}).hide(),i.hide()}),e.cancelHandle=function(){n.hide(),i.hide()}}}}function W(t){var e={toolbar:["source undo redo bold italic underline"],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,autoHeightEnabled:!1,initialFrameHeight:400};return{restrict:"A",scope:{ngModel:"=?",config:"=",umeditor:"="},require:"ngModel",link:function(t,a,r,n){var i=a[0];t.umStyle={width:"1000px",height:"440px"},r.umStyle&&0===r.umStyle.indexOf("{")&&(t.umStyle=t.$eval(r.umStyle)),t.editorId=r.umeditor;require(["ueditor_lang"],function(a){function o(){if(!c){var a="_"+Math.floor(100*Math.random()).toString()+(new Date).getTime().toString(),o=r.placeholder;o||(o="");var s='<p style="font-size:14px;color:#ccc;">'+o+"</p>",l=null;l=t.config?jQuery.extend(!0,{},e,t.config):jQuery.extend(!0,{},e),i.setAttribute("id",a);var c=UE.getEditor(a,l);t.umeditor=c;var d=function(){c.hasContents()?n.$setViewValue(c.getContent()):n.$setViewValue(void 0)};c.ready(function(){return r.initHtmlContentId?(c.setContent($("#"+r.initHtmlContentId).html()),void n.$setViewValue(c.getContent())):(n.$viewValue?c.setContent(n.$viewValue):c.setContent(s),void c.addListener("contentChange",d))}),c.addListener("focus",function(){n.$viewValue||c.addListener("contentChange",d)}),c.addListener("blur",function(){c.hasContents()||(c.removeListener("contentChange",d),c.setContent(s))})}}o()})}}}function Q(){return{scope:{startTime:"=",endTime:"=",ngModel:"="},restrict:"A",link:function(t,e,a){function r(e){var a=require("moment"),r=a().format("x"),n=a().format("x");switch(e){case"最近7天":r=a().subtract(1,"weeks").format("x");break;case"最近10天":r=a().subtract(10,"days").format("x");break;case"最近一个月":r=a().subtract(1,"months").format("x")}t.startTime=r,t.endTime=n}t.$watch("ngModel",function(t){r(t)})}}}function H(t,e){return{restrict:"A",link:function(a,r,n){r.on("click",function(r){var i=n.ngSrc||n.src;if(!i)return void console.log("url is null");i=i.split("@")[0];var o='{"url":"'+i+'"}';console.log(o),t.open({template:Config.tplPath+"tpl/show-original-image.html",cache:!1,trapFocus:!1,data:o,scope:a,controller:["$scope","$element",function(t,a){$(".ngdialog-content",a).width(e.getMainBodyWidth()),$(".ngdialog-content",a).height(e.getwindowHeight())}]}),r.preventDefault()})}}}function G(t,e,a,r){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-medicalStockBatch.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=null,require(["project/angucomplete"],function(o){n.angucomplete1=new o(n,i,t,e,a,r,s)})}}}function z(t,e,a,r){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",ngModelId:"=?",ngModel:"=",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-supplier.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=n.searchFields,o.ngModelId&&n.$watch("ngModel",function(t){t&&(n.ngModelId=t.id,n.searchStr=t.data.name)},!0),require(["project/angucomplete"],function(o){n.angucomplete1=new o(n,i,t,e,a,r,s)})}}}function K(t,e,a,r){return{restrict:"EA",scope:{id:"@?",placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/autocomplete-medicalStock.html",link:function(n,i,o,s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=300,n.minLength=1,n.searchStr=null,require(["project/angucomplete"],function(o){var l=function(t){try{if("已冻结"==t.data.businessApplication.businessStatus)return!1}catch(e){}return!0};n.angucomplete1=new o(n,i,t,e,a,r,s,l)})}}}function J(t,e){return{restrict:"EA",scope:{id:"@?",ngModel:"=",addDataCallbackFn:"&?",formData:"=?"},require:"?^ngModel",templateUrl:Config.tplPath+"tpl/project/flashAddMedical.html",link:function(a,r,n,i){angular.isDefined(n.hideQuantity)&&(a.hideQuantity=!0),angular.isDefined(n.hideImport)&&(a.hideImport=!0),n.$observe("ajaxUrl",function(t,e){a.ajaxUrl=t}),angular.isDefined(n.isDisabledThis)||(a.isCustomerId=!0),n.$observe("isDisabledThis",function(t,e){t&&(a.isCustomerId=!0)}),a.angucompleteMedicalOnChange=function(){if(a.hideQuantity)a.addDataFn();else{var e="flashAddMedical_input_count";a.id&&(e+=a.id),t.focusByInputId(e)}},a.addDataFn=function(){if(a.addDataCallbackFn){var r=t.replaceObject({},a.ngModel),n=a.addDataCallbackFn(r);if("function"==typeof n&&(n=n(r)),!n)return!1}else console.log("scope.addDataCallback function is null!");a.ngModel={};var i="#angucompleteMedical_searchInputId";return a.id&&(i+=a.id),e(function(){$(i).val(""),$(i).trigger("focus")},0),!1},a.handleAddThisItem=function(t){var e=window.event?t.keyCode:t.which;return 13==e&&a.addDataFn(),!1}}}}function Y(){return{restrict:"EA",replace:!0,templateUrl:Config.tplPath+"tpl/project/customTable.html",link:function(t,e,a,r,n){a.checkboxShow&&(t._checkboxShow=a.checkboxShow),a.customTable&&(t._customTableName=a.customTable),a.customTrMenus&&(t._customTrMenus=a.customTrMenus)}}}function X(t,e,a){return{restrict:"A",link:function(r,n,i){var o=$("<div></div>");$(n).mouseenter(function(s){var l=r[i.tableTrMouseOverMenu],c=r[i.businessData];r._tableTrMouseOverMenus=a.parseVariableMenuList(l,c);var d='<span query-item-card-button-list="_tableTrMouseOverMenus"></span>';o.html(d),e(o.contents())(r);var u=0;if(r._tableTrMouseOverMenus&&(u=r._tableTrMouseOverMenus.length),n.addClass("bg-c"),o){moveBtnDivWidth=34*u;var f=n.offset().top-document.body.scrollTop,h=t.getwindowWidth()-10-moveBtnDivWidth;h<0&&(h=0),o.css({position:"fixed",width:moveBtnDivWidth,height:n.height(),top:f,left:h}),$(this).append(o)}}),$(n).mouseleave(function(){$(this).removeClass("bg-c"),o.remove()})}}}function Z(){return{restrict:"EA",scope:!1,replace:!0,templateUrl:Config.tplPath+"tpl/project/customTablePrint.html",link:function(t,e,a){a.customTablePrint&&(t.customTablePrintName=a.customTablePrint)}}}function tt(t){t.ngClick2=function(e){var a=t.$parent.$eval(e);console.log("ngClick2",e,a)},t.cancelCallback=function(e){var a=t.$parent.$eval(e);console.log("cancelCallback",e,a)},t.ngShow2=function(e){if(!e)return!0;var a=t.$parent.$eval(e);return a},t.ngDisabled2=function(e){if(!e)return!1;var a=t.$parent.$eval(e);return console.log("ngDisabled2",e,a),a}}function et(){return{restrict:"EA",scope:{spanClass:"=?",bottomButtonList:"=?"},templateUrl:Config.tplPath+"tpl/project/bottomButtonList.html",link:function(t,e,a){tt(t),t.spanClass||(t.spanClass="mgl"),t.defalutItemClass="btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg"}}}function at(){return{restrict:"EA",scope:{spanClass:"=?",queryItemCardButtonList:"=?"},templateUrl:Config.tplPath+"tpl/project/queryItemCardButtonList.html",link:function(t,e,a){tt(t),t.spanClass||(t.spanClass="mgl"),t.defalutItemClass="btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg"}}}function rt(){return{restrict:"EA",link:function(t,e,a){require(["store","resizableColumns"],function(t){e.resizableColumns({store:t})})}}}function nt(t,e){"use strict";return{restrict:"EA",scope:{formData:"=?",requestUrl:"@",createAddressType:"@",requestDataId:"@",invoicesGetCallBack:"&",reloadTime:"@",modifyModalTitle:"@",createModalTitle:"@",compnentTitle:"@",scopeDataPrefix:"@",modifyModalUrl:"@",createModalUrl:"@",setDefaultAddressRequesturl:"@",delThisAddressRequesturl:"@",contactsNull:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/addressManageComponent.html",link:function(e,a,r){e.contactsNull=!1,e.$watch("requestDataId",function(t,a){t&&t!==a&&n(e)}),r.$observe("logisticsCenterId",function(t,a){t&&t!=a&&(e.logisticsCenterId=t)});var n=function(e){var a=e.requestUrl+"?id="+e.requestDataId+"&type="+e.createAddressType;t(a,{},"get").then(function(t){var a=t[1];200===a.code&&e.returnAddressObj&&(e.returnAddressObj.contacts=a.data.contacts,a.data.contacts||(e.formData.contactsNull=!0))})["catch"](function(t){console.log(t||"出错")})};e.$on("reloadAddressList",function(){n(e)})},controller:["$scope","$element",function(e,a){e.choisedItemId="",e.chkDefaultChoise=function(t){if(e.formData.id){if(e.returnAddressObj.defaultContactId===t)return!0}else{if(e.returnAddressObj.choisedItemId&&e.returnAddressObj.choisedItemId===t)return!0;if(e.returnAddressObj.defaultContactId===t)return!0}},e.addressGetCallBack=function(){if(!e.returnAddressObj)return!1;if(e.scopeDataId=e.scopeDataPrefix+"Id",e.scopeDataContacts=e.scopeDataPrefix+"Contacts",e.formData[e.scopeDataId]||(e.formData[e.scopeDataId]=e.returnAddressObj.defaultContactId),!e.formData.id){var t=e.returnAddressObj.contacts;if(t&&!e.choisedItemId)for(var a=0;a<t.length;a++)e.returnAddressObj.defaultContactId===t[a].id&&(e.formData[e.scopeDataContacts]=t[a])}e.returnAddressObj.contacts&&1===e.returnAddressObj.contacts.length&&(e.formData[e.scopeDataContacts]=e.returnAddressObj.contacts[0],e.formData.contactsNull=!1),e.choisedItemId&&(e.returnAddressObj.choisedItemId=e.choisedItemId)},e.getCurrentIndexAddress=function(t){if(!e.returnAddressObj)return!1;var a={},r=e.returnAddressObj.contacts[t],n=e.scopeDataPrefix+"AddressId";return a[n]=e.returnAddressObj.id,a.defaultContactId=e.returnAddressObj.defaultContactId,a.contact=r,a.type=e.createAddressType,a.title=e.modifyModalTitle,a.logisticsCenterId=e.logisticsCenterId,a},e.returnCreateNewAddressObj=function(){var t={},a=e.scopeDataPrefix+"AddressId";return e.returnAddressObj&&(t[a]=e.returnAddressObj.id),t.type=e.createAddressType,t.title=e.createModalTitle,t.logisticsCenterId=e.logisticsCenterId,t.contact={},t},e.choiseOtherItem=function(t,a){e.formData[e.scopeDataId]=a,e.formData[e.scopeDataContacts]=t,e.choisedItemId=t.id},e.setThisAddressToDefault=function(a){var r={};r.id=e.returnAddressObj.id,r.contactId=a,t(e.setDefaultAddressRequesturl,r,"POST").then(function(t){})["catch"](function(t){t&&console.log(t||"出错!")})}}]}}function it(t,e){"use strict";return{restrict:"EA",scope:{expressData:"=?",saveExpressUrl:"@",delExpressUrl:"@",orderId:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/expressManageComponent.html",link:function(t,e,a){if(!angular.isDefined(a.expressData))throw new Error("Attr expressData must be defined!");t.editThisAreaInfo=function(t,e){var a="express-details-"+e;$("#"+a).find("div.show-express-info").hide(),$("#"+a).find("div.edit-express-info").css("top",0)},t.cancelEditExpress=function(t){var e="express-details-"+t;$("#"+e).find("div.show-express-info").show(),$("#"+e).find("div.edit-express-info").css("top","-9999px")}},controller:["$scope","$element",function(a,r){a.saveExpressInfo=function(r){var n=angular.isObject(r)?r:"",i=a.saveExpressUrl;n&&t(i,n,"POST").then(function(t){200===t[1].code&&e.goOrRefreshHref()})["catch"](function(t){console.log(t||"出错")})}}]}}function ot(){"use strict";return{restrict:"EA",scope:{listParams:"=?",crumbsNav:"@",componentTitle:"@",createNewUrl:"@",getStatusNumUrl:"@",statusGroupData:"@",getBusinessTypeUrl:"@",isShowSelectItem:"@",searchPlaceholderInfo:"@",getWarehouseListUrl:"@"},replace:!0,transclude:!0,templateUrl:Config.tplPath+"tpl/project/pageMainHeaderComponent.html",link:function(t,e,a){if(t.crumbsNav){var r=angular.fromJson(t.crumbsNav);t.crumbsCode="",angular.forEach(r,function(e,a){a+1!==r.length?t.crumbsCode+='<span class="mgr-s '+e.style+'">'+e.name+'</span><span class="fa fa-angle-right mgr-s"></span>':t.crumbsCode+='<span class="mgr-s '+e.style+'">'+e.name+"</span>"}),$("#crumbsNav").append(t.crumbsCode)}t.statusGroupData&&(t.statusGroupList=angular.fromJson(t.statusGroupData)),t.splitStringData=function(t){var e=t.split("-");return e[1]=Boolean(e[1]),e},t.isShowSelectItem&&(t.selectObj=angular.fromJson(t.isShowSelectItem),t.itemChooise=t.selectObj[0].link),t.isShowCreateBtn=!!angular.isDefined(a.isShowCreateBtn)&&a.isShowCreateBtn,t.isShowTypeFilter=!!angular.isDefined(a.isShowTypeFilter)&&a.isShowTypeFilter,t.isShowWarehouseFilter=!!angular.isDefined(a.isShowWarehouseFilter)&&a.isShowWarehouseFilter,t.isShowDateFilter=!!angular.isDefined(a.isShowDateFilter)&&a.isShowDateFilter,t.isShowKeyFilter=!!angular.isDefined(a.isShowKeyFilter)&&a.isShowKeyFilter,t.isShowBusinessBtnGroup=!!angular.isDefined(a.isShowBusinessBtnGroup)&&a.isShowBusinessBtnGroup,t.searchPlaceholderInfo=angular.isDefined(a.searchPlaceholderInfo)?a.searchPlaceholderInfo:"客户名 / 单据编号"}}}function st(){"use strict";return{restrict:"A",scope:!0,link:function(t,e,a){$(e).find("a.origin-ele").hover(function(){$(this).next().show()},function(){$(this).next().hide()}),$(e).find("div.edit-del-btn").hover(function(){$(this).show()},function(){$(this).hide()}),$(e).find("a.handle-edit-info").on("click",function(t){t.stopPropagation(),$(e).find("div.show-express-info").hide(),$(e).find("div.edit-express-info").css("top",0)}),$(e).find("a.cancel-edit-express").on("click",function(t){t.stopPropagation(),$(e).find("div.show-express-info").show(),$(e).find("div.edit-express-info").css("top","-9999px")})}}}function lt(t,e){"use strict";return{restrict:"A",scope:{expressInfoList:"="},link:function(t,e,a){$(e).on("click",function(t){t.stopPropagation(),$(this).addClass("active").parent().siblings().each(function(){$(this).children().removeClass("active")});var r=[];$(e).parent().siblings().each(function(){var t=$(this).children().attr("id");r.push("tabContent"+t)}),angular.forEach(r,function(t,e){$("#"+t).addClass("pr-dpy-none")}),$("#tabContent"+a.id).removeClass("pr-dpy-none")})}}}function ct(t,e){"use strict";return{restrict:"A",scope:!0,link:function(a,r,n){var i=$(r).find("div.table-item-multiple-btn"),o=$(r).find("div.del-details-btn"),s=$(r).find("div.other-handle-btn");$(r).find(".hide-this-area");o.on("click",function(){$(".del-confirm-area").show()}),s.on("click",function(){$(".handle-area-show").show()}),$(r).find(".hide-this-area").on("click",function(t){t.stopPropagation(),$(r).find("div.del-confirm-area").hide()}),r.hover(function(){var e=$(r).offset().top-document.body.scrollTop+23,a=t.getMainBodyWidth()-23;i.css({position:"fixed",top:e,left:a}).show()},function(){i.css({position:"absolute",top:0,left:0}).hide(),$(".del-confirm-area").hide(),$(".handle-area-show").hide()}),a.handleDelDetails=function(a,r,n){if(a&&r&&n){var i=r+"?id="+a;e(i,{},"POST").then(function(e){200==e[1].code&&t.goTo(n)})["catch"](function(t){if(t)throw new Error(t)})}}}}}angular.module("manageApp.project").directive("tableItemMultipleBtn",["utils","requestData",ct]).directive("pageMainHeaderComponent",ot).directive("expressManageComponent",["requestData","utils",it]).directive("tableItemHandlebtnComponent",["utils",V]).directive("requestExpressInfoTab",["requestData","alertError",lt]).directive("expressBtnToggle",[st]).directive("htmlEdit",[e]).directive("textareaJson",["utils","alertError",t]).directive("addressManageComponent",["requestData","utils",nt]).directive("attachmentsItemShow",[a]).directive("attachmentsShow",[r]).directive("attachmentsEdit",[n]).directive("bottomButtonList",[et]).directive("queryItemCardButtonList",[at]).directive("customTablePrint",[Z]).directive("resizableColumns",[rt]).directive("customTable",[Y]).directive("flashAddMedical",["utils","$timeout",J]).directive("angucompleteMedicalStockBatch",["$parse","requestData","$sce","$timeout",G]).directive("angucompleteMedical",["$parse","requestData","$sce","$timeout",K]).directive("angucompleteSupplier",["$parse","requestData","$sce","$timeout",z]).directive("modalImgShow",["modal","utils",H]).directive("datePeriodSelect",[Q]).directive("umeditor",["$timeout",W]).directive("salesorderEditShowDelbtn",[U]).directive("handleTextOverflow",[R]).directive("hospitalPurchaseComeinEdit",[q]).directive("saleOutStockKuaDi",[_]).directive("lodopFuncs",["modal","utils",x]).directive("canvasBusinessFlow",["modal","utils",N]).directive("businessFlowShow",[P]).directive("canvasWorkflow",["modal","utils",T]).directive("queryOrderStatusButton",g).directive("intervalCountdown",["$interval",O]).directive("workflowRejectButton",["utils",s]).directive("workflowPassButton",["utils",l]).directive("workflowButtonQueryCard",["utils",c]).directive("customMenuList",["utils",d]).directive("workflowTaskRunWithAttchments",["utils",u]).directive("orderMedicalsPurchase",o).directive("orderMedicals",i).directive("niceScroll",f).directive("leftMenuChange",["$location",h]).directive("leftMenuToggle",["$location",m]).directive("orderStatusChoise",p).directive("orderListTips",v).directive("toggleLeftMenu",y).directive("togglePanel",D).directive("morris",b).directive("icheck",w).directive("sparkline",C).directive("runTooltips",k).directive("runPopovers",["$timeout",I]).directive("handleThisClick",["$window","dialogConfirm","requestData","alertOk","alertError","utils",S]).directive("leftMenuSecondToggle",["$location","$rootScope",F]).directive("leftNavigationMenu",[M]).directive("styleToggle",["$location",A]).directive("leftSideActive",[L]).directive("tableTrMouseOverMenu",["utils","$compile","customMenuUtils",X]).directive("medicalStockMouseOver",["utils",E]).directive("stepFlowArrowShow",["utils",B]).directive("limitWordShow",["utils",j])}),define("project/filters",["project/init"],function(){function t(){return function(t){if(!t)return"";var e=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],r=[["元","万","亿"],["","拾","佰","仟"]],n=t<0?"欠":"";t=Math.abs(t);for(var i="",o=0;o<e.length;o++)i+=(a[Math.floor(10*t*Math.pow(10,o))%10]+e[o]).replace(/零./,"");i=i||"整",t=Math.floor(t);for(var o=0;o<r[0].length&&t>0;o++){for(var s="",l=0;l<r[1].length&&t>0;l++)s=a[t%10]+r[1][l]+s,t=Math.floor(t/10);i=s.replace(/(零.)*零$/,"").replace(/^$/,"零")+r[0][o]+i}return n+i.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}}function e(){return function(t){var e=[];return angular.forEach(t,function(t,a){0!==t.returnQuantity&&e.push(t)}),e}}angular.module("manageApp.project").filter("upDigit",t).filter("repeatFilter",e)}),define("project/init",["angular"],function(){angular.module("manageApp.project",[])}),define("project/registration",["angular"],function(){angular.module("manageApp.registration",[]).config(["$routeProvider",function(t){"use strict";t.when("/verify_phone",{templateUrl:"angular/tpl/registration/verify_phone.html",controller:"registrationCtrl"}).when("/send_info",{templateUrl:"angular/tpl/registration/send_info.html",controller:"registrationCtrl"}).when("/apply_bind",{templateUrl:"angular/tpl/registration/apply_bind.html",controller:"registrationCtrl"}).when("/bind_done",{templateUrl:"angular/tpl/registration/bind_done.html",controller:"registrationCtrl"}).when("/retrievepwd",{templateUrl:"angular/tpl/retrieve-pwd/retrievepwd.html",controller:"registrationCtrl"}).when("/resetpwd",{templateUrl:"angular/tpl/retrieve-pwd/resetpwd.html",controller:"registrationCtrl"}).otherwise({redirectTo:"/verify_phone"})}]).controller("registrationCtrl",["$scope","requestData","$interval","$rootScope","$location",function(t,e,a,r,n){"use strict";t.globalData={requestUrlHead:""},t.sendVerifyCodeStatus=!1,t.countdown=function(e){t.second=e,a(function(){t.second>=1?t.second-=1:(clearInterval(),t.sendVerifyCodeStatus=!1,r.verifyResult.phone=!0)},1e3)},t.sendRegVerifyCode=function(){if(t.regData.phone){t.sendVerifyCodeStatus=!0,t.countdown(59);var a="";"/verify_phone"===n.path()&&(a=t.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=true&tel="+t.regData.phone,e(a,{}).then(function(e){var a=e[0];t.validCode=a.code})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})),"/retrievepwd"===n.path()&&(a=t.mainConfig.serverPath+"rest/sms/sendVerificationCode.json?isNewUser=false&tel="+t.regData.phone,e(a,{}).then(function(e){var a=e[0];t.validCode=a.code})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)}))}},t.bind_done=function(){window.location.assign("#/bind_done")},t.regSubmit=function(){if(t.regData){var a=t.mainConfig.serverPath+"rest/index/register",r=t.regData,n="POST";e(a,r,n).then(function(t){var e=t[1];200===e.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){window.location.href="#/apply_bind"},1500))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})}},t.resetPwdSubmit=function(){if(t.regData){var a=t.mainConfig.serverPath+"rest/index/forgetPassword",r=t.regData,n="POST";e(a,r,n).then(function(e){var a=e[1];200===a.code&&($(".reg-success-prompt").fadeIn(500),setTimeout(function(){t.pageTo("login.html")},1500))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:$(".reg-info-prompt").fadeIn(500)})}}}]).filter("registrationFilter",[function(){}]).service("registrationService",[function(){}]).value("registrationValue",[function(){}]).directive("regCheckPhone",["$rootScope","requestData",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){t.verifyResult||(t.verifyResult={}),r.on("keyup",function(){if(11===$(r).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var n=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;e(n,{},"GET").then(function(e){200===e[1].code&&(t.verifyResult.phone=!0,t.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled"))})["catch"](function(e){t.verifyResult.phone=!1,t.verifyResult.msg=e,"none"!==$(".reg-info-prompt").css("display")?t.verifyResult.msg=e:($(".reg-info-prompt").fadeIn(500),$(r).focus())})}else t.verifyResult.phone=!1,t.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(r).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}]).directive("regCheckVerifyCode",["requestData","$rootScope",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){r.on("keyup",function(){var n=i.$viewValue.toString();if(4===n.length){var o=a.mainConfig.serverPath+"rest/sms/verifySmsCodey.json",s={tel:a.regData.phone,code:a.regData.verifyCode};t(o,s,"POST").then(function(t){200===t[1].code&&(e.verifyResult.verifyCode=!0,e.verifyResult.phone=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200))})["catch"](function(t){e.verifyResult.verifyCode=!1,e.verifyResult.msg=t,"none"!==$(".reg-info-prompt").css("display")?e.verifyResult.msg=t:($(".reg-info-prompt").fadeIn(500),$(r).focus())})}})}}}]).directive("regCheckPassword",["$rootScope",function(t){"use strict";return{restrict:"A",require:"ngModel",link:function(e,a,r,n){t.verifyResult||(t.verifyResult={msg:"",password:!1,repassword:!1}),a.on("keyup",function(i){if(16!==i.keyCode){if("password"===r.name){t.verifyResult={msg:"密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线"};var o=$.trim($(a).val());if(o.length>=6)if(/[A-Za-z0-9_-]{6,32}/.test(n.$viewValue))t.verifyResult.password=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200);else if(t.verifyResult.password=!1,t.verifyResult.repassword=!1,"none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}if("repassword"===r.name)if(t.verifyResult.password===!1){if(t.verifyResult.msg="密码应在6~32位之间且可包含大小写字母、数字、下划线和中划线","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else{t.verifyResult={msg:"两次输入的密码不一致",password:!0,repassword:!1};var s=$.trim($(a).val());if(s.length>=6)if(e.regData.password!==e.regData.repassword){if(t.verifyResult.msg="两次输入的密码不一致","none"===$(".reg-info-prompt").css("display"))return $(".reg-info-prompt").fadeIn(200),void $(a).focus()}else t.verifyResult.repassword=!0,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)}}})}}}]).directive("regCheckName",["$rootScope",function(t){"use strict";return{restrict:"A",require:"ngModel",link:function(e,a,r,n){t.verifyResult||(t.verifyResult={}),a.on("keydown",function(){var e=n.$viewValue;return void 0!==e&&e.length>16?(t.verifyResult.name=!1,t.verifyResult.msg="用户名为必填项且长度应在1~16位之间",void("none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(a).focus()))):(t.verifyResult.name=!0,void("none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeOut(200)))})}}}]).directive("repwdCheckPhone",["$rootScope","requestData",function(t,e){"use strict";return{restrict:"A",require:"ngModel",link:function(a,r,n,i){t.verifyResult||(t.verifyResult={}),r.on("keyup",function(){if(11===$(r).val().length)if(i.$viewValue=$.trim(i.$viewValue),/^1(3|4|5|7|8)\d{9}$/.test(i.$viewValue)){var n=a.mainConfig.serverPath+"rest/index/user/isExist?phone="+i.$viewValue;e(n,{},"GET").then(function(e){200===e[1].code&&(t.verifyResult.phone=!1,t.verifyResult.msg="该手机号码未注册","none"===$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").fadeIn(200))})["catch"](function(e){t.verifyResult.phone=!0,t.verifyResult.msg="",t.verifyResult.phoneNumber=i.$viewValue,"none"!==$(".reg-info-prompt").css("display")&&$(".reg-info-prompt").hide(),"disabled"==$("#getVerifyCodeBtn").attr("disabled")&&$("#getVerifyCodeBtn").removeAttr("disabled")})}else t.verifyResult.phone=!1,t.verifyResult.msg="手机号码不能为空或格式不正确","none"===$(".reg-info-prompt").css("display")&&($(".reg-info-prompt").fadeIn(500),$(r).focus());else $("#getVerifyCodeBtn").attr("disabled","disabled"),$('button[type="submit"]').attr("disabled","disabled")})}}}])}),define("project/services",["project/init"],function(){function t(){return function(t,e,a){var r='<div class="pr-top-dialog-tips" style="position:fixed;left:50%;top:0;opacity:0;height:42px;line-height:42px;padding:0 15px;color:#fff;background-color:#64c213;animation:topIn 1s;">'+test+"</div>";$(html).append(r)}}function e(t){var e={canShowButton:function(e){return!e.authority||!!t.hasAuthor(e.authority)},get_ButtonListDemo:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),r={authority:"采购单新建权限",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"新建权限"},e.canShowButton(r)&&a.push(r),r={type:"modalRight",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"右侧弹出层"},e.canShowButton(r)&&a.push(r),r={type:"modalCenter",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"中间弹出层"},e.canShowButton(r)&&a.push(r),r={type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"$root.goTo('#/hospitalApplication/query.html?tt='+showData.id)",showName:"自定义方法"},e.canShowButton(r)&&a.push(r),r={showName:"自定义ctr方法",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"ngDisabled_button",type:"button",modalWidth:"1000",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"!!ngShow",showName:"ngShow",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"handleThisClick",type:"handleThisClick",alertTemplate:"pr-dialog-return.html",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"editForm.$valid",showName:"保存",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),t&&(r={aclass:"btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg",ahref:Config.serverPath+"rest/authen/firstEnterpriseApplication/exportWord?id="+t.id,
showName:"打印"},e.canShowButton(r)&&a.push(r)),console.log(a),a},get_confirmOrder:function(t){var a=[],r={aclass:"mgr-l",ahref:"#/confirmOrder/query.html",showName:"返回销售单列表"};return e.canShowButton(r)&&a.push(r),r={ngShow:"formData.orderStatus=='待处理' && formData.inputUserId==mainStatus.id",showName:"删除",type:"handleThisClick",alertTemplate:"dialog-confirm.html",requestUrl:"rest/authen/salesOrder/delete?id="+t.id,aclass:"pr-color-red mgr",alertTitle:"确认删除?",alertMsg:"您确认删除这条销售单吗?",ngClick:"$root.goTo('#/confirmOrder/query.html')"},e.canShowButton(r)&&a.push(r),r={aclass:"pr-btn-save-glodbg mgr color-white",ahref:"indexOfPrint.html#/print/confirmOrderPrint.html?id="+t.id,target:"_blank",showName:"打印预览"},e.canShowButton(r)&&a.push(r),a},get_firstEnterpriseApplication:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_firstMedicalApplication:function(t){var a=[],r={aclass:"",ahref:"#/firstMedicalApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_medicalStock:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_customerAddress:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_hospitalApplication:function(t){var a=[],r={aclass:"",ahref:"#/hospitalApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a},get_hospitalPurchaseContents:function(t){var a=[],r={type:"modalRight",modalWidth:"800",aclass:"color-orange add-return-order mgl-s",requestUrl:"rest/authen/versionFlow/query?businessKey="+t.id,httpMethod:"GET",ahref:"views/versionFlow/get-right-side.html?businessKey="+t.id,showName:"查看操作记录"};return e.canShowButton(r)&&a.push(r),a},get_otherCustomerApplication:function(t){var a=[],r={aclass:"",ahref:"#/otherCustomerApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),a}};return e}function a(t){var e={canShowButton:function(e){return!e.authority||!!t.hasAuthor(e.authority)},get_ButtonListDemo:function(t){var a=[],r={aclass:"",ahref:"#/firstEnterpriseApplication/query.html",showName:"返回申请单列表"};return e.canShowButton(r)&&a.push(r),r={authority:"采购单新建权限",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"新建权限"},e.canShowButton(r)&&a.push(r),r={type:"modalRight",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"右侧弹出层"},e.canShowButton(r)&&a.push(r),r={type:"modalCenter",modalWidth:"1000",aclass:"color-orange add-return-order",ahref:"#/firstEnterpriseApplication/query.html",showName:"中间弹出层"},e.canShowButton(r)&&a.push(r),r={type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"$root.goTo('#/hospitalApplication/query.html?tt='+showData.id)",showName:"自定义方法"},e.canShowButton(r)&&a.push(r),r={showName:"自定义ctr方法",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"ngDisabled_button",type:"button",modalWidth:"1000",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"!!ngShow",showName:"ngShow",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngDisabled:"!!ngDisabled",showName:"handleThisClick",type:"handleThisClick",alertTemplate:"pr-dialog-return.html",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),r={ngShow:"editForm.$valid",showName:"保存",type:"ngClick",modalWidth:"1000",aclass:"color-orange add-return-order",ngClick:"openIm('123','fff')"},e.canShowButton(r)&&a.push(r),t&&(r={aclass:"btn btn-primary pr-btn-bg-gold pr-btn-save-glodbg",ahref:Config.serverPath+"rest/authen/firstEnterpriseApplication/exportWord?id="+t.id,showName:"打印"},e.canShowButton(r)&&a.push(r)),console.log(a),a},getQuery_salesOrder:function(t){var a=[],r={iconClass:"View-Logistics-icon",showName:"查看物流",ngShow:"tr.orderStatus=='已发货'",aclass:"btn-link pd-m rect-s mr--4",ahref:"#/salesOrder/get.html?openWuliu=true&id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus!='已处理' && $root.hasAuthor('购需单编辑')",aclass:"btn-link pd-m rect-s",ahref:"#/salesOrder/edit2.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus=='已处理' || !$root.hasAuthor('购需单编辑')",aclass:"btn-link pd-m rect-s",ahref:"#/salesOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='待处理' && tr.inputUserId==mainStatus.id",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/salesOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/salesOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_confirmOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'||tr.orderStatus=='未通过'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"examine-approve",showName:"立即审核",ngShow:"tr.orderStatus=='待审核'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus!='待审核'&&tr.orderStatus!='未提交'&&tr.orderStatus!='未通过'",aclass:"btn-link pd-m rect-s",ahref:"#/confirmOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'||tr.orderStatus=='未通过'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/confirmOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/confirmOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_invoicesOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/invoicesOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus!='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/invoicesOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/invoicesOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/invoicesOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_saleReturnOrder:function(t){var a=[],r={iconClass:"edit-link-icon",showName:"编辑",ngShow:"tr.orderStatus=='未提交'",aclass:"btn-link pd-m rect-s",ahref:"#/saleReturnOrder/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"tr.orderStatus=='处理中' || tr.orderStatus=='已处理'",aclass:"btn-link pd-m rect-s",ahref:"#/saleReturnOrder/get.html?id="+t.id},e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/saleReturnOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/saleReturnOrder/query.html')"},e.canShowButton(r)&&a.push(r),a},getQuery_hospitalPurchaseContents:function(t){var a=[];r={iconClass:"watch-detail-icon",showName:"查看详情",ngShow:"",aclass:"btn-link pd-m rect-s",ahref:"#/hospitalPurchaseContents/get.html?id="+t.id},e.canShowButton(r)&&a.push(r);var r={ngShow:"tr.businessApplication.businessStatus!='已冻结' || tr.businessApplication.businessStatus!='已终止'",iconClass:"edit-link-icon",showName:"编辑",aclass:"btn-link pd-m rect-s",ahref:"#/hospitalPurchaseContents/edit.html?id="+t.id};return e.canShowButton(r)&&a.push(r),r={ngShow:"tr.orderStatus=='未提交'",showName:"删除",iconClass:"delete-link-icon",type:"handleThisClick",alertTemplate:"pr-dialog-submit.html",requestUrl:"rest/authen/saleReturnOrder/delete?id="+t.id,aclass:"btn-link pd-m rect-s mr--4",alertTitle:"确认删除?",alertMsg:"删除后将无法恢复,确认删除?",ngClick:"$root.goTo('#/saleReturnOrder/query.html')"},e.canShowButton(r)&&a.push(r),a}};return e}function r(t){var e={getHanShuiDanJian:function(e){var a;return a=t.numberDiv(e.discountRate,100),a=t.numberMul(e.strike_price,a)},getWuSuiDanJian:function(a){var r;return r=t.numberDiv(a.tax,100),r=1+r,r=t.numberDiv(e.getHanShuiDanJian(a),r)},getWuSuiJinE:function(a,r){var n;return n=e.getWuSuiDanJian(a),n=r?t.numberMul(n,a.planQuantity):t.numberMul(n,a.quantity)},getSuiE:function(a,r){var n,i=e.getWuSuiDanJian(a);return r?(i=t.numberMul(i,a.planQuantity),n=e.getJiaSuiHeJi(a,r),i=t.numberSub(n,i)):(i=t.numberMul(i,a.quantity),n=e.getJiaSuiHeJi(a),i=t.numberSub(n,i))},getJiaSuiHeJi:function(a,r){var n;return n=e.getHanShuiDanJian(a),n=r?t.numberMul(n,a.planQuantity):t.numberMul(n,a.quantity)}};return e}function n(t){var e={getWuSuiDanJian:function(e){var a;return a=t.numberDiv(e.tax,100),a=1+a,a=t.numberDiv(e.strike_price,a)},getWuSuiJinE:function(a){var r;return r=e.getWuSuiDanJian(a),r=t.numberMul(r,a.quantity)},getJiaSuiHeJi:function(e){var a;return a=t.numberMul(e.strike_price,e.quantity)}};return e}function i(t){var e={getWuSuiDanJian:function(e){var a;return a=t.numberDiv(e.taxRate,100),a=1+a,a=t.numberDiv(e.purchasePrice,a)},getWuSuiJinE:function(a){var r;return r=e.getWuSuiDanJian(a),r=t.numberMul(r,a.quantity)},getJiaSuiHeJi:function(e){var a;return a=t.numberMul(e.purchasePrice,e.quantity)}};return e}function o(t){var e={parseVariableMenuList:function(e,a){if(!e)return e;for(var r=[],n=0;n<e.length;n++){var i=$.extend(!0,{},e[n]);for(var o in i){var s=t.parseVariableString(i[o],a);i[o]=s}r.push(i)}return r}};return e}angular.module("manageApp.project").factory("customMenuUtils",["utils",o]).factory("saleOrderUtils",["utils",r]).factory("purchaseOrderUtils",["utils",n]).factory("requestPurchaseOrderUtils",["utils",i]).factory("bottomButtonList",["$rootScope",e]).factory("queryItemCardButtonList",["$rootScope",a]).factory("proMessageTips",[t])}),define("upload/directives",["upload/init"],function(){function t(){return{restrict:"EA",scope:{ngModel:"=",uploadMax:"@",uploadSize:"@",width:"@",height:"@"},replace:!0,templateUrl:Config.tplPath+"tpl/uploader.html",link:function(t,e,a){function r(){for(var e=o[0].files,a=0,r=e.length;a<r;a++){if(e[a].size/1024>t.uploadSize)return void alert("文件大小不能超过 "+t.uploadSize+" K");switch(s){case"*":var n={status:"uploading",file:e[a],progress:0,text:"上传中...",name:e[a].name,data:{}};t.fileList.push(n),i(n);break;case"image":if(/image/g.test(e[a].type)){var n={status:"uploading",file:e[a],progress:0,text:"上传中...",name:e[a].name,data:{},imgSrc:window.URL.createObjectURL(new Blob([e[a]],{type:e[a].type}))};t.fileList.push(n),t.$digest(),i(n)}else alert("只能上传图片");break;default:if(!e[a].type||new RegExp(s).test(e[a].type)){var n={status:"uploading",file:e[a],progress:0,text:"上传中...",data:{}};t.fileList.push(n),t.$digest(),i(n)}else alert("上传格式错误")}}}function n(e){var a=[],r=t.fileList.indexOf(e);r>-1&&t.fileList.splice(r,1),angular.forEach(t.fileList,function(t,e){a.push(t.data.id)}),t.ngModel=a}function i(e){var r=new XMLHttpRequest,n=new FormData;n.append("fileData",e.file),r.upload.addEventListener("progress",function(a){var r=Math.round(100*a.loaded/a.total);100==r&&(r=99),e.progress=r,t.$digest()},!1),r.addEventListener("load",function(a){var r=angular.fromJson(a.target.responseText);e.progress=100,e.status="finished",e.text="上传成功！",e.data=r.data,t.ngModel.push(r.data.id),t.$apply(),o.val("")},!1),r.addEventListener("loadend",function(a){200!=a.target.status&&(e.status="error",e.text="上传失败！",t.$apply())});var i=a.uploader;Config.serverPath&&0!==i.indexOf("http://")&&0!==i.indexOf("https://")&&(i=Config.serverPath+i),r.open("POST",i),r.withCredentials=!0,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(n)}var o=$('<input type="file" multiple/>'),s=a.uploadType||"image",l=angular.fromJson(a.files||[]);t.fileList=[],t.delFile=n,t.ngModel=t.ngModel||[],t.uploadMax=t.uploadMax||99,t.uploadSize=t.uploadSize||1e4,t.width=t.width?t.width:"120px",t.height=t.height?t.height:"100px",t.styleName=a.styleName||"styleName",angular.forEach(l,function(e){e.data=angular.copy(e),e.status="finished",/\.(jpe?g|png|gif)$/.test(e.url)&&(e.imgSrc=e.url),t.fileList.push(e),t.ngModel.push(e.id)}),t.$parent.resetPic=function(){t.ngModel=[],t.fileList=[]},t.uploadBtn_click=function(){o.trigger("click")};var c=$(".uploadBtn",e);c.on("click",function(){o.trigger("click")}),o.on("change",r)}}}function e(t,e,a){return{restrict:"EA",scope:{ngModel:"=?",upFile:"=?",params:"=?",responseList:"=?",uploadSize:"@",width:"@",height:"@"},link:function(r,n,i){function o(){for(var t=c[0].files,e=0,a=t.length;e<a;e++){if(t[e].size/1024>r.uploadSize)return void alert("文件大小不能超过 "+r.uploadSize+" K");switch(d){case"*":var n={status:"uploading",file:t[e],progress:0,text:"上传中...",name:t[e].name,data:""};r.upFile&&(r.upFile=n),l(n);break;case"image":/image/g.test(t[e].type)?(n={status:"uploading",file:t[e],progress:0,text:"上传中...",name:t[e].name,data:"",imgSrc:window.URL.createObjectURL(new Blob([t[e]],{type:t[e].type}))},r.upFile&&(r.upFile=n),r.$digest(),l(n)):alert("只能上传图片");break;default:!t[e].type||new RegExp(d).test(t[e].type)?(n={status:"uploading",file:t[e],progress:0,text:"上传中...",data:{}},r.upFile&&(r.upFile=n),r.$digest(),l(n)):alert("上传格式错误")}}}function s(t){r.ngModel=""}function l(o){var s=new XMLHttpRequest,l=new FormData;if(angular.isObject(r.params))for(var d in r.params)l.append(d,r.params[d]);i.usege&&l.append("usege",i.usege),l.append("fileData",o.file);var u=null;i.noshowLoading||(u=a(n)),s.upload.addEventListener("progress",function(t){var e=Math.round(100*t.loaded/t.total);100==e&&(e=99),o.progress=e,r.$digest()},!1),s.addEventListener("load",function(a){u&&u.hide(),c.val("");var n=angular.fromJson(a.target.responseText);return angular.isDefined(i.responseList)&&(r.responseList||(r.responseList=[]),n._responseTime=(new Date).getTime(),r.responseList.push(n)),n&&200==n.code?(angular.isDefined(i.alertOk)&&e(n.msg),o.progress=100,o.status="finished",o.text="上传成功！",o.data=n.data,angular.isString(n.data)?r.ngModel=n.data:n.data&&(r.ngModel=n.data.key),r.upFile&&(r.upFile.data=n.data),r.$apply(),i.callback&&r.$parent.$eval(i.callback),void r.$apply()):void t(n.msg||"出错了")},!1),s.addEventListener("loadend",function(t){u&&u.hide(),200!=t.target.status&&(o.status="error",o.text="上传失败！")});var f=i.uploaderOne;Config.serverPath&&0!==f.indexOf("http://")&&0!==f.indexOf("https://")&&(f=Config.serverPath+f),s.open("POST",f),s.withCredentials=!0,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(l)}var c=$('<input type="file"/>'),d=i.uploadType||"*";r.delFile=s,r.ngModel=r.ngModel,r.uploadSize=r.uploadSize||1e4,r.width=r.width?r.width:"120px",r.height=r.height?r.height:"100px",r.styleName=i.styleName||"styleName",r.$parent.resetPic=function(){r.ngModel=[]},n.on("click",function(){c.trigger("click")}),c.on("change",o)}}}angular.module("manageApp.upload").directive("uploaderOne",["alertError","alertOk","proLoading",e]).directive("uploader",t)}),define("upload/init",["angular"],function(){angular.module("manageApp.upload",[])});